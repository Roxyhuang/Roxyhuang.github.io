<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    
    <title>Neo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="Neo">
<meta property="og:type" content="website">
<meta property="og:title" content="Neo">
<meta property="og:url" content="http://www.neohuang.com/child/img/Neo.html">
<meta property="og:site_name" content="Neo">
<meta property="og:description" content="Neo">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://www.neohuang.com/child/img/Neo_files/doge.jpeg">
<meta property="og:image" content="http://www.neohuang.com/child/img/Neo_files/doge.jpeg">
<meta property="og:image" content="http://www.neohuang.com/child/img/Neo_files/npm.jpg">
<meta property="og:image" content="http://www.neohuang.com/child/img/Neo_files/npm-1.png">
<meta property="og:updated_time" content="2018-09-19T08:38:18.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Neo">
<meta name="twitter:description" content="Neo">
<meta name="twitter:image" content="http://www.neohuang.com/child/img/Neo_files/doge.jpeg">
    

    

    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/open-sans/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/2.1.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
    
    


</head>

<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <!--<span class="site-title">Neo</span>-->
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/.">Home</a>
                
                    <a class="main-nav-link" href="/archives">Archives</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="/css/images/doge.jpeg" />
                            <i class="fa fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/.">Home</a></td>
                
                    <td><a class="main-nav-link" href="/archives">Archives</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
                

<aside id="profile">
    <div class="inner profile-inner">
        <div class="base-info profile-block">
            <img id="avatar" src="/css/images/doge.jpeg" />
            <h2 id="name">Neo Huang</h2>
            <h3 id="title">Front End Developer</h3>
            <span id="location"><i class="fa fa-map-marker"></i>Shanghai, China</span>
            <a id="follow" target="_blank" href="https://github.com/Roxyhuang">FOLLOW</a>
        </div>
        <div class="article-info profile-block">
            <div class="article-info-block">
                25
                <span>posts</span>
            </div>
            <div class="article-info-block">
                0
                <span>tag</span>
            </div>
        </div>
        
        <div class="profile-block social-links">
            <table>
                <tr>
                    
                    
                    <td>
                        <a href="https://github.com/Roxyhuang" target="_blank" title="github" class=tooltip>
                            <i class="fa fa-github"></i>
                        </a>
                    </td>
                    
                </tr>
            </table>
        </div>
        
    </div>
</aside>

            
            <section id="main"><article id="page-undefined" class="article article-type-page" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <!DOCTYPE html>
<!-- saved from url=(0022)http://localhost:4000/ -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    
    <title>Neo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta property="og:type" content="website">
<meta property="og:title" content="Neo">
<meta property="og:url" content="http://www.neohuang.com/child/index.html">
<meta property="og:site_name" content="Neo">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Neo">
    

    

    

    <link rel="stylesheet" href="./Neo_files/font-awesome.min.css">
    <link rel="stylesheet" href="./Neo_files/styles.css">
    <link rel="stylesheet" href="./Neo_files/styles(1).css">

    <link rel="stylesheet" href="./Neo_files/style.css">

    <script src="./Neo_files/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="./Neo_files/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="./Neo_files/justifiedGallery.min.css">
    
    
    
    


</head>

<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="http://localhost:4000/" id="logo" target="_blank" rel="noopener">
                <i class="logo"></i>
                <!--<span class="site-title">Neo</span>-->
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="http://localhost:4000/" target="_blank" rel="noopener">Home</a>
                
                    <a class="main-nav-link" href="http://localhost:4000/archives" target="_blank" rel="noopener">Archives</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;" target="_blank" rel="noopener">
                            <img class="avatar" src="./Neo_files/doge.jpeg">
                            <i class="fa fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Buscar">
        <button type="submit" class="search-form-submit"></button>
    </form>
    
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Entradas',
            PAGES: 'Pages',
            CATEGORIES: 'Categorias',
            TAGS: 'Etiquetas',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="./Neo_files/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tbody><tr>
                
                    <td><a class="main-nav-link" href="http://localhost:4000/" target="_blank" rel="noopener">Home</a></td>
                
                    <td><a class="main-nav-link" href="http://localhost:4000/archives" target="_blank" rel="noopener">Archives</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Buscar">
    </div>

                </td>
            </tr>
        </tbody></table>
    </div>
</header>

        <div class="outer">
            
                

<aside id="profile">
    <div class="inner profile-inner">
        <div class="base-info profile-block">
            <img id="avatar" src="./Neo_files/doge.jpeg">
            <h2 id="name">Neo Huang</h2>
            <h3 id="title">Front End Developer</h3>
            <span id="location"><i class="fa fa-map-marker"></i>Shanghai, China</span>
            <a id="follow" target="_blank" href="https://github.com/Roxyhuang">SEGUIR</a>
        </div>
        <div class="article-info profile-block">
            <div class="article-info-block">
                23
                <span>Entradas</span>
            </div>
            <div class="article-info-block">
                0
                <span>Etiqueta</span>
            </div>
        </div>
        
        <div class="profile-block social-links">
            <table>
                <tbody><tr>
                    
                    
                    <td>
                        <a href="https://github.com/Roxyhuang" target="_blank" title="github" class="tooltip">
                            <i class="fa fa-github"></i>
                        </a>
                    </td>
                    
                </tr>
            </tbody></table>
        </div>
        
    </div>
</aside>

            
            <section id="main">
    <article id="post-not-know-js-review-closure" class="article article-type-post" itemscope="" itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="http://localhost:4000/2018/09/19/not-know-js-review-closure/" target="_blank" rel="noopener">你不知道的js复习笔记 (作用域闭包)</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="http://localhost:4000/2018/09/19/not-know-js-review-closure/" target="_blank" rel="noopener">
            <time datetime="2018-09-18T16:00:00.000Z" itemprop="datePublished">2018-09-19</time>
        </a>
    </div>


                        
                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody" lg-uid="lg0">
        
            
            <h2 id="第一部分-作用域和闭包之函数作用域与块级作用域"><a href="http://localhost:4000/#%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86-%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E9%97%AD%E5%8C%85%E4%B9%8B%E5%87%BD%E6%95%B0%E4%BD%9C%E7%94%A8%E5%9F%9F%E4%B8%8E%E5%9D%97%E7%BA%A7%E4%BD%9C%E7%94%A8%E5%9F%9F" class="headerlink" title="第一部分 作用域和闭包之函数作用域与块级作用域" target="_blank" rel="noopener"></a>第一部分 作用域和闭包之函数作用域与块级作用域</h2><p>参考： 《你不知道的javascript—上卷》 第一部分</p>
<p>在读该章节前，发现是闭包，哎哟，又是你。。。。</p>
<h3 id="一、闭包实质"><a href="http://localhost:4000/#%E4%B8%80%E3%80%81%E9%97%AD%E5%8C%85%E5%AE%9E%E8%B4%A8" class="headerlink" title="一、闭包实质" target="_blank" rel="noopener"></a>一、闭包实质</h3><p><strong>书中定义</strong>：当函数可以记住并访问所在的词法作用域时，就产生了闭包，即使函数是在当前词法作用 域之外执行。</p>
<h4 id="1-闭包例子"><a href="http://localhost:4000/#1-%E9%97%AD%E5%8C%85%E4%BE%8B%E5%AD%90" class="headerlink" title="1.闭包例子" target="_blank" rel="noopener"></a>1.闭包例子</h4><p><code>`</code>javascript<br>function foo() { var a = 2;<br>    function bar() {<br>        console.log( a );<br>    }<br>    return bar;<br>}<br>var baz = foo();<br>baz(); // 2 —— 朋友，这就是闭包的效果。<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">函数 bar() 的词法作用域能够访问 foo() 的内部作用域。然后我们将 bar() 函数本身当作 一个值类型进行传递。在这个例子中，我们将 bar 所引用的函数对象本身当作返回值。</span><br><span class="line"></span><br><span class="line">**执行过程：**</span><br><span class="line"></span><br><span class="line">- foo() 执行</span><br><span class="line">- 其返回值(也就是内部的 bar() 函数)赋值给变量 baz // bar函数可以记住并访问所在词法作用域</span><br><span class="line">- 调用 baz()</span><br><span class="line">- 执行bar() (在自己定义的词法作用域以外的地方 执行)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**进一步解析**</span><br><span class="line"></span><br><span class="line">- 在 foo() 执行后，通常会期待 foo() 的整个内部作用域都被销毁，因为我们知道引擎有垃圾回收器用来释放不再使用的内存空间。由于看上去 foo() 的内容不会再被使用，所以很 自然地会考虑对其进行**回收**。</span><br><span class="line">
- 而闭包的“神奇”之处正是可以阻止这件事情的发生。事实上内部作用域依然存在，因此 没有被回收。谁在使用这个内部作用域?原来是 bar() 本身在使用。

- 拜bar() 所声明的位置所赐，它拥有涵盖 foo() 内部作用域的闭包，使得该作用域能够一 直存活，以供 bar() 在之后任何时间进行引用。
bar() 依然持有对该作用域的引用，而这个引用就叫作闭包。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### 2.另外一个反例（某种意义上）</span><br><span class="line"></span><br><span class="line">```javascript
function foo() { </span><br><span class="line">	var a = 2;
	function bar() { </span><br><span class="line">		console.log( a ); // 2
	}
	bar(); </span><br><span class="line">}
foo();</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>这是闭包吗?</p>
<p>技术上来讲，<strong>也许是</strong>。但根据前面的定义，<strong>确切地说并不是</strong>。</p>
<ul>
<li>foo() 执行</li>
<li>其返回值(也就是内部的 bar() 函数)赋值给变量 baz // bar函数可以记住并访问所在词法作用域</li>
<li>调用 baz()</li>
<li>执行bar() (没有在自己定义的词法作用域以外的地方 执行)</li>
</ul>
<h4 id="3-其他类型对函数类型的值进行传递的例子："><a href="http://localhost:4000/#3-%E5%85%B6%E4%BB%96%E7%B1%BB%E5%9E%8B%E5%AF%B9%E5%87%BD%E6%95%B0%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%80%BC%E8%BF%9B%E8%A1%8C%E4%BC%A0%E9%80%92%E7%9A%84%E4%BE%8B%E5%AD%90%EF%BC%9A" class="headerlink" title="3.其他类型对函数类型的值进行传递的例子：" target="_blank" rel="noopener"></a>3.其他类型对函数类型的值进行传递的例子：</h4><h5 id="1-通过回调传递"><a href="http://localhost:4000/#1-%E9%80%9A%E8%BF%87%E5%9B%9E%E8%B0%83%E4%BC%A0%E9%80%92" class="headerlink" title="(1)通过回调传递" target="_blank" rel="noopener"></a>(1)通过回调传递</h5><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>{ </span><br><span class="line">	<span class="keyword">var</span> a = <span class="number">2</span>;
	<span class="function"><span class="keyword">function</span> <span class="title">baz</span>(<span class="params"></span>) </span>{ </span><br><span class="line">		<span class="built_in">console</span>.log( a ); <span class="comment">// 2</span>
	}
	bar( baz ); </span><br><span class="line">}
<span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params">fn</span>) </span>{
	fn(); <span class="comment">// 妈妈快看呀，这就是闭包!</span>
}</span><br><span class="line"></span><br><span class="line">foo();</span><br></pre></td></tr></tbody></table></figure>
<p><strong>执行过程：</strong></p>
<ul>
<li>foo()</li>
<li>bar()执行，并将baz引用通过回调的方式传递给bar作为回调执行 baz可以记住可以记住并访问所在词法作用域</li>
<li>bar()执行  (在自己定义的词法作用域以外的地方 执行)</li>
</ul>
<h5 id="2-间接传递参数"><a href="http://localhost:4000/#2-%E9%97%B4%E6%8E%A5%E4%BC%A0%E9%80%92%E5%8F%82%E6%95%B0" class="headerlink" title="(2)间接传递参数" target="_blank" rel="noopener"></a>(2)间接传递参数</h5><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fn;
<span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>{
	<span class="keyword">var</span> a = <span class="number">2</span>;
	<span class="function"><span class="keyword">function</span> <span class="title">baz</span>(<span class="params"></span>) </span>{</span><br><span class="line">	 <span class="built_in">console</span>.log( a );
	}
	fn = baz; <span class="comment">//将baz分配给全局变量 </span></span><br><span class="line">}</span><br><span class="line">
<span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>{
	fn(); <span class="comment">// 妈妈快看呀，这就是闭包!</span>
}

foo();
bar(); <span class="comment">// 2</span></span><br></pre></td></tr></tbody></table></figure>
<p><strong>执行过程：</strong></p>
<ul>
<li>foo()</li>
<li>fn = baz; 将baz分配给全局变量fn</li>
<li>bar()执行，fn即baz以记住可以记住并访问所在词法作用域</li>
<li>bar()执行  (即baz在自己定义的词法作用域以外的地方执行)</li>
</ul>
<h3 id="二、闭包无处不在"><a href="http://localhost:4000/#%E4%BA%8C%E3%80%81%E9%97%AD%E5%8C%85%E6%97%A0%E5%A4%84%E4%B8%8D%E5%9C%A8" class="headerlink" title="二、闭包无处不在" target="_blank" rel="noopener"></a>二、闭包无处不在</h3><p>你已经写过的代码中一定到处都是闭包的身影。 现在让我们来搞懂这个事实。</p>
<p><strong>例子1:</strong></p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">wait</span>(<span class="params">message</span>) </span>{
   setTimeout( <span class="function"><span class="keyword">function</span> <span class="title">timer</span>(<span class="params"></span>) </span>{
      <span class="built_in">console</span>.log( message );</span><br><span class="line">   }, <span class="number">1000</span> ); </span><br><span class="line">}</span><br><span class="line">      
wait( <span class="string">"Hello, closure!"</span> );</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>wait() 执行</li>
<li>setTimeout执行 timer 具有涵盖 wait(..) 作用域，timer可以记住并访问所在词法作用域</li>
<li>timer()执行  (timer在自己定义的词法作用域以外的地方执行)</li>
</ul>
<p><strong>例子2</strong></p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setupBot</span>(<span class="params">name, selector</span>) </span>{
	$( selector ).click( <span class="function"><span class="keyword">function</span> <span class="title">activator</span>(<span class="params"></span>) </span>{
      <span class="built_in">console</span>.log( <span class="string">"Activating: "</span> + name );
	});
}</span><br><span class="line">
setupBot( <span class="string">"Closure Bot 1"</span>, <span class="string">"#bot_1"</span> );
setupBot( <span class="string">"Closure Bot 2"</span>, <span class="string">"#bot_2"</span> );</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>setupBot()执行</li>
<li>将activator函数，绑定到selector，activator可以记住并访问所在词法作用域（setupBot函数）</li>
<li>点击selector，执行activator函数，setupBot的作用域会保留，不会被回收 (activator在自己定义的词法作用域以外的地方执行)</li>
</ul>
<p><strong>总结：</strong></p>
<p>如果将函数(访问它们各自的词法作用域)当作第一 级的值类型并到处传递，你就会看到闭包在这些函数中的应用。在定时器、事件监听器、 Ajax请求、跨窗口通信、Web Workers或者任何其他的异步(或者同步)任务中，只要使 用了回调函数，实际上就是在使用闭包!</p>
<h3 id="三、IIFE"><a href="http://localhost:4000/#%E4%B8%89%E3%80%81IIFE" class="headerlink" title="三、IIFE" target="_blank" rel="noopener"></a>三、IIFE</h3><p>通常认为 IIFE 是典型的闭包例子，但根据先前对 闭包的定义，书上并不是很同意这个观点。</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">2</span>;
(<span class="function"><span class="keyword">function</span> <span class="title">IIFE</span>(<span class="params"></span>) </span>{ </span><br><span class="line">	<span class="built_in">console</span>.log( a );
})();</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>虽然这段代码可以正常工作，但严格来讲它并不是闭包。</li>
<li>IIFE不是在它本身的词法作用域以外执行的。它在定义时所在的作用域中执行</li>
<li>a 是通过普通的词法作用域查找而非闭包被发 现的。</li>
</ul>
<h3 id="四、循环和闭包"><a href="http://localhost:4000/#%E5%9B%9B%E3%80%81%E5%BE%AA%E7%8E%AF%E5%92%8C%E9%97%AD%E5%8C%85" class="headerlink" title="四、循环和闭包" target="_blank" rel="noopener"></a>四、循环和闭包</h3><p>要说明闭包，for 循环是最常见的例子。</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">1</span>; i&lt;=<span class="number">5</span>; i++) { </span><br><span class="line">	setTimeout( <span class="function"><span class="keyword">function</span> <span class="title">timer</span>(<span class="params"></span>) </span>{
      <span class="built_in">console</span>.log( i ); <span class="comment">// 输出5个6</span>
   }, i*<span class="number">1000</span> );
}</span><br></pre></td></tr></tbody></table></figure>
<p>正常情况下，我们对这段代码行为的预期是分别输出数字 1~5，每秒一次，每次一个。<br>但实际上，这段代码在运行时会以每秒一次的频率输出五次 6。</p>
<h3 id="五、重返块作用域"><a href="http://localhost:4000/#%E4%BA%94%E3%80%81%E9%87%8D%E8%BF%94%E5%9D%97%E4%BD%9C%E7%94%A8%E5%9F%9F" class="headerlink" title="五、重返块作用域" target="_blank" rel="noopener"></a>五、重返块作用域</h3><h3 id="六、模块"><a href="http://localhost:4000/#%E5%85%AD%E3%80%81%E6%A8%A1%E5%9D%97" class="headerlink" title="六、模块" target="_blank" rel="noopener"></a>六、模块</h3><h3 id="七、现代的模块机制"><a href="http://localhost:4000/#%E4%B8%83%E3%80%81%E7%8E%B0%E4%BB%A3%E7%9A%84%E6%A8%A1%E5%9D%97%E6%9C%BA%E5%88%B6" class="headerlink" title="七、现代的模块机制" target="_blank" rel="noopener"></a>七、现代的模块机制</h3><h3 id="八、未来的模块化机制"><a href="http://localhost:4000/#%E5%85%AB%E3%80%81%E6%9C%AA%E6%9D%A5%E7%9A%84%E6%A8%A1%E5%9D%97%E5%8C%96%E6%9C%BA%E5%88%B6" class="headerlink" title="八、未来的模块化机制" target="_blank" rel="noopener"></a>八、未来的模块化机制</h3>
        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://www.neohuang.com/child/2018/09/19/not-know-js-review-closure/" data-id="cjm8w7vkh000okam7odrsvugb" class="article-share-link"><i class="fa fa-share"></i>Compartir</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            <!--
    
        <a href="http://www.neohuang.com/child/2018/09/19/not-know-js-review-closure/#comments" class="article-comment-link">Comentarios</a>
    
-->
        </footer>
    </div>
    
</article>



    <article id="post-not-know-js-review-fp-scope-block-scope" class="article article-type-post" itemscope="" itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="http://localhost:4000/2018/09/13/not-know-js-review-fp-scope-block-scope/" target="_blank" rel="noopener">你不知道的js复习笔记 (词法作用域)</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="http://localhost:4000/2018/09/13/not-know-js-review-fp-scope-block-scope/" target="_blank" rel="noopener">
            <time datetime="2018-09-12T16:00:00.000Z" itemprop="datePublished">2018-09-13</time>
        </a>
    </div>


                        
                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody" lg-uid="lg1">
        
            
            <h2 id="第一部分-作用域和闭包之函数作用域与块级作用域"><a href="http://localhost:4000/#%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86-%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E9%97%AD%E5%8C%85%E4%B9%8B%E5%87%BD%E6%95%B0%E4%BD%9C%E7%94%A8%E5%9F%9F%E4%B8%8E%E5%9D%97%E7%BA%A7%E4%BD%9C%E7%94%A8%E5%9F%9F" class="headerlink" title="第一部分 作用域和闭包之函数作用域与块级作用域" target="_blank" rel="noopener"></a>第一部分 作用域和闭包之函数作用域与块级作用域</h2><p>参考： 《你不知道的javascript—上卷》 第一部分    </p>
<h3 id="1-函数中的作用域"><a href="http://localhost:4000/#1-%E5%87%BD%E6%95%B0%E4%B8%AD%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F" class="headerlink" title="1.函数中的作用域" target="_blank" rel="noopener"></a>1.函数中的作用域</h3><h4 id="1-函数作用域的概念"><a href="http://localhost:4000/#1-%E5%87%BD%E6%95%B0%E4%BD%9C%E7%94%A8%E5%9F%9F%E7%9A%84%E6%A6%82%E5%BF%B5" class="headerlink" title="(1) 函数作用域的概念" target="_blank" rel="noopener"></a>(1) 函数作用域的概念</h4><p>JavaScript 具有基于函数的作用域</p>
<p>函数作用域的含义是指，属于这个函数的全部变量都可以在整个函数的范围内使用及复 用(事实上在嵌套的作用域中也可以使用)</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">a</span>) </span>{</span><br><span class="line">	<span class="keyword">var</span> b = <span class="number">2</span>;</span><br><span class="line">	<span class="comment">// some code</span></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>{</span><br><span class="line">		<span class="comment">// some code</span></span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">var</span> c = <span class="number">3</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>上例就创建了2个函数作用域 foo() bar()以及一个全局用域，foo作用域包含了 a b bar c</p>
<p>bar(..) 拥有自己的作用域气泡。全局作用域也有自己的作用域气泡，它只包含了一个标 识符:foo。</p>
<h4 id="2-隐藏内部实现"><a href="http://localhost:4000/#2-%E9%9A%90%E8%97%8F%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0" class="headerlink" title="(2)隐藏内部实现" target="_blank" rel="noopener"></a>(2)隐藏内部实现</h4><p>我们可以通过函数作用域来隐藏不想暴露给外部的方法，从而实现最小特权原则</p>
<p><strong>ps. 最小特权原则是指在软件设计中，应该最小限度地暴露必 要内容，而将其他内容都“隐藏”起来，比如某个模块或对象的 API 设计。</strong></p>
<p>例：</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">function doSomething(a) {
	b = a + doSomethingElse( a * 2 );
	console.log( b * 3 );
}
function doSomethingElse(a) { </span><br><span class="line">	return a - 1;
}
var b;
doSomething( 2 ); // 15</span><br></pre></td></tr></tbody></table></figure>
<p>实际没有必要暴露 var b 以及 doSomethingElse给到全局作用域</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doSomething</span>(<span class="params">a</span>) </span>{ </span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">doSomethingElse</span>(<span class="params">a</span>) </span>{
		<span class="keyword">return</span> a - <span class="number">1</span>; </span><br><span class="line">	}
	<span class="keyword">var</span> b;
	b = a + doSomethingElse( a * <span class="number">2</span> );
   <span class="built_in">console</span>.log( b * <span class="number">3</span> );
 }
     doSomething( <span class="number">2</span> ); <span class="comment">// 15</span></span><br></pre></td></tr></tbody></table></figure>
<p>功能性和最终效果都没有受影响，但是设计上将具体内容私有化了，设计良好的软件都会 依此进行实现。</p>
<h4 id="3-规避冲突"><a href="http://localhost:4000/#3-%E8%A7%84%E9%81%BF%E5%86%B2%E7%AA%81" class="headerlink" title="(3)规避冲突" target="_blank" rel="noopener"></a>(3)规避冲突</h4><p>“隐藏”作用域中的变量和函数所带来的另一个好处，是可以避免同名标识符之间的冲突</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>{ </span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params">a</span>) </span>{
		i = <span class="number">3</span>; <span class="comment">// 修改for循环所属作用域中的i</span>
    	<span class="built_in">console</span>.log( a + i );       </span><br><span class="line">   }
	<span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="number">10</span>; i++) {
		bar( i * <span class="number">2</span> ); <span class="comment">// 糟糕，无限循环了!</span>
	} </span><br><span class="line">}
foo();</span><br></pre></td></tr></tbody></table></figure>
<h5 id="1-改名"><a href="http://localhost:4000/#1-%E6%94%B9%E5%90%8D" class="headerlink" title="[1] 改名" target="_blank" rel="noopener"></a>[1] 改名</h5><p>将i=0; 改为 j = 0，是软件设计在某种情况下可能自然 而然地要求使用同样的标识符名称，因此在这种情况下使用作用域来“隐藏”内部声明是 唯一的最佳选择。</p>
<h5 id="2-函数作用域隐藏"><a href="http://localhost:4000/#2-%E5%87%BD%E6%95%B0%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%9A%90%E8%97%8F" class="headerlink" title="[2] 函数作用域隐藏" target="_blank" rel="noopener"></a>[2] 函数作用域隐藏</h5><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>{ </span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params">a</span>) </span>{
		<span class="keyword">var</span> i = <span class="number">3</span>; <span class="comment">// 修改for循环所属作用域中的i</span>
    	<span class="built_in">console</span>.log( a + i );       </span><br><span class="line">   }
	<span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="number">10</span>; i++) {
		bar( i * <span class="number">2</span> ); <span class="comment">// 糟糕，无限循环了!</span>
	} </span><br><span class="line">}
foo();</span><br></pre></td></tr></tbody></table></figure>
<h5 id="3-全局命名空间"><a href="http://localhost:4000/#3-%E5%85%A8%E5%B1%80%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4" class="headerlink" title="[3] 全局命名空间" target="_blank" rel="noopener"></a>[3] 全局命名空间</h5><p>变量冲突的一个典型例子存在于全局作用域中。当程序中加载了多个第三方库时,这些库通常会在全局作用域中声明一个名字足够独特的变量来作为命名空间，所有需要暴露给外界的功能都会成为这个对象(命名空间)的属 性，而不是将自己的标识符暴漏在顶级的词法作用域中。</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> MyReallyCoolLibrary = {</span><br><span class="line"> awesome: <span class="string">"stuff"</span>, </span><br><span class="line"> doSomething: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
	<span class="comment">// ... </span></span><br><span class="line"> },
 <span class="attr">doAnotherThing</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
   <span class="comment">// ...</span>
   函数作用域和块作用域 | <span class="number">25</span></span><br><span class="line"> } </span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<h5 id="4-模块管理"><a href="http://localhost:4000/#4-%E6%A8%A1%E5%9D%97%E7%AE%A1%E7%90%86" class="headerlink" title="[4] 模块管理" target="_blank" rel="noopener"></a>[4] 模块管理</h5><p>另外一种避免冲突的办法和现代的模块机制很接近，就是从众多模块管理器中挑选一个来 使用。使用这些工具，任何库都无需将标识符加入到全局作用域中，而是通过依赖管理器 的机制将库的标识符显式地导入到另外一个特定的作用域中。</p>
<h4 id="2-深入函数作用域"><a href="http://localhost:4000/#2-%E6%B7%B1%E5%85%A5%E5%87%BD%E6%95%B0%E4%BD%9C%E7%94%A8%E5%9F%9F" class="headerlink" title="(2) 深入函数作用域" target="_blank" rel="noopener"></a>(2) 深入函数作用域</h4><p><code>`</code><br>var a = 2;<br>function foo() {<br>     // &lt;– 添加这一行<br>    var a = 3;<br>    console.log( a ); // 3<br>}  // &lt;– 以及这一行<br>foo(); // &lt;– 以及这一行<br>console.log( a ); // 2<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">这种方式通过foo，形成了一个函数作用域，完成了隐藏内部实现，但他仍存在两个问题</span><br><span class="line"></span><br><span class="line">1. 必须声明一个具名函数 foo()，意味着 foo 这个名称本身“污染”了所在作用域(</span><br><span class="line">2. 必须显式地通过函数名(foo())调用这个函数才能运行其 中的代码。</span><br><span class="line"></span><br><span class="line">JavaScript 提供了能够同时解决这两个问题的方案: IIFE</span><br><span class="line"></span><br><span class="line">```javascript</span><br><span class="line">(function foo(){ // &lt;-- 添加这一行 var a = 3;
	console.log( a ); // 3 </span><br><span class="line">})(); // &lt;-- 以及这一行 console.log( a ); // 2</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>解析：</p>
<ul>
<li><p>包装函数的声明以 (function… 而不仅是以 function… ，因此是一个函数表达式，不是函数声明</p>
</li>
<li><p>两者区别第一个片段中 foo 被绑定在所在作用域中，第二个片段中 foo 被绑定在函数表达式自身的函数中而不是所在作用域中。</p>
</li>
<li>前者可以直接foo()调用，后者不可以</li>
</ul>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">(function(){</span><br><span class="line">  console.log(123);</span><br><span class="line">})()</span><br><span class="line"></span><br><span class="line">// 相当于</span><br><span class="line"></span><br><span class="line">var __ox123 = function() {</span><br><span class="line">	console.log(123);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">__ox123(); // 编译器无法直接调用 ,并且该函数由于是匿名的无法使用名称递归</span><br><span class="line"></span><br><span class="line"> (function foo(){</span><br><span class="line">  console.log(123);</span><br><span class="line">})()</span><br><span class="line"></span><br><span class="line"> var __ox234 = function() foo{</span><br><span class="line">	console.log(234);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"> __ox234(); 编译器无法直接调用 ,并且foo函数由于是具名的的无法使用名称递归</span><br></pre></td></tr></tbody></table></figure>
<p><strong>衍生知识 – 如何判断函数表达式和表述声明：</strong></p>
<p>function 关键字是声明中的一个词，就代表为函数声明语句，因此就是一个函数声明，否则就是一个函数表达式。</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{} <span class="comment">// 函数声明</span></span><br><span class="line"></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{}) <span class="comment">//函数表达式</span></span><br><span class="line"></span><br><span class="line">-<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>{} <span class="comment">//函数表达式</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="3-匿名和具名函数"><a href="http://localhost:4000/#3-%E5%8C%BF%E5%90%8D%E5%92%8C%E5%85%B7%E5%90%8D%E5%87%BD%E6%95%B0" class="headerlink" title="(3) 匿名和具名函数" target="_blank" rel="noopener"></a>(3) 匿名和具名函数</h4><p>[1] 匿名函数</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"> setTimeout( <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
         <span class="built_in">console</span>.log(<span class="string">"I waited 1 second!"</span>);
}, <span class="number">1000</span> );</span><br></pre></td></tr></tbody></table></figure>
<p><strong>这叫作匿名函数表达式，因为 function().. 没有名称标识符。函数表达式可以是匿名的，<br>而函数声明则不可以省略函数名——在 JavaScript 的语法中这是非法的。</strong></p>
<p>缺点：</p>
<ul>
<li>匿名函数在栈追踪中不会显示出有意义的函数名，使得调试很困难。</li>
<li>如果没有函数名，当函数需要引用自身时只能使用已经过期的arguments.callee引用， 比如在递归中。另一个函数需要引用自身的例子，是在事件触发后事件监听器需要解绑 自身。</li>
<li>匿名函数省略了对于代码可读性/可理解性很重要的函数名。一个描述性的名称可以让 代码不言自明。</li>
</ul>
<p>[2] 行内函数表达式</p>
<p>行内函数表达式非常强大且有用——匿名和具名之间的区别并不会对这点有任何影响。给函 数表达式指定一个函数名可以有效解决以上问题。始终给函数表达式命名是一个最佳实践:</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">setTimeout( function timeoutHandler() {</span><br><span class="line"> // &lt;-- 快看，我有名字了! </span><br><span class="line"> console.log( "I waited 1 second!" );
}, 1000 );</span><br></pre></td></tr></tbody></table></figure>
<h4 id="4-立即执行函数"><a href="http://localhost:4000/#4-%E7%AB%8B%E5%8D%B3%E6%89%A7%E8%A1%8C%E5%87%BD%E6%95%B0" class="headerlink" title="(4) 立即执行函数" target="_blank" rel="noopener"></a>(4) 立即执行函数</h4><h5 id="1-IIFE"><a href="http://localhost:4000/#1-IIFE" class="headerlink" title="[1] IIFE" target="_blank" rel="noopener"></a>[1] IIFE</h5><p>IIFE，代表立即执行函数表达式：</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var a = 2;
(function foo() {</span><br><span class="line"> var a = 3;
 console.log( a ); // 3      </span><br><span class="line">})();
 console.log( a ); // 2</span><br></pre></td></tr></tbody></table></figure>
<p>由于函数被包含在一对 ( ) 括号内部，因此成为了一个表达式，通过在末尾加上另外一个 ( ) 可以立即执行这个函数，比如 (function foo(){ .. })()。第一个 ( ) 将函数变成表 达式，第二个 ( ) 执行了这个函数。</p>
<p>相较于传统的 IIFE 形式，很多人都更喜欢另一个改进的形式:(function(){ .. }())，这两种形式在功能上是一致的。选择哪个全凭个人喜好。</p>
<h5 id="2-传递参数"><a href="http://localhost:4000/#2-%E4%BC%A0%E9%80%92%E5%8F%82%E6%95%B0" class="headerlink" title="[2] 传递参数" target="_blank" rel="noopener"></a>[2] 传递参数</h5><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">2</span>;
(<span class="function"><span class="keyword">function</span> <span class="title">IIFE</span>(<span class="params"> global </span>) </span>{
	<span class="keyword">var</span> a = <span class="number">3</span>;
	<span class="built_in">console</span>.log( a ); <span class="comment">// 3 console.log( global.a ); // 2</span>
})( <span class="built_in">window</span> );
<span class="built_in">console</span>.log( a ); <span class="comment">// 2</span></span><br></pre></td></tr></tbody></table></figure>
<p>我们将 window 对象的引用传递进去，但将参数命名为 global，可以从外部作用域传递任何你需要的东西，并将变量命名为任何你觉得合适的名字这对于改进代码风格是非 常有帮助的。</p>
<h5 id="3-解决undefined标识符的默认值被错误覆盖导致的异常"><a href="http://localhost:4000/#3-%E8%A7%A3%E5%86%B3undefined%E6%A0%87%E8%AF%86%E7%AC%A6%E7%9A%84%E9%BB%98%E8%AE%A4%E5%80%BC%E8%A2%AB%E9%94%99%E8%AF%AF%E8%A6%86%E7%9B%96%E5%AF%BC%E8%87%B4%E7%9A%84%E5%BC%82%E5%B8%B8" class="headerlink" title="[3]解决undefined标识符的默认值被错误覆盖导致的异常" target="_blank" rel="noopener"></a>[3]解决undefined标识符的默认值被错误覆盖导致的异常</h5><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">undefined</span> = <span class="literal">true</span>; <span class="comment">// 给其他代码挖了一个大坑!绝对不要这样做! (function IIFE( undefined ) {</span>
	<span class="keyword">var</span> a;
	<span class="keyword">if</span> (a === <span class="literal">undefined</span>) {
         <span class="built_in">console</span>.log( <span class="string">"Undefined is safe here!"</span> );
   }
})();</span><br></pre></td></tr></tbody></table></figure>
<h5 id="4-倒置代码的运行顺序"><a href="http://localhost:4000/#4-%E5%80%92%E7%BD%AE%E4%BB%A3%E7%A0%81%E7%9A%84%E8%BF%90%E8%A1%8C%E9%A1%BA%E5%BA%8F" class="headerlink" title="[4]倒置代码的运行顺序" target="_blank" rel="noopener"></a>[4]倒置代码的运行顺序</h5><p>IFE 还有一种变化的用途是倒置代码的运行顺序，将需要运行的函数放在第二位，在 IIFE 执行之后当作参数传递进去。这种模式在 UMD(Universal Module Definition)项目中被广 泛使用。尽管这种模式略显冗长，但有些人认为它更易理解。</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">2</span>;
<span class="comment">// 函数作用域和块作用域 | 29</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span> <span class="title">IIFE</span>(<span class="params"> def </span>) </span>{ </span><br><span class="line">	def( <span class="built_in">window</span> );
})(<span class="function"><span class="keyword">function</span> <span class="title">def</span>(<span class="params"> global </span>) </span>{
	<span class="keyword">var</span> a = <span class="number">3</span>;
	<span class="built_in">console</span>.log( a ); <span class="comment">// 3 console.log( global.a ); // 2</span>
});</span><br></pre></td></tr></tbody></table></figure>
<h4 id="5-块作用域"><a href="http://localhost:4000/#5-%E5%9D%97%E4%BD%9C%E7%94%A8%E5%9F%9F" class="headerlink" title="(5) 块作用域" target="_blank" rel="noopener"></a>(5) 块作用域</h4><p>尽管函数作用域是最常见的作用域单元，但其他类型的作用域单元也是存在的</p>
<p>js中：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="number">10</span>; i++) { </span><br><span class="line">	<span class="built_in">console</span>.log( i ); <span class="regexp">/ 1 2 3 4 5 6 7 8 9
}</span></span><br><span class="line"><span class="regexp">console.log(i); /</span><span class="regexp">/ 10</span></span><br></pre></td></tr></tbody></table></figure>
<p>c++中：</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">   <span class="keyword">int</span> i = <span class="number">1</span>;	</span><br><span class="line">   <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) {</span><br><span class="line">      <span class="built_in">cout</span> &lt;&lt; i; / <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span></span><br><span class="line">   }</span><br><span class="line">	</span><br><span class="line">   <span class="built_in">cout</span> &lt;&lt; i; <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>块作用域是一个用来对之前的最小授权原则进行扩展的工具，将代码从在函数中隐藏信息 扩展为在块中隐藏信息。</p>
<h5 id="1-js中的块级作用域"><a href="http://localhost:4000/#1-js%E4%B8%AD%E7%9A%84%E5%9D%97%E7%BA%A7%E4%BD%9C%E7%94%A8%E5%9F%9F" class="headerlink" title="[1] js中的块级作用域" target="_blank" rel="noopener"></a>[1] js中的块级作用域</h5><p>表面上看 JavaScript 并没有块作用域的相关功能,除非你更加深入地研究。</p>
<h6 id="1-with"><a href="http://localhost:4000/#1-with" class="headerlink" title="(1) with" target="_blank" rel="noopener"></a>(1) with</h6><p>之前有提过with会生成一个词法作用域，因为with本身之后{}是一个语句块，因此用 with 从对象中创建出的作用域仅在 with 声明中而非外 部作用域中有效。</p>
<h6 id="2-try-catch"><a href="http://localhost:4000/#2-try-catch" class="headerlink" title="(2) try/catch" target="_blank" rel="noopener"></a>(2) try/catch</h6><p>JavaScript 的 ES3 规范中规定 try/catch 的 catch 分句会创建一个块作<br>用域，其中声明的变量仅在 catch 内部有效。</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> {
	<span class="literal">undefined</span>(); <span class="comment">// 执行一个非法操作来强制制造一个异常</span>
}
<span class="keyword">catch</span> (err) {
	<span class="built_in">console</span>.log( err ); <span class="comment">// 能够正常执行! </span></span><br><span class="line">}
<span class="built_in">console</span>.log( err ); <span class="comment">// ReferenceError: err not found</span></span><br></pre></td></tr></tbody></table></figure>
<h6 id="3-let"><a href="http://localhost:4000/#3-let" class="headerlink" title="(3) let" target="_blank" rel="noopener"></a>(3) let</h6><ol>
<li>块级作用域</li>
</ol>
<p>ES6 改变了现状，引入了新的 let 关键字，提供了除 var 以外的另一种变量声明方式。</p>
<ul>
<li>隐式声明：</li>
</ul>
<p><code>`</code>javascript<br>var foo = true;<br>if (foo) {<br>    let bar = foo * 2;<br>    bar = something( bar );<br>    console.log( bar );<br>}<br>console.log( bar ); // ReferenceError<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 显示声明：</span><br><span class="line"></span><br><span class="line">显式地创建块可以部分解决这个问题，可以使变量的附属关系变得更加清晰。</span><br><span class="line"></span><br><span class="line">```javascript</span><br><span class="line">var foo = true;</span><br><span class="line">if (foo) {
	{ // &lt;-- 显式的快
		let bar = foo * 2;
		bar = something( bar ); console.log( bar );
	} </span><br><span class="line">}
console.log( bar ); // ReferenceError</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>2.不存在变量提升</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">	<span class="built_in">console</span>.log( bar ); <span class="comment">// ReferenceError! </span></span><br><span class="line">	<span class="keyword">let</span> bar = <span class="number">2</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>3.垃圾收集方面使用let带来的好处</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">process</span>(<span class="params">data</span>) </span>{
<span class="comment">// 在这里做点有趣的事情</span>
}
	<span class="keyword">var</span> someReallyBigData = { .. };
	process( someReallyBigData );
	<span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById( <span class="string">"my_button"</span> );</span><br><span class="line">	<span class="comment">// 此处由于dom引用了process中的监听，形成了闭包</span>
   btn.addEventListener( <span class="string">"click"</span>, <span class="function"><span class="keyword">function</span> <span class="title">click</span>(<span class="params">evt</span>) </span>{
          <span class="built_in">console</span>.log(<span class="string">"button clicked"</span>);
	}, <span class="comment">/*capturingPhase=*/</span><span class="literal">false</span> );</span><br></pre></td></tr></tbody></table></figure>
<p>实际click 函数的点击回调并不需要 someReallyBigData 变量。理论上这意味着当 process(..) 执 行后，在内存中占用大量空间的数据结构就可以被垃圾回收了。但是，由于 click 函数形成 了一个覆盖整个作用域的闭包，JavaScript 引擎极有可能依然保存着这个结构(取决于具体 实现)。</p>
<p>如果使用了块作用域：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">process</span>(<span class="params">data</span>) </span>{
	<span class="comment">// 在这里做点有趣的事情</span>
}
<span class="comment">// 在这个块中定义的内容可以销毁了! </span></span><br><span class="line">{
	<span class="keyword">let</span> someReallyBigData = {</span><br><span class="line">		 .. </span><br><span class="line">	}; </span><br><span class="line">	process( someReallyBigData );
}
<span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById( <span class="string">"my_button"</span> );
btn.addEventListener( <span class="string">"click"</span>, <span class="function"><span class="keyword">function</span> <span class="title">click</span>(<span class="params">evt</span>)</span>{
   <span class="built_in">console</span>.log(<span class="string">"button clicked"</span>);</span><br><span class="line">}, <span class="comment">/*capturingPhase=*/</span><span class="literal">false</span> );</span><br></pre></td></tr></tbody></table></figure>
<p>4.let循环</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">
<span class="keyword">for</span> (<span class="keyword">let</span> i=<span class="number">0</span>; i&lt;<span class="number">10</span>; i++) { </span><br><span class="line">	<span class="built_in">console</span>.log( i );
}
 <span class="built_in">console</span>.log( i ); <span class="comment">// ReferenceError</span></span><br></pre></td></tr></tbody></table></figure>
<p>for 循环头部的 let 不仅将 i 绑定到了 for 循环的块中，事实上它将其重新绑定到了循环 的每一个迭代中，确保使用上一个循环迭代结束时的值重新进行赋值。</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">{
	<span class="keyword">let</span> j;
	<span class="keyword">for</span> (j=<span class="number">0</span>; j&lt;<span class="number">10</span>; j++) {
		<span class="keyword">let</span> i = j; <span class="comment">// 每个迭代重新绑定!</span>
    	<span class="built_in">console</span>.log( i );
  	}
}</span><br></pre></td></tr></tbody></table></figure>
<p>由于 let 声明附属于一个新的作用域而不是当前的函数作用域(也不属于全局作用域)，可能会存在很多陷阱：</p>
<p>例：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = <span class="literal">true</span>, baz = <span class="number">10</span>; </span><br><span class="line"><span class="keyword">if</span> (foo) {
	<span class="keyword">var</span> bar = <span class="number">3</span>;
	<span class="keyword">if</span> (baz &gt; bar) {</span><br><span class="line">	 <span class="built_in">console</span>.log( baz );
	}	
	<span class="comment">// ... </span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>可以重构成</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = <span class="literal">true</span>, baz = <span class="number">10</span>; </span><br><span class="line"><span class="keyword">if</span> (foo) {</span><br><span class="line">	<span class="keyword">var</span> bar = <span class="number">3</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (baz &gt; bar) {</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'baz'</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>但如果是用了let</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = <span class="literal">true</span>, baz = <span class="number">10</span>; </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (foo) {</span><br><span class="line">	<span class="keyword">let</span> bar = <span class="number">3</span>;</span><br><span class="line">	<span class="keyword">if</span> (baz &gt; bar) {</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">'baz'</span>);</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="5-另外一种块作用域形式"><a href="http://localhost:4000/#5-%E5%8F%A6%E5%A4%96%E4%B8%80%E7%A7%8D%E5%9D%97%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%BD%A2%E5%BC%8F" class="headerlink" title="(5)另外一种块作用域形式" target="_blank" rel="noopener"></a>(5)另外一种块作用域形式</h4><h4 id="6-const"><a href="http://localhost:4000/#6-const" class="headerlink" title="(6)const" target="_blank" rel="noopener"></a>(6)const</h4><p>除了 let 以外，ES6 还引入了 const，同样可以用来创建块作用域变量，但其值是固定的 (常量)。之后任何试图修改值的操作都会引起错误。</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = <span class="literal">true</span>;
<span class="keyword">if</span> (foo) {
	<span class="keyword">var</span> a = <span class="number">2</span>;
	<span class="keyword">const</span> b = <span class="number">3</span>; <span class="comment">// 包含在 if 中的块作用域常量</span>
	a = <span class="number">3</span>; <span class="comment">// 正常!</span>
	b = <span class="number">4</span>; <span class="comment">// 错误! </span></span><br><span class="line">}
<span class="built_in">console</span>.log( a ); <span class="comment">// 3</span>
<span class="built_in">console</span>.log( b ); <span class="comment">// ReferenceError!</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="总结"><a href="http://localhost:4000/#%E6%80%BB%E7%BB%93" class="headerlink" title="总结" target="_blank" rel="noopener"></a>总结</h3>
        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://www.neohuang.com/child/2018/09/13/not-know-js-review-fp-scope-block-scope/" data-id="cjm8w7vkn000wkam79yd2askq" class="article-share-link"><i class="fa fa-share"></i>Compartir</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            <!--
    
        <a href="http://www.neohuang.com/child/2018/09/13/not-know-js-review-fp-scope-block-scope/#comments" class="article-comment-link">Comentarios</a>
    
-->
        </footer>
    </div>
    
</article>



    <article id="post-not-know-js-review-lexical-scope " class="article article-type-post" itemscope="" itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="http://localhost:4000/2018/09/13/not-know-js-review-lexical-scope%20/" target="_blank" rel="noopener">你不知道的js复习笔记 (词法作用域)</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="http://localhost:4000/2018/09/13/not-know-js-review-lexical-scope%20/" target="_blank" rel="noopener">
            <time datetime="2018-09-12T16:00:00.000Z" itemprop="datePublished">2018-09-13</time>
        </a>
    </div>


                        
                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody" lg-uid="lg2">
        
            
            <h2 id="第一部分-作用域和闭包之词法作用域"><a href="http://localhost:4000/#%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86-%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E9%97%AD%E5%8C%85%E4%B9%8B%E8%AF%8D%E6%B3%95%E4%BD%9C%E7%94%A8%E5%9F%9F" class="headerlink" title="第一部分 作用域和闭包之词法作用域" target="_blank" rel="noopener"></a>第一部分 作用域和闭包之词法作用域</h2><p>参考： 《你不知道的javascript—上卷》 第一部分    </p>
<h3 id="1-作用域工作模型类型"><a href="http://localhost:4000/#1-%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%9E%8B%E7%B1%BB%E5%9E%8B" class="headerlink" title="1.作用域工作模型类型" target="_blank" rel="noopener"></a>1.作用域工作模型类型</h3><p>作用域共有两种主要的工作模型：</p>
<ul>
<li>词法作用域 ：javascript java</li>
<li>动态作用域 ： Bash, Perl的一部分</li>
</ul>
<h3 id="2-词法作用域"><a href="http://localhost:4000/#2-%E8%AF%8D%E6%B3%95%E4%BD%9C%E7%94%A8%E5%9F%9F" class="headerlink" title="2.词法作用域" target="_blank" rel="noopener"></a>2.词法作用域</h3><p>理解词法作用域及其名称来历，必须理解上篇复习里的编译器的第一个工作阶段叫作词法化的过程。</p>
<h4 id="1-概念："><a href="http://localhost:4000/#1-%E6%A6%82%E5%BF%B5%EF%BC%9A" class="headerlink" title="(1)概念：" target="_blank" rel="noopener"></a>(1)概念：</h4><p>简单地说，<strong>词法作用域就是定义在词法阶段的作用域。</strong></p>
<p>词法作用域是由你在写 代码时将变量和块作用域写在哪里来决定的，因此当词法分析器处理代码时会保持作用域不变。</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function foo(a) {</span><br><span class="line">	var b = a * 2;
	function bar(c) {</span><br><span class="line">	 console.log( a, b, c );
	}
	bar( b * 3 ); </span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">foo( 2 ); // 2, 4, 12</span><br></pre></td></tr></tbody></table></figure>
<p>在这个例子中有三个逐级嵌套的作用域。</p>
<ul>
<li>(1) 全局作用域 包含:foo</li>
<li>(2) foo函数作用域 包含:a bar b </li>
<li>(3) bar函数作用域：c</li>
</ul>
<p>没有任何函数可以部分地同时出现在两个父级函数。</p>
<h4 id="2-和动态作用域的区别"><a href="http://localhost:4000/#2-%E5%92%8C%E5%8A%A8%E6%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E7%9A%84%E5%8C%BA%E5%88%AB" class="headerlink" title="(2) 和动态作用域的区别" target="_blank" rel="noopener"></a>(2) 和动态作用域的区别</h4><p>这部分是书中没有提及的部分（我感觉书中没有直观的表现出词法作用域和动态作用域的区别）</p>
<ul>
<li><p><strong>词法作用域，函数的作用域在函数定义的时候就决定了。</strong></p>
</li>
<li><p><strong>动态作用域，函数的作用域是在函数调用的时候才决定的。</strong></p>
</li>
</ul>
<p>[1] 词法作用域</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> value = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>{</span><br><span class="line">    <span class="built_in">console</span>.log(value);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>{</span><br><span class="line">    <span class="keyword">var</span> value = <span class="number">2</span>;</span><br><span class="line">    foo(); <span class="comment">// 1</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">bar();</span><br></pre></td></tr></tbody></table></figure>
<p>[2] 动态作用域</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">value=1</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">foo</span></span> () {</span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$value</span>;</span><br><span class="line">}</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">bar</span></span> () {</span><br><span class="line">    <span class="built_in">local</span> value=2;</span><br><span class="line">    foo; ／／2</span><br><span class="line">}</span><br><span class="line">bar</span><br></pre></td></tr></tbody></table></figure>
<h4 id="3-查找"><a href="http://localhost:4000/#3-%E6%9F%A5%E6%89%BE" class="headerlink" title="(3) 查找" target="_blank" rel="noopener"></a>(3) 查找</h4><p>[1] 查找过程 </p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function foo(a) {</span><br><span class="line">	var b = a * 2;
	function bar(c) {</span><br><span class="line">	 console.log( a, b, c );
	}
	bar( b * 3 ); </span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">foo( 2 ); // 2, 4, 12</span><br></pre></td></tr></tbody></table></figure>
<p>在这个例子中有三个逐级嵌套的作用域。</p>
<ul>
<li>(1) 全局作用域 包含:foo</li>
<li>(2) foo函数作用域 包含:a bar b </li>
<li>(3) bar函数作用域：c</li>
</ul>
<p>以此例为例</p>
<p>查找a b c 3个变量，过程：</p>
<ul>
<li>执行foo函数</li>
<li>执行bar函数</li>
<li>查找变量 a bc =&gt; bar函数内找到 变量c,变量c标识符时停止</li>
<li>查找变量 a foo函数内找到 变量a,b,变量a,b标识符时停止</li>
</ul>
<p>js引擎会顺着作用域链向上查找变量，作用域查找会在找到第一个匹配的标识符时停止，在多层的嵌套作用域中可以定义同名的 标识符，这叫作“遮蔽效应”(内部的标识符“遮蔽”了外部的标识符)。抛开遮蔽效应， 作用域查找始终从运行时所处的最内部作用域开始，逐级向外或者说向上进行，直到遇见 第一个匹配的标识符为止。</p>
<p>[2] 函数的词法作用域只由函数被声明时所处 的位置决定</p>
<p>[3] 词法作用域查找只会查找一级标识符</p>
<p>比如 a、b 和 c。如果代码中引用了 foo.bar.baz， 词法作用域查找只会试图查找 foo 标识符，找到这个变量后，对象属性访问规则会分别接 管对 bar 和 baz 属性的访问。</p>
<h4 id="4-欺骗词法"><a href="http://localhost:4000/#4-%E6%AC%BA%E9%AA%97%E8%AF%8D%E6%B3%95" class="headerlink" title="(4) 欺骗词法" target="_blank" rel="noopener"></a>(4) 欺骗词法</h4><p>如果词法作用域完全由写代码期间函数所声明的位置来定义，怎样才能在运行时来“修<br>改”(也可以说欺骗)词法作用域呢?</p>
<p>JavaScript 中有两种机制来实现这个目的。社区普遍认为在代码中使用这两种机制并不是 什么好注意。但是关于它们的争论通常会忽略掉最重要的点:欺骗词法作用域会导致性能 下降。</p>
<h5 id="1-eval"><a href="http://localhost:4000/#1-eval" class="headerlink" title="[1] eval" target="_blank" rel="noopener"></a>[1] eval</h5><p><strong>原理：</strong>JavaScript 中的 eval(..) 函数可以接受一个字符串为参数，并将其中的内容视为好像在书 写时就存在于程序中这个位置的代码。</p>
<p>在执行 eval(..) 之后的代码时，引擎并不“知道”或“在意”前面的代码是以动态形式插 入进来，并对词法作用域的环境进行修改的。引擎只会如往常地进行词法作用域查找。</p>
<p>举例：</p>
<p><code>`</code>javascript<br>function foo(str, a) {<br>eval( str ); // 欺骗!<br>console.log( a, b );<br>}<br>var b = 2;<br>foo( “var b = 3;”, 1 ); // 1, 3<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**补充知识**</span><br><span class="line"></span><br><span class="line">- 在这个例子中，为了展示的方便和简洁，我们传递进去的“代码”字符串是 固定不变的。而在实际情况中，可以非常容易地根据程序逻辑动态地将字符 拼接在一起之后再传递进去。eval(..) 通常被用来执行动态创建的代码，因 为像例子中这样动态地执行一段固定字符所组成的代码，并没有比直接将代 码写在那里更有好处。</span><br><span class="line"></span><br><span class="line">- 在严格模式的程序中，eval(..) 在运行时有其自己的词法作用域，意味着其 中的声明无法修改所在的作用域。</span><br><span class="line"></span><br><span class="line">	```javascript
function foo(str) { </span><br><span class="line">		"use strict";
	eval( str );
	console.log( a ); // ReferenceError: a is not de ned
}
foo( "var a = 2" );</span><br></pre></td></tr></tbody></table></figure><p></p>
<p><strong>注意事项：</strong></p>
<ol>
<li><p>setTimeout(..)和 setInterval(..) 也可以模拟类似效果</p>
<p> 他们的第一个参数可以是字符串，字符串的内容可以被解释为一段动态生成的 函数代码。这些功能已经过时且并不被提倡。<strong>不要使用它们!</strong></p>
</li>
<li><p>new Function(..) 函数也可以模拟类似效果</p>
<p> 最后一个参数可以接受代码字符串，并将其转 化为动态生成的函数(前面的参数是这个新生成的函数的形参)。这种构建函数的语法比 eval(..) 略微安全一些，<strong>但也要尽量避免使用</strong>。</p>
</li>
</ol>
<p>在程序中动态生成代码的使用场景非常罕见，因为它所带来的好处无法抵消性能上的损失。</p>
<h5 id="2-with"><a href="http://localhost:4000/#2-with" class="headerlink" title="[2] with" target="_blank" rel="noopener"></a>[2] with</h5><p>with 通常被当作重复引用同一个对象中的多个属性的快捷方式，可以不需要重复引用对象 本身。</p>
<p>例子：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = {</span><br><span class="line">	 a: <span class="number">1</span>,
	 <span class="attr">b</span>: <span class="number">2</span>,
	 <span class="attr">c</span>: <span class="number">3</span> </span><br><span class="line">};
<span class="comment">// 单调乏味的重复 "obj" </span></span><br><span class="line">obj.a = <span class="number">2</span>;
obj.b = <span class="number">3</span>;
obj.c = <span class="number">4</span>;
<span class="comment">// 简单的快捷方式 </span></span><br><span class="line"><span class="keyword">with</span> (obj) {
    a = <span class="number">3</span>;
    b = <span class="number">4</span>;
    c = <span class="number">5</span>;
}</span><br></pre></td></tr></tbody></table></figure>
<p>可以利用这种特性实现：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">obj</span>) </span>{ </span><br><span class="line">	<span class="keyword">with</span> (obj) {
		a = <span class="number">2</span>; </span><br><span class="line">	}
}
<span class="keyword">var</span> o1 = {</span><br><span class="line">	a: <span class="number">3</span>
};
<span class="keyword">var</span> o2 = { </span><br><span class="line">	b: <span class="number">3</span>
};</span><br><span class="line">
foo( o1 );
<span class="built_in">console</span>.log( o1.a ); <span class="comment">// 2</span>
foo( o2 );
<span class="built_in">console</span>.log( o2.a ); <span class="comment">// undefined</span>
<span class="built_in">console</span>.log( a ); <span class="comment">// 2——不好，a 被泄漏到全局作用域上了!</span></span><br></pre></td></tr></tbody></table></figure>
<p>这个例子中创建了 o1 和 o2 两个对象。其中一个具有 a 属性，另外一个没有。foo(..) 函 数接受一个obj参数，该参数是一个对象引用，并对这个对象引用执行了with(obj) {..}。 在 with 块内部，我们写的代码看起来只是对变量 a 进行简单的词法引用，实际上就是一个 LHS 引用(查看第 1 章)，并将 2 赋值给它。</p>
<p><strong>注意事项：</strong></p>
<ul>
<li><p>with 可以将一个没有或有多个属性的对象处理为一个完全隔离的词法作用域</p>
  <figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">	<span class="keyword">with</span> (obj) {
	a = <span class="number">2</span>; </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>o2没有a这个属性，执行到a = 2 赋值操作创建了一个全局的变量 a。这里存在一个副作用<br>with 可以将一个没有或有多个属性的对象处理为一个完全隔离的词法作用域，因此这个对象的属性也会被处理为定义在这个作用域中的词法标识符。</p>
</li>
<li><p>尽管 with 块可以将一个对象处理为词法作用域，但是这个块内部正常的 var 声明并不会被限制在这个块的作用域中，而是被添加到 with 所处的函数作 用域中。</p>
</li>
</ul>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">obj</span>) </span>{</span><br><span class="line">	<span class="comment">// 实际相当于 var a= 2在此处声明 </span></span><br><span class="line">	<span class="keyword">with</span> (obj) {
	<span class="keyword">var</span> a = <span class="number">2</span>; </span><br><span class="line">	}
}</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">obj</span>) </span>{</span><br><span class="line">  a = <span class="number">13</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(a, <span class="string">'&gt;&gt;&gt;&gt; fp'</span>); <span class="comment">// 13</span></span><br><span class="line">  <span class="keyword">with</span> (obj) {</span><br><span class="line">   <span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="keyword">var</span> o1 = {</span><br><span class="line">  a: <span class="number">3</span></span><br><span class="line">};</span><br><span class="line"><span class="keyword">var</span> o2 = {</span><br><span class="line">  b: <span class="number">3</span></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line">foo( o1 );</span><br><span class="line"><span class="built_in">console</span>.log( o1.a ); <span class="comment">// 2</span></span><br><span class="line">foo( o2 );</span><br><span class="line"><span class="built_in">console</span>.log( o2.a ); <span class="comment">// undefined</span></span><br><span class="line"><span class="built_in">console</span>.log( a ); <span class="comment">// undefined</span></span><br></pre></td></tr></tbody></table></figure>
<h5 id="3-eval和with区别"><a href="http://localhost:4000/#3-eval%E5%92%8Cwith%E5%8C%BA%E5%88%AB" class="headerlink" title="[3] eval和with区别" target="_blank" rel="noopener"></a>[3] eval和with区别</h5><p>eval(..) 函数如果接受了含有一个或多个声明的代码，就会修改其所处的词法作用域，而 with 声明实际上是根据你传递给它的对象凭空创建了一个全新的词法作用域。</p>
<h5 id="4-性能"><a href="http://localhost:4000/#4-%E6%80%A7%E8%83%BD" class="headerlink" title="[4] 性能" target="_blank" rel="noopener"></a>[4] 性能</h5><p>JavaScript 引擎会在编译阶段进行数项的性能优化。其中有些优化依赖于能够根据代码的 词法进行静态分析，并预先确定所有变量和函数的定义位置，才能在执行过程中快速找到 标识符。</p>
<p>因此eval(..) 和 with会带来<strong>性能问题</strong>原因：如果引擎在代码中发现了 eval(..) 或 with，它只能简单地假设关于标识符位置的判断 都是无效的，因为无法在词法分析阶段明确知道 eval(..) 会接收到什么代码，这些代码会 如何对作用域进行修改，也无法知道传递给 with 用来创建新词法作用域的对象的内容到底 是什么。</p>
<p>最悲观的情况是如果出现了 eval(..) 或 with，所有的优化可能都是无意义的，因此最简 单的做法就是完全不做任何优化。</p>
<h3 id="重点总结"><a href="http://localhost:4000/#%E9%87%8D%E7%82%B9%E6%80%BB%E7%BB%93" class="headerlink" title="重点总结" target="_blank" rel="noopener"></a>重点总结</h3><ul>
<li>词法作用域意味着作用域是由书写代码时函数声明的位置来决定的</li>
<li>编译的词法分析阶段 基本能够知道全部标识符在哪里以及是如何声明的，从而能够预测在执行过程中如何对它 们进行查找。</li>
<li>JavaScript 中有两个机制可以“欺骗”词法作用域:eval(..) 和 with</li>
<li>eval可以对一段包 含一个或多个声明的“代码”字符串进行演算，并借此来修改已经存在的词法作用域</li>
<li>with本质上是通过将一个对象的引用当作作用域来处理，将对象的属性当作作 用域中的标识符来处理，从而创建了一个新的词法作用域(同样是在运行时)</li>
<li>这两个机制的副作用是引擎无法在编译时对作用域查找进行优化，因为引擎只能谨慎地认 为这样的优化是无效的。使用这其中任何一个机制都将导致代码运行变慢。不要使用它们。</li>
</ul>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://www.neohuang.com/child/2018/09/13/not-know-js-review-lexical-scope /" data-id="cjm8w7vko0010kam7zw1ecdwp" class="article-share-link"><i class="fa fa-share"></i>Compartir</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            <!--
    
        <a href="http://www.neohuang.com/child/2018/09/13/not-know-js-review-lexical-scope /#comments" class="article-comment-link">Comentarios</a>
    
-->
        </footer>
    </div>
    
</article>



    <article id="post-not-know-js-review-function-hosting" class="article article-type-post" itemscope="" itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="http://localhost:4000/2018/09/13/not-know-js-review-function-hosting/" target="_blank" rel="noopener">你不知道的js复习笔记 (提升)</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="http://localhost:4000/2018/09/13/not-know-js-review-function-hosting/" target="_blank" rel="noopener">
            <time datetime="2018-09-12T16:00:00.000Z" itemprop="datePublished">2018-09-13</time>
        </a>
    </div>


                        
                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody" lg-uid="lg3">
        
            
            <h2 id="第一部分-提升"><a href="http://localhost:4000/#%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86-%E6%8F%90%E5%8D%87" class="headerlink" title="第一部分 提升" target="_blank" rel="noopener"></a>第一部分 提升</h2><p>参考： 《你不知道的javascript—上卷》 第一部分</p>
<p>直觉上会认为 JavaScript 代码在执行时是由上到下一行一行执行的。但实际上这并不完全正确。</p>
<h3 id="1-变量提升"><a href="http://localhost:4000/#1-%E5%8F%98%E9%87%8F%E6%8F%90%E5%8D%87" class="headerlink" title="(1) 变量提升" target="_blank" rel="noopener"></a>(1) 变量提升</h3><p>这是javascript中的变量提升</p>
<p>例子1:</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a=<span class="number">2</span>;
<span class="keyword">var</span> a; </span><br><span class="line"><span class="built_in">console</span>.log( a ); <span class="comment">// 2</span></span><br></pre></td></tr></tbody></table></figure>
<p>例子2：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log( a );</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">2</span>; <span class="comment">// undefined</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="2-变量提升和编译器"><a href="http://localhost:4000/#2-%E5%8F%98%E9%87%8F%E6%8F%90%E5%8D%87%E5%92%8C%E7%BC%96%E8%AF%91%E5%99%A8" class="headerlink" title="(2) 变量提升和编译器" target="_blank" rel="noopener"></a>(2) 变量提升和编译器</h3><h4 id="1-声明提前"><a href="http://localhost:4000/#1-%E5%A3%B0%E6%98%8E%E6%8F%90%E5%89%8D" class="headerlink" title="[1] 声明提前" target="_blank" rel="noopener"></a>[1] 声明提前</h4><p>变量提升的背后和第一章的编译器有密切的关系，引擎会 在解释 JavaScript 代码之前首先对其进行编译。编译阶段中的一部分工作就是找到所有的 声明，并用合适的作用域将它们关联起来。</p>
<p>因此，我们在分析js代码的时候正确的思考思路是，包括变量和函数在内的所有声明都会在任何代码被执行前首先 被处理。</p>
<p>当你看到 var a = 2; 时，可能会认为这是一个声明。但 JavaScript 实际上会将其看成<strong>两个声明</strong>:var a;和a = 2;。第一个定义声明是在编译阶段进行的。第二个赋值声明会被留在 原地等待执行阶段。</p>
<p>例子1实际在编译器中会这样执行:</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a;
a=<span class="number">2</span>;</span><br><span class="line"><span class="built_in">console</span>.log( a );</span><br></pre></td></tr></tbody></table></figure>
<p>例子2:</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a;
<span class="built_in">console</span>.log( a );</span><br><span class="line">a=<span class="number">2</span></span><br></pre></td></tr></tbody></table></figure>
<p>其中第一部分是编译，而第二部分是执行。</p>
<p>因此，打个比方，这个过程就好像变量和函数声明从它们在代码中出现的位置被“移动” 到了最上面。这个过程就叫作提升。</p>
<p><strong>换句话说，先声明，后赋值</strong></p>
<h4 id="2-函数执行不会被提前"><a href="http://localhost:4000/#2-%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C%E4%B8%8D%E4%BC%9A%E8%A2%AB%E6%8F%90%E5%89%8D" class="headerlink" title="[2]  函数执行不会被提前" target="_blank" rel="noopener"></a>[2]  函数执行不会被提前</h4><p>只有声明本身会被提升，而赋值或其他运行逻辑会留在原地。如果提升改变了代码执行的顺序，会造成非常严重的破坏。</p>
<h4 id="3-每个作用域都会声明提升"><a href="http://localhost:4000/#3-%E6%AF%8F%E4%B8%AA%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%83%BD%E4%BC%9A%E5%A3%B0%E6%98%8E%E6%8F%90%E5%8D%87" class="headerlink" title="[3] 每个作用域都会声明提升" target="_blank" rel="noopener"></a>[3] 每个作用域都会声明提升</h4><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">foo(); <span class="comment">// 会将 foo声明提升</span>
<span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>{</span><br><span class="line">	<span class="built_in">console</span>.log( a );  <span class="comment">// 会将 变量a声明提升</span></span><br><span class="line">	<span class="comment">// undefined var a =2;</span>
}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="4-函数声明会被提升，但是函数表达式却不会被提升"><a href="http://localhost:4000/#4-%E5%87%BD%E6%95%B0%E5%A3%B0%E6%98%8E%E4%BC%9A%E8%A2%AB%E6%8F%90%E5%8D%87%EF%BC%8C%E4%BD%86%E6%98%AF%E5%87%BD%E6%95%B0%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%8D%B4%E4%B8%8D%E4%BC%9A%E8%A2%AB%E6%8F%90%E5%8D%87" class="headerlink" title="[4] 函数声明会被提升，但是函数表达式却不会被提升" target="_blank" rel="noopener"></a>[4] 函数声明会被提升，但是函数表达式却不会被提升</h4><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">foo(); <span class="comment">// 不是 ReferenceError, 而是 TypeError!</span>
<span class="keyword">var</span> foo = <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>{</span><br><span class="line"> <span class="comment">// ...</span>
};</span><br></pre></td></tr></tbody></table></figure>
<p>实际是 foo 会提升，但是 foo 此时并没有赋值(如果它是一个函数声明而不 是函数表达式，那么就会赋值)。foo() 由于对 undefined 值进行函数调用而导致非法操作， 因此抛出 TypeError 异常。</p>
<h4 id="5-函数声明会被提升，但是函数表达式却不会被提升"><a href="http://localhost:4000/#5-%E5%87%BD%E6%95%B0%E5%A3%B0%E6%98%8E%E4%BC%9A%E8%A2%AB%E6%8F%90%E5%8D%87%EF%BC%8C%E4%BD%86%E6%98%AF%E5%87%BD%E6%95%B0%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%8D%B4%E4%B8%8D%E4%BC%9A%E8%A2%AB%E6%8F%90%E5%8D%87" class="headerlink" title="[5] 函数声明会被提升，但是函数表达式却不会被提升" target="_blank" rel="noopener"></a>[5] 函数声明会被提升，但是函数表达式却不会被提升</h4><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">foo(); <span class="comment">// TypeError</span>
bar(); <span class="comment">// ReferenceError</span>
<span class="keyword">var</span> foo = <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>{ </span><br><span class="line">	<span class="comment">// ...</span>
};</span><br></pre></td></tr></tbody></table></figure>
<p>这个代码片段经过提升后，实际上会被理解为以下形式:</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo;
foo(); <span class="comment">// TypeError</span>
bar(); <span class="comment">// ReferenceError</span>
foo = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
<span class="keyword">var</span> bar = ...self... </span><br><span class="line"><span class="comment">// ...</span>
}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="3-函数优先"><a href="http://localhost:4000/#3-%E5%87%BD%E6%95%B0%E4%BC%98%E5%85%88" class="headerlink" title="(3) 函数优先" target="_blank" rel="noopener"></a>(3) 函数优先</h3><h4 id="1-函数声明和变量声明都会被提升-函数会首先被提升，然后才是变量"><a href="http://localhost:4000/#1-%E5%87%BD%E6%95%B0%E5%A3%B0%E6%98%8E%E5%92%8C%E5%8F%98%E9%87%8F%E5%A3%B0%E6%98%8E%E9%83%BD%E4%BC%9A%E8%A2%AB%E6%8F%90%E5%8D%87-%E5%87%BD%E6%95%B0%E4%BC%9A%E9%A6%96%E5%85%88%E8%A2%AB%E6%8F%90%E5%8D%87%EF%BC%8C%E7%84%B6%E5%90%8E%E6%89%8D%E6%98%AF%E5%8F%98%E9%87%8F" class="headerlink" title="[1] 函数声明和变量声明都会被提升,函数会首先被提升，然后才是变量" target="_blank" rel="noopener"></a>[1] 函数声明和变量声明都会被提升,函数会首先被提升，然后才是变量</h4><p>函数声明和变量声明都会被提升。但是一个值得注意的细节(这个细节可以出现在有多个<br>“重复”声明的代码中)是函数会首先被提升，然后才是变量。</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">foo(); <span class="comment">// 执行1</span>
<span class="keyword">var</span> foo;
<span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>{ </span><br><span class="line">	<span class="built_in">console</span>.log( <span class="number">1</span> );
}
foo = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line"> <span class="built_in">console</span>.log( <span class="number">2</span> );
};</span><br></pre></td></tr></tbody></table></figure>
<p>实际可以看成这样:</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>{</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> foo <span class="comment">// 重复声明被忽略</span></span><br><span class="line"></span><br><span class="line">foo();</span><br><span class="line"></span><br><span class="line">foo = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="2-重复的-var-声明会被忽略掉，但出现在后面的函数声明还是可以覆盖前面的。"><a href="http://localhost:4000/#2-%E9%87%8D%E5%A4%8D%E7%9A%84-var-%E5%A3%B0%E6%98%8E%E4%BC%9A%E8%A2%AB%E5%BF%BD%E7%95%A5%E6%8E%89%EF%BC%8C%E4%BD%86%E5%87%BA%E7%8E%B0%E5%9C%A8%E5%90%8E%E9%9D%A2%E7%9A%84%E5%87%BD%E6%95%B0%E5%A3%B0%E6%98%8E%E8%BF%98%E6%98%AF%E5%8F%AF%E4%BB%A5%E8%A6%86%E7%9B%96%E5%89%8D%E9%9D%A2%E7%9A%84%E3%80%82" class="headerlink" title="[2]重复的 var 声明会被忽略掉，但出现在后面的函数声明还是可以覆盖前面的。" target="_blank" rel="noopener"></a>[2]重复的 var 声明会被忽略掉，但出现在后面的函数声明还是可以覆盖前面的。</h4><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">foo(); <span class="comment">// 3</span>
<span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>{</span><br><span class="line"> <span class="built_in">console</span>.log( <span class="number">1</span> );
}
<span class="keyword">var</span> foo = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{ </span><br><span class="line">	<span class="built_in">console</span>.log( <span class="number">2</span> );
};
<span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>{ </span><br><span class="line">	<span class="built_in">console</span>.log( <span class="number">3</span> );
}</span><br></pre></td></tr></tbody></table></figure>
<p>实际转换成了</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>{</span><br><span class="line"> <span class="built_in">console</span>.log( <span class="number">1</span> );
}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>{ </span><br><span class="line">	<span class="built_in">console</span>.log( <span class="number">3</span> );
}</span><br><span class="line"></span><br><span class="line">foo(); <span class="comment">//3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> foo = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{ </span><br><span class="line">	<span class="built_in">console</span>.log( <span class="number">2</span> );
};</span><br></pre></td></tr></tbody></table></figure>
<p>判断不要这么用</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">foo(); <span class="comment">// "b"</span>
<span class="keyword">var</span> a = <span class="literal">true</span>; </span><br><span class="line"><span class="keyword">if</span>(a){
	<span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>{ <span class="built_in">console</span>.log(<span class="string">"a"</span>); } }
<span class="keyword">else</span> {
	<span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>{ <span class="built_in">console</span>.log(<span class="string">"b"</span>); }
}</span><br></pre></td></tr></tbody></table></figure>
<p>但是需要注意这个行为并不可靠，在 JavaScript 未来的版本中有可能发生改变，因此应该 尽可能避免在块内部声明函数。</p>
<h3 id="总结"><a href="http://localhost:4000/#%E6%80%BB%E7%BB%93" class="headerlink" title="总结" target="_blank" rel="noopener"></a>总结</h3><ul>
<li>var a = 2;可以看作2个阶段 var a; a=2,第一个是编译阶段的任务，而第二个则是执行阶段的任务。</li>
<li><p>无论作用域中的声明出现在什么地方，所有的声明(变量和函数)都会被“移动”到各自作用域的 最顶端，这个过程被称为提升。</p>
</li>
<li><p>声明本身会被提升，而包括函数表达式的赋值在内的赋值操作并不会提升。</p>
</li>
<li>要注意避免重复声明，特别是当普通的 var 声明和函数声明混合在一起的时候</li>
</ul>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://www.neohuang.com/child/2018/09/13/not-know-js-review-function-hosting/" data-id="cjm8w7vko000ykam79f4240d7" class="article-share-link"><i class="fa fa-share"></i>Compartir</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            <!--
    
        <a href="http://www.neohuang.com/child/2018/09/13/not-know-js-review-function-hosting/#comments" class="article-comment-link">Comentarios</a>
    
-->
        </footer>
    </div>
    
</article>



    <article id="post-array-review" class="article article-type-post" itemscope="" itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="http://localhost:4000/2018/09/12/array-review/" target="_blank" rel="noopener">js数组方法分类复习</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="http://localhost:4000/2018/09/12/array-review/" target="_blank" rel="noopener">
            <time datetime="2018-09-11T16:00:00.000Z" itemprop="datePublished">2018-09-12</time>
        </a>
    </div>


                        
                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody" lg-uid="lg4">
        
            
            <p>年纪大了，每过一段时间都记不住数组的基本方法，所以经常要自己做一个review（这篇先占位之后好好再复习）</p>
<h3 id="一、数组"><a href="http://localhost:4000/#%E4%B8%80%E3%80%81%E6%95%B0%E7%BB%84" class="headerlink" title="一、数组" target="_blank" rel="noopener"></a>一、数组</h3><h4 id="1-检测数组"><a href="http://localhost:4000/#1-%E6%A3%80%E6%B5%8B%E6%95%B0%E7%BB%84" class="headerlink" title="(1) 检测数组" target="_blank" rel="noopener"></a>(1) 检测数组</h4><ul>
<li><p>value instanceof Array</p>
</li>
<li><p>Array.isArray</p>
</li>
</ul>
<h4 id="2-转换方法"><a href="http://localhost:4000/#2-%E8%BD%AC%E6%8D%A2%E6%96%B9%E6%B3%95" class="headerlink" title="(2) 转换方法" target="_blank" rel="noopener"></a>(2) 转换方法</h4><ul>
<li><p>toString</p>
</li>
<li><p>toLocalString</p>
</li>
<li><p>toValue</p>
</li>
</ul>
<h4 id="3-栈方法"><a href="http://localhost:4000/#3-%E6%A0%88%E6%96%B9%E6%B3%95" class="headerlink" title="(3) 栈方法" target="_blank" rel="noopener"></a>(3) 栈方法</h4><ul>
<li>push (改变原数组)</li>
<li>pop （改变原数组）</li>
</ul>
<h4 id="4-队列方法"><a href="http://localhost:4000/#4-%E9%98%9F%E5%88%97%E6%96%B9%E6%B3%95" class="headerlink" title="(4) 队列方法" target="_blank" rel="noopener"></a>(4) 队列方法</h4><ul>
<li>unshift （改变原数组）</li>
<li>shift （改变原数组）</li>
</ul>
<h4 id="5-排序方法"><a href="http://localhost:4000/#5-%E6%8E%92%E5%BA%8F%E6%96%B9%E6%B3%95" class="headerlink" title="(5) 排序方法" target="_blank" rel="noopener"></a>(5) 排序方法</h4><ul>
<li>sort （改变原数组）</li>
<li>reverse(改变原数组)</li>
</ul>
<h4 id="6-操作方法"><a href="http://localhost:4000/#6-%E6%93%8D%E4%BD%9C%E6%96%B9%E6%B3%95" class="headerlink" title="(6) 操作方法" target="_blank" rel="noopener"></a>(6) 操作方法</h4><ul>
<li>concat</li>
<li>slice </li>
<li>join</li>
<li>splice (改变原数组)</li>
</ul>
<h4 id="7-位置方法"><a href="http://localhost:4000/#7-%E4%BD%8D%E7%BD%AE%E6%96%B9%E6%B3%95" class="headerlink" title="(7) 位置方法" target="_blank" rel="noopener"></a>(7) 位置方法</h4><ul>
<li>indexOf</li>
<li>lastIndexOf</li>
</ul>
<h4 id="8-迭代方法"><a href="http://localhost:4000/#8-%E8%BF%AD%E4%BB%A3%E6%96%B9%E6%B3%95" class="headerlink" title="(8) 迭代方法" target="_blank" rel="noopener"></a>(8) 迭代方法</h4><ul>
<li>every  （有返回值）</li>
<li>filter （有返回值）</li>
<li>forEach （没有返回值）</li>
<li>map （有返回值）</li>
<li>some （有返回值）</li>
</ul>
<h4 id="9-归并方法"><a href="http://localhost:4000/#9-%E5%BD%92%E5%B9%B6%E6%96%B9%E6%B3%95" class="headerlink" title="(9) 归并方法" target="_blank" rel="noopener"></a>(9) 归并方法</h4><ul>
<li><p>reduce （有返回值）</p>
</li>
<li><p>reduceRight （有返回值）</p>
</li>
</ul>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://www.neohuang.com/child/2018/09/12/array-review/" data-id="cjm8w7vk00006kam7ydsj0q7a" class="article-share-link"><i class="fa fa-share"></i>Compartir</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            <!--
    
        <a href="http://www.neohuang.com/child/2018/09/12/array-review/#comments" class="article-comment-link">Comentarios</a>
    
-->
        </footer>
    </div>
    
</article>



    <article id="post-not-know-js-review-base-scope" class="article article-type-post" itemscope="" itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="http://localhost:4000/2018/09/12/not-know-js-review-base-scope/" target="_blank" rel="noopener">你不知道的js复习笔记 (什么是作用域)</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="http://localhost:4000/2018/09/12/not-know-js-review-base-scope/" target="_blank" rel="noopener">
            <time datetime="2018-09-11T16:00:00.000Z" itemprop="datePublished">2018-09-12</time>
        </a>
    </div>


                        
                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody" lg-uid="lg5">
        
            
            <h2 id="第一部分-作用域和闭包之什么是作用域"><a href="http://localhost:4000/#%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86-%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E9%97%AD%E5%8C%85%E4%B9%8B%E4%BB%80%E4%B9%88%E6%98%AF%E4%BD%9C%E7%94%A8%E5%9F%9F" class="headerlink" title="第一部分 作用域和闭包之什么是作用域" target="_blank" rel="noopener"></a>第一部分 作用域和闭包之什么是作用域</h2><p>参考： 《你不知道的javascript—上卷》 第一部分    </p>
<h3 id="1-作用域"><a href="http://localhost:4000/#1-%E4%BD%9C%E7%94%A8%E5%9F%9F" class="headerlink" title="1.作用域" target="_blank" rel="noopener"></a>1.作用域</h3><h4 id="1-作用域概念"><a href="http://localhost:4000/#1-%E4%BD%9C%E7%94%A8%E5%9F%9F%E6%A6%82%E5%BF%B5" class="headerlink" title="1.作用域概念" target="_blank" rel="noopener"></a>1.作用域概念</h4><p>一套来规定存储、读取变量的规则，解释器根据该规则来存储以及读取变量。</p>
<h4 id="2-编译原理"><a href="http://localhost:4000/#2-%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86" class="headerlink" title="2.编译原理" target="_blank" rel="noopener"></a>2.编译原理</h4><h5 id="1-js语言特性："><a href="http://localhost:4000/#1-js%E8%AF%AD%E8%A8%80%E7%89%B9%E6%80%A7%EF%BC%9A" class="headerlink" title="(1) js语言特性：" target="_blank" rel="noopener"></a>(1) js语言特性：</h5><p>js归类为“动态”或“解释型语言”，但事实上它仍是一门编译语言</p>
<p><strong>衍生知识：</strong></p>
<p>前置知识：</p>
<p>运行期间：当程序在内存中的时候，就是运行时,其余时候都是在磁盘上，都不是运行时 (不一定在全部编译后，解释型语言可能会动态编译)</p>
<p>改变其结构：例如新的函数、对象、甚至代码可以被引进，已有的函数可以被删除或是其他结构上的变化。<br>（等待js元编程章节再探讨）</p>
<p>(1) 动态语言和静态语言的区别 （容易混淆）：</p>
<ul>
<li><p><strong>动态语言：</strong>指运行期间可以改变其结构的语言</p>
</li>
<li><p><strong>静态语言：</strong>与动态语言相反，在运行时不能改变其结构 （虽然尽管静态语言可以通过复杂的手段实现动态语言的特性，但是动态语言提供了直接的方法实现语言的动态性。）</p>
</li>
</ul>
<p>(2) 动态类型语言和静态类型语言区别 （容易混淆）：</p>
<ul>
<li><p><strong>动态类型语言：</strong>指在运行期间才去做数据类型检查的语言</p>
</li>
<li><p><strong>静态类型语言：</strong>与动态类型语言刚好相反，它的数据类型检查发生在在编译阶段。（静态语言通常会使用泛型去实现，实现其动态性    ）</p>
</li>
</ul>
<p>(3) 强类语言和弱类语言区别：</p>
<ul>
<li><strong>强类型语言：</strong> 偏向于不容忍隐式类型转换的语言</li>
<li><strong>弱类型语言:</strong> 偏向于容忍隐式类型转换的语言</li>
</ul>
<p>(4) 解释型语言和编译型语言区别：</p>
<ul>
<li><strong>解释型类型语言：</strong>  是一种以用解释器来实现的编程语言，在执行期，动态将程式码逐句解释（interpret）为机器码，或是已经预先编译为机器码的的子程式，之后再执行。</li>
<li><strong>编译型语言：</strong> 是一种以编译器来实现的编程语言，以编译器，先将代码编译为机器码，再加以运行。</li>
</ul>
<h5 id="2-编译型语言的编译过程："><a href="http://localhost:4000/#2-%E7%BC%96%E8%AF%91%E5%9E%8B%E8%AF%AD%E8%A8%80%E7%9A%84%E7%BC%96%E8%AF%91%E8%BF%87%E7%A8%8B%EF%BC%9A" class="headerlink" title="(2) 编译型语言的编译过程：" target="_blank" rel="noopener"></a>(2) 编译型语言的编译过程：</h5><p>[1] 分词/词法分析 （Tokeninzing/Lexing）</p>
<p>这个过程会将由字符组成的字符串分解成(对编程语言来说)有意义的代码块，这些代 码块被称为词法单元(token)。例如，考虑程序var a = 2;。这段程序通常会被分解成 为下面这些词法单元:var、a、=、2 、;。空格是否会被当作词法单元，取决于空格在 这门语言中是否具有意义。 </p>
<p><strong>白话解析：这个过程主要是为了将一句句js代码转换成词法单元流(数组)，虽然不是很准确可以简单理解为将String按特定规则转化为Array。</strong></p>
<p><strong>衍生知识：</strong></p>
<p>分词(tokenizing)和词法分析(Lexing)之间的区别是非常微妙、晦涩的， 主要差异在于词法单元的识别是通过有状态还是无状态的方式进行的。简 单来说，如果词法单元生成器在判断 a 是一个独立的词法单元还是其他词法 单元的一部分时，调用的是有状态的解析规则，那么这个过程就被称为词法 分析。</p>
<p>[2] 解析／语法分析 (Parsing)</p>
<p>这个过程是将词法单元流(数组)转换成一个由元素逐级嵌套所组成的代表了程序语法 结构的树。这个树被称为“抽象语法树”(Abstract Syntax Tree，AST)。<br>var a = 2; 的抽象语法树中可能会有一个叫作 VariableDeclaration 的顶级节点，接下 来是一个叫作 Identifier(它的值是 a)的子节点，以及一个叫作 AssignmentExpression 的子节点。AssignmentExpression 节点有一个叫作 NumericLiteral(它的值是 2)的子 节点。</p>
<p><strong>白话解析：这个过程主要是将词法单元流转换为AST，虽然不是很准确可以简单理解将string 按特定规则转换为tree，以便代码生成时转换为机器码</strong></p>
<p>[3] 代码生成</p>
<p>将 AST 转换为可执行代码的过程称被称为代码生成。这个过程与语言、目标平台等息 息相关。<br>抛开具体细节，简单来说就是有某种方法可以将 var a = 2; 的 AST 转化为一组机器指令，用来创建一个叫作 a 的变量(包括分配内存等)，并将一个值储存在 a 中</p>
<p><strong>白话解析：这个过程主要是将AST根据平台差异转换为机器码，让计算机进行执行代码</strong></p>
<h5 id="3-javascript的编译与传统编译型语言的区别-解释型语言-："><a href="http://localhost:4000/#3-javascript%E7%9A%84%E7%BC%96%E8%AF%91%E4%B8%8E%E4%BC%A0%E7%BB%9F%E7%BC%96%E8%AF%91%E5%9E%8B%E8%AF%AD%E8%A8%80%E7%9A%84%E5%8C%BA%E5%88%AB-%E8%A7%A3%E9%87%8A%E5%9E%8B%E8%AF%AD%E8%A8%80-%EF%BC%9A" class="headerlink" title="(3) javascript的编译与传统编译型语言的区别(解释型语言)：" target="_blank" rel="noopener"></a>(3) javascript的编译与传统编译型语言的区别(解释型语言)：</h5><p>比起只有3步的编译型语言，编译过程复杂的多，和书上一样只做宏观理解来了解决一下差别</p>
<p>简单总结下来说，由于js是解释型语言，会存在多次在执行前编译代码的情况造成：</p>
<ul>
<li>js没有引擎没有大量时间优化，因为编译过程并不在构建前</li>
<li>大部分情况下js编译代码是在执行前的几微秒，因此js引擎用了JIT等优化来保证性能</li>
</ul>
<p><strong>衍生知识：Just-In-Time Compiler(JIT) （挖个坑之后填）</strong></p>
<p>关于JIT可以参考该文：<a href="https://juejin.im/post/58c12adc128fe1006020dff9" target="_blank" rel="noopener">https://juejin.im/post/58c12adc128fe1006020dff9</a></p>
<p>Just-In-Time Compiler(JIT)实时编译：动态编译的一种形式，是一种提高程序运行效率的方法。通常，程序有两种运行方式：静态编译与动态解释。静态编译的程序在执行前全部被翻译为机器码，而解释执行的则是一句一句边运行边翻译。</p>
<p>即时编译器则混合了这二者，一句一句编译源代码，但是会将翻译过的代码缓存起来以降低性能损耗。相对于静态编译代码，即时编译的代码可以处理延迟绑定并增强安全性。</p>
<p>简单来说就是为了解决解释器的低效问题，后来的浏览器把编译器也引入进来，形成混合模式。</p>
<p>实现思路基本是：在 JavaScript 引擎中增加一个监视器（也叫分析器）。监视器监控着代码的运行情况，记录代码一共运行了多少次、如何运行的等信息。</p>
<h4 id="2-作用域解析过程"><a href="http://localhost:4000/#2-%E4%BD%9C%E7%94%A8%E5%9F%9F%E8%A7%A3%E6%9E%90%E8%BF%87%E7%A8%8B" class="headerlink" title="2.作用域解析过程" target="_blank" rel="noopener"></a>2.作用域解析过程</h4><p>分析具体作用域之前需要一些前置知识，</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">2</span>;</span><br></pre></td></tr></tbody></table></figure>
<p>上面这句代码js引擎会认为有两个完全不同的声明：</p>
<ul>
<li>一个由js编译器处理：</li>
</ul>
<p>译器会在当前作用域中声明一个变量(如 果之前没有声明过)</p>
<ul>
<li>一个由js引擎在运行时处理：</li>
</ul>
<p>在运行时引擎会在作用域中查找该变量，如果能够找到就会对 它赋值。</p>
<p>js运行这段代码的大背后致过程</p>
<p><strong>大致过程：</strong></p>
<ul>
<li>编译器首先会将这段程序分解成词法单元，然后将词法单元解析成一个树结构</li>
<li>编译器会在当前作用域中声明一个变量</li>
<li>运行时引擎会在作用域中查找该变量，如果能够找到就会对 它赋值。</li>
</ul>
<p>结果：如果引擎最终找到了 a 变量，就会将 2 赋值给它。否则引擎就会举手示意并抛出一个异 常!</p>
<h5 id="1-不完全正确："><a href="http://localhost:4000/#1-%E4%B8%8D%E5%AE%8C%E5%85%A8%E6%AD%A3%E7%A1%AE%EF%BC%9A" class="headerlink" title="[1] 不完全正确：" target="_blank" rel="noopener"></a>[1] 不完全正确：</h5><h5 id="2-正确理解："><a href="http://localhost:4000/#2-%E6%AD%A3%E7%A1%AE%E7%90%86%E8%A7%A3%EF%BC%9A" class="headerlink" title="[2] 正确理解：" target="_blank" rel="noopener"></a>[2] 正确理解：</h5><p>变量的赋值操作会执行两个动作，首先编译器会在当前作用域中声明一个变量(如果之前没有声明过)，然后在运行时引擎会在作用域中查找该变量，如果能够找到就会对 它赋值。</p>
<h4 id="4-编译器如何进行变量查找"><a href="http://localhost:4000/#4-%E7%BC%96%E8%AF%91%E5%99%A8%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E5%8F%98%E9%87%8F%E6%9F%A5%E6%89%BE" class="headerlink" title="4.编译器如何进行变量查找" target="_blank" rel="noopener"></a>4.编译器如何进行变量查找</h4><p>编译器在编译过程的第二步中生成了代码，引擎执行它时，会通过查找变量 a 来判断它是 否已声明过。查找的过程由作用域进行协助，但是引擎执行怎样的查找，会影响最终的查 找结果。</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">2</span>;</span><br></pre></td></tr></tbody></table></figure>
<p>会进行两个查找，一个是LHS、一个RHS，</p>
<p>[1] LHS: 左侧查询</p>
<p>是一个赋值操作的左侧，当变量出现在赋值操作的左侧时进行 LHS 查询，而 LHS 查询则是试图 找到变量的容器本身。</p>
<p>[2] RHS： 右侧查询</p>
<p>是一个赋值操作的右侧，出现在右侧时进行 RHS 查询。RHS 查询与简单地查找某个变量的值别无二致。</p>
<p>例1:</p>
<p><code>`</code>javascript<br>console.log( a );<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">其中对 a 的引用是一个 RHS 引用，因为这里 a 并没有赋予任何值。相应地，需要查找并取
得 a 的值，这样才能将值传递给 console.log(..)。从这个角度说，RHS 并不是真正意义上的“赋 值操作的右侧”，更准确地说是“非左侧”。</span><br><span class="line"></span><br><span class="line">例2:</span><br><span class="line"></span><br><span class="line">```javascript</span><br><span class="line">a = 2;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>这里对 a 的引用则是 LHS 引用，因为实际上我们并不关心当前的值是什么，只是想要为 =<br>2 这个赋值操作找到一个目标。</p>
<p>例3:</p>
<p><code>`</code>javascript<br>function foo(a) {<br>    // 隐式 var a； 所以存在一次 LHS<br>    console.log( a ); // 2  // console对象一次LHS, 所以存在一次需要查找a，RHS<br>}<br>foo( 2 ); // 一次 RHS<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">有LHS 又有 RHS</span><br><span class="line"></span><br><span class="line">**补充知识：函数声明需要LHS吗**</span><br><span class="line"></span><br><span class="line">否，可能会倾向于将函数声明 function foo(a) {... 概念化为普通的变量声明 和赋值，比如 var foo、foo = function(a) {...。如果这样理解的话，这 个函数声明将需要进行 LHS 查询。 然而还有一个重要的细微差别，编译器可以在代码生成的同时处理声明和值 的定义，比如在引擎执行代码时，并不会有线程专门用来将一个函数值“分 配给”foo。因此，将函数声明理解成前面讨论的 LHS 查询和赋值的形式并 不合适。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">测验：</span><br><span class="line"></span><br><span class="line">```javascirpt</span><br><span class="line">function foo(a) {</span><br><span class="line">// var a; 一次LHS</span><br><span class="line">var b = a; // 一次LHS 一次 RHS
return a + b;  ／／ 2次RHS</span><br><span class="line">}
var c = foo( 2 ); ／／ 一次LHS 一次RHS</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>总结:</p>
<ul>
<li>3次LHS</li>
<li>2次RHS</li>
</ul>
<h4 id="5-作用域嵌套"><a href="http://localhost:4000/#5-%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%B5%8C%E5%A5%97" class="headerlink" title="5.作用域嵌套" target="_blank" rel="noopener"></a>5.作用域嵌套</h4><p>作用域是根据名称查找变量的一套规则。实际情况中，通常需要同时顾及几个作用域。</p>
<h4 id="1-嵌套作用域"><a href="http://localhost:4000/#1-%E5%B5%8C%E5%A5%97%E4%BD%9C%E7%94%A8%E5%9F%9F" class="headerlink" title="[1] 嵌套作用域" target="_blank" rel="noopener"></a>[1] 嵌套作用域</h4><p>当一个块或函数嵌套在另一个块或函数中时，就发生了作用域的嵌套。</p>
<h4 id="2-遍历嵌套作用域链的规则"><a href="http://localhost:4000/#2-%E9%81%8D%E5%8E%86%E5%B5%8C%E5%A5%97%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E7%9A%84%E8%A7%84%E5%88%99" class="headerlink" title="[2]遍历嵌套作用域链的规则" target="_blank" rel="noopener"></a>[2]遍历嵌套作用域链的规则</h4><p>此时变量查找：若当前作用域无法查找到变量，则会到在外层嵌套的作用域中继续查找，直到找到该变量或抵达最外层。</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">
<span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">a</span>) </span>{ </span><br><span class="line">	<span class="built_in">console</span>.log( a + b );
}
<span class="keyword">var</span> b = <span class="number">2</span>; foo( <span class="number">2</span> ); <span class="comment">// 4</span></span><br></pre></td></tr></tbody></table></figure>
<p>对 b 进行的 RHS 引用无法在函数 foo 内部完成，但可以在上一级作用域(在这个例子中就 是全局作用域)中完成。</p>
<p><strong>遍历嵌套作用域链的规则:</strong> </p>
<p>引擎从当前的执行作用域开始查找变量，如果找不到， 就向上一级继续查找。当抵达最外层的全局作用域时，无论找到还是没找到，查找过程都 会停止。</p>
<h4 id="6-异常"><a href="http://localhost:4000/#6-%E5%BC%82%E5%B8%B8" class="headerlink" title="6.异常" target="_blank" rel="noopener"></a>6.异常</h4><p>区分 LHS 和 RHS 是一件重要的原因其中之一是因为异常</p>
<ul>
<li><p>LHS</p>
<ul>
<li><p>非严格模式</p>
<p>当引擎执行 LHS 查询时，如果在顶层(全局作用域)中也无法找到目标变量，<br>全局作用域中就会创建一个具有该名称的变量，并将其返还给引擎</p>
</li>
<li><p>严格模式</p>
<pre><code>严格模式禁止自动或隐式地创建全局变量，因此，在 严格模式中 LHS 查询失败时，并不会创建并        返回一个全局变量，引擎会抛出同 RHS 查询 失败时类似的 ReferenceError 异常。
</code></pre></li>
</ul>
</li>
<li><p>RHS</p>
<ul>
<li><p>查找不到目标变量</p>
<p>  RHS 查询在所有嵌套的作用域中遍寻不到所需的变量，引擎就会抛出 ReferenceError 异常</p>
<ul>
<li><p>查询找到了一个变量，但是对这个变量的值进行不合理的操作</p>
<p>比如试图对一个非函数类型的值进行函数调用，或着引用 null 或 undefined 类型的值中的 属性，那么引擎会抛出另外一种类型的异常，叫作 TypeError。</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://www.neohuang.com/child/2018/09/12/not-know-js-review-base-scope/" data-id="cjm8w7vkm000ukam7sgosup7l" class="article-share-link"><i class="fa fa-share"></i>Compartir</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            <!--
    
        <a href="http://www.neohuang.com/child/2018/09/12/not-know-js-review-base-scope/#comments" class="article-comment-link">Comentarios</a>
    
-->
        </footer>
    </div>
    
</article>



    <article id="post-js-reivew-event-mouse" class="article article-type-post" itemscope="" itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="http://localhost:4000/2018/09/11/js-reivew-event-mouse/" target="_blank" rel="noopener">js复习鼠标事件笔记</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="http://localhost:4000/2018/09/11/js-reivew-event-mouse/" target="_blank" rel="noopener">
            <time datetime="2018-09-10T16:00:00.000Z" itemprop="datePublished">2018-09-11</time>
        </a>
    </div>


                        
                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody" lg-uid="lg6">
        
            
            <h3 id="一、鼠标事件"><a href="http://localhost:4000/#%E4%B8%80%E3%80%81%E9%BC%A0%E6%A0%87%E4%BA%8B%E4%BB%B6" class="headerlink" title="一、鼠标事件" target="_blank" rel="noopener"></a>一、鼠标事件</h3><p>dom3事件模型中与鼠标事件相关的事件共12种鼠标事件</p>
<ul>
<li>5个点击相关</li>
<li>5个移动相关</li>
<li>1个滚动</li>
<li>1个选择事件</li>
</ul>
<p>点击相关事件：</p>
<ul>
<li><p>click</p>
</li>
<li><p>dblclick</p>
</li>
<li><p>contextmeun (次键点击)</p>
</li>
<li><p>mousedown</p>
</li>
<li><p>mouseup</p>
</li>
</ul>
<p>移动相关</p>
<ul>
<li><p>mousemove</p>
</li>
<li><p>mouseenter</p>
</li>
<li><p>mouseover</p>
</li>
<li><p>mouseleave</p>
</li>
<li><p>mouseout</p>
</li>
</ul>
<p>滚动</p>
<ul>
<li>wheel</li>
</ul>
<p>选择</p>
<ul>
<li>select</li>
</ul>
<p>click 执行顺序</p>
<p>dblclick 执行顺序</p>
<h3 id="二、relatedTarget"><a href="http://localhost:4000/#%E4%BA%8C%E3%80%81relatedTarget" class="headerlink" title="二、relatedTarget" target="_blank" rel="noopener"></a>二、relatedTarget</h3><p>参考：<a href="https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent/relatedTarget" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent/relatedTarget</a></p>
<p>定义：和事件相关的次要节点，如果存在返回节点，不存在返回null</p>
<p>target与relatedTarget总是相反的</p>
<p>与relatedTarget相关的事件，有以下8种：</p>
<ul>
<li>focusin</li>
<li>focusout</li>
<li>mouseover</li>
<li>mouseout</li>
<li>mouseenter</li>
<li>mouseleave</li>
<li>dragenter</li>
<li>dragexit</li>
</ul>
<p>###(1) mouseover与mouseenter（mouseout和mouseleave同理）的区别</p>
<h4 id="1-mouseover："><a href="http://localhost:4000/#1-mouseover%EF%BC%9A" class="headerlink" title="[1]mouseover：" target="_blank" rel="noopener"></a>[1]mouseover：</h4><ul>
<li>特征：从事件节点进入其子节点也会触发事件，会向父节点冒泡</li>
<li>target: 移入进入节点</li>
<li>relatedTarget： 移入时离开的节点</li>
</ul>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">content</span>=<span class="string">"width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">        #container {</span></span><br><span class="line"><span class="undefined">            width: 200px;</span></span><br><span class="line"><span class="undefined">            height: 200px;</span></span><br><span class="line"><span class="undefined">            background-color: blue;</span></span><br><span class="line"><span class="undefined">        }</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">        #child {</span></span><br><span class="line"><span class="undefined">            width: 100px;</span></span><br><span class="line"><span class="undefined">            height: 100px;</span></span><br><span class="line"><span class="undefined">            background-color: red;</span></span><br><span class="line"><span class="undefined">        }</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"container"</span> <span class="attr">onmouseover</span>=<span class="string">"handleMouseover(event)"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"child"</span>&gt;</span>sddddd<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">handleMouseover</span>(<span class="params">e</span>) </span>{</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(e);</span></span><br><span class="line"><span class="undefined">    }</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="2-mouseenter："><a href="http://localhost:4000/#2-mouseenter%EF%BC%9A" class="headerlink" title="[2]mouseenter：" target="_blank" rel="noopener"></a>[2]mouseenter：</h4><ul>
<li>特征：从事件节点进入其子节点也会不会触发事件，不会向父节点冒泡</li>
<li>target: 移入进入节点</li>
<li>relatedTarget： 移入时离开的节点</li>
</ul>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">content</span>=<span class="string">"width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">        #container {</span></span><br><span class="line"><span class="undefined">            width: 200px;</span></span><br><span class="line"><span class="undefined">            height: 200px;</span></span><br><span class="line"><span class="undefined">            background-color: blue;</span></span><br><span class="line"><span class="undefined">        }</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">        #child {</span></span><br><span class="line"><span class="undefined">            width: 100px;</span></span><br><span class="line"><span class="undefined">            height: 100px;</span></span><br><span class="line"><span class="undefined">            background-color: red;</span></span><br><span class="line"><span class="undefined">        }</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"container"</span> <span class="attr">onmouseenter</span>=<span class="string">"handleMouseEnter(event)"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"child"</span>&gt;</span>sddddd<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">handleMouseEnter</span>(<span class="params">e</span>) </span>{</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(e); <span class="comment">// 进入事件节点的子阶段不会触发</span></span></span><br><span class="line"><span class="undefined">    }</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="3-通过mouseover模拟mouseenter："><a href="http://localhost:4000/#3-%E9%80%9A%E8%BF%87mouseover%E6%A8%A1%E6%8B%9Fmouseenter%EF%BC%9A" class="headerlink" title="[3]通过mouseover模拟mouseenter：" target="_blank" rel="noopener"></a>[3]通过mouseover模拟mouseenter：</h4><p><strong>(1) 模拟实现核心思路：</strong></p>
<p>只处理从外层移入的事件</p>
<p><strong>(2) 拆分步骤：</strong></p>
<p>mouseOver伴随以下几种情况</p>
<ul>
<li><p>外层节点移入事件节点 （relatedTarget: 外层节点）</p>
</li>
<li><p>事件节点往子节点移入</p>
<ul>
<li>事件节点往子节点移入 （relatedTarget: 事件节点）</li>
<li>事件节点的子节点往其他子节点移入 （relatedTarget: 事件节点子节点）</li>
</ul>
</li>
</ul>
<p><strong>(3)因此模拟处理的关键：</strong></p>
<p><strong>判断次要节点不是 本身也不是其子节点</strong></p>
<p><strong>(4)是否可以只判断，非自身节点</strong></p>
<p>不能，若只判断判断次要节点不是本身，绝大多数情况可以解决但是一个前提是需要事件节点与子节点间有空间才可以判断，如果没有空间可能是更上一层的节点</p>
<p><strong>(5)是否可以通过阻止子节点冒泡来解决</strong></p>
<p>不能，只能解决子节点之间移动的问题，不能解决子节点往事件节点上的触发</p>
<p><strong>(6)是否可以通过事件流的方式解决</strong></p>
<p>不能，通过addEventListener解决： 无效（会产生新的mouseover，有一个完整的事件流）、</p>
<h4 id="2-鼠标事件对应的事件处理程序"><a href="http://localhost:4000/#2-%E9%BC%A0%E6%A0%87%E4%BA%8B%E4%BB%B6%E5%AF%B9%E5%BA%94%E7%9A%84%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E7%A8%8B%E5%BA%8F" class="headerlink" title="(2)鼠标事件对应的事件处理程序" target="_blank" rel="noopener"></a>(2)鼠标事件对应的事件处理程序</h4><p>参考：<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/MouseEvent" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/API/MouseEvent</a></p>
<h5 id="1-鼠标事件相关属性"><a href="http://localhost:4000/#1-%E9%BC%A0%E6%A0%87%E4%BA%8B%E4%BB%B6%E7%9B%B8%E5%85%B3%E5%B1%9E%E6%80%A7" class="headerlink" title="[1] 鼠标事件相关属性" target="_blank" rel="noopener"></a>[1] 鼠标事件相关属性</h5><p>可以大致分为三类：</p>
<ul>
<li><p>位置相关</p>
<ul>
<li>screenX <strong>(相对屏幕位置)</strong>：他提供了鼠标相对于屏幕坐标系的水平偏移量</li>
<li>clientX (相对可是区域位置，浏览器窗口)</li>
<li>pageX (相对于html文档) （非标准属性）兼容：pageX = clientX + scrollLeft + clientLeft</li>
<li>offesetX： 鼠标在的位置与触发元素相距的距离，以content为参考点（ie属性非标准，但浏览器打多实现，基本通用）</li>
<li>movementX : 与mousemove搭配，两个连续的mousemove相隔的距离 （ie不支持，现代浏览器支持）</li>
</ul>
</li>
<li><p>键盘相关</p>
<ul>
<li>cotrrolKey:<br>点鼠标时，有没有按住cotrrol</li>
<li>shiftKey：<br>  点击点鼠标时，有没有按住shift        </li>
<li>altKey：<br>  点击点鼠标时，有没有按住alt</li>
<li>metaKey： （win键 command键）</li>
<li>button：-1（没有按键）鼠标移动  0 （主键） 1 （辅助键） 2 （次键） </li>
<li>buttons： 同时按下两个键，数字可能会变，3位2进制值  1 左 2 右 4 中<br>举例： 左中：5</li>
</ul>
</li>
</ul>
<h5 id="2-位置相关以及键盘相关注意事项"><a href="http://localhost:4000/#2-%E4%BD%8D%E7%BD%AE%E7%9B%B8%E5%85%B3%E4%BB%A5%E5%8F%8A%E9%94%AE%E7%9B%98%E7%9B%B8%E5%85%B3%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9" class="headerlink" title="[2]位置相关以及键盘相关注意事项" target="_blank" rel="noopener"></a>[2]位置相关以及键盘相关注意事项</h5><p>(1)强调 click只是主键点击</p>
<p>(2)其他键可以通过 mousedown mouseup</p>
<p>(3)preventDefalt可以注销contextmenu         </p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">content</span>=<span class="string">"width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">        .context {</span></span><br><span class="line"><span class="undefined">            background-color: pink;</span></span><br><span class="line"><span class="undefined">            width: 100px;</span></span><br><span class="line"><span class="undefined">            height: 100px;</span></span><br><span class="line"><span class="undefined">        }</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"context"</span> <span class="attr">oncontextmenu</span>=<span class="string">"handleOnContextmenu(event)"</span>&gt;</span></span><br><span class="line">    21321</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="keyword">function</span> <span class="title">handleOnContextmenu</span>(<span class="params">e</span>) </span>{</span></span><br><span class="line"><span class="javascript">    e.preventDefault(); <span class="comment">//阻止默认右键菜单</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">'弹出自定义菜单'</span>);</span></span><br><span class="line"><span class="undefined">  }</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<ul>
<li><p>滚轮事件：</p>
<p>参考：<a href="https://developer.mozilla.org/zh-CN/docs/Web/Events/wheel" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/Events/wheel</a></p>
</li>
</ul>
<p> 当滚动鼠标滚轮或操作其它类似输入设备时会触发滚轮事件。滚轮事件替换了已被弃用的非标准mousewheel事件。</p>
<p>（1）mousewheel事件</p>
<ul>
<li>可以冒泡冒泡到document </li>
<li>wheeldelta: 是一个整值120的倍数 上滚120倍数 下滚是-120倍数 是滚动调的方向,一般只关心正数还是负数</li>
<li>mousewheel，documentmouse<br>存在detail wheelDelta 1的倍数 新版正3 -3，和标准相反</li>
<li>标准版本weel事件（html5）：大部分浏览器都支持<br>deltaX: 变量增量 X  浏览器数值不同<br>deltaY：变量增量 Y 浏览器数值不同<br>deltaZ: 变量增量 Z 浏览器数值不同</li>
</ul>
<h5 id="4-滚动鼠标事件注意点："><a href="http://localhost:4000/#4-%E6%BB%9A%E5%8A%A8%E9%BC%A0%E6%A0%87%E4%BA%8B%E4%BB%B6%E6%B3%A8%E6%84%8F%E7%82%B9%EF%BC%9A" class="headerlink" title="[4]滚动鼠标事件注意点：" target="_blank" rel="noopener"></a>[4]滚动鼠标事件注意点：</h5><ul>
<li>要根据实际客户需求调研，客户版本（mdn文档）</li>
<li>wheeldelta 不一定是整数倍，线性滚轮鼠标不一定正数，mac触控板也模拟鼠标滚轮，就有可能是3的倍数（可能会触发几十次，并且可能有动画过度，wheelDealte可能还会继续改变）</li>
<li>不要相信wheeldelta的值</li>
<li>极限情况：wheeldelta（通常是抛物线曲线）会出现震动情况（一般是动画过程中旋转设备，切换屏幕）</li>
<li>鼠标滚动事件和页面滚动事件无关 （触摸设备手指滑，pc拖拽滚动条也不会触发滚动事件，mac放大不会触发，mac和安卓 2手指手势会触发）<br>只能通过滚轮或触控板触发</li>
<li>滚动到页面顶部和底部后也会继续触发</li>
</ul>
<h4 id="（3）防抖函数与节流函数"><a href="http://localhost:4000/#%EF%BC%883%EF%BC%89%E9%98%B2%E6%8A%96%E5%87%BD%E6%95%B0%E4%B8%8E%E8%8A%82%E6%B5%81%E5%87%BD%E6%95%B0" class="headerlink" title="（3）防抖函数与节流函数" target="_blank" rel="noopener"></a>（3）防抖函数与节流函数</h4><p>只叙述概念，之后文章具体分析源码与原理</p>
<p>根本原理是通过时间戳控制</p>
<h5 id="1-防抖函数"><a href="http://localhost:4000/#1-%E9%98%B2%E6%8A%96%E5%87%BD%E6%95%B0" class="headerlink" title="[1] 防抖函数" target="_blank" rel="noopener"></a>[1] 防抖函数</h5><p>同一个时间处理，当超过设定时间后才触发，</p>
<p><strong>核心实现思路</strong>：2个事件发生间隔小于某个时间点，推迟执行</p>
<h5 id="2-节流函数"><a href="http://localhost:4000/#2-%E8%8A%82%E6%B5%81%E5%87%BD%E6%95%B0" class="headerlink" title="[2] 节流函数" target="_blank" rel="noopener"></a>[2] 节流函数</h5><p>同一个事件处理，设定时间内只触发一次 </p>
<p><strong>核心实现思路</strong>：2个事件发生间隔大于某个时间点，就执行</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://www.neohuang.com/child/2018/09/11/js-reivew-event-mouse/" data-id="cjm8w7vkb000gkam76j8z942s" class="article-share-link"><i class="fa fa-share"></i>Compartir</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            <!--
    
        <a href="http://www.neohuang.com/child/2018/09/11/js-reivew-event-mouse/#comments" class="article-comment-link">Comentarios</a>
    
-->
        </footer>
    </div>
    
</article>



    <article id="post-js-reivew-event-level" class="article article-type-post" itemscope="" itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="http://localhost:4000/2018/09/11/js-reivew-event-level/" target="_blank" rel="noopener">js复习事件的优先级和事件对象</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="http://localhost:4000/2018/09/11/js-reivew-event-level/" target="_blank" rel="noopener">
            <time datetime="2018-09-10T16:00:00.000Z" itemprop="datePublished">2018-09-11</time>
        </a>
    </div>


                        
                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody" lg-uid="lg7">
        
            
            <h3 id="一、dom0-dom2-dom3事件区分"><a href="http://localhost:4000/#%E4%B8%80%E3%80%81dom0-dom2-dom3%E4%BA%8B%E4%BB%B6%E5%8C%BA%E5%88%86" class="headerlink" title="一、dom0 dom2 dom3事件区分" target="_blank" rel="noopener"></a>一、dom0 dom2 dom3事件区分</h3><p>上篇当中有提到html内联事件、属性事件和事件监听回调事件，那他们和dom0 dom2 dom3事件有什么关系呢，这里简述下：</p>
<p>DOM Level”是描述DOM对象，方法和行为的规范集合。更高级别的DOM规范建立在之前的级别上。变化发生在两个方面：</p>
<ul>
<li><p>dom0事件模型: html事件、属性事件</p>
</li>
<li><p>dom1事件模型: 1级DOM标准中并没有定义事件相关的内容，所以没有所谓的1级DOM事件模型。</p>
</li>
<li><p>dom2事件模型: 监听器回调事件</p>
</li>
<li><p>dom3事件模型: 与绑定事件无关</p>
</li>
</ul>
<h3 id="二、什么是事件优先级"><a href="http://localhost:4000/#%E4%BA%8C%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E4%BA%8B%E4%BB%B6%E4%BC%98%E5%85%88%E7%BA%A7" class="headerlink" title="二、什么是事件优先级" target="_blank" rel="noopener"></a>二、什么是事件优先级</h3><h4 id="解释：事件执行的顺序"><a href="http://localhost:4000/#%E8%A7%A3%E9%87%8A%EF%BC%9A%E4%BA%8B%E4%BB%B6%E6%89%A7%E8%A1%8C%E7%9A%84%E9%A1%BA%E5%BA%8F" class="headerlink" title="解释：事件执行的顺序" target="_blank" rel="noopener"></a>解释：事件执行的顺序</h4><h5 id="1-几个看实例之前需要知道的概念："><a href="http://localhost:4000/#1-%E5%87%A0%E4%B8%AA%E7%9C%8B%E5%AE%9E%E4%BE%8B%E4%B9%8B%E5%89%8D%E9%9C%80%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E6%A6%82%E5%BF%B5%EF%BC%9A" class="headerlink" title="(1) 几个看实例之前需要知道的概念：" target="_blank" rel="noopener"></a>(1) 几个看实例之前需要知道的概念：</h5><ul>
<li>html事件会被属性事件覆盖</li>
</ul>
<h5 id="2-dom-0-只存在事件冒泡"><a href="http://localhost:4000/#2-dom-0-%E5%8F%AA%E5%AD%98%E5%9C%A8%E4%BA%8B%E4%BB%B6%E5%86%92%E6%B3%A1" class="headerlink" title="(2) dom 0 只存在事件冒泡" target="_blank" rel="noopener"></a>(2) dom 0 只存在事件冒泡</h5><h5 id="3-dom2-支持事件冒泡和事件捕获"><a href="http://localhost:4000/#3-dom2-%E6%94%AF%E6%8C%81%E4%BA%8B%E4%BB%B6%E5%86%92%E6%B3%A1%E5%92%8C%E4%BA%8B%E4%BB%B6%E6%8D%95%E8%8E%B7" class="headerlink" title="(3) dom2 支持事件冒泡和事件捕获" target="_blank" rel="noopener"></a>(3) dom2 支持事件冒泡和事件捕获</h5><ul>
<li>事件目标阶段，按绑定顺序事件</li>
<li>冒泡阶段事件执行顺序，属性事件会比监听执行早（哪个时间先绑定哪个先执行）</li>
</ul>
<p>分析实例：</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">id</span>=<span class="string">"body"</span> <span class="attr">onclick</span>=<span class="string">"htmlEvent1()"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"container"</span> <span class="attr">onclick</span>=<span class="string">"htmlEvent2()"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"test"</span> <span class="attr">onclick</span>=<span class="string">"htmlEvent3"</span>&gt;</span>test<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> body = <span class="built_in">document</span>.getElementById(<span class="string">'body'</span>);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> container = <span class="built_in">document</span>.getElementById(<span class="string">'container'</span>);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> test = <span class="built_in">document</span>.getElementById(<span class="string">'test'</span>);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">    body.onclick = propsEvent1;</span></span><br><span class="line"><span class="undefined">    container.onclick = propsEvent2;</span></span><br><span class="line"><span class="undefined">    test.onclick = propsEvent3;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    body.addEventListener(<span class="string">'click'</span>,listenerEventC1,<span class="literal">true</span>);</span></span><br><span class="line"><span class="javascript">    container.addEventListener(<span class="string">'click'</span>,listenerEventC2,<span class="literal">true</span>);</span></span><br><span class="line"><span class="javascript">    test.addEventListener(<span class="string">'click'</span>,listenerEventC3,<span class="literal">true</span>);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    body.addEventListener(<span class="string">'click'</span>,listenerEventB1,<span class="literal">false</span>);</span></span><br><span class="line"><span class="javascript">    container.addEventListener(<span class="string">'click'</span>,listenerEventB2,<span class="literal">false</span>);</span></span><br><span class="line"><span class="javascript">    test.addEventListener(<span class="string">'click'</span>,listenerEventB3,<span class="literal">false</span>);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">htmlEvent1</span>(<span class="params"></span>) </span>{</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">'htmlEvent1'</span>);</span></span><br><span class="line"><span class="undefined">    }</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">htmlEvent2</span>(<span class="params"></span>) </span>{</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">'htmlEvent2'</span>);</span></span><br><span class="line"><span class="undefined">    }</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">htmlEvent3</span>(<span class="params"></span>) </span>{</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">'htmlEvent3'</span>);</span></span><br><span class="line"><span class="undefined">    }</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">propsEvent1</span>(<span class="params"></span>) </span>{</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">'propsEvent1'</span>);</span></span><br><span class="line"><span class="undefined">    }</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">propsEvent2</span>(<span class="params"></span>) </span>{</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">'propsEvent2'</span>);</span></span><br><span class="line"><span class="undefined">    }</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">propsEvent3</span>(<span class="params"></span>) </span>{</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">'propsEvent3'</span>);</span></span><br><span class="line"><span class="undefined">    }</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">listenerEventB1</span>(<span class="params"></span>) </span>{</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">'listenerEventB1'</span>);</span></span><br><span class="line"><span class="undefined">    }</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">listenerEventB2</span>(<span class="params"></span>) </span>{</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">'listenerEventB2'</span>);</span></span><br><span class="line"><span class="undefined">    }</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">listenerEventB3</span>(<span class="params"></span>) </span>{</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">'listenerEventB3  '</span>);</span></span><br><span class="line"><span class="undefined">    }</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">listenerEventC1</span>(<span class="params"></span>) </span>{</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">'listenerEventC1'</span>);</span></span><br><span class="line"><span class="undefined">    }</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">listenerEventC2</span>(<span class="params"></span>) </span>{</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">'listenerEventC2'</span>);</span></span><br><span class="line"><span class="undefined">    }</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">listenerEventC3</span>(<span class="params"></span>) </span>{</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">'listenerEventC3'</span>);</span></span><br><span class="line"><span class="undefined">    }</span></span><br><span class="line"><span class="undefined">    </span></span><br><span class="line"><span class="javascript"><span class="comment">// 捕获阶段执行开始   </span></span></span><br><span class="line"><span class="javascript"><span class="comment">// listenerEventC1</span></span></span><br><span class="line"><span class="javascript"><span class="comment">// listenerEventC2</span></span></span><br><span class="line"><span class="javascript"><span class="comment">// 捕获事件执行完毕</span></span></span><br><span class="line"><span class="javascript"><span class="comment">// 事件目标，按绑定顺序执行开始</span></span></span><br><span class="line"><span class="javascript"><span class="comment">// propsEvent3</span></span></span><br><span class="line"><span class="javascript"><span class="comment">// listenerEventC3</span></span></span><br><span class="line"><span class="javascript"><span class="comment">// listenerEventB3  </span></span></span><br><span class="line"><span class="javascript"><span class="comment">// 事件目标，按书写顺序执行结束</span></span></span><br><span class="line"><span class="javascript"><span class="comment">// 冒泡阶段开始，容器，根据书写顺序 （实际会是属性事件先执行，再监听起器）</span></span></span><br><span class="line"><span class="javascript"><span class="comment">// propsEvent2</span></span></span><br><span class="line"><span class="javascript"><span class="comment">//	listenerEventB2</span></span></span><br><span class="line"><span class="javascript"><span class="comment">// 冒泡阶段结束，容器，根据书写顺序</span></span></span><br><span class="line"><span class="javascript"><span class="comment">// 冒泡阶段开始，body，根据书写顺序 （实际会是属性事件先执行，再监听起器）</span></span></span><br><span class="line"><span class="javascript"><span class="comment">//	propsEvent1</span></span></span><br><span class="line"><span class="javascript"><span class="comment">//	listenerEventB1</span></span></span><br><span class="line"><span class="javascript"><span class="comment">// 冒泡阶段结束，body，根据书写顺序</span></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>原则一： 牢记事件绑定是浏览器绑定</li>
<li>原则二：事件向传播目标对象（捕获阶段），先出发事件监听</li>
<li>事件在目标阶段，按事件解析或事件被定义的事件执行 （简单理解可理解为js书写顺序）</li>
<li>事件上按事件解析或事件被定义的事件执行，如果包含html事件上执行，即使属性被覆盖了还是会先执行html事件（即被覆盖的属性事件）</li>
</ul>
<h4 id="4-事件传递和cs会影响事件传播有关（比如把外层div层级改动）"><a href="http://localhost:4000/#4-%E4%BA%8B%E4%BB%B6%E4%BC%A0%E9%80%92%E5%92%8Ccs%E4%BC%9A%E5%BD%B1%E5%93%8D%E4%BA%8B%E4%BB%B6%E4%BC%A0%E6%92%AD%E6%9C%89%E5%85%B3%EF%BC%88%E6%AF%94%E5%A6%82%E6%8A%8A%E5%A4%96%E5%B1%82div%E5%B1%82%E7%BA%A7%E6%94%B9%E5%8A%A8%EF%BC%89" class="headerlink" title="(4)事件传递和cs会影响事件传播有关（比如把外层div层级改动）" target="_blank" rel="noopener"></a>(4)事件传递和cs会影响事件传播有关（比如把外层div层级改动）</h4><p>不会，事件绑定与css显示不相关</p>
<p><strong>特例：</strong><br>假设绝对定位，住了遮挡元素 不会触发，（以弹窗插件为例）: 事件绑定只html结构有关</p>
<p><strong>特例中的特例：</strong></p>
<p>但是有一个例子可能会有事件穿透</p>
<p>移动端中的事件穿透：</p>
<p>touchstart touchend touchmove </p>
<ul>
<li><p>touch没有 300ms延迟</p>
</li>
<li><p>onclick 300ms延迟</p>
</li>
</ul>
<p>处理方式：</p>
<p>(1) 延迟消失弹窗</p>
<p>(2) 叠加层 300毫秒消失</p>
<h3 id="二、事件对象相关："><a href="http://localhost:4000/#%E4%BA%8C%E3%80%81%E4%BA%8B%E4%BB%B6%E5%AF%B9%E8%B1%A1%E7%9B%B8%E5%85%B3%EF%BC%9A" class="headerlink" title="二、事件对象相关：" target="_blank" rel="noopener"></a>二、事件对象相关：</h3><p>####（1）定义与兼容写法 </p>
<p>event：包含事件相关的所有信息</p>
<p>ie浏览器：绑定在window上</p>
<p>兼容性写法</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> e = e || <span class="built_in">window</span>.event</span><br></pre></td></tr></tbody></table></figure>
<p>为了更好的兼容IE浏览器和非ie浏览器。<br>在ie浏览器中,window.event是全局变量,在非ie中，就需要自己传入一个参数来获取event啦，所以就有了var e = e||window.event</p>
<p>####（2）事件对象常用属性</p>
<p>参考： <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Event" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/API/Event</a></p>
<ul>
<li><p>bubbles（只读）: 当前事件是否是冒泡事件 true：是，false：不是</p>
</li>
<li><p>cancelable: 代表当前事件是否可以取消默认行为：true： 可取消 （true可以passive优化） false：不可取消</p>
</li>
<li><p>currentTarget（只读）： 当前事件正在处理哪个元素</p>
</li>
<li><p>defaultPrevented（只读） ： 一个布尔值，表示了是否已经执行过了event.preventDefault()</p>
</li>
<li><p>detail： 事件相关的详细信息（数字表示，和事件api对比）</p>
</li>
<li><p>eventPhase(只读): 1捕获 2目标 3冒泡</p>
</li>
<li><p>target（只读）: 当前的目标元素是什么</p>
</li>
<li><p>Event.isTrusted（只读）：  指明事件是否是由浏览器（当用户点击实例后）或者由脚本（使用事件的创建方法，例如event.initEvent）启动。 （大部分都是浏览器事件，当然可以开发人员可以自定义生成）</p>
</li>
<li><p>Event.type(只读) : 类事件的类型（不区分大小写）。</p>
</li>
<li><p>Event.view ：关联视图，一般是当前window</p>
</li>
</ul>
<h4 id="（3）事件对象常用方法"><a href="http://localhost:4000/#%EF%BC%883%EF%BC%89%E4%BA%8B%E4%BB%B6%E5%AF%B9%E8%B1%A1%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95" class="headerlink" title="（3）事件对象常用方法" target="_blank" rel="noopener"></a>（3）事件对象常用方法</h4><ul>
<li>event.preventDefault</li>
</ul>
<p>取消事件（如果该事件可取消）: canable 为 true ，同时可以用passive优化，取消事件（如果该事件可取消）。</p>
<p>return fasle</p>
<ul>
<li>event.stopPropagation</li>
</ul>
<p>阻止事件进一步传播 （bubbles为true 可以调用, false不可），只阻止会往下层传播</p>
<ul>
<li>event.stopImmediatePropagation</li>
</ul>
<p>阻止事件进一步传播 （bubbles为true 可以调用, false不可），阻止传播之后函数不执行</p>
<p>阻止事件传播不会阻止事件默认行为，阻止事件默认行为，不会阻止事件传播</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://www.neohuang.com/child/2018/09/11/js-reivew-event-level/" data-id="cjm8w7vk9000ckam7d4lx4uy9" class="article-share-link"><i class="fa fa-share"></i>Compartir</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            <!--
    
        <a href="http://www.neohuang.com/child/2018/09/11/js-reivew-event-level/#comments" class="article-comment-link">Comentarios</a>
    
-->
        </footer>
    </div>
    
</article>



    <article id="post-js-review-event-op" class="article article-type-post" itemscope="" itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="http://localhost:4000/2018/09/06/js-review-event-op/" target="_blank" rel="noopener">js复习事件的基本操作</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="http://localhost:4000/2018/09/06/js-review-event-op/" target="_blank" rel="noopener">
            <time datetime="2018-09-05T16:00:00.000Z" itemprop="datePublished">2018-09-06</time>
        </a>
    </div>


                        
                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody" lg-uid="lg8">
        
            
            <h2 id="一、什么是事件"><a href="http://localhost:4000/#%E4%B8%80%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E4%BA%8B%E4%BB%B6" class="headerlink" title="一、什么是事件" target="_blank" rel="noopener"></a>一、什么是事件</h2><h3 id="1-定义"><a href="http://localhost:4000/#1-%E5%AE%9A%E4%B9%89" class="headerlink" title="1. 定义" target="_blank" rel="noopener"></a>1. 定义</h3><p>在js中事件通常是指发生某种于Dom元素、document对象、window对象 有关的预定义或自定义的时刻或契机，这些契机通常是预定义的并且程序上依赖于它们，以关联这些契机发生时候的的功能发生代码。</p>
<h3 id="2-相关基本概念"><a href="http://localhost:4000/#2-%E7%9B%B8%E5%85%B3%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5" class="headerlink" title="2. 相关基本概念" target="_blank" rel="noopener"></a>2. 相关基本概念</h3><h4 id="1-事件类型"><a href="http://localhost:4000/#1-%E4%BA%8B%E4%BB%B6%E7%B1%BB%E5%9E%8B" class="headerlink" title="(1)事件类型" target="_blank" rel="noopener"></a>(1)事件类型</h4><p>字符串，用来表示事件类型</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">onclick</span>=<span class="string">""</span>&gt;</span>来点我<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.addEventListener(<span class="string">'onclick'</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">'我是点击事件'</span>);</span></span><br><span class="line"><span class="undefined">    });</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="2-事件目标"><a href="http://localhost:4000/#2-%E4%BA%8B%E4%BB%B6%E7%9B%AE%E6%A0%87" class="headerlink" title="(2)事件目标" target="_blank" rel="noopener"></a>(2)事件目标</h4><p>指事件发生在哪个对象上(dom元素、document对象、window对象)。</p>
<h4 id="3-事件处理程序"><a href="http://localhost:4000/#3-%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E7%A8%8B%E5%BA%8F" class="headerlink" title="(3)事件处理程序" target="_blank" rel="noopener"></a>(3)事件处理程序</h4><p>当事件发生时，执行的函数</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">onclick</span>=<span class="string">"console.log('来点我')"</span>&gt;</span>来点我<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.addEventListener(<span class="string">'onclick'</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">'我是点击事件'</span>);</span></span><br><span class="line"><span class="undefined">    })</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="4-事件对象"><a href="http://localhost:4000/#4-%E4%BA%8B%E4%BB%B6%E5%AF%B9%E8%B1%A1" class="headerlink" title="(4)事件对象" target="_blank" rel="noopener"></a>(4)事件对象</h4><p>事件发生时，事件本身包含的信息的对象（event对象）</p>
<p>如：位置信息，具体操作,事件对象等</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"getEvent(event)"</span>&gt;</span>来点我<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">getEvent</span>(<span class="params">e</span>) </span>{</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(e); <span class="comment">// MouseEvent&nbsp;{clientX:27, clientY: 16, toElement: button ...}</span></span></span><br><span class="line"><span class="undefined">    }</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="5-事件流"><a href="http://localhost:4000/#5-%E4%BA%8B%E4%BB%B6%E6%B5%81" class="headerlink" title="(5)事件流" target="_blank" rel="noopener"></a>(5)事件流</h4><p>浏览器中事件传播的机制：</p>
<h5 id="1-事件冒泡："><a href="http://localhost:4000/#1-%E4%BA%8B%E4%BB%B6%E5%86%92%E6%B3%A1%EF%BC%9A" class="headerlink" title="[1]事件冒泡：" target="_blank" rel="noopener"></a>[1]事件冒泡：</h5><p>从具体节点到不具体节点，接受事件</p>
<h5 id="2-事件捕获："><a href="http://localhost:4000/#2-%E4%BA%8B%E4%BB%B6%E6%8D%95%E8%8E%B7%EF%BC%9A" class="headerlink" title="[2]事件捕获：" target="_blank" rel="noopener"></a>[2]事件捕获：</h5><p>从不具体节点到具体节点，接受事件</p>
<p>在事件达到节点之前，捕获事件，性能更好，移动设备上touch事件用捕获实现</p>
<p>ps: 规范中定义事件从document开始传播,但实际浏览器是从windows开始捕获（为了性能）</p>
<h5 id="3-IE事件流-基于事件冒泡，并且他们不基于W3C规范"><a href="http://localhost:4000/#3-IE%E4%BA%8B%E4%BB%B6%E6%B5%81-%E5%9F%BA%E4%BA%8E%E4%BA%8B%E4%BB%B6%E5%86%92%E6%B3%A1%EF%BC%8C%E5%B9%B6%E4%B8%94%E4%BB%96%E4%BB%AC%E4%B8%8D%E5%9F%BA%E4%BA%8EW3C%E8%A7%84%E8%8C%83" class="headerlink" title="[3]IE事件流 (基于事件冒泡，并且他们不基于W3C规范)" target="_blank" rel="noopener"></a>[3]IE事件流 (基于事件冒泡，并且他们不基于W3C规范)</h5><ul>
<li><p>EventTarget.attachEvent(type, listener)</p>
<ul>
<li>this指向window</li>
<li>执行顺序相反</li>
<li>detachEventEvent删除必须是同一引用</li>
</ul>
</li>
</ul>
<ul>
<li>EventTarget.detachEventEvent(type, listener)</li>
</ul>
<p>分两个阶段 </p>
<p>（1）事件目标</p>
<p>（2）事件冒泡</p>
<h5 id="4-dom2级别事件流（现代浏览器）："><a href="http://localhost:4000/#4-dom2%E7%BA%A7%E5%88%AB%E4%BA%8B%E4%BB%B6%E6%B5%81%EF%BC%88%E7%8E%B0%E4%BB%A3%E6%B5%8F%E8%A7%88%E5%99%A8%EF%BC%89%EF%BC%9A" class="headerlink" title="[4]dom2级别事件流（现代浏览器）：" target="_blank" rel="noopener"></a>[4]dom2级别事件流（现代浏览器）：</h5><p>添加事件处理程序</p>
<p>分三个阶段 </p>
<p>（1）事件捕获 （规范不设计涉及事件目标，但是实现里会触发事件对象）</p>
<p>（2）事件目标</p>
<p>（3）事件冒泡 （为了IE增加了事件冒泡）</p>
<h3 id="3-事件触发"><a href="http://localhost:4000/#3-%E4%BA%8B%E4%BB%B6%E8%A7%A6%E5%8F%91" class="headerlink" title="3.事件触发" target="_blank" rel="noopener"></a>3.事件触发</h3><h4 id="1-html事件"><a href="http://localhost:4000/#1-html%E4%BA%8B%E4%BB%B6" class="headerlink" title="(1) html事件" target="_blank" rel="noopener"></a>(1) html事件</h4><p>称为html内联属性或html事件</p>
<h5 id="1-如何触发"><a href="http://localhost:4000/#1-%E5%A6%82%E4%BD%95%E8%A7%A6%E5%8F%91" class="headerlink" title="[1] 如何触发" target="_blank" rel="noopener"></a>[1] 如何触发</h5><p>在dom元素上on + 事件名称 = “需要执行的函数” （需要括号，因为是执行函数）</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"getEvent(event)"</span>&gt;</span>html事件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>例子：</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"getEvent(event)"</span>&gt;</span>html事件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">getEvent</span>(<span class="params">e</span>) </span>{</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(e);</span></span><br><span class="line"><span class="undefined">    }</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h5 id="2-Html事件使用注意事项"><a href="http://localhost:4000/#2-Html%E4%BA%8B%E4%BB%B6%E4%BD%BF%E7%94%A8%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9" class="headerlink" title="[2] Html事件使用注意事项" target="_blank" rel="noopener"></a>[2] Html事件使用注意事项</h5><ul>
<li>Html不支持字符 需要转义</li>
<li>可以访问全局作用域下所有函数</li>
<li>有event 事件对象 </li>
<li>this的指针指向当前是触发事件的dom元素</li>
</ul>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;button onclick="htmlEvent(this)"&gt;HTML事件&lt;/button&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    function htmlEvent(_this) {</span><br><span class="line">        console.log(_this); // 不能直接打印this</span><br><span class="line">        console.log(this); // 指向window</span><br><span class="line">    }</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>可以通过setattribute 动态修改、移除事件</li>
</ul>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;button id=<span class="string">"button"</span> onclick=<span class="string">"htmlEvent(this)"</span>&gt;HTML事件&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;button onclick="removeEvent()"&gt;移除HTML事件&lt;/</span>button&gt;</span><br><span class="line">&lt;<span class="regexp">/body&gt;</span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">    var btn = document.getElementById('button');</span></span><br><span class="line"><span class="regexp">    function htmlEvent(_this) {</span></span><br><span class="line"><span class="regexp">        console.log(_this); /</span><span class="regexp">/ 不能直接打印this</span></span><br><span class="line"><span class="regexp">        console.log(this); /</span><span class="regexp">/ 指向window</span></span><br><span class="line"><span class="regexp">        btn.setAttribute('onclick',console.log('替换咯...'));</span></span><br><span class="line"><span class="regexp">    }</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    function removeEvent() {</span></span><br><span class="line"><span class="regexp">      btn.setAttribute('onclick',''); /</span><span class="regexp">/ 删除事件</span></span><br><span class="line"><span class="regexp">    }</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br></pre></td></tr></tbody></table></figure>
<h5 id="3-Html事件的缺点"><a href="http://localhost:4000/#3-Html%E4%BA%8B%E4%BB%B6%E7%9A%84%E7%BC%BA%E7%82%B9" class="headerlink" title="[3] Html事件的缺点" target="_blank" rel="noopener"></a>[3] Html事件的缺点</h5><ul>
<li>使用会存在时间差 写在body最后 try catch避免</li>
<li>html事件作用域,全局作用域访问限定对象会出问题</li>
<li>代码耦合问题(需要修改两个地方)</li>
</ul>
<h4 id="2-属性事件（dom-0事件）"><a href="http://localhost:4000/#2-%E5%B1%9E%E6%80%A7%E4%BA%8B%E4%BB%B6%EF%BC%88dom-0%E4%BA%8B%E4%BB%B6%EF%BC%89" class="headerlink" title="(2) 属性事件（dom 0事件）" target="_blank" rel="noopener"></a>(2) 属性事件（dom 0事件）</h4><h5 id="1-添加事件"><a href="http://localhost:4000/#1-%E6%B7%BB%E5%8A%A0%E4%BA%8B%E4%BB%B6" class="headerlink" title="[1] 添加事件" target="_blank" rel="noopener"></a>[1] 添加事件</h5><p>获取dom元素，将on + 事件名称的属性赋予相关函数</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"test"</span>&gt;</span>属性事件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> test = <span class="built_in">document</span>.getElementById(<span class="string">'test'</span>);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">    test.onclick = getEvent;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">getEvent</span>(<span class="params">e</span>) </span>{</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(e);</span></span><br><span class="line"><span class="undefined">    }</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h5 id="2-删除事件"><a href="http://localhost:4000/#2-%E5%88%A0%E9%99%A4%E4%BA%8B%E4%BB%B6" class="headerlink" title="[2] 删除事件" target="_blank" rel="noopener"></a>[2] 删除事件</h5><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;button id="button"&gt;HTML事件&lt;/button&gt;</span><br><span class="line">    &lt;button id="button2"&gt;移除HTML事件&lt;/button&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    var btn = document.getElementById('button');</span><br><span class="line">    var btn2 = document.getElementById('button2');</span><br><span class="line">    btn.onclick = htmlEvent;</span><br><span class="line">    btn2.onclick = removeEvent;</span><br><span class="line"></span><br><span class="line">    function htmlEvent() {</span><br><span class="line">        console.log(this); </span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    function removeEvent() {</span><br><span class="line">      btn.onclick = null;</span><br><span class="line">    }</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>
<h5 id="3-节点复制"><a href="http://localhost:4000/#3-%E8%8A%82%E7%82%B9%E5%A4%8D%E5%88%B6" class="headerlink" title="[3] 节点复制" target="_blank" rel="noopener"></a>[3] 节点复制</h5><p>事件会被复制，复制出来的事件不是指向同一个引用</p>
<h5 id="4-属性事件使用注意事项"><a href="http://localhost:4000/#4-%E5%B1%9E%E6%80%A7%E4%BA%8B%E4%BB%B6%E4%BD%BF%E7%94%A8%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9" class="headerlink" title="[4]属性事件使用注意事项" target="_blank" rel="noopener"></a>[4]属性事件使用注意事项</h5><ul>
<li><p>增加事件  事件处理程序（小写）</p>
  <figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">El.onclick</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>支持Event对象</p>
</li>
<li><p>This指向当前dom</p>
  <figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">htmlEvent</span>(<span class="params"></span>) </span>{</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>);  <span class="comment">// 指向当前dom</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
</li>
</ul>
<p>解决问题</p>
<ul>
<li>解决了时间差问题</li>
<li>降低了代码耦合性</li>
</ul>
<p>缺点</p>
<ul>
<li><p>一次只能指定一个事件</p>
  <figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;button id="test"&gt;属性事件&lt;/button&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    var test = document.getElementById('test');</span><br><span class="line">    test.onclick = hello;</span><br><span class="line"></span><br><span class="line">    test.onclick = world;</span><br><span class="line"></span><br><span class="line">    test.onclick = helloWolrd;</span><br><span class="line"></span><br><span class="line">    function hello() {</span><br><span class="line">      console.log('hello');</span><br><span class="line">    }</span><br><span class="line">    // world 会覆盖 world</span><br><span class="line">    function world() {</span><br><span class="line">      console.log('world');</span><br><span class="line">    }</span><br><span class="line">    // 必须放一个fp</span><br><span class="line">    function helloWolrd() {</span><br><span class="line">      console.log('hello');</span><br><span class="line">      console.log('world');</span><br><span class="line">    }</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>
</li>
</ul>
<h4 id="3-事件监听回调-（dom2）"><a href="http://localhost:4000/#3-%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC%E5%9B%9E%E8%B0%83-%EF%BC%88dom2%EF%BC%89" class="headerlink" title="(3) 事件监听回调 （dom2）" target="_blank" rel="noopener"></a>(3) 事件监听回调 （dom2）</h4><p>注意事件类型没有on</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"test"</span>&gt;</span>属性事件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> test = <span class="built_in">document</span>.getElementById(<span class="string">'test'</span>);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">getEvent</span>(<span class="params">e</span>) </span>{</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(e);</span></span><br><span class="line"><span class="undefined">    }</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    test.addEventListener(<span class="string">'click'</span>,getEvent);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>p.s: 没有dom1没有做事件相关规定</p>
<h4 id="1-绑定事件与删除事件"><a href="http://localhost:4000/#1-%E7%BB%91%E5%AE%9A%E4%BA%8B%E4%BB%B6%E4%B8%8E%E5%88%A0%E9%99%A4%E4%BA%8B%E4%BB%B6" class="headerlink" title="[1]绑定事件与删除事件" target="_blank" rel="noopener"></a>[1]绑定事件与删除事件</h4><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">target.addEventListener(type, listener, options);</span><br><span class="line"></span><br><span class="line">target.addEventListener(type, listener ,{<span class="attr">capture</span>: <span class="built_in">Boolean</span>, <span class="attr">passive</span>: <span class="built_in">Boolean</span>, <span class="attr">once</span>: <span class="built_in">Boolean</span>});</span><br><span class="line"></span><br><span class="line">target.addEventListener(type, listener, useCapture);</span><br><span class="line"></span><br><span class="line">target.addEventListener(type, listener[, useCapture, wantsUntrusted  ]); <span class="comment">// Gecko/Mozilla only</span></span><br></pre></td></tr></tbody></table></figure>
<ul>
<li><p>type 表示监听事件类型的字符串。</p>
</li>
<li><p>listener</p>
<p>  当所监听的事件类型触发时，会接收到一个事件通知（实现了 Event 接口的对象）对象。listener 必须是一个实现了 EventListener 接口的对象，或者是一个函数</p>
  <figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">'button'</span>);</span><br><span class="line"></span><br><span class="line">   btn.addEventListener(<span class="string">'click'</span>,handleEvent);</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">handleEvent</span>(<span class="params"></span>) </span>{</span><br><span class="line">       <span class="built_in">console</span>.log(<span class="keyword">this</span>); <span class="comment">// 指向当前dom</span></span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>options 可选<br>  一个指定有关 listener 属性的可选参数对象。可用的选项如下：</p>
<ul>
<li><p>capture:  Boolean，表示 listener 会在该类型的事件捕获阶段传播到该 EventTarget 时触发。</p>
<p>效果同useCapture可参考</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">'button'</span>);</span><br><span class="line"><span class="keyword">var</span> container = <span class="built_in">document</span>.getElementById(<span class="string">'container'</span>);</span><br><span class="line">btn.addEventListener(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'button'</span>); <span class="comment">// 后触发</span></span><br><span class="line">});</span><br><span class="line">	</span><br><span class="line">container.addEventListener(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'container'</span>); <span class="comment">// 先触发</span></span><br><span class="line">},{ <span class="attr">capture</span>: <span class="literal">true</span> });</span><br></pre></td></tr></tbody></table></figure>
</li>
</ul>
</li>
</ul>
<pre><code>- once:  Boolean，表示 listener 在添加之后最多只调用一次。如果是 true， listener 会在其被调用之后自动移除。

<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">'button'</span>);</span><br><span class="line">  btn.addEventListener(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'button'</span>); <span class="comment">// 只执行一次</span></span><br><span class="line">  },{<span class="attr">once</span>: <span class="literal">true</span>});</span><br></pre></td></tr></tbody></table></figure>


- passive: Boolean，表示 listener 永远不会调用 preventDefault()。如果 listener 仍然调用了这个函数，客户端将会忽略它并抛出一个控制台警告。
mozSystemGroup: 只能在 XBL 或者是 Firefox' chrome 使用，这是个 Boolean，表示 listener 被添加到 system group。

关于passive可以参考：[https://zhuanlan.zhihu.com/p/24555031](****)

具体之后文章会具体聊聊这个问题

- true的话浏览器会开2个线程为了提高性能， 
- 永远不会调用 preventDefault()
- 同一个dom对象，只要同一事件一个设置了passivefasle，浏览器都不会做性能优化，
- cancelable 为true都可以支持
</code></pre><p>option支持的安全检测例子:</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> passiveSupported = <span class="literal">false</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">try</span> {</span><br><span class="line">	  <span class="keyword">var</span> options = <span class="built_in">Object</span>.defineProperty({}, <span class="string">"passive"</span>, {</span><br><span class="line">	    get: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">	      passiveSupported = <span class="literal">true</span>;</span><br><span class="line">	    }</span><br><span class="line">	  });</span><br><span class="line">	</span><br><span class="line">	  <span class="built_in">window</span>.addEventListener(<span class="string">"test"</span>, <span class="literal">null</span>, options);</span><br><span class="line">	} <span class="keyword">catch</span>(err) {}</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>useCapture  可选<br>Boolean，是指在DOM树中，注册了该listener的元素，是否会先于它下方的任何事件目标，接收到该事件。沿着DOM树向上冒泡的事件不会触发被指定为use capture（也就是设为true）的listener。当一个元素嵌套了另一个元素，两个元素都对同一个事件注册了一个处理函数时，所发生的事件冒泡和事件捕获是两种不同的事件传播方式。事件传播模式决定了元素以哪个顺序接收事件。进一步的解释可以查看 事件流 及 JavaScript Event order 文档。 如果没有指定， useCapture 默认为 false 。 </li>
</ul>
<p>例子：父容器元素与子容器元素都为false:</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">'button'</span>);</span><br><span class="line"><span class="keyword">var</span> container = <span class="built_in">document</span>.getElementById(<span class="string">'container'</span>);</span><br><span class="line">btn.addEventListener(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'button'</span>); <span class="comment">// 先触发</span></span><br><span class="line">},<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">container.addEventListener(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'container'</span>); <span class="comment">// 后触发</span></span><br><span class="line">}, <span class="literal">false</span>);</span><br></pre></td></tr></tbody></table></figure>
<p>例子：父容器元素与子容器元素都为true:</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">'button'</span>);</span><br><span class="line"><span class="keyword">var</span> container = <span class="built_in">document</span>.getElementById(<span class="string">'container'</span>);</span><br><span class="line">btn.addEventListener(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'button'</span>); <span class="comment">// 后触发</span></span><br><span class="line">},<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">container.addEventListener(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'container'</span>); <span class="comment">// 先触发</span></span><br><span class="line">},<span class="literal">true</span>);</span><br></pre></td></tr></tbody></table></figure>
<p>例子：父容器元素为true与子容器元素false:</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">'button'</span>);</span><br><span class="line"><span class="keyword">var</span> container = <span class="built_in">document</span>.getElementById(<span class="string">'container'</span>);</span><br><span class="line">btn.addEventListener(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'button'</span>); <span class="comment">// 后触发</span></span><br><span class="line">},<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">container.addEventListener(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'container'</span>); <span class="comment">// 先触发</span></span><br><span class="line">},<span class="literal">true</span>);</span><br></pre></td></tr></tbody></table></figure>
<p>例子：父容器元素为false与子容器元素true:</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">'button'</span>);</span><br><span class="line"><span class="keyword">var</span> container = <span class="built_in">document</span>.getElementById(<span class="string">'container'</span>);</span><br><span class="line">btn.addEventListener(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'button'</span>); <span class="comment">// 先触发</span></span><br><span class="line">},<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">container.addEventListener(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'container'</span>); <span class="comment">// 后触发</span></span><br><span class="line">},<span class="literal">false</span>);</span><br></pre></td></tr></tbody></table></figure>
<p>注意事项：</p>
<ul>
<li>事件类别没有on 如click keydown</li>
<li>this指向window</li>
<li>useCapture默认是fasle表示冒泡，true表示捕获</li>
</ul>
<ul>
<li><p>wantsUntrusted  （only Gecko）<br>如果为 true , 则事件处理程序会接收网页自定义的事件。此参数只适用于 Gecko，主要用于附加组件的代码和浏览器本身。请见 Interaction between privileged and non-privileged pages.<br>在使用 options 对象中的特定值之前，最好确保用户的浏览器支持它，因为他并没有被所有浏览器所支持。查看更多细节关于option支持的安全检测。</p>
</li>
<li><p>删除事件处理程序</p>
</li>
</ul>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">target.removeEventListener(type, listener[, useCapture])</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>type：一个字符串，表示需要移除的事件类型，如 “click”。</li>
<li>listener： 需要移除的 EventListener 函数（先前使用 addEventListener 方法定义的）</li>
<li>useCapture 可选<br>指定需要移除的 EventListener 函数是否为事件捕获。如果无此参数，默认值为 false。</li>
</ul>
<p>注意事项</p>
<ul>
<li>用EventTarget.addEventListener指定，只能用EventTarget.removeEventListener删除</li>
<li>如果同一个监听事件分别为“事件捕获”和“事件冒泡”注册了一次，一共两次，这两次事件需要分别移除。两者不会互相干扰。</li>
</ul>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div id=<span class="string">"container"</span>&gt;</span><br><span class="line">        &lt;button id=<span class="string">"button"</span>&gt;事件&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button onclick="removeBubbleEvent()"&gt;删除冒泡事件&lt;/</span>button&gt;</span><br><span class="line">        &lt;button onclick=<span class="string">"removeCaptureEvent()"</span>&gt;删除捕获事件&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line"></span><br><span class="line">&lt;<span class="regexp">/body&gt;</span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">    var btn = document.getElementById('button');</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    btn.addEventListener('click',clickEvent,false);</span></span><br><span class="line"><span class="regexp">    btn.addEventListener('click',clickEvent,true);</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    function removeCaptureEvent(){</span></span><br><span class="line"><span class="regexp">      btn.removeEventListener('click',clickEvent,true);</span></span><br><span class="line"><span class="regexp">      console.log('removeCaptureEvent ')</span></span><br><span class="line"><span class="regexp">    }</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    function removeBubbleEvent(){</span></span><br><span class="line"><span class="regexp">      btn.removeEventListener('click',clickEvent,false);</span></span><br><span class="line"><span class="regexp">      console.log('removeBubbleEvent ')</span></span><br><span class="line"><span class="regexp">    }</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    function clickEvent(){</span></span><br><span class="line"><span class="regexp">        console.log('clickEvent');</span></span><br><span class="line"><span class="regexp">    }</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>删除的函数，必须与添加时函数同一引用</li>
</ul>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> div = <span class="built_in">document</span>.getElementById(<span class="string">'div'</span>);</span><br><span class="line"><span class="keyword">var</span> listener = <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>{</span><br><span class="line">  <span class="comment">/* do something here */</span></span><br><span class="line">};</span><br><span class="line">div.addEventListener(<span class="string">'click'</span>, listener, <span class="literal">false</span>);</span><br><span class="line">div.removeEventListener(<span class="string">'click'</span>, listener, <span class="literal">false</span>);</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"button"</span>&gt;</span>事件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"delEvent()"</span>&gt;</span>删除事件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">'button'</span>);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    btn.addEventListener(<span class="string">'click'</span>,clickEvent,<span class="literal">false</span>);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">delEvent</span>(<span class="params"></span>)</span>{</span></span><br><span class="line"><span class="javascript">      btn.removeEventListener(<span class="string">'click'</span>,clickEvent,<span class="literal">false</span>);</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">'removeEvent'</span>)</span></span><br><span class="line"><span class="undefined">    }</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">clickEvent</span>(<span class="params"></span>)</span>{</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">'clickEvent'</span>);</span></span><br><span class="line"><span class="undefined">    }</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="4-事件目标支持情况"><a href="http://localhost:4000/#4-%E4%BA%8B%E4%BB%B6%E7%9B%AE%E6%A0%87%E6%94%AF%E6%8C%81%E6%83%85%E5%86%B5" class="headerlink" title="(4) 事件目标支持情况" target="_blank" rel="noopener"></a>(4) 事件目标支持情况</h4><h5 id="1-element"><a href="http://localhost:4000/#1-element" class="headerlink" title="[1] element:" target="_blank" rel="noopener"></a>[1] element:</h5><p>[x] html事件</p>
<p>[x] 属性事件 (dom0 事件)</p>
<p>[x] 事件监听回调  （dom2事件）</p>
<h5 id="2-document"><a href="http://localhost:4000/#2-document" class="headerlink" title="[2] document:" target="_blank" rel="noopener"></a>[2] document:</h5><p>[x] html事件</p>
<p>[x] 属性事件 (dom0 事件)</p>
<p>[] 事件监听回调  （dom2事件）</p>
<h5 id="3-window"><a href="http://localhost:4000/#3-window" class="headerlink" title="[3] window:" target="_blank" rel="noopener"></a>[3] window:</h5><p>实际body标签通过frameset等来支持html事件</p>
<p>[x] html事件</p>
<p>[x] 属性事件 (dom0 事件)</p>
<p>[x] 事件监听回调  （dom2事件）</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://www.neohuang.com/child/2018/09/06/js-review-event-op/" data-id="cjm8w7vkg000mkam7wsrs57t0" class="article-share-link"><i class="fa fa-share"></i>Compartir</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            <!--
    
        <a href="http://www.neohuang.com/child/2018/09/06/js-review-event-op/#comments" class="article-comment-link">Comentarios</a>
    
-->
        </footer>
    </div>
    
</article>



    <article id="post-muti-npm" class="article article-type-post" itemscope="" itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="http://localhost:4000/2018/09/04/muti-npm/" target="_blank" rel="noopener">前端项目共享node_modules</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="http://localhost:4000/2018/09/04/muti-npm/" target="_blank" rel="noopener">
            <time datetime="2018-09-03T16:00:00.000Z" itemprop="datePublished">2018-09-04</time>
        </a>
    </div>


                        
                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody" lg-uid="lg9">
        
            
            <p><a href="./Neo_files/npm.jpg" title="" class="gallery-item" lg-event-uid="&amp;1"><img src="./Neo_files/npm.jpg" alt=""></a></p>
<h3 id="1-前言"><a href="http://localhost:4000/#1-%E5%89%8D%E8%A8%80" class="headerlink" title="1. 前言" target="_blank" rel="noopener"></a>1. 前言</h3><p>在npm、yarn等包管理工具的帮助下，前端工程化模块化的进程日益加快，项目的依赖包也日益增大，特别是若项目采用webpack来构建用到许多webpack的插件以及一些Browsersync之类的插件，项目中的node_module就会变的十分庞大。</p>
<p>因此团队开发者每次重新初始化项目进行npm install会十分缓慢，并且若占用大量空间，更进一步来说项目中往往很多前端团队会用到一台构建服务器，对前端项目的代码获取、打包、构建、部署进行管理（例如我自己所在的团队就在使用jenkins对前端项目的打包、构建、部署进行自动化托管）。npm这样的项目级依赖管理的特性就会造成大量的时间以及资源的消耗。</p>
<p>同时笔者也想在文章开始之前表明一个态度，npm本身portable的模块化设计，使每个项目互不干系，也是一种它设计的精华所在，本文仅是针对实际使用中遇到的一些小困扰进行解读，希望提供一个新的思路。</p>
<p>此本篇文章就在这样的背景下诞生了。纯粹是笔者在项目中积累的一些经验，若有不足望指出。</p>
<h3 id="2-问题的总结"><a href="http://localhost:4000/#2-%E9%97%AE%E9%A2%98%E7%9A%84%E6%80%BB%E7%BB%93" class="headerlink" title="2. 问题的总结" target="_blank" rel="noopener"></a>2. 问题的总结</h3><p>接前言，若不对项目做任何优化以及设置正常一般前端项目的依赖应该是这样的：</p>
<p>如图：</p>
<p><a href="./Neo_files/npm-1.png" title="" class="gallery-item" lg-event-uid="&amp;2"><img src="./Neo_files/npm-1.png" alt=""></a></p>
<p>可以看到图中 webpackA 与 webpackB项目在devDependencies层面其实只有less和sass，以及他们两者的webpackloader的差异，但是其项目中的node_modules剩余的依赖都会被重复获取。parcel项目A项目A 与 parcel项目B项目B同理,项目中的devDependencies只有parcel-plugin-vue 1.5.0和babel-preset-react有区别。</p>
<p>p.s: </p>
<p><strong>1. dependencies一般项目都会有较大差异，因此不在本文讨论范围，该图还是列出以便更接近现实状况</strong></p>
<p><strong>2. 使用webpack和parcel技术栈也可能会有一部分devDependencies，但本文暂不考虑两个项目差异极大的node_modules共享</strong></p>
<p>这样的情况，总结如下来会带来如下问题：</p>
<ul>
<li>项目devDependencies以及dependencies过多造成项目初始化过慢。</li>
<li>各个项目devDependencies大量重复，打包时项目占用空间过大。</li>
</ul>
<p>这样的问题在项目数不大时并不会明显体现，并且这些重复很大一部分是因为构建是devDependencies中的依赖所导致的。</p>
<h3 id="3-现有的一些解决方案以及存在的一些问题"><a href="http://localhost:4000/#3-%E7%8E%B0%E6%9C%89%E7%9A%84%E4%B8%80%E4%BA%9B%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E4%BB%A5%E5%8F%8A%E5%AD%98%E5%9C%A8%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98" class="headerlink" title="3. 现有的一些解决方案以及存在的一些问题" target="_blank" rel="noopener"></a>3. 现有的一些解决方案以及存在的一些问题</h3><p>那难道没有方法让几个项目的依赖指向同一路径吗？答案当然是有</p>
<h4 id="1-解决办法"><a href="http://localhost:4000/#1-%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95" class="headerlink" title="(1)解决办法" target="_blank" rel="noopener"></a>(1)解决办法</h4><p>可以通过配置NODE_PATH，具体来说就是：</p>
<p>在对应系统的环境变量配置文件中增加环境变量NODE_PATH，例如在MacOS中</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /ect/profile <span class="comment"># 或/etc/bashrc或~/.bashrc此处不赘述配置问价的加载顺序以及原理</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-&gt; <span class="built_in">export</span> PATH=<span class="variable">$PATH</span>: <span class="comment"># 将 /usr/bin 追加到 PATH 变量中</span></span><br><span class="line">-&gt; <span class="built_in">export</span> NODE_PATH=<span class="string">"/usr/lib/node_modules;/usr/local/lib/node_modules"</span> <span class="comment">#指定 NODE_PATH 变量</span></span><br></pre></td></tr></tbody></table></figure>
<p>那 NODE_PATH 就是NODE中用来寻找模块所提供的路径注册环境变量。我们可以使用上面的方法指定NODE_PATH环境变量。并且用;分割多个不同的目录。</p>
<p>关于 node 的包加载机制我就不在这里赘述了。NODE_PATH中的路径被遍历是发生在<br>从项目的根位置递归搜寻 node_modules 目录，直到文件系统根目录的 node_modules，如果还没有查找到指定模块的话，就会去 NODE_PATH中注册的路径中查找。</p>
<h4 id="2-存在问题"><a href="http://localhost:4000/#2-%E5%AD%98%E5%9C%A8%E9%97%AE%E9%A2%98" class="headerlink" title="(2)存在问题" target="_blank" rel="noopener"></a>(2)存在问题</h4><p>经过调整后，依赖的结构目前变为了：</p>
<p>如图：</p>
<p>看似不错让多个项目指向的依赖指向了全局的node_modules，但这种方式存在很明显的缺点：</p>
<h5 id="a-不会生成package-json-无法增量安装"><a href="http://localhost:4000/#a-%E4%B8%8D%E4%BC%9A%E7%94%9F%E6%88%90package-json-%E6%97%A0%E6%B3%95%E5%A2%9E%E9%87%8F%E5%AE%89%E8%A3%85" class="headerlink" title="a. 不会生成package.json,无法增量安装" target="_blank" rel="noopener"></a>a. 不会生成package.json,无法增量安装</h5><p>在使用 –global 参数的时候 –save 或 –save-dev参数是无效的。<br>此时 package.json 中的 dependencies, devDependencies 将无法享受到npm增量更新带来的便利，不使用 dependencies, devDependencies 字段对整个依赖库的管理是非常不利的。</p>
<h5 id="b-若项目模块出现版本差异，很难维护以及解决"><a href="http://localhost:4000/#b-%E8%8B%A5%E9%A1%B9%E7%9B%AE%E6%A8%A1%E5%9D%97%E5%87%BA%E7%8E%B0%E7%89%88%E6%9C%AC%E5%B7%AE%E5%BC%82%EF%BC%8C%E5%BE%88%E9%9A%BE%E7%BB%B4%E6%8A%A4%E4%BB%A5%E5%8F%8A%E8%A7%A3%E5%86%B3" class="headerlink" title="b.若项目模块出现版本差异，很难维护以及解决" target="_blank" rel="noopener"></a>b.若项目模块出现版本差异，很难维护以及解决</h5><p>差异性的解决方法<br>如果 项目A 使用了，express的3.x版本，项目B 使用了 express的4.x版本，那这种情况该怎么办呢？</p>
<p>如图：</p>
<p>可以将 NODE_PATH 指定的位置中存放 webpack的3.x版本，项目B需要webpack 目录中放置 2.x 版本呢？</p>
<p>可以利用node_module依赖包加载的机制，将webpack的3.x版本放在项目A自己的node_modules中</p>
<p>，这样确实可以解决了模块版本差异性问题，并不能做到根据让项目按技术框架去划分并且因为若项目数量多，依然无法做到统一管理，当然这种灵活使用node_module依赖包加载的机制仍十分有借鉴意义，也启发了我们可以使用一个更灵活的方式去解决问题。</p>
<h3 id="4-进一步增强以及改进的方案"><a href="http://localhost:4000/#4-%E8%BF%9B%E4%B8%80%E6%AD%A5%E5%A2%9E%E5%BC%BA%E4%BB%A5%E5%8F%8A%E6%94%B9%E8%BF%9B%E7%9A%84%E6%96%B9%E6%A1%88" class="headerlink" title="4.进一步增强以及改进的方案" target="_blank" rel="noopener"></a>4.进一步增强以及改进的方案</h3><p>总而言之上述两种方式，在实际使用中都存在一定的问题。</p>
<p><strong>目前笔者的理想方案应该能够达到下列几个目的：</strong></p>
<ul>
<li><p>可以将项目构建相似技术栈的项目统一在一起，共享依赖</p>
</li>
<li><p>可以实现对公共模块的维护和管理，并实现增量安装</p>
</li>
<li><p>对原来npm install流程改动不会太大</p>
</li>
</ul>
<p><strong>因此笔者我经过了一系列的实践，采用了这种结构去维护模块，以下是主要思路：</strong></p>
<ul>
<li><p>由于node的包加载机制是从项目的根位置递归搜寻 node_modules 目录，因此我们只需要向当前项目的上层的node_modules安装依赖，既可以使项目正常引入。</p>
</li>
<li><p>对于相同构建技术栈的项目，建立一个框架目录，并将相同技术栈项目放在该目录中，在此目录下的node_modules和package.json中管理以及共享依赖包，项目目录如: webpack、gulp</p>
</li>
<li><p>在每个项目框架下维护一个自己的package.json以及一个框架级的node_modules，为了更好的区分哪些是我们框架需要的依赖包，并仍可以在项目中直接操作，故我们在项目级增加一个devDependenciesGlobal字段以从项目层面更好的维护公共框架的依赖</p>
</li>
<li><p>使用nodejs、shell脚本，结合npm script中的preinstall hook npm install的流程进行一些补充</p>
</li>
<li><p>在框架目录中建立带有md5的package.json来维护、管理公共的依赖</p>
</li>
<li><p>检查框架目录下是否存在package.json，若不存在视为需要初始化</p>
</li>
<li><p>若被视为初始化，会生成一个含有devDependenciesGlobal指纹的package.json，并在这个package.json的devDependencies写入，devDependenciesGlobal中所有描述的依赖</p>
</li>
<li><p>若已存在，跳过此步骤对项目自己的devdependencies以及devDependencies进行安装</p>
</li>
<li><p>若md5改变，则进行npm install，此时npm install会对借助npm本身的机制，对包进行分析，进行增量安装或更新</p>
</li>
</ul>
<p>故按这种结构来管理，假设团队项目中有2套技术框架 A: webpack B: gulp</p>
<p>调整下的依赖关系图：</p>
<p>如图:</p>
<p>示例webpack项目的github地址：<a href="https://github.com/Roxyhuang/npm-module-share" target="_blank" rel="noopener">https://github.com/Roxyhuang/npm-module-share</a></p>
<p>下面是本人的一些具体实践的核心代码以及，希望能够对大家有所启发：</p>
<h4 id="1-按技术框架划分项目目录，并增加devDependenciesGlobal"><a href="http://localhost:4000/#1-%E6%8C%89%E6%8A%80%E6%9C%AF%E6%A1%86%E6%9E%B6%E5%88%92%E5%88%86%E9%A1%B9%E7%9B%AE%E7%9B%AE%E5%BD%95%EF%BC%8C%E5%B9%B6%E5%A2%9E%E5%8A%A0devDependenciesGlobal" class="headerlink" title="(1)按技术框架划分项目目录，并增加devDependenciesGlobal" target="_blank" rel="noopener"></a>(1)按技术框架划分项目目录，并增加devDependenciesGlobal</h4><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"dependencies"</span>: {</span><br><span class="line">  <span class="string">"react"</span>: <span class="string">"^16.2.0"</span>,</span><br><span class="line">  <span class="string">"react-dom"</span>: <span class="string">"^16.2.0"</span></span><br><span class="line">},</span><br><span class="line"><span class="string">"devDependencies"</span>: {</span><br><span class="line">  <span class="string">"babel-cli"</span>: <span class="string">"6.26.0"</span>,</span><br><span class="line">  <span class="string">"babel-plugin-transform-decorators-legacy"</span>: <span class="string">"1.3.4"</span>,</span><br><span class="line">  <span class="string">"babel-plugin-transform-runtime"</span>: <span class="string">"6.23.0"</span>,</span><br><span class="line">  <span class="string">"babel-polyfill"</span>: <span class="string">"6.23.0"</span>,</span><br><span class="line">  <span class="string">"babel-preset-env"</span>: <span class="string">"1.6.0"</span>,</span><br><span class="line">  <span class="string">"babel-preset-react"</span>: <span class="string">"6.24.1"</span>,</span><br><span class="line">  <span class="string">"babel-preset-stage-0"</span>: <span class="string">"6.24.1"</span></span><br><span class="line">},</span><br><span class="line"><span class="string">"devDependenciesGlobal"</span>: {</span><br><span class="line">  <span class="string">"babel-core"</span>: <span class="string">"6.26.0"</span>,</span><br><span class="line">  <span class="string">"babel-loader"</span>: <span class="string">"7.1.2"</span>,</span><br><span class="line">  <span class="string">"chalk"</span>: <span class="string">"2.1.0"</span>,</span><br><span class="line">  <span class="string">"css-loader"</span>: <span class="string">"0.28.4"</span>,</span><br><span class="line">  <span class="string">"connect-history-api-fallback"</span>: <span class="string">"1.3.0"</span>,</span><br><span class="line">  <span class="string">"express"</span>: <span class="string">"4.16.1"</span>,</span><br><span class="line">  <span class="string">"webpack"</span>: <span class="string">"3.6.0"</span>,</span><br><span class="line">  <span class="string">"style-loader"</span>: <span class="string">"0.18.2"</span>,</span><br><span class="line">  <span class="string">"less"</span>: <span class="string">"2.7.3"</span>,</span><br><span class="line">  <span class="string">"rimraf"</span>: <span class="string">"2.6.1"</span>,</span><br><span class="line">  <span class="string">"html-webpack-plugin"</span>: <span class="string">"2.30.1"</span>,</span><br><span class="line">  <span class="string">"less-loader"</span>: <span class="string">"4.0.5"</span>,</span><br><span class="line">  <span class="string">"webpack-dev-middleware"</span>: <span class="string">"1.12.0"</span>,</span><br><span class="line">  <span class="string">"webpack-hot-middleware"</span>: <span class="string">"2.19.1"</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="2-利用npm-script的hook机制，增加preinstall脚本"><a href="http://localhost:4000/#2-%E5%88%A9%E7%94%A8npm-script%E7%9A%84hook%E6%9C%BA%E5%88%B6%EF%BC%8C%E5%A2%9E%E5%8A%A0preinstall%E8%84%9A%E6%9C%AC" class="headerlink" title="(2)利用npm script的hook机制，增加preinstall脚本" target="_blank" rel="noopener"></a>(2)利用npm script的hook机制，增加preinstall脚本</h4><p>接下来为了更好和本身npm依赖管理机制结合的更好，可以利用npm script的hook，在script中增加preinstall</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: {</span><br><span class="line">  <span class="string">"preinstall"</span>: <span class="string">"node build/script/preinstall.js"</span></span><br><span class="line">},</span><br></pre></td></tr></tbody></table></figure>
<p>下面是具体的node.js代码：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> exec = <span class="built_in">require</span>(<span class="string">'child_process'</span>).exec;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> preList = <span class="built_in">require</span>(<span class="string">'../../package.json'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">'crypto'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> execPath = path.resolve(<span class="string">'../'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> preListObj = preList.devDependenciesGlobal;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> preListObjArray = <span class="built_in">Object</span>.keys(preListObj);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isFirst = !fs.existsSync(<span class="string">`<span class="subst">${execPath}</span>/package.json`</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> currentMd5 = md5(<span class="built_in">JSON</span>.stringify(preListObj));</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> script = <span class="string">`cd <span class="subst">${execPath}</span> &amp;&amp; npm i`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> isUpdate = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`The md5 for this project: <span class="subst">${currentMd5}</span>`</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> md5 = <span class="function"><span class="keyword">function</span> (<span class="params">str</span>) </span>{</span><br><span class="line">  <span class="keyword">const</span> md5sum = crypto.createHash(<span class="string">'md5'</span>);</span><br><span class="line">  md5sum.update(str);</span><br><span class="line">  str = md5sum.digest(<span class="string">'hex'</span>);</span><br><span class="line">  <span class="keyword">return</span> str;</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (isFirst){</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'init global modules...'</span>);</span><br><span class="line">  fs.writeFileSync(<span class="string">`<span class="subst">${execPath}</span>/package.json`</span>, <span class="built_in">JSON</span>.stringify({<span class="string">"md5"</span>: currentMd5,<span class="attr">dependencies</span>: preListObj}));</span><br><span class="line">  isUpdate = <span class="literal">true</span>;</span><br><span class="line">} <span class="keyword">else</span> {</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'will check update'</span>);</span><br><span class="line">  <span class="keyword">const</span> lastVersion = <span class="built_in">require</span>(<span class="string">`<span class="subst">${execPath}</span>/package.json`</span>).md5;</span><br><span class="line">  <span class="keyword">if</span> (lastVersion !== currentMd5) {</span><br><span class="line">    fs.writeFileSync(<span class="string">`<span class="subst">${execPath}</span>/package.json`</span>, <span class="built_in">JSON</span>.stringify({<span class="string">"md5"</span>: currentMd5,<span class="attr">dependencies</span>: preListObj}));</span><br><span class="line">    isUpdate = <span class="literal">true</span>;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (isUpdate) {</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`will install in <span class="subst">${execPath}</span>`</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'start install public package for neo-antd'</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'please wait some minutes.....'</span>);</span><br><span class="line"></span><br><span class="line">  exec(script, <span class="function"><span class="keyword">function</span> (<span class="params">err, stdout, stderr</span>) </span>{</span><br><span class="line">    <span class="built_in">console</span>.log(stdout);</span><br><span class="line">    <span class="keyword">if</span> (err) {</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'error:'</span> + stderr);</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">      <span class="built_in">console</span>.log(stdout);</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'package init success'</span>);</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`The global install in <span class="subst">${execPath}</span>`</span>);</span><br><span class="line">    }</span><br><span class="line">  });</span><br><span class="line"></span><br><span class="line">} <span class="keyword">else</span> {</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'not any update'</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'will be run next'</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="（3）-通过node-js生成package-json，并维护md5安装框架级依赖"><a href="http://localhost:4000/#%EF%BC%883%EF%BC%89-%E9%80%9A%E8%BF%87node-js%E7%94%9F%E6%88%90package-json%EF%BC%8C%E5%B9%B6%E7%BB%B4%E6%8A%A4md5%E5%AE%89%E8%A3%85%E6%A1%86%E6%9E%B6%E7%BA%A7%E4%BE%9D%E8%B5%96" class="headerlink" title="（3） 通过node.js生成package.json，并维护md5安装框架级依赖" target="_blank" rel="noopener"></a>（3） 通过node.js生成package.json，并维护md5安装框架级依赖</h4><figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  <span class="attr">"md5"</span>: <span class="string">"4c4ee67828b3e09f07b17774cb1633c7"</span>,</span><br><span class="line">  <span class="attr">"dependencies"</span>: {</span><br><span class="line">    <span class="attr">"babel-core"</span>: <span class="string">"6.26.0"</span>,</span><br><span class="line">    <span class="attr">"babel-loader"</span>: <span class="string">"7.1.2"</span>,</span><br><span class="line">    <span class="attr">"chalk"</span>: <span class="string">"2.1.0"</span>,</span><br><span class="line">    <span class="attr">"css-loader"</span>: <span class="string">"0.28.4"</span>,</span><br><span class="line">    <span class="attr">"connect-history-api-fallback"</span>: <span class="string">"1.3.0"</span>,</span><br><span class="line">    <span class="attr">"express"</span>: <span class="string">"4.16.1"</span>,</span><br><span class="line">    <span class="attr">"webpack"</span>: <span class="string">"3.6.0"</span>,</span><br><span class="line">    <span class="attr">"style-loader"</span>: <span class="string">"0.18.2"</span>,</span><br><span class="line">    <span class="attr">"less"</span>: <span class="string">"2.7.3"</span>,</span><br><span class="line">    <span class="attr">"rimraf"</span>: <span class="string">"2.6.1"</span>,</span><br><span class="line">    <span class="attr">"html-webpack-plugin"</span>: <span class="string">"2.30.1"</span>,</span><br><span class="line">    <span class="attr">"less-loader"</span>: <span class="string">"4.0.5"</span>,</span><br><span class="line">    <span class="attr">"webpack-dev-middleware"</span>: <span class="string">"1.12.0"</span>,</span><br><span class="line">    <span class="attr">"webpack-hot-middleware"</span>: <span class="string">"2.19.1"</span></span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="4-初始化项目，并在框架目录生成存有md的package-json"><a href="http://localhost:4000/#4-%E5%88%9D%E5%A7%8B%E5%8C%96%E9%A1%B9%E7%9B%AE%EF%BC%8C%E5%B9%B6%E5%9C%A8%E6%A1%86%E6%9E%B6%E7%9B%AE%E5%BD%95%E7%94%9F%E6%88%90%E5%AD%98%E6%9C%89md%E7%9A%84package-json" class="headerlink" title="(4) 初始化项目，并在框架目录生成存有md的package.json" target="_blank" rel="noopener"></a>(4) 初始化项目，并在框架目录生成存有md的package.json</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">npm install <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">&gt; npm-module-share@1.0.0 preinstall /Users/neo/home/webpack/npm-module-share</span><br><span class="line">&gt; node build/script/preinstall.js</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">The md5 <span class="keyword">for</span> this project: 4c4ee67828b3e09f07b17774cb1633c7</span><br><span class="line">init global modules...</span><br><span class="line">will install <span class="keyword">in</span> /Users/neo/home/webpack</span><br><span class="line">start install public package <span class="keyword">for</span> neo-antd</span><br><span class="line">please <span class="built_in">wait</span> some minutes....</span><br><span class="line"></span><br><span class="line">....</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">added 704 packages <span class="keyword">in</span> 7.777s</span><br><span class="line"></span><br><span class="line">package init success</span><br><span class="line">The global install <span class="keyword">in</span> /Users/neo/home/webpack</span><br><span class="line"></span><br><span class="line">....</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt; fsevents@1.1.3 install /Users/neo/home/webpack/npm-module-share/node_modules/fsevents</span><br><span class="line">&gt; node install</span><br><span class="line"></span><br><span class="line">[fsevents] Success: <span class="string">"/Users/neo/home/webpack/npm-module-share/node_modules/fsevents/lib/binding/Release/node-v57-darwin-x64/fse.node"</span> already installed</span><br><span class="line">Pass --update-binary to reinstall or --build-from-source to recompile</span><br><span class="line">npm WARN npm-module-share@1.0.0 No description</span><br><span class="line"></span><br><span class="line">added 341 packages <span class="keyword">in</span> 13.46s</span><br></pre></td></tr></tbody></table></figure>
<h4 id="5-检查md5是否存在变化，判断是否需要进行增量安装"><a href="http://localhost:4000/#5-%E6%A3%80%E6%9F%A5md5%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%E5%8F%98%E5%8C%96%EF%BC%8C%E5%88%A4%E6%96%AD%E6%98%AF%E5%90%A6%E9%9C%80%E8%A6%81%E8%BF%9B%E8%A1%8C%E5%A2%9E%E9%87%8F%E5%AE%89%E8%A3%85" class="headerlink" title="(5)    检查md5是否存在变化，判断是否需要进行增量安装" target="_blank" rel="noopener"></a>(5)    检查md5是否存在变化，判断是否需要进行增量安装</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">npm install <span class="comment"># 若没有任何更新，md5不会有任何变化，也不会再对会直接跳过preinstall的步骤</span></span><br><span class="line"></span><br><span class="line">The md5 <span class="keyword">for</span> this project: 4c4ee67828b3e09f07b17774cb1633c7</span><br><span class="line">will check update</span><br><span class="line">not any update</span><br><span class="line">will be run next</span><br><span class="line">npm WARN npm-module-share@1.0.0 No description</span><br><span class="line"></span><br><span class="line">update <span class="keyword">in</span> 1.291s</span><br></pre></td></tr></tbody></table></figure>
<h4 id="6-几点需要注意的地方"><a href="http://localhost:4000/#6-%E5%87%A0%E7%82%B9%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84%E5%9C%B0%E6%96%B9" class="headerlink" title="(6) 几点需要注意的地方" target="_blank" rel="noopener"></a>(6) 几点需要注意的地方</h4><h5 id="a-npm-script中直接需要调用的模块，需要放置到该项目的dependencies和devDependencies中"><a href="http://localhost:4000/#a-npm-script%E4%B8%AD%E7%9B%B4%E6%8E%A5%E9%9C%80%E8%A6%81%E8%B0%83%E7%94%A8%E7%9A%84%E6%A8%A1%E5%9D%97%EF%BC%8C%E9%9C%80%E8%A6%81%E6%94%BE%E7%BD%AE%E5%88%B0%E8%AF%A5%E9%A1%B9%E7%9B%AE%E7%9A%84dependencies%E5%92%8CdevDependencies%E4%B8%AD" class="headerlink" title="a. npm script中直接需要调用的模块，需要放置到该项目的dependencies和devDependencies中" target="_blank" rel="noopener"></a>a. npm script中直接需要调用的模块，需要放置到该项目的dependencies和devDependencies中</h5><p>关于这点阮一峰前辈的博客中: <a href="http://www.ruanyifeng.com/blog/2016/10/npm_scripts.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2016/10/npm_scripts.html</a></p>
<p>在对npm script的原理中有提到，在此因为篇幅有限不赘述了，简单来说就是npm script当中用到的模块需要存在当前项目的devdependencies或devDependencies中。</p>
<h5 id="b-经过测试在windows下需要将babel以及babelrc相关的依赖"><a href="http://localhost:4000/#b-%E7%BB%8F%E8%BF%87%E6%B5%8B%E8%AF%95%E5%9C%A8windows%E4%B8%8B%E9%9C%80%E8%A6%81%E5%B0%86babel%E4%BB%A5%E5%8F%8Ababelrc%E7%9B%B8%E5%85%B3%E7%9A%84%E4%BE%9D%E8%B5%96" class="headerlink" title="b. 经过测试在windows下需要将babel以及babelrc相关的依赖" target="_blank" rel="noopener"></a>b. 经过测试在windows下需要将babel以及babelrc相关的依赖</h5><p>目前这点笔者暂时还没有找到原因，在mac中并不会报错，但是在windows中会包找不到这些模块。</p>
<p>希望知道的同行能够与我联系告知我具体原因</p>
<h5 id="c-若有eslint需要增加-eslintignore"><a href="http://localhost:4000/#c-%E8%8B%A5%E6%9C%89eslint%E9%9C%80%E8%A6%81%E5%A2%9E%E5%8A%A0-eslintignore" class="headerlink" title="c. 若有eslint需要增加 .eslintignore" target="_blank" rel="noopener"></a>c. 若有eslint需要增加 .eslintignore</h5><h5 id="d-需要尽量保证一套技术框架下的devDependenciesGlobal尽量一致"><a href="http://localhost:4000/#d-%E9%9C%80%E8%A6%81%E5%B0%BD%E9%87%8F%E4%BF%9D%E8%AF%81%E4%B8%80%E5%A5%97%E6%8A%80%E6%9C%AF%E6%A1%86%E6%9E%B6%E4%B8%8B%E7%9A%84devDependenciesGlobal%E5%B0%BD%E9%87%8F%E4%B8%80%E8%87%B4" class="headerlink" title="d. 需要尽量保证一套技术框架下的devDependenciesGlobal尽量一致" target="_blank" rel="noopener"></a>d. 需要尽量保证一套技术框架下的devDependenciesGlobal尽量一致</h5><h3 id="结语："><a href="http://localhost:4000/#%E7%BB%93%E8%AF%AD%EF%BC%9A" class="headerlink" title="结语：" target="_blank" rel="noopener"></a>结语：</h3><p>经过上述操作，我们便可以将前端项目根据框架进行依赖管理以及划分了，其实如此改进仍并非最完美以及优化，不足之处仍非常之多，如：同一技术框架下，框架依赖包的升级策略并不完善，期待更加优雅的解决方案，使我们前端项目的架构更佳健壮和灵活。</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://www.neohuang.com/child/2018/09/04/muti-npm/" data-id="cjm8w7vkj000qkam7vg0e86zq" class="article-share-link"><i class="fa fa-share"></i>Compartir</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            <!--
    
        <a href="http://www.neohuang.com/child/2018/09/04/muti-npm/#comments" class="article-comment-link">Comentarios</a>
    
-->
        </footer>
    </div>
    
</article>



    <nav id="page-nav">
        <span class="page-number current">1</span><a class="page-number" href="http://localhost:4000/page/2/" target="_blank" rel="noopener">2</a><a class="page-number" href="http://localhost:4000/page/3/" target="_blank" rel="noopener">3</a><a class="extend next" rel="noopener" href="http://localhost:4000/page/2/" target="_blank">Siguiente  »</a>
    </nav>
</section>
            
                <aside id="sidebar">
   
        
    <div class="widget-wrap">
        <h3 class="widget-title">Recientes</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="http://localhost:4000/2018/09/19/not-know-js-review-closure/" class="thumbnail" target="_blank" rel="noopener">
    
    
        <span style="background-image:url(/img/not-know-js-review.jpeg)" alt="你不知道的js复习笔记 (作用域闭包)" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="http://localhost:4000/2018/09/19/not-know-js-review-closure/" class="title" target="_blank" rel="noopener">你不知道的js复习笔记 (作用域闭包)</a></p>
                            <p class="item-date"><time datetime="2018-09-18T16:00:00.000Z" itemprop="datePublished">2018-09-19</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="http://localhost:4000/2018/09/13/not-know-js-review-fp-scope-block-scope/" class="thumbnail" target="_blank" rel="noopener">
    
    
        <span style="background-image:url(/img/not-know-js-review.jpeg)" alt="你不知道的js复习笔记 (词法作用域)" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="http://localhost:4000/2018/09/13/not-know-js-review-fp-scope-block-scope/" class="title" target="_blank" rel="noopener">你不知道的js复习笔记 (词法作用域)</a></p>
                            <p class="item-date"><time datetime="2018-09-12T16:00:00.000Z" itemprop="datePublished">2018-09-13</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="http://localhost:4000/2018/09/13/not-know-js-review-lexical-scope%20/" class="thumbnail" target="_blank" rel="noopener">
    
    
        <span style="background-image:url(/img/not-know-js-review.jpeg)" alt="你不知道的js复习笔记 (词法作用域)" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="http://localhost:4000/2018/09/13/not-know-js-review-lexical-scope%20/" class="title" target="_blank" rel="noopener">你不知道的js复习笔记 (词法作用域)</a></p>
                            <p class="item-date"><time datetime="2018-09-12T16:00:00.000Z" itemprop="datePublished">2018-09-13</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="http://localhost:4000/2018/09/13/not-know-js-review-function-hosting/" class="thumbnail" target="_blank" rel="noopener">
    
    
        <span style="background-image:url(/img/not-know-js-review.jpeg)" alt="你不知道的js复习笔记 (提升)" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="http://localhost:4000/2018/09/13/not-know-js-review-function-hosting/" class="title" target="_blank" rel="noopener">你不知道的js复习笔记 (提升)</a></p>
                            <p class="item-date"><time datetime="2018-09-12T16:00:00.000Z" itemprop="datePublished">2018-09-13</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="http://localhost:4000/2018/09/12/array-review/" class="thumbnail" target="_blank" rel="noopener">
    
    
        <span style="background-image:url(/img/array-review.jpeg)" alt="js数组方法分类复习" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="http://localhost:4000/2018/09/12/array-review/" class="title" target="_blank" rel="noopener">js数组方法分类复习</a></p>
                            <p class="item-date"><time datetime="2018-09-11T16:00:00.000Z" itemprop="datePublished">2018-09-12</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

    
        
    
        
    <div class="widget-wrap">
        <h3 class="widget-title">Archivos</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="http://localhost:4000/archives/2018/09/" target="_blank" rel="noopener">September 2018</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="http://localhost:4000/archives/2018/08/" target="_blank" rel="noopener">August 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="http://localhost:4000/archives/2018/07/" target="_blank" rel="noopener">July 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="http://localhost:4000/archives/2018/06/" target="_blank" rel="noopener">June 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="http://localhost:4000/archives/2018/05/" target="_blank" rel="noopener">May 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="http://localhost:4000/archives/2018/04/" target="_blank" rel="noopener">April 2018</a><span class="archive-list-count">1</span></li></ul>
        </div>
    </div>

    
        
    
        
    
        
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">Links</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://blog.zhaiyifan.cn/" target="_blank" rel="noopener">MarkZhai</a>
                    </li>
                
                    <li>
                        <a href="http://silverd.cn/" target="_blank" rel="noopener">SilverdJiang</a>
                    </li>
                
                    <li>
                        <a href="http://yownyang.github.io/" target="_blank" rel="noopener">YownYang</a>
                    </li>
                
                    <li>
                        <a href="http://zhukejin.com/" target="_blank" rel="noopener">PrimoZhu</a>
                    </li>
                
                    <li>
                        <a href="http://wjerryzhen11.github.io/" target="_blank" rel="noopener">JerryXu</a>
                    </li>
                
                    <li>
                        <a href="http://yocann.cn/" target="_blank" rel="noopener">CnnyChen</a>
                    </li>
                
            </ul>
        </div>
    </div>


    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>
            
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            © 2018 Neo<br>
            Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice" target="_blank" rel="noopener">PPOffice</a>
        </div>
    </div>
</footer>
        
    
    <script type="text/javascript" src="./Neo_files/uyan.js"></script>




    
        <script src="./Neo_files/lightgallery.min.js"></script>
        <script src="./Neo_files/lg-thumbnail.min.js"></script>
        <script src="./Neo_files/lg-pager.min.js"></script>
        <script src="./Neo_files/lg-autoplay.min.js"></script>
        <script src="./Neo_files/lg-fullscreen.min.js"></script>
        <script src="./Neo_files/lg-zoom.min.js"></script>
        <script src="./Neo_files/lg-hash.min.js"></script>
        <script src="./Neo_files/lg-share.min.js"></script>
        <script src="./Neo_files/lg-video.min.js"></script>
    
    
        <script src="./Neo_files/jquery.justifiedGallery.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="./Neo_files/main.js"></script>

    </div><div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something...">
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>

</body></html>
        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://www.neohuang.com/child/img/Neo.html" data-id="cjm8wajmb0006lum7a60pc8hf" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            <!--
    
        <a href="http://www.neohuang.com/child/img/Neo.html#comments" class="article-comment-link">Comments</a>
    
-->
        </footer>
    </div>
    
        

    
</article>


    
    <section id="comments">
    
        
    <div id="uyan_frame"></div>

    
    </section>

</section>
            
                <aside id="sidebar">
   
        
    <div class="widget-wrap">
        <h3 class="widget-title">recent</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/09/25/not-know-js-review-this/" class="thumbnail">
    
    
        <span style="background-image:url(/img/not-know-js-review.jpeg)" alt="你不知道的js复习笔记 (this)" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2018/09/25/not-know-js-review-this/" class="title">你不知道的js复习笔记 (this)</a></p>
                            <p class="item-date"><time datetime="2018-09-24T16:00:00.000Z" itemprop="datePublished">2018-09-25</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/09/25/not-know-js-review-object/" class="thumbnail">
    
    
        <span style="background-image:url(/img/not-know-js-review.jpeg)" alt="你不知道的js复习笔记 (对象)" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2018/09/25/not-know-js-review-object/" class="title">你不知道的js复习笔记 (对象)</a></p>
                            <p class="item-date"><time datetime="2018-09-24T16:00:00.000Z" itemprop="datePublished">2018-09-25</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/09/19/not-know-js-review-closure/" class="thumbnail">
    
    
        <span style="background-image:url(/img/not-know-js-review.jpeg)" alt="你不知道的js复习笔记 (作用域闭包)" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2018/09/19/not-know-js-review-closure/" class="title">你不知道的js复习笔记 (作用域闭包)</a></p>
                            <p class="item-date"><time datetime="2018-09-18T16:00:00.000Z" itemprop="datePublished">2018-09-19</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/09/13/not-know-js-review-lexical-scope /" class="thumbnail">
    
    
        <span style="background-image:url(/img/not-know-js-review.jpeg)" alt="你不知道的js复习笔记 (词法作用域)" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2018/09/13/not-know-js-review-lexical-scope /" class="title">你不知道的js复习笔记 (词法作用域)</a></p>
                            <p class="item-date"><time datetime="2018-09-12T16:00:00.000Z" itemprop="datePublished">2018-09-13</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/09/13/not-know-js-review-function-hosting/" class="thumbnail">
    
    
        <span style="background-image:url(/img/not-know-js-review.jpeg)" alt="你不知道的js复习笔记 (提升)" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2018/09/13/not-know-js-review-function-hosting/" class="title">你不知道的js复习笔记 (提升)</a></p>
                            <p class="item-date"><time datetime="2018-09-12T16:00:00.000Z" itemprop="datePublished">2018-09-13</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

    
        
    
        
    <div class="widget-wrap">
        <h3 class="widget-title">archives</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a><span class="archive-list-count">1</span></li></ul>
        </div>
    </div>

    
        
    
        
    
        
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">links</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://blog.zhaiyifan.cn/">MarkZhai</a>
                    </li>
                
                    <li>
                        <a href="http://silverd.cn/">SilverdJiang</a>
                    </li>
                
                    <li>
                        <a href="http://yownyang.github.io">YownYang</a>
                    </li>
                
                    <li>
                        <a href="http://zhukejin.com">PrimoZhu</a>
                    </li>
                
                    <li>
                        <a href="http://wjerryzhen11.github.io">JerryXu</a>
                    </li>
                
                    <li>
                        <a href="http://yocann.cn">CnnyChen</a>
                    </li>
                
            </ul>
        </div>
    </div>


    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>
            
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2018 Neo<br>
            Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>
        </div>
    </div>
</footer>
        
    
    <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2131605"></script>




    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>