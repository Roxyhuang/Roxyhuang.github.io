<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    
    <title>Neo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta property="og:type" content="website">
<meta property="og:title" content="Neo">
<meta property="og:url" content="http://www.neohuang.com/child/index.html">
<meta property="og:site_name" content="Neo">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Neo">
    

    

    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/open-sans/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/2.1.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
    
    


</head>

<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <!--<span class="site-title">Neo</span>-->
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/.">Home</a>
                
                    <a class="main-nav-link" href="/archives">Archives</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="/css/images/doge.jpeg" />
                            <i class="fa fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/.">Home</a></td>
                
                    <td><a class="main-nav-link" href="/archives">Archives</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
                

<aside id="profile">
    <div class="inner profile-inner">
        <div class="base-info profile-block">
            <img id="avatar" src="/css/images/doge.jpeg" />
            <h2 id="name">Neo Huang</h2>
            <h3 id="title">Front End Developer</h3>
            <span id="location"><i class="fa fa-map-marker"></i>Shanghai, China</span>
            <a id="follow" target="_blank" href="https://github.com/Roxyhuang">FOLLOW</a>
        </div>
        <div class="article-info profile-block">
            <div class="article-info-block">
                21
                <span>posts</span>
            </div>
            <div class="article-info-block">
                0
                <span>tag</span>
            </div>
        </div>
        
        <div class="profile-block social-links">
            <table>
                <tr>
                    
                    
                    <td>
                        <a href="https://github.com/Roxyhuang" target="_blank" title="github" class=tooltip>
                            <i class="fa fa-github"></i>
                        </a>
                    </td>
                    
                </tr>
            </table>
        </div>
        
    </div>
</aside>

            
            <section id="main">
    <article id="post-neo-fe-review-prospect" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2019/08/18/neo-fe-review-prospect/">回顾前端系列 - 前瞻</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2019/08/18/neo-fe-review-prospect/">
            <time datetime="2019-08-17T16:00:00.000Z" itemprop="datePublished">2019-08-18</time>
        </a>
    </div>


                        
                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p><img src="/img/npm.jpg" alt=""></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>回首自己从2014年入行至今已有了5个年头，对自身的技术实力还是十分不满意，因此想利用这段时间对自己的技术实力进行一个提升。<br>同时如果没有扎实深厚的技术实力，很可能会演变成写了许多自认为非常好的作品,但实际缺乏设计，只是闭门造车。</p>
<h2 id="冲击目标"><a href="#冲击目标" class="headerlink" title="冲击目标"></a>冲击目标</h2><h3 id="1-基础知识体系"><a href="#1-基础知识体系" class="headerlink" title="1. 基础知识体系"></a>1. 基础知识体系</h3><p>大体划分：</p>
<h4 id="1-js"><a href="#1-js" class="headerlink" title="(1) js"></a>(1) js</h4><h4 id="2-常用框架、类库"><a href="#2-常用框架、类库" class="headerlink" title="(2) 常用框架、类库"></a>(2) 常用框架、类库</h4><h4 id="3-html"><a href="#3-html" class="headerlink" title="(3) html"></a>(3) html</h4><h4 id="4-css"><a href="#4-css" class="headerlink" title="(4) css"></a>(4) css</h4><h4 id="5-计算机基础"><a href="#5-计算机基础" class="headerlink" title="(5) 计算机基础"></a>(5) 计算机基础</h4><h4 id="6-算法、设计模式、语言"><a href="#6-算法、设计模式、语言" class="headerlink" title="(6) 算法、设计模式、语言"></a>(6) 算法、设计模式、语言</h4><h4 id="7-网络-amp-安全-amp-浏览器内核"><a href="#7-网络-amp-安全-amp-浏览器内核" class="headerlink" title="(7) 网络&amp;安全&amp;浏览器内核"></a>(7) 网络&amp;安全&amp;浏览器内核</h4><h4 id="8-工程化"><a href="#8-工程化" class="headerlink" title="(8) 工程化"></a>(8) 工程化</h4><h4 id="9-服务端、数据库、node"><a href="#9-服务端、数据库、node" class="headerlink" title="(9) 服务端、数据库、node"></a>(9) 服务端、数据库、node</h4><h3 id="2-个人亮点以及解决过的问题"><a href="#2-个人亮点以及解决过的问题" class="headerlink" title="2. 个人亮点以及解决过的问题"></a>2. 个人亮点以及解决过的问题</h3><h4 id="1-个人亮点"><a href="#1-个人亮点" class="headerlink" title="(1) 个人亮点"></a>(1) 个人亮点</h4><h5 id="1-工程化"><a href="#1-工程化" class="headerlink" title="[1] 工程化"></a>[1] 工程化</h5><h5 id="2-插件开发经验"><a href="#2-插件开发经验" class="headerlink" title="[2] 插件开发经验"></a>[2] 插件开发经验</h5><h4 id="2-解决过的问题罗列"><a href="#2-解决过的问题罗列" class="headerlink" title="(2) 解决过的问题罗列"></a>(2) 解决过的问题罗列</h4><h5 id="1-技术细节"><a href="#1-技术细节" class="headerlink" title="[1] 技术细节"></a>[1] 技术细节</h5><h5 id="2-设计过的方案"><a href="#2-设计过的方案" class="headerlink" title="[2] 设计过的方案　"></a>[2] 设计过的方案　</h5><h3 id="3-形式"><a href="#3-形式" class="headerlink" title="3.形式"></a>3.形式</h3><h4 id="1-按大纲更新"><a href="#1-按大纲更新" class="headerlink" title="(1) 按大纲更新"></a>(1) 按大纲更新</h4><h4 id="2-一天一道前端题"><a href="#2-一天一道前端题" class="headerlink" title="(2) 一天一道前端题"></a>(2) 一天一道前端题</h4><h4 id="3-一天一道算法题"><a href="#3-一天一道算法题" class="headerlink" title="(3) 一天一道算法题"></a>(3) 一天一道算法题</h4><p>目前先罗列了这些部分…</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://www.neohuang.com/child/2019/08/18/neo-fe-review-prospect/" data-id="cjzh45xvy000ac4jgsyc8d0v1" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            <!--
    
        <a href="http://www.neohuang.com/child/2019/08/18/neo-fe-review-prospect/#comments" class="article-comment-link">Comments</a>
    
-->
        </footer>
    </div>
    
</article>



    <article id="post-npm-manager" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h2 id="浅聊前端依赖管理及优化-上"><a href="#浅聊前端依赖管理及优化-上" class="headerlink" title="浅聊前端依赖管理及优化(上)"></a>浅聊前端依赖管理及优化(上)</h2><p><img src="/img/npm.jpg" alt=""></p>
<h2 id="一、引子"><a href="#一、引子" class="headerlink" title="一、引子"></a>一、引子</h2><p>在npm、yarn等包管理工具的帮助下，前端工程化模块化的进程日益加快，项目的依赖包也日益增大，特别是若项目采用webpack来构建用到许多webpack的插件、一些辅助开发如（eslint、postcss、dev-server之类的库）以及一些单元测试(jest、mocha、enzyme)可能需要用到的插件，项目中的node_module就会变的十分庞大。</p>
<p>如图：</p>
<p><img src="/img/npm-manger-big.jpg" alt=""></p>
<p>如果搭配这种情况是不是很绝望：</p>
<p><img src="/img/npm-manger-disk.jpg" alt=""></p>
<p>因此团队开发者每次重新初始化项目进行npm install会十分缓慢，并且若占用大量空间，更进一步来说项目中往往很多前端团队会用到一台构建服务器，对前端项目的代码获取、打包、构建、部署进行管理（例如笔者自己所在的团队就在使用jenkins对前端项目的打包、构建、部署进行自动化托管）。npm这样的项目级依赖管理的特性就会造成大量的时间以及资源的消耗。</p>
<p>同时笔者也想在文章开始之前表明一个态度，npm本身portable的模块化设计，使每个项目互不干系，也是一种它设计的精华所在，本文仅是针对实际使用中遇到的一些小困扰进行解读，希望提供一个新的思路。</p>
<p>此本篇文章就在这样的背景下诞生了。纯粹是笔者在项目中积累的一些经验，若有不足望指出。</p>
<h2 id="二、先来说说示例"><a href="#二、先来说说示例" class="headerlink" title="二、先来说说示例"></a>二、先来说说示例</h2><p>github仓库地址：<a href="https://github.com/Roxyhuang/npm-module-share" target="_blank" rel="noopener">https://github.com/Roxyhuang/npm-module-share</a></p>
<p>通常现代前端的标准工程往往具备以下功能，为了让这个讨论更贴近实际开发，并且更直观，因此规定示例项目基本具备以下这些能力：</p>
<p>(1) 提供dev-server</p>
<p>(2) 提供语法转译（babel）</p>
<p>(3) 能够解析样式</p>
<p>(4) js代码风格插件以及样式风格检查</p>
<p>(5) 单元测试</p>
<p>(6) 提供样式兼容处理</p>
<p>当然以上部分只体现的依赖层面。因此可能有些依赖的引入可能出现错误或者不合理。</p>
<p>并假设目前团队使用了webpack和parcel两套前端构建方案，团队项目中有使用了React和Vue。</p>
<h2 id="三、问题的总结"><a href="#三、问题的总结" class="headerlink" title="三、问题的总结"></a>三、问题的总结</h2><p>若不对项目做任何优化以及设置正常项目的依赖的结构应该是这样的：</p>
<p>如图：</p>
<p><img src="/img/npm-manger-sample-1.png" alt=""></p>
<p>然后我们再看一下node_modules整体所占的空间：</p>
<p><img src="/img/npm-manger-webpack-react.jpg" alt=""></p>
<h3 id="情况一：多个依赖模块完全相同的项目"><a href="#情况一：多个依赖模块完全相同的项目" class="headerlink" title="情况一：多个依赖模块完全相同的项目"></a>情况一：多个依赖模块完全相同的项目</h3><p>这种情况相对很常见，实际就是相同依赖的项目有多个</p>
<p>如图：</p>
<p><img src="/img/npm-manger-sample-2.png" alt=""></p>
<p>可以想象这样模块的容量便是162.2mb x 3,同时文件数也会是1072 x 3。</p>
<p>由此可见实际我们对容量的消耗是是十分大的,笔者做了非精确统计实际：</p>
<p><strong>生产中所需的模块容量与文件数</strong>（dependencies）:</p>
<p><img src="/img/npm-manger-webpack-react-devp.jpg" alt=""></p>
<p><strong>本地开发和测试所需的模块容量与文件数</strong>（devDependencies）:</p>
<p><img src="/img/npm-manger-webpack-react-devp2.jpg" alt=""></p>
<p>实际可以看到<strong>devDependencies</strong>才是我们整体依赖体积与数量如此庞大的“元凶”。</p>
<p>当然有部分生产中全局所需的库（如：React Vue）可以采用外部化，通过CDN来引入。(即图上CDN模块的复用)</p>
<h3 id="情况二：仅生产中所需的模块依赖依赖重复-（dependencies）"><a href="#情况二：仅生产中所需的模块依赖依赖重复-（dependencies）" class="headerlink" title="情况二：仅生产中所需的模块依赖依赖重复 （dependencies）"></a>情况二：仅生产中所需的模块依赖依赖重复 （dependencies）</h3><p>如图：</p>
<p><img src="/img/npm-manger-sample-3.png" alt=""></p>
<p><strong>生产中所需的模块容量与文件数</strong>（dependencies）:</p>
<p>仅图中dependencies中红色标注的react-redux,redux版本以及使用了mobx react-mobx更换</p>
<p><strong>本地开发和测试所需的模块容量与文件数</strong>（devDependencies）:</p>
<p>无变化</p>
<p>实际这种情况和<strong>情况一</strong>类似只有dependencies中部分模块的依赖有差异或者版本不同。当然再进一步，这个部分每个项目确实可能出现较大的差异，同时着部分差异可能会引发devDependencies也出现变化（如:React Vue 可能用到webpack Loader eslint plugins等，之后会提及这块）。</p>
<p>实际依然<strong>devDependencies</strong>才是我们整体依赖体积与数量如此庞大的“元凶”。</p>
<h3 id="情况三：本地开发和测试所需的包依赖重复且，但不存在版本差异-（devDependencies）"><a href="#情况三：本地开发和测试所需的包依赖重复且，但不存在版本差异-（devDependencies）" class="headerlink" title="情况三：本地开发和测试所需的包依赖重复且，但不存在版本差异 （devDependencies）"></a>情况三：本地开发和测试所需的包依赖重复且，但不存在版本差异 （devDependencies）</h3><p>如图：</p>
<p><img src="/img/npm-manger-sample-4.png" alt=""></p>
<p>这种情况我们也囊括了情况二的差异(由于dependencies产生的差异，同时也会影响devDependencies的)</p>
<p><strong>生产中所需的模块容量与文件数</strong>（dependencies）:</p>
<p>如图所示，除了情况中出现的react-redux,redux版本有差异，由于出现了webpack + vue的项目，项目中dependencies的依赖需要引入vue或vue-router，除此都是一致的。</p>
<p><strong>本地开发和测试所需的模块容量与文件数</strong>（devDependencies）:</p>
<p>由于我们需要引入vue，导致我们devDependencies需要产生一些变化包括移除一些webpack与react相关的插件，eslint与react的插件等，变更为webpack与vue相关的插件，eslint与vue的插件等。</p>
<p>如图笔者非精确的统计一下这种情况仅devDependencies下的容量与文件数：</p>
<p><img src="/img/npm-manger-webpack-vue-devp.jpg" alt=""></p>
<p>还是依然很大，并且实际还是存在大量的依赖重叠（例子中有17个依赖重叠）。</p>
<h3 id="情况四：多个构件工具，存在本地开发和测试所需的包依赖重复，且存在在版本差异-（devDependencies）"><a href="#情况四：多个构件工具，存在本地开发和测试所需的包依赖重复，且存在在版本差异-（devDependencies）" class="headerlink" title="情况四：多个构件工具，存在本地开发和测试所需的包依赖重复，且存在在版本差异, （devDependencies）"></a>情况四：多个构件工具，存在本地开发和测试所需的包依赖重复，且存在在版本差异, （devDependencies）</h3><p>这种是目前最复杂的情况，存在下列几个情况</p>
<p>(1) 前端构件方案存在多个, 例子中为webpack 和 parcel</p>
<p>(2) 生产中所需的模块存在差异，甚至技术栈不同</p>
<p>(3) 本地开发和测试所需的包依赖重复，但有略微不同，且存在版本不同</p>
<p>如图：</p>
<p><img src="/img/npm-manger-sample-5.png" alt=""></p>
<p>这种情况我们也囊括了情况二的差异,可以看到同一个构件工具下存在本地开发和测试所需的包依赖重叠的情况依然是较多的。</p>
<p>因此实际如果出现这种情况，我们仍需要考虑以及解决。</p>
<h3 id="小小的总结一下："><a href="#小小的总结一下：" class="headerlink" title="小小的总结一下："></a>小小的总结一下：</h3><p>结合<strong>情况一</strong>、<strong>情况二</strong>、<strong>情况三</strong>、<strong>情况四</strong>的例子可以得出几点小小的“规律”：</p>
<p>(1) devDependencies无论从模块所占体积还是文件数量都在整体依赖模块中所占的比较较大</p>
<p>(2) dependencies下的包，可能会因为项目不同差异较大，同时也会导致devDependencies下模块有差异</p>
<p>(3) 即使devDependencies可能项目存在差异，但是仍有可能一部分重叠</p>
<p>(4) 多个模块化方案，可能会导致项目devDependencies差异较大</p>
<p>我们可以发现其中不管前三种情况的哪一种devDependencies都会有一部分的依赖模块是<strong>重叠的</strong>。那既然存在重复，那我们就有必要考虑“复用”</p>
<p>同时我们发现多个模块化方案（webpack, parcel）devDependencies下的模块差异会较大，这也是我们之后需要解决的。</p>
<h3 id="锁定依赖模块的能力："><a href="#锁定依赖模块的能力：" class="headerlink" title="锁定依赖模块的能力："></a>锁定依赖模块的能力：</h3><p>非本文重点，仅简述一下：</p>
<h4 id="（1）-lock-or-dont’lock"><a href="#（1）-lock-or-dont’lock" class="headerlink" title="（1） lock or dont’lock"></a>（1） lock or dont’lock</h4><p>这个问题社区探讨的老问题，锁不锁都有支持的一方，然而这边笔者不表明态度，但是同时也希望我们之后的依赖管理的优化和“瘦身”能够具备锁定依赖的能力。</p>
<h4 id="（2）-npm-锁定依赖以及锁定依赖的内部循环的方式"><a href="#（2）-npm-锁定依赖以及锁定依赖的内部循环的方式" class="headerlink" title="（2） npm 锁定依赖以及锁定依赖的内部循环的方式"></a>（2） npm 锁定依赖以及锁定依赖的内部循环的方式</h4><ul>
<li><p>使用语义版本控制来锁定版本：</p>
<p>  关于semantic-versioning，这里我们不赘述，有兴趣可以看一下npm文档：</p>
<p>  <a href="https://docs.npmjs.com/about-semantic-versioning" target="_blank" rel="noopener">https://docs.npmjs.com/about-semantic-versioning</a></p>
<p>  但是通过semantic-versioning来锁定版本，无法锁定依赖的内部循环（即依赖的依赖）。</p>
</li>
<li><p>npm-package-locks来锁定</p>
<p>  关于npm-package-locks，这里我们不赘述，有兴趣的可以看一下：</p>
<p>  <a href="https://docs.npmjs.com/files/package-locks" target="_blank" rel="noopener">https://docs.npmjs.com/files/package-locks</a></p>
</li>
</ul>
<p>我们关注的重点是我们需要依赖<strong>package-lock.json</strong>，来协助锁定依赖的版本以及依赖内部循环的版本。</p>
<h3 id="再总结一下："><a href="#再总结一下：" class="headerlink" title="再总结一下："></a>再总结一下：</h3><p>(1) devDependencies无论从模块所占体积还是文件数量都在整体依赖模块中所占的比较较大</p>
<p>(2) 项目的dependencies可能会因为项目不同差异较大，同时一部分可以外部化，因此不在本文想要探讨“瘦身管理”的范围内，列出主要是以便更接近现实状况</p>
<p>(3) 即使devDependencies可能项目存在差异，但是仍有大量的依赖重复与重叠，根据实际包的分析他们是目前依赖“瘦身管理”的主要目标</p>
<p>(4) 即使dependencies有差异的项目，devDependencies大部分可能相似（如情况三所示），因此我们仍可以提炼出一部分相同的devDependencies进行“瘦身管理”。</p>
<p>(5) 多个模块化方案，可能会导致项目devDependencie差异较大（如例子中webpack和parcel）可能会有一部分devDependencies可能版本也会不同，不建议两个项目差异极大的node_modules共享。</p>
<p>(6) 同一个模块可能会存在版本差异，因此我们可能会面对同时面对一个库存在多版本的情况 </p>
<p>(7) 无论依赖锁定是否必要，但是希望提供的方案能够具备。</p>
<p>(8) 依赖锁定，需要依靠package-lock.json实现（shrinkwrap.json亦可）</p>
<h2 id="四、优化方案以及存在的一些问题"><a href="#四、优化方案以及存在的一些问题" class="headerlink" title="四、优化方案以及存在的一些问题"></a>四、优化方案以及存在的一些问题</h2><p>下面的优化方案都依赖了NodeJS模块加载机制，因此先粗略的聊一下，这里不描述完整的过程，感兴趣的朋友可以查询官方文档或可以看一下朴灵大大的深入浅出NodeJS 。</p>
<h4 id="如何利用NodeJS模块加载机制"><a href="#如何利用NodeJS模块加载机制" class="headerlink" title="如何利用NodeJS模块加载机制"></a>如何利用NodeJS模块加载机制</h4><p>简单来说 - 在NodeJS中引入模块，需要经历如下3个步骤：</p>
<ul>
<li>路径分析</li>
<li>扩展名分析</li>
<li>编译执行</li>
</ul>
<p>我们利用的则是在路径分析中自定义文件模块（第三方npm包）的查找：</p>
<p>自定义文件模块查找顺序为：</p>
<ul>
<li>当前目录下node_modules目录</li>
<li>父目录下node_modules目录</li>
<li>向上逐级递归直到根目录下下node_modules目录</li>
<li>递归至根目录</li>
</ul>
<p>有点类似于JS的原型链查找，文件路径越深，模块查找越耗时，同时也是它慢的原因。</p>
<p>当然这是默认情况下，实际通畅我们可以通过配置NODE_PATH的方式，在递归至根目录后，若依然无法找到，给到一个路径或多个路径找到具体模块。</p>
<h3 id="1-配置NODE-PATH-方案一"><a href="#1-配置NODE-PATH-方案一" class="headerlink" title="1. 配置NODE_PATH(方案一)"></a>1. 配置NODE_PATH(方案一)</h3><p>方案一实际就是利用了配置NODE_PATH，通常一般会将其配制成<code>npm i -g</code>所在的全局模块目录（实际可以改，本例暂定这个目录）。</p>
<h4 id="结构变动"><a href="#结构变动" class="headerlink" title="结构变动"></a>结构变动</h4><p><strong>情况一、情况二、情况三</strong>都可以转化成如下结构：</p>
<p>以<strong>情况三</strong>下为例子 - 如图：</p>
<p><img src="/img/npm-manger-sample-global.png" alt=""></p>
<h4 id="具体实现："><a href="#具体实现：" class="headerlink" title="具体实现："></a>具体实现：</h4><p>在对应系统的环境变量配置文件中增加环境变量NODE_PATH，例如在MacOS中</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vi /ect/profile  </span><br><span class="line"><span class="comment"># 或/etc/bashrc或~/.bashrc </span></span><br><span class="line"><span class="comment"># 此处不赘述配置问题、加载顺序以及原理</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-&gt; <span class="built_in">export</span> PATH=<span class="variable">$PATH</span>: </span><br><span class="line"><span class="comment"># 将 /usr/bin 追加到 PATH 变量中</span></span><br><span class="line"></span><br><span class="line">-&gt; <span class="built_in">export</span> NODE_PATH=<span class="string">"/usr/lib/node_modules;/usr/local/lib/node_modules"</span></span><br><span class="line"><span class="comment"># 指定 NODE_PATH 变量</span></span><br></pre></td></tr></table></figure>
<p>那 NODE_PATH 就是NODE中用来寻找模块所提供的路径注册环境变量。我们可以使用上面的方法指定NODE_PATH环境变量。并且用;分割多个不同的目录。</p>
<p>关于 node 的包加载机制我就不在这里赘述了。NODE_PATH中的路径被遍历是发生，从项目的根位置递归搜寻 node_modules 目录，直到文件系统根目录的 node_modules，如果还没有查找到指定模块的话，就会去 NODE_PATH中注册的路径中查找。</p>
<h4 id="存在问题："><a href="#存在问题：" class="headerlink" title="存在问题："></a>存在问题：</h4><p>(1) 不会生成<strong>package.json</strong>,因此对依赖管理比较繁琐，实现增量安装比较繁琐</p>
<ul>
<li>当然其实可以不需要<code>npm i -g</code>去处理，可以手动自己维护一个目录包括package.json，以及package-lock.json，但如果这么只会形成只是一个线性关系，而非一个树状关系。</li>
</ul>
<p>(2) 不支持同一模块同时存在不同版本，因此如果依赖出现版本差异，没有解决方案</p>
<ul>
<li>因为形成的是一个线性关系，而非一个树状关系实际项目若存同一依赖版本差异，就会有一个优先级的问题存在。</li>
</ul>
<p>(3) 全局安装模块，无法生成<strong>package-lock.json</strong>无法锁定依赖内部循环（依赖模块的依赖）</p>
<ul>
<li>默认如果使用<code>npm i -g</code>安装，同样不会生成package-lock.json，因此无法锁定依赖内部循环。</li>
</ul>
<h3 id="2-提升node-modules目录-方案二"><a href="#2-提升node-modules目录-方案二" class="headerlink" title="2. 提升node_modules目录(方案二)"></a>2. 提升node_modules目录(方案二)</h3><p>结合之前问题分析的我们得出的结论，因此实际上我们把项目中devDependencies依赖重叠的模块，在<strong>项目的父目录存放</strong>node_modules即可将依赖提升。即可以进行项目间的共享。</p>
<p><strong>目前笔者的理想方案应该能够达到下列几个目的：</strong></p>
<ul>
<li><p>可以将项目构建相似技术栈的项目统一在一起，共享依赖</p>
</li>
<li><p>可以实现对公共模块的维护和管理，并实现增量安装</p>
</li>
<li><p>对原来npm install流程改动不会太大</p>
</li>
</ul>
<h4 id="2-结构变化后的依赖结构图"><a href="#2-结构变化后的依赖结构图" class="headerlink" title="(2)结构变化后的依赖结构图"></a>(2)结构变化后的依赖结构图</h4><p>实际需要实现只要将项目目录改为以下结构</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">----|---wwwroot／ # 工作目录或部署目录</span><br><span class="line"><span class="code">    |</span></span><br><span class="line"><span class="code">    |---webpack/--|---webpack-react/---|---package.json</span></span><br><span class="line"><span class="code">    |             |                    |---package-lock.json</span></span><br><span class="line"><span class="code">    |             |                    |---node_modules/</span></span><br><span class="line"><span class="code">    |             |                    |---src/</span></span><br><span class="line"><span class="code">    |             |                    |</span></span><br><span class="line"><span class="code">    |             |--- webpack-vue/--- |---package.json</span></span><br><span class="line"><span class="code">    |             |                    |---package-lock.json</span></span><br><span class="line"><span class="code">    |             |                    |---node_modules/</span></span><br><span class="line"><span class="code">    |             |                    |---src/</span></span><br><span class="line"><span class="code">    |             |---node_modules/     |</span></span><br><span class="line"><span class="code">    |             |---package.json     |</span></span><br><span class="line"><span class="code">    |             |---package.json-lock|</span></span><br><span class="line"><span class="code">    |             |                    |</span></span><br><span class="line"><span class="code">    |---parcel/---|--- parcel-react/---|---package.json</span></span><br><span class="line"><span class="code">    |             |                    |---package-lock.json</span></span><br><span class="line"><span class="code">    |             |                    |---node_modules/</span></span><br><span class="line"><span class="code">    |             |                    |---src/</span></span><br><span class="line"><span class="code">    |             |                    |</span></span><br><span class="line"><span class="code">    |             |--- parcel-vue/ --- |---package.json</span></span><br><span class="line"><span class="code">    |             |                    |---package-lock.json</span></span><br><span class="line"><span class="code">    |             |                    |---node_modules/</span></span><br><span class="line"><span class="code">    |             |                    |---src/</span></span><br></pre></td></tr></table></figure>
<p><strong>情况一、情况二、情况三、情况四</strong>可以转化成如下结构：</p>
<p>以<strong>情况四</strong>下为例子 - 如图：</p>
<p><img src="/img/npm-manger-sample-node.png" alt=""></p>
<p>说说目前笔者探索的两个实践：</p>
<h4 id="1-手工管理package-json"><a href="#1-手工管理package-json" class="headerlink" title="(1)手工管理package.json"></a>(1)手工管理package.json</h4><p>下一步说起来也十分简单：</p>
<p>实际只要在，维护一个package.json即可，实际常常只需要devDependencies，然后实际需要安装时只需要进行一次npm install即可，并且会生成package-lock.json。</p>
<p>即上面说到的这几个位置</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">|---webpack/--|---webpack-react/---|---package.json</span><br><span class="line">|             |--- webpack-vue/--- |---package.json</span><br><span class="line"></span><br><span class="line">|---parcel/---|--- parcel-react/---|---package.json</span><br><span class="line">|             |--- parcel-vue/ --- |---package.json</span><br></pre></td></tr></table></figure>
<p>实际只要在devDependencies按正常package.json中的内容维护即可。</p>
<h4 id="2-利用-preinstall"><a href="#2-利用-preinstall" class="headerlink" title="(2)利用 preinstall"></a>(2)利用 preinstall</h4><p>“对原来npm install流程改动不会太大”，这一点上面对于手工管理方式实际并并不满足。并且手工进行管理十分繁琐，因此我们是否可以在npm install之前把devDependencies内重叠模块的node_modules进行提升呢？</p>
<p>答案是：<strong>可以的</strong>,主要利用的是npm script中的preinstall，关于npm script以及preinstall可以通过：<a href="https://docs.npmjs.com/misc/scripts" target="_blank" rel="noopener">https://docs.npmjs.com/misc/scripts</a>来了解。</p>
<p>npm的preinstall这个hook实际会在安装软件包之前运行。实际我们就可以通过preinstall去执行一些node.js的代码让我们的devDependencies内重叠模块的node_modules提升。</p>
<p>那具体来看一下步骤：</p>
<h5 id="a-在项目package-json中增加preinstall"><a href="#a-在项目package-json中增加preinstall" class="headerlink" title="a.在项目package.json中增加preinstall"></a>a.在项目package.json中增加preinstall</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">  <span class="string">"preinstall"</span>: <span class="string">"node build/scripts/preinstall.js"</span>,</span><br><span class="line">  <span class="string">"start"</span>: <span class="string">"webpack-dev-server --mode development --hot --progress --colors --port 3000 --open"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里我会在项目的build目录下的scripts执行preinstall.js这个文件内的代码</p>
<h5 id="b-切换至项目父级目录（即约定的技术栈目录）"><a href="#b-切换至项目父级目录（即约定的技术栈目录）" class="headerlink" title="b.切换至项目父级目录（即约定的技术栈目录）"></a>b.切换至项目父级目录（即约定的技术栈目录）</h5><p>这里我仅进行了一个最简单的示范，其原理是在项目的package.json里增加devDependenciesGlobal<br>项：</p>
<p>实际可以看一下我提供的实现<a href="https://github.com/Roxyhuang/npm-module-share/blob/master/webpack/webpack-react/build/scripts/preinstall.js" target="_blank" rel="noopener">具体代码</a></p>
<p>实际最为关键的为：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> execPath = path.resolve(<span class="string">'../'</span>);</span><br><span class="line"><span class="keyword">const</span> preListObj = preList.devDependenciesGlobal; <span class="comment">// 项目package.json自己维护的devDependencies那些重叠依赖</span></span><br><span class="line"><span class="keyword">const</span> currentMd5 = md5(<span class="built_in">JSON</span>.stringify(preListObj)); <span class="comment">// 简单举例生成一个md5，实际应用中可以搭配其他机制</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">fs.writeFileSync(<span class="string">`<span class="subst">$&#123;execPath&#125;</span>/package.json`</span>, <span class="built_in">JSON</span>.stringify(&#123;<span class="string">"md5"</span>: currentMd5,<span class="attr">dependencies</span>: preListObj&#125;)); <span class="comment">// 在上级目录创建一个package.json文件并，写入md5以及devDependenciesGlobal的内容</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> script = <span class="string">`cd <span class="subst">$&#123;execPath&#125;</span> &amp;&amp; npm i`</span>;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 切换至父级目录并执行npm install</span></span><br><span class="line"> </span><br><span class="line">exec(script, <span class="function"><span class="keyword">function</span> (<span class="params">err, stdout, stderr</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(stdout);</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">'error:'</span> + stderr);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">   <span class="built_in">console</span>.log(stdout);</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">'package init success'</span>);</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">`The global install in <span class="subst">$&#123;execPath&#125;</span>`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h5 id="c-实际所占空间的变化："><a href="#c-实际所占空间的变化：" class="headerlink" title="c.实际所占空间的变化："></a>c.实际所占空间的变化：</h5><p>（此处就不贴图片了，大家可以clone实例自己试一下）</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">|---webpack/--|---webpack-react/---|---node_modules/ # 共21.1 MB，369项</span><br><span class="line">|             |--- webpack-vue/--- |---node_modules/ # 共17.8 MB, 336项</span><br><span class="line">|             |---node_modules/ # 共153.3 MB，994项</span><br><span class="line">|             |</span><br><span class="line">|---parcel/---|--- parcel-react/---|---node_modules/ # 89.4 MB,540项</span><br><span class="line">|             |--- parcel-vue/ --- |---node_modules/ # 71.5 MB,491项</span><br><span class="line">|             |---node_modules/ # 共21.1 MB，118项</span><br></pre></td></tr></table></figure>
<p>实际非常简单，即得执行目录的上级目录，此处为了举例我的例子里会在运行preinstall时根据devDependenciesGlobal生成一个md5，以便下次install时比对，若一致不执行preinstall内的流程。当然这并不是一个最佳实践（之后的各种实践方案在下篇中进一步给出）</p>
<p>当然实际这部分存在“无限”的可能性，可以根据自己的需求来完善（比如服务端获取devDependenciesGlobal以及md5）。</p>
<p>这仅仅是一个简单示范，实际可以通过配合一些服务端以及docker进一步提升。</p>
<h4 id="存在问题：-1"><a href="#存在问题：-1" class="headerlink" title="存在问题："></a>存在问题：</h4><p>(1) windows兼容性</p>
<p>笔者所在的团队在使用的过程中，有遇到windows的开发环境下的各种问题，比如：</p>
<ul>
<li>win10下自定义的preinstall流程中的install执行十分缓慢，或无法执行</li>
<li>babel或抛出一些错误（这里不具体说明）</li>
</ul>
<p>(2) 使用者无法做到无感知</p>
<p>也是最大的缺点，即使用的时候使用者会有感知，开发项目的时候要求使用一定是主动必须按特定的目录结构来安排自己的workspace。</p>
<p>(3) 本地npm版本，不一致，也可能对依赖造成的影响较大</p>
<p>(4) npm script相关的必须在devDependencies引入 （当然也可以通过一些方式避开，比如dev-server不直接使用npm script启动）</p>
<h2 id="这仅仅是一个开始…待续"><a href="#这仅仅是一个开始…待续" class="headerlink" title="这仅仅是一个开始…待续"></a>这仅仅是一个开始…待续</h2><p>利用node模块加载机制，我们其实已经可以很大程度改进我们的依赖了，但如上所述我们还存在这些问题：</p>
<p>(1) windows兼容性</p>
<p>上文有提到过windows下，笔者实际实践发现会出现一些问题，是不是有办法可以统一环境呢？</p>
<p>(2) 无法做到让使用者到无感知</p>
<p>(3) 本地npm版本，对依赖造成的影响较大</p>
<p>(5) 管理公共依赖没有标准化和自动化</p>
<p>因此下篇笔者可能会主要进一步通过其他方案来配合这个解决方案</p>
<p>(1) 本文举例的完善版本 （通过shell远程下载公共依赖的package.json，也是笔者目前团队在使用的）</p>
<p>(2) 通过搭配docker进一步完善方案 （是笔者想进一步增强的）</p>
<p>(3) 搭配私有npm仓库</p>
<p>(4) 如何更标准化的管理公共依赖，使其可以自动化标准化</p>
<p><strong>这里挖个坑下篇会更新这部分内容</strong>。</p>
<h3 id="结语以及本文不足之处"><a href="#结语以及本文不足之处" class="headerlink" title="结语以及本文不足之处"></a>结语以及本文不足之处</h3><p>经过上述操作，我们便可以将前端项目根据框架进行依赖管理以及划分了，其实如此改进仍并非最完美以及优化，不足之处仍非常之多，期待更加优雅的解决方案，使我们前端项目的架构更佳健壮和灵活。也欢迎大家和我探讨和讨论，谢谢各位大佬能耐心看完。</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://www.neohuang.com/child/2018/12/10/npm-manager/" data-id="cjzh45xw1000dc4jg19jne9d0" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            <!--
    
        <a href="http://www.neohuang.com/child/2018/12/10/npm-manager/#comments" class="article-comment-link">Comments</a>
    
-->
        </footer>
    </div>
    
</article>



    <article id="post-http-cache" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2018/11/20/http-cache/">浅聊HTTP缓存 (HTTP Cache)</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2018/11/20/http-cache/">
            <time datetime="2018-11-19T16:00:00.000Z" itemprop="datePublished">2018-11-20</time>
        </a>
    </div>


                        
                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p><img src="/img/how-browser-caching-works.png" alt=""></p>
<h2 id="1-引子"><a href="#1-引子" class="headerlink" title="1.引子"></a>1.引子</h2><p>HTTP缓存一直是一个老生常谈的问题，前端在日常发布、部署工作中，常常要面对。</p>
<p>其中面对的问题有可能会是：<strong>部署的代码无法生效</strong></p>
<p>这次本人所在团队也遇到了相关问题，这里简述一下：</p>
<ul>
<li><p>项目会在静态资源（如:css,js）使用chunkHash来处理，因此能保证修改后与旧代码文件名字不会重复。以避免无法更新改动。</p>
</li>
<li><p>在该项目中部署后，进行代码进行一次<code>location.reload</code>，改动即可以生效。</p>
</li>
</ul>
<p>最后，本人发现是因为该项目部署的服务器上所有静态资源的response headers的设置如下：</p>
<p><strong>response headers</strong>： </p>
<ul>
<li><strong>cache-control</strong>: public, max-age=31536000</li>
</ul>
<p>但致命的是，项目的入口: <strong>index.html</strong>也是如此。因此实际是因为所有的.html文件命中(cache hit)了<strong>强缓存</strong>，导致了用户无法直接呈现更新后代码的改动。</p>
<p>找到了原因，也想到了如下三个解决方案</p>
<ul>
<li><p>跳转时增加时间戳例如：</p>
<p>  具体为什么可以这么做在之后分析查看是否存在缓存步骤时会解析</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">location.href = <span class="string">'https://www.google.com/index.html?t=201811141248001'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>修改response headers中的cache-control</p>
<p>  举例：</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cache-control: public, max-age=<span class="number">0</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>使用HTML Meta 标签</p>
<p>  可以在html代码中增加meta标签：</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Cache-Control"</span> <span class="attr">content</span>=<span class="string">"no-cache, no-store, must-revalidate"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Pragma"</span> <span class="attr">content</span>=<span class="string">"no-cache"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Expires"</span> <span class="attr">content</span>=<span class="string">"0"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>  上述代码的作用是告诉浏览器当前页面不被缓存，每次访问都需要去服务器拉取。使用上很简单，但只有部分浏览器可以支持，而且所有缓存代理服务器都不支持，因为代理不解析HTML内容本身。</p>
<p>  最好还是不要指定HTML标签，通过可能会出现混乱（到底以那端为主，实际response header的优先级更高）。此外，在HTML5中，这些<meta http等="">标签是无效的。只有HTML5规范中列出的HTTP等效值才被允许。</p>
<p>  可参考：<a href="https://www.w3.org/TR/html4/charset.html#h-5.2.2" target="_blank" rel="noopener">W3 HTML spec chapter 5.2.2</a></p>
</li>
</ul>
<h2 id="2-HTTP缓存基本概念"><a href="#2-HTTP缓存基本概念" class="headerlink" title="2. HTTP缓存基本概念"></a>2. HTTP缓存基本概念</h2><p>既然找到问题了，我觉得那我就顺藤摸瓜的总结一下吧。</p>
<ul>
<li><p>HTTP 缓存：重用已获取的资源能够有效的提升网站与应用的性能。Web 缓存能够减少延迟与网络阻塞，进而减少显示某个资源所用的时间。借助 HTTP 缓存，Web 站点变得更具有响应性。</p>
</li>
<li><p>HTTP 缓存分为：强缓存和协商缓存    </p>
</li>
</ul>
<h3 id="1-简化流程"><a href="#1-简化流程" class="headerlink" title="(1) 简化流程"></a>(1) 简化流程</h3><p><img src="/img/cache-1.png" alt=""></p>
<p>其中关键步骤是：</p>
<ul>
<li>判断是否存在缓存</li>
<li>判断缓存是否有效(<strong>即强缓存是否命中</strong>)</li>
<li>请求服务端，判断服务端资源是否更新（<strong>即协商缓存是否命中</strong>）</li>
<li>返回资源（若服务端返回的资源，本地保存请求，包括请求头信息）</li>
</ul>
<h3 id="2-查看是否存在缓存"><a href="#2-查看是否存在缓存" class="headerlink" title="(2) 查看是否存在缓存"></a>(2) 查看是否存在缓存</h3><p>浏览器怎么判定是否存在本地缓存，这个步骤在此可以理解为浏览器去查找本地是否存在该响应请求的文件存在，查找是否是否有该对应的请求，不同浏览器缓存文件的地址也不尽相同。</p>
<p>以firefox举例，可以在地址栏输入：<code>about:cache</code></p>
<p>P.S: <code>chrome://cache</code> 在 chrome66版本后已废弃。</p>
<p><img src="/img/cache-2.png" alt=""></p>
<p>如图上所示，这里我们可以看到浏览器关于网络请求缓存的一些信息。我们以本地磁盘中的为例子。</p>
<p><img src="/img/cache-4.png" alt=""></p>
<p>如图上所示，在此我们可以查看到一些关于缓存在磁盘内的信息，包括实际本地缓存所在的位置等。</p>
<p><img src="/img/cache-5.png" alt=""></p>
<p>如上图，这就是一次响应请求的文件，并且他会记录完整的url包括：query string。</p>
<p><img src="/img/cache-7.png" alt=""></p>
<p><img src="/img/cache-6.png" alt=""></p>
<p>如上两图所见，我们改变了t参数的值，实际我们在url后打时间戳来规避命中缓存，实际就是在此改变了查询URL，让浏览器无法查询到与之前请求相同的本地缓存。</p>
<p><img src="/img/cache-3.png" alt=""></p>
<p>最后可以看到，我们的本地缓存文件内，会包含response-head的信息，之后的缓存策略和流程都需要依赖此处的信息。</p>
<p><strong>总结一下，查看是否存在缓存的过程实际就是查找响应请求文件是否存在</strong>。</p>
<h3 id="3-强缓存"><a href="#3-强缓存" class="headerlink" title="(3) 强缓存"></a>(3) 强缓存</h3><h4 id="1-强缓存概念"><a href="#1-强缓存概念" class="headerlink" title="[1] 强缓存概念"></a>[1] 强缓存概念</h4><p><strong>强制缓存就是向浏览器缓存查找该请求结果，并根据该结果的缓存规则来决定是否使用该缓存结果的过程。</strong></p>
<p>实际就是我们整体流程内的，查看是否存在缓存以及，查看缓存是否有效。</p>
<h4 id="2-如何实现强缓存"><a href="#2-如何实现强缓存" class="headerlink" title="[2] 如何实现强缓存"></a>[2] 如何实现强缓存</h4><ul>
<li><p>实现强缓存，主要是根据客户端保留的一个服务器端的response header中的两个字段：<code>expires</code>、<code>cache-control</code>。</p>
</li>
<li><p><code>cache-control</code>优先级比<code>expires</code><strong>高</strong>。</p>
</li>
</ul>
<p>如图：</p>
<p><img src="/img/cache-8.png" alt=""></p>
<p>图中可知两者的区别</p>
<ul>
<li><p>HTTP响应报文中expires的时间值，是一个绝对值。</p>
</li>
<li><p>HTTP响应报文中Cache-Control为max-age=31536000，是相对值。</p>
</li>
</ul>
<p>在无法确定客户端的时间是否与服务端的时间同步的情况下，Cache-Control相比于expires是更好的选择，所以同时存在时，只有Cache-Control生效。</p>
<p><strong>Expires</strong></p>
<ul>
<li><p>Expires是HTTP/1.0控制网页缓存的字段，其值为服务器返回该请求结果缓存的到期时间，即再次发起该请求时，如果客户端的时间小于Expires的值时，直接使用缓存结果。</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Expires: Wed, <span class="number">21</span> Oct <span class="number">2015</span> <span class="number">07</span>:<span class="number">28</span>:<span class="number">00</span> GMT</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>Cache-Control</strong></p>
<p>在HTTP/1.1中，Cache-Control是最重要的规则，主要用于控制网页缓存，列几个常见的值：</p>
<ul>
<li><p>public：所有内容都将被缓存（客户端和代理服务器都可缓存）</p>
</li>
<li><p>private：所有内容只有客户端可以缓存，Cache-Control的默认取值</p>
</li>
<li><p>no-cache：客户端缓存内容，但是是否使用缓存则需要经过协商缓存来验证决定</p>
</li>
<li><p>no-store：所有内容都不会被缓存，即不使用强制缓存，也不使用协商缓存</p>
</li>
<li><p>max-age=xxx (xxx is numeric)：缓存内容将在xxx秒后失效</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cache-Control:public, max-age=<span class="number">31536000</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>判断缓存是否过期的流程的流程：</p>
<p><img src="/img/cache-control.png" alt=""></p>
<p>缓存失效时间计算公式如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expirationTime = responseTime + freshnessLifetime - currentAge</span><br></pre></td></tr></table></figure>
<p>在上面这个公式里，<code>responseTime</code> 表示浏览器接收到此响应的那个时间点。</p>
<h4 id="3-如何判断强缓存是否命中"><a href="#3-如何判断强缓存是否命中" class="headerlink" title="[3] 如何判断强缓存是否命中"></a>[3] 如何判断强缓存是否命中</h4><p><img src="/img/cache-9.png" alt=""></p>
<p>状态码为<strong>灰色</strong>的请求则代表使用了强制缓存，请求对应的<strong>Size值则代表该缓存存放的位置</strong></p>
<p>至于from memory cache 和 from disk cache相关的之后讲解。</p>
<h3 id="4-协商缓存"><a href="#4-协商缓存" class="headerlink" title="(4) 协商缓存"></a>(4) 协商缓存</h3><h4 id="1-协商缓存概念"><a href="#1-协商缓存概念" class="headerlink" title="[1] 协商缓存概念"></a>[1] 协商缓存概念</h4><p><strong>协商缓存就是强制缓存失效后，浏览器携带缓存标识向服务器发起请求，由服务器根据缓存标识决定是否使用缓存的过程。</strong></p>
<h4 id="2-如何实现协商缓存"><a href="#2-如何实现协商缓存" class="headerlink" title="[2] 如何实现协商缓存"></a>[2] 如何实现协商缓存</h4><ul>
<li><p>协商缓存的标识也是在响应报文的HTTP头中和请求结果一起返回给浏览器的，控制协商缓存的字段分别有：<code>Last-Modified / If-Modified-Since</code> 和 <code>Etag / If-None-Match</code>。</p>
</li>
<li><p><code>Etag / If-None-Match</code> 优先级比 <code>Last-Modified / If-Modified-Since</code> 高。</p>
</li>
</ul>
<p><strong>Last-modified:</strong></p>
<p>Last-Modified是服务器响应请求时，返回该资源文件在服务器最后被修改的时间</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Last-Modified: Wed, <span class="number">21</span> Oct <span class="number">2015</span> <span class="number">07</span>:<span class="number">28</span>:<span class="number">00</span> GMT</span><br></pre></td></tr></table></figure>
<p><strong>If-Modified-Since:</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">If-Modified-Since: Wed, <span class="number">21</span> Oct <span class="number">2015</span> <span class="number">07</span>:<span class="number">28</span>:<span class="number">00</span> GMT</span><br></pre></td></tr></table></figure>
<p><strong>Etag:</strong></p>
<p>Etag是服务器响应请求时，返回当前资源文件的一个唯一标识(由服务器生成)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ETag: <span class="string">"33a64df551425fcc55e4d42a148795d9f25f89d4"</span></span><br><span class="line">ETag: W/<span class="string">"0815"</span></span><br></pre></td></tr></table></figure>
<p><strong>If-None-Match:</strong></p>
<p>If-None-Match是客户端再次发起该请求时，携带上次请求返回的唯一标识Etag值，通过此字段值告诉服务器该资源上次请求返回的唯一标识值。服务器收到该请求后，发现该请求头中含有If-None-Match，则会根据If-None-Match的字段值与该资源在服务器的Etag值做对比，一致则返回304，代表资源无更新，继续使用缓存文件；不一致则重新返回资源文件，状态码为200</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">If-None-Match: <span class="string">"33a64df551425fcc55e4d42a148795d9f25f89d4"</span></span><br></pre></td></tr></table></figure>
<p>然后我们看一下具体流程：</p>
<p><img src="/img/etag.png" alt=""></p>
<h4 id="4-如何判断协商缓存是否命中"><a href="#4-如何判断协商缓存是否命中" class="headerlink" title="[4] 如何判断协商缓存是否命中"></a>[4] 如何判断协商缓存是否命中</h4><p>如果协商缓存命中，请求响应返回的http状态为304并且会显示一个Not Modified的字符串。</p>
<p><img src="/img/cache-10.png" alt=""></p>
<p><img src="/img/cache-11.png" alt=""></p>
<h3 id="5-两者异同"><a href="#5-两者异同" class="headerlink" title="(5) 两者异同"></a>(5) 两者异同</h3><ul>
<li><p>两者的共同点是：如果命中，都是从客户端缓存中加载资源，而不是从服务器加载资源数据；</p>
</li>
<li><p>两者的区别是：强缓存不发请求到服务器，协商缓存会发请求到服务器。</p>
</li>
</ul>
<h2 id="4-相关浏览操操作"><a href="#4-相关浏览操操作" class="headerlink" title="4.相关浏览操操作"></a>4.相关浏览操操作</h2><p>其实浏览器的相关操作，会对开发人员理解浏览器HTTP缓存产生一些影响，因此我们详细来分析一下：</p>
<p>在Alloy Team的Web缓存机制系列中有总结：</p>
<p><a href="http://www.alloyteam.com/2012/03/web-cache-2-browser-cache/" target="_blank" rel="noopener">Web缓存机制系列2 – Web浏览器的缓存机制 - Alloy Team</a></p>
<table>
<thead>
<tr>
<th>浏览器相关操作</th>
<th>Expires/Cache-Control</th>
<th>Last-Modified / Etag</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>地址栏回车</strong></td>
<td>有效</td>
<td>有效</td>
</tr>
<tr>
<td><strong>页面链接跳转</strong></td>
<td>有效</td>
<td>有效</td>
</tr>
<tr>
<td><strong>新开窗口</strong></td>
<td>有效</td>
<td>有效</td>
</tr>
<tr>
<td><strong>前进、后退</strong></td>
<td>有效</td>
<td>有效</td>
</tr>
<tr>
<td><strong>刷新</strong></td>
<td>无效</td>
<td>有效</td>
</tr>
<tr>
<td><strong>强制刷新</strong></td>
<td>无效</td>
<td>无效</td>
</tr>
</tbody>
</table>
<p>这块我想梳理一下，与大家分享以及验证一下：</p>
<p>测试前提：</p>
<ul>
<li>服务端设置相应的response header，</li>
<li>相应资源都已经加载完毕第一次（如果测试结果相同，测试结果的图片就复用了）：</li>
</ul>
<p>测试的浏览器为：</p>
<ul>
<li>Chrome 70</li>
<li>Firefox 63.0.1 </li>
<li>Opera 56.0</li>
</ul>
<p>测试影响的文件：</p>
<ul>
<li>index.html (主页面)</li>
<li>index.js (js资源)</li>
<li>index.css (样式文件)</li>
<li>doge.jpeg (图片文件)</li>
<li>favicon.ico (图标文件)</li>
<li>temp.html(跳转辅助页面，不设置response header且，不在统计范围内)</li>
</ul>
<p>测试使用的response header的设置为：</p>
<ul>
<li>Cache-Control: max-age=300 // 缓存5分钟</li>
<li>ETag: 33a64df551425fcc55e4d42a148795d9f25f89d4 // 服务端固定返回</li>
<li>Expires: Fri Nov 16 2018 09:33:01 GMT+0800 (CST) // 缓存5分钟</li>
<li>Last-Modified: Wed, 21 Oct 2018 07:28:00 GMT // 服务端固定返回</li>
</ul>
<h3 id="1-页面链接跳转"><a href="#1-页面链接跳转" class="headerlink" title="(1) 页面链接跳转"></a>(1) 页面链接跳转</h3><p>Chrome 70测试结果：</p>
<p>如图：</p>
<p><img src="/img/cache-12.png" alt=""></p>
<p>结果：</p>
<ul>
<li>index.html：命中<strong>强缓存</strong></li>
<li>index.js： 命中<strong>强缓存</strong></li>
<li>index.css：命中<strong>强缓存</strong></li>
<li>doge.jpeg：命中<strong>强缓存</strong></li>
<li>favicon.ico：未显示(使用抓包工具抓包，未发出请求)</li>
</ul>
<p>Firefox 63.0.1 测试结果：</p>
<p>如图：</p>
<p><img src="/img/cache-13.png" alt=""></p>
<p>结果：</p>
<ul>
<li>index.html：命中<strong>强缓存</strong></li>
<li>index.js：命中<strong>强缓存</strong></li>
<li>index.css：命中<strong>强缓存</strong></li>
<li>doge.jpeg：命中<strong>强缓存</strong></li>
<li>favicon.ico：命中<strong>强缓存</strong>(使用抓包工具抓包，未发出请求)</li>
</ul>
<p>Opera 56.0 测试结果：</p>
<p>如图：</p>
<p><img src="/img/cache-14.png" alt=""></p>
<p>结果：</p>
<ul>
<li>index.html：命中<strong>强缓存</strong></li>
<li>index.js：命中<strong>强缓存</strong></li>
<li>index.css：命中<strong>强缓存</strong></li>
<li>doge.jpeg：命中<strong>强缓存</strong></li>
<li>favicon.ico：未发出请求(使用抓包工具抓包，无请求)</li>
</ul>
<h3 id="2-新开窗口"><a href="#2-新开窗口" class="headerlink" title="(2) 新开窗口"></a>(2) 新开窗口</h3><p>Chrome 70测试（由于默认为google页，采用了隐私模式测试）结果：</p>
<p>如图：</p>
<p><img src="/img/cache-15.png" alt=""></p>
<p>结果：</p>
<ul>
<li>index.html：命中<strong>强缓存</strong></li>
<li>index.js：命中<strong>强缓存</strong></li>
<li>index.css：命中<strong>强缓存</strong></li>
<li>doge.jpeg：命中<strong>强缓存</strong></li>
<li>favicon.ico：未发出请求(使用抓包工具抓包，无请求)</li>
</ul>
<p>Firefox 63.0.1 测试结果：</p>
<p>如图：</p>
<p><img src="/img/cache-16.png" alt=""></p>
<p>结果：</p>
<ul>
<li>index.html：命中<strong>强缓存</strong></li>
<li>index.js：命中<strong>强缓存</strong></li>
<li>index.css：命中<strong>强缓存</strong></li>
<li>doge.jpeg：命中<strong>强缓存</strong></li>
<li>favicon.ico：命中<strong>强缓存</strong>(使用抓包工具抓包，未发出请求)</li>
</ul>
<p>Opera 56.0(隐私模式) 测试结果：</p>
<p>如图：</p>
<p><img src="/img/cache-15.png" alt=""></p>
<p>结果：</p>
<ul>
<li>index.html：命中<strong>强缓存</strong></li>
<li>index.js：命中<strong>强缓存</strong></li>
<li>index.css：命中<strong>强缓存</strong></li>
<li>doge.jpeg：命中<strong>强缓存</strong></li>
<li>favicon.ico：未发出请求(使用抓包工具抓包，无请求)</li>
</ul>
<h3 id="4-前进、后退"><a href="#4-前进、后退" class="headerlink" title="(4) 前进、后退"></a>(4) 前进、后退</h3><p>Chrome 70测试结果：</p>
<p>如图：</p>
<p><img src="/img/cache-14.png" alt=""></p>
<p>结果：</p>
<ul>
<li>index.html：命中<strong>强缓存</strong></li>
<li>index.js：命中<strong>强缓存</strong></li>
<li>index.css：命中<strong>强缓存</strong></li>
<li>doge.jpeg：命中<strong>强缓存</strong></li>
<li>favicon.ico：未发出请求(使用抓包工具抓包，无请求)</li>
</ul>
<p>Firefox 63.0.1 测试结果：</p>
<p>如图：</p>
<p><img src="/img/cache-16.png" alt=""></p>
<p>结果：</p>
<ul>
<li>index.html：命中<strong>强缓存</strong></li>
<li>index.js：命中<strong>强缓存</strong></li>
<li>index.css：命中<strong>强缓存</strong></li>
<li>doge.jpeg：命中<strong>强缓存</strong></li>
<li>favicon.ico：命中<strong>强缓存</strong>(使用抓包工具抓包，未发出请求)</li>
</ul>
<p>Opera 56.0 测试结果：</p>
<p>如图：</p>
<p><img src="/img/cache-15.png" alt=""></p>
<p>结果：</p>
<ul>
<li>index.html：命中<strong>强缓存</strong></li>
<li>index.js：命中<strong>强缓存</strong></li>
<li>index.css：命中<strong>强缓存</strong></li>
<li>doge.jpeg：命中<strong>强缓存</strong></li>
<li>favicon.ico：未发出请求(使用抓包工具抓包，无请求)</li>
</ul>
<h3 id="5-刷新"><a href="#5-刷新" class="headerlink" title="(5) 刷新"></a>(5) 刷新</h3><p>刷新这一块是测试的重点（之前正因为）</p>
<p>Chrome 70测试结果：</p>
<p>如图：</p>
<p><img src="/img/cache-17.png" alt=""></p>
<p>结果：</p>
<ul>
<li>index.html：命中<strong>协商缓存</strong></li>
<li>index.js：命中<strong>强缓存</strong></li>
<li>index.css：命中<strong>强缓存</strong></li>
<li>doge.jpeg：命中<strong>强缓存</strong></li>
<li>favicon.ico：<strong>没有命中缓存</strong>，服务端获取资源</li>
</ul>
<p>Firefox 63.0.1 测试结果：</p>
<p>如图：</p>
<p><img src="/img/cache-18.png" alt=""></p>
<p>结果:</p>
<ul>
<li>index.html：命中<strong>协商缓存</strong></li>
<li>index.js：命中<strong>协商缓存</strong></li>
<li>index.css：命中<strong>协商缓存</strong></li>
<li>doge.jpeg：命中<strong>协商缓存</strong></li>
<li>favicon.ico：命中<strong>协商缓存</strong></li>
</ul>
<p>Opera 56.0 测试结果：</p>
<p>如图：</p>
<p><img src="/img/cache-19.png" alt=""></p>
<p>结果:</p>
<ul>
<li>index.html：命中<strong>协商缓存</strong></li>
<li>index.js：命中<strong>强缓存</strong></li>
<li>index.css：命中<strong>强缓存</strong></li>
<li>doge.jpeg：命中<strong>强缓存</strong></li>
<li>favicon.ico：未发出请求(使用抓包工具抓包，无请求)</li>
</ul>
<h3 id="6-地址栏回车"><a href="#6-地址栏回车" class="headerlink" title="(6) 地址栏回车"></a>(6) 地址栏回车</h3><p>这个部分还得分成从当前tab回车和从另一url</p>
<ul>
<li>Chrome 70测试结果：</li>
</ul>
<h4 id="1-从另一url跳转"><a href="#1-从另一url跳转" class="headerlink" title="[1] 从另一url跳转"></a>[1] 从另一url跳转</h4><p><img src="/img/cache-15.png" alt=""></p>
<p>相当于<strong>页面链接跳转</strong></p>
<h4 id="2-当前url回车"><a href="#2-当前url回车" class="headerlink" title="[2] 当前url回车"></a>[2] 当前url回车</h4><p><img src="/img/cache-19.png" alt=""></p>
<p>相当于<strong>刷新</strong></p>
<p>Firefox 63.0.1 测试结果：</p>
<h4 id="1-从另一url跳转-1"><a href="#1-从另一url跳转-1" class="headerlink" title="[1] 从另一url跳转"></a>[1] 从另一url跳转</h4><p><img src="/img/cache-16.png" alt=""></p>
<p>相当于<strong>页面链接跳转</strong></p>
<h4 id="2-当前url回车-1"><a href="#2-当前url回车-1" class="headerlink" title="[2] 当前url回车"></a>[2] 当前url回车</h4><p><img src="/img/cache-16.png" alt=""></p>
<p>相当于<strong>页面链接跳转</strong></p>
<p>Opera 56.0 测试结果：</p>
<h4 id="1-从另一url跳转-2"><a href="#1-从另一url跳转-2" class="headerlink" title="[1] 从另一url跳转"></a>[1] 从另一url跳转</h4><p><img src="/img/cache-15.png" alt=""></p>
<p>相当于<strong>页面链接跳转</strong></p>
<h4 id="2-当前url回车-2"><a href="#2-当前url回车-2" class="headerlink" title="[2] 当前url回车"></a>[2] 当前url回车</h4><p><img src="/img/cache-19.png" alt=""></p>
<p>相当于<strong>刷新</strong></p>
<h3 id="6-强制刷新"><a href="#6-强制刷新" class="headerlink" title="(6) 强制刷新"></a>(6) 强制刷新</h3><p>Chrome 70测试结果：</p>
<p>如图：</p>
<p><img src="/img/cache-20.png" alt=""></p>
<p><strong>结果：</strong></p>
<ul>
<li>index.html：从服务器端获取资源</li>
<li>index.js：从服务器端获取资源</li>
<li>index.css：从服务器端获取资源</li>
<li>doge.jpeg：从服务器端获取资源</li>
<li>favicon.ico：从服务器端获取资源</li>
</ul>
<p>Firefox 63.0.1 测试结果：</p>
<p>如图：</p>
<p><img src="/img/cache-21.png" alt=""></p>
<p><strong>结果：</strong></p>
<ul>
<li>index.html：从服务器端获取资源</li>
<li>index.js：从服务器端获取资源</li>
<li>index.css：从服务器端获取资源</li>
<li>doge.jpeg：从服务器端获取资源</li>
<li><p>favicon.ico：从服务器端获取资源</p>
</li>
<li><p>Opera 56.0 测试结果：</p>
</li>
</ul>
<p>如图：</p>
<p><img src="/img/cache-20.png" alt=""></p>
<p><strong>结果：</strong></p>
<ul>
<li>index.html：从服务器端获取资源</li>
<li>index.js：从服务器端获取资源</li>
<li>index.css：从服务器端获取资源</li>
<li>doge.jpeg：从服务器端获取资源</li>
<li>favicon.ico：从服务器端获取资源</li>
</ul>
<h3 id="7-最终总结："><a href="#7-最终总结：" class="headerlink" title="(7)最终总结："></a>(7)最终总结：</h3><p>虽然费了那么大力气测试，最终结论只是稍微调整了一下：</p>
<table>
<thead>
<tr>
<th>浏览器相关操作</th>
<th>Expires/Cache-Control</th>
<th>Last-Modified / Etag</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>页面链接跳转</strong></td>
<td>有效</td>
<td>有效</td>
</tr>
<tr>
<td><strong>新开窗口</strong></td>
<td>有效</td>
<td>有效</td>
</tr>
<tr>
<td><strong>前进、后退</strong></td>
<td>有效</td>
<td>有效</td>
</tr>
<tr>
<td><strong>刷新</strong></td>
<td>chrome opera html无效 ico文件无效，<br> ff有效</td>
<td>chrome opera ico文件无效，<br> ff有效</td>
</tr>
<tr>
<td><strong>地址栏回车</strong></td>
<td>当前URL回车 - chrome opera同刷新 <br> 当前URL回车 - ff同刷新 <br> 其他URL回车 - 同页面链接跳转</td>
<td>当前URL回车 - chrome opera同刷新 <br> 当前URL回车 - ff同刷新 <br> 其他URL回车 - 同页面链接跳转</td>
</tr>
<tr>
<td><strong>强制刷新</strong></td>
<td>无效</td>
<td>无效</td>
</tr>
</tbody>
</table>
<h2 id="6-相关HTTP相关的头字段总结"><a href="#6-相关HTTP相关的头字段总结" class="headerlink" title="6. 相关HTTP相关的头字段总结"></a>6. 相关HTTP相关的头字段总结</h2><p><img src="http://alloyteam.com/wp-content/uploads/2012/03/http-header1.png" alt=""></p>
<p>图片引用自：<a href="http://www.alloyteam.com/2012/03/web-cache-2-browser-cache/" target="_blank" rel="noopener">Web缓存机制系列2 – Web浏览器的缓存机制</a></p>
<h2 id="7-完整流程图"><a href="#7-完整流程图" class="headerlink" title="7.完整流程图"></a>7.完整流程图</h2><p>总结了一个相对完成的流程图：</p>
<p><img src="/img/cache-all-proccess.png" alt=""></p>
<h2 id="8-本文一些不足之处"><a href="#8-本文一些不足之处" class="headerlink" title="8. 本文一些不足之处"></a>8. 本文一些不足之处</h2><h3 id="1-分布式系统相关"><a href="#1-分布式系统相关" class="headerlink" title="(1) 分布式系统相关"></a>(1) 分布式系统相关</h3><p>这部分没有实际实践过，只是摘选了部分文章的观点：</p>
<ul>
<li><p>分布式系统里多台服务器间的文件的Last-Modified必须保持一致，以免负载均衡到不同服务器导致对比结果不一致。</p>
</li>
<li><p>分布式系统尽量关闭掉ETag（每台机器生成的ETag都会不一样，淘宝页面中的静态资源response headers中都没有ETag）。</p>
</li>
</ul>
<h3 id="2-缓存的不同来源相关"><a href="#2-缓存的不同来源相关" class="headerlink" title="(2) 缓存的不同来源相关"></a>(2) 缓存的不同来源相关</h3><p>这个部分目前暂时没有找到十分的标准答案或文档，目前我仅将自己梳理过的部分知识记录在案：</p>
<p>其实webkit缓存机制还有一个叫 pageCache 这里暂不讨论：<a href="https://webkit.org/blog/427/webkit-page-cache-i-the-basics/" target="_blank" rel="noopener">WebKit Page Cache I – The Basics</a></p>
<p>Chrome使用两个缓存: <code>disk cache</code> 和 <code>memory cache</code></p>
<p>以下例子都仅针对<strong>Chrome</strong></p>
<h4 id="1-disk-cache"><a href="#1-disk-cache" class="headerlink" title="[1] disk cache"></a>[1] disk cache</h4><p>从磁盘中获取缓存资源，等待下次访问时不需要重新下载资源，而直接从磁盘中获取。</p>
<p><img src="/img/disk-memory-2.jpg" alt=""></p>
<h4 id="2-memory-cache"><a href="#2-memory-cache" class="headerlink" title="[2] memory cache"></a>[2] memory cache</h4><p>从内存中获取资源，等待下次访问时不需要重新下载资源，而直接从内存中获取。Webkit早已支持memoryCache。</p>
<p><img src="/img/disk-memory.jpg" alt=""></p>
<h4 id="3-浏览器如何区分使用两者呢？"><a href="#3-浏览器如何区分使用两者呢？" class="headerlink" title="[3]浏览器如何区分使用两者呢？"></a>[3]浏览器如何区分使用两者呢？</h4><p>测试条件与上文其他测试相同：</p>
<h5 id="a-当前tabs生命周期未结束"><a href="#a-当前tabs生命周期未结束" class="headerlink" title="a. 当前tabs生命周期未结束"></a>a. 当前tabs生命周期未结束</h5><p><img src="/img/open-tabs-cache.png" alt=""></p>
<h5 id="b-当前tabs生命周期未结束"><a href="#b-当前tabs生命周期未结束" class="headerlink" title="b. 当前tabs生命周期未结束"></a>b. 当前tabs生命周期未结束</h5><p><img src="/img/close-tabs-cache.png" alt=""></p>
<p>可以得出一个基本<strong>“现象”</strong>：</p>
<p>memory cache的生命周期于tabs的选项卡大致对应。</p>
<p><code>The lifetime of an in-memory cache is attached to the lifetime of a render process, which roughly corresponds to a tab.</code></p>
<p>可以参考：<a href="https://developer.chrome.com/extensions/webRequest" target="_blank" rel="noopener">developer.chrome - webRequest</a></p>
<h5 id="c-有疑问之处"><a href="#c-有疑问之处" class="headerlink" title="c. 有疑问之处"></a>c. 有疑问之处</h5><p>有见过一种论点：</p>
<p>目前Webkit资源分成两类:</p>
<ol>
<li><p>主资源</p>
<p> 主资源: 通过<code>MainResourceLoader</code>加载，如HTML页面，或者下载项等</p>
</li>
<li><p>派生资源</p>
<p>派生资源：，通过 <code>SubresourceLoader</code>加载，比如HTML页面中内嵌的图片或者脚本链接</p>
</li>
</ol>
<p>虽然Webkit支持memoryCache，但是也只是针对派生资源，它对应的类为CachedResource，用于保存原始数据（比如CSS，JS等），以及解码过的图片数据。</p>
<p>此图所示：</p>
<p><img src="/img/cache-22.png" alt=""></p>
<p>好像并不适用，完全适用css第一次并没有，从 memory cache 加载，</p>
<p>但是经过几次，后退重新跳转后（不定次数）：</p>
<p><img src="/img/cache-23.png" alt=""></p>
<p>到此，以本人的能力可能暂时，无法作出一个比较好的解答了，希望之后有大佬可以给到一个解答。</p>
<h2 id="9-供实践的Demo"><a href="#9-供实践的Demo" class="headerlink" title="9. 供实践的Demo"></a>9. 供实践的Demo</h2><p><a href="https://github.com/Roxyhuang/http-cache-demo" target="_blank" rel="noopener">Demo仓库地址</a></p>
<h2 id="参考文献："><a href="#参考文献：" class="headerlink" title="参考文献："></a>参考文献：</h2><ul>
<li><p>MDN HTTP 缓存:</p>
<p>  <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Caching_FAQ" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Caching_FAQ</a></p>
</li>
<li><p>Web缓存机制系列2 Web浏览器的缓存机制: </p>
<p>  <a href="http://www.alloyteam.com/2012/03/web-cache-2-browser-cache/" target="_blank" rel="noopener">http://www.alloyteam.com/2012/03/web-cache-2-browser-cache</a></p>
</li>
<li><p>W3 HTML spec chapter 5.2.2: </p>
<p>  <a href="https://www.w3.org/TR/html4/charset.html#h-5.2.2" target="_blank" rel="noopener">https://www.w3.org/TR/html4/charset.html#h-5.2.2</a></p>
</li>
<li><p>Stackoverflow how-to-control-web-page-caching-across-all-browsers: </p>
<p>  <a href="https://stackoverflow.com/questions/49547/how-to-control-web-page-caching-across-all-browsers" target="_blank" rel="noopener">https://stackoverflow.com/questions/49547/how-to-control-web-page-caching-across-all-browsers</a></p>
</li>
<li><p>Stackoverflow how-chrome-browser-determine-memory-cache-and-disk-cache:</p>
<p>  <a href="https://stackoverflow.com/questions/45497696/how-chrome-browser-determine-memory-cache-and-disk-cache" target="_blank" rel="noopener">https://stackoverflow.com/questions/45497696/how-chrome-browser-determine-memory-cache-and-disk-cache</a></p>
</li>
<li><p>developer.chrome.com webRequest：</p>
<p>  <a href="https://developer.chrome.com/extensions/webRequest" target="_blank" rel="noopener">https://developer.chrome.com/extensions/webRequest</a></p>
</li>
</ul>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://www.neohuang.com/child/2018/11/20/http-cache/" data-id="cjzh45xvr0004c4jgnpsx9gnk" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            <!--
    
        <a href="http://www.neohuang.com/child/2018/11/20/http-cache/#comments" class="article-comment-link">Comments</a>
    
-->
        </footer>
    </div>
    
</article>



    <article id="post-array-review" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2018/09/12/array-review/">js数组方法分类复习</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2018/09/12/array-review/">
            <time datetime="2018-09-11T16:00:00.000Z" itemprop="datePublished">2018-09-12</time>
        </a>
    </div>


                        
                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p>年纪大了，每过一段时间都记不住数组的基本方法，所以经常要自己做一个review（这篇先占位之后好好再复习）</p>
<h3 id="一、数组"><a href="#一、数组" class="headerlink" title="一、数组"></a>一、数组</h3><h4 id="1-检测数组"><a href="#1-检测数组" class="headerlink" title="(1) 检测数组"></a>(1) 检测数组</h4><ul>
<li><p>value instanceof Array</p>
</li>
<li><p>Array.isArray</p>
</li>
</ul>
<h4 id="2-转换方法"><a href="#2-转换方法" class="headerlink" title="(2) 转换方法"></a>(2) 转换方法</h4><ul>
<li><p>toString</p>
</li>
<li><p>toLocalString</p>
</li>
<li><p>toValue</p>
</li>
</ul>
<h4 id="3-栈方法"><a href="#3-栈方法" class="headerlink" title="(3) 栈方法"></a>(3) 栈方法</h4><ul>
<li>push (改变原数组)</li>
<li>pop （改变原数组）</li>
</ul>
<h4 id="4-队列方法"><a href="#4-队列方法" class="headerlink" title="(4) 队列方法"></a>(4) 队列方法</h4><ul>
<li>unshift （改变原数组）</li>
<li>shift （改变原数组）</li>
</ul>
<h4 id="5-排序方法"><a href="#5-排序方法" class="headerlink" title="(5) 排序方法"></a>(5) 排序方法</h4><ul>
<li>sort （改变原数组）</li>
<li>reverse(改变原数组)</li>
</ul>
<h4 id="6-操作方法"><a href="#6-操作方法" class="headerlink" title="(6) 操作方法"></a>(6) 操作方法</h4><ul>
<li>concat</li>
<li>slice </li>
<li>join</li>
<li>splice (改变原数组)</li>
</ul>
<h4 id="7-位置方法"><a href="#7-位置方法" class="headerlink" title="(7) 位置方法"></a>(7) 位置方法</h4><ul>
<li>indexOf</li>
<li>lastIndexOf</li>
</ul>
<h4 id="8-迭代方法"><a href="#8-迭代方法" class="headerlink" title="(8) 迭代方法"></a>(8) 迭代方法</h4><ul>
<li>every  （有返回值）</li>
<li>filter （有返回值）</li>
<li>forEach （没有返回值）</li>
<li>map （有返回值）</li>
<li>some （有返回值）</li>
</ul>
<h4 id="9-归并方法"><a href="#9-归并方法" class="headerlink" title="(9) 归并方法"></a>(9) 归并方法</h4><ul>
<li><p>reduce （有返回值）</p>
</li>
<li><p>reduceRight （有返回值）</p>
</li>
</ul>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://www.neohuang.com/child/2018/09/12/array-review/" data-id="cjzh45xvn0001c4jg6c4atljk" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            <!--
    
        <a href="http://www.neohuang.com/child/2018/09/12/array-review/#comments" class="article-comment-link">Comments</a>
    
-->
        </footer>
    </div>
    
</article>



    <article id="post-js-reivew-event-level" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2018/09/11/js-reivew-event-level/">js复习事件的优先级和事件对象</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2018/09/11/js-reivew-event-level/">
            <time datetime="2018-09-10T16:00:00.000Z" itemprop="datePublished">2018-09-11</time>
        </a>
    </div>


                        
                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h3 id="一、dom0-dom2-dom3事件区分"><a href="#一、dom0-dom2-dom3事件区分" class="headerlink" title="一、dom0 dom2 dom3事件区分"></a>一、dom0 dom2 dom3事件区分</h3><p>上篇当中有提到html内联事件、属性事件和事件监听回调事件，那他们和dom0 dom2 dom3事件有什么关系呢，这里简述下：</p>
<p>DOM Level”是描述DOM对象，方法和行为的规范集合。更高级别的DOM规范建立在之前的级别上。变化发生在两个方面：</p>
<ul>
<li><p>dom0事件模型: html事件、属性事件</p>
</li>
<li><p>dom1事件模型: 1级DOM标准中并没有定义事件相关的内容，所以没有所谓的1级DOM事件模型。</p>
</li>
<li><p>dom2事件模型: 监听器回调事件</p>
</li>
<li><p>dom3事件模型: 与绑定事件无关</p>
</li>
</ul>
<h3 id="二、什么是事件优先级"><a href="#二、什么是事件优先级" class="headerlink" title="二、什么是事件优先级"></a>二、什么是事件优先级</h3><h4 id="解释：事件执行的顺序"><a href="#解释：事件执行的顺序" class="headerlink" title="解释：事件执行的顺序"></a>解释：事件执行的顺序</h4><h5 id="1-几个看实例之前需要知道的概念："><a href="#1-几个看实例之前需要知道的概念：" class="headerlink" title="(1) 几个看实例之前需要知道的概念："></a>(1) 几个看实例之前需要知道的概念：</h5><ul>
<li>html事件会被属性事件覆盖</li>
</ul>
<h5 id="2-dom-0-只存在事件冒泡"><a href="#2-dom-0-只存在事件冒泡" class="headerlink" title="(2) dom 0 只存在事件冒泡"></a>(2) dom 0 只存在事件冒泡</h5><h5 id="3-dom2-支持事件冒泡和事件捕获"><a href="#3-dom2-支持事件冒泡和事件捕获" class="headerlink" title="(3) dom2 支持事件冒泡和事件捕获"></a>(3) dom2 支持事件冒泡和事件捕获</h5><ul>
<li>事件目标阶段，按绑定顺序事件</li>
<li>冒泡阶段事件执行顺序，属性事件会比监听执行早（哪个时间先绑定哪个先执行）</li>
</ul>
<p>分析实例：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">id</span>=<span class="string">"body"</span> <span class="attr">onclick</span>=<span class="string">"htmlEvent1()"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"container"</span> <span class="attr">onclick</span>=<span class="string">"htmlEvent2()"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"test"</span> <span class="attr">onclick</span>=<span class="string">"htmlEvent3"</span>&gt;</span>test<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> body = <span class="built_in">document</span>.getElementById(<span class="string">'body'</span>);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> container = <span class="built_in">document</span>.getElementById(<span class="string">'container'</span>);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> test = <span class="built_in">document</span>.getElementById(<span class="string">'test'</span>);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">    body.onclick = propsEvent1;</span></span><br><span class="line"><span class="undefined">    container.onclick = propsEvent2;</span></span><br><span class="line"><span class="undefined">    test.onclick = propsEvent3;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    body.addEventListener(<span class="string">'click'</span>,listenerEventC1,<span class="literal">true</span>);</span></span><br><span class="line"><span class="javascript">    container.addEventListener(<span class="string">'click'</span>,listenerEventC2,<span class="literal">true</span>);</span></span><br><span class="line"><span class="javascript">    test.addEventListener(<span class="string">'click'</span>,listenerEventC3,<span class="literal">true</span>);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    body.addEventListener(<span class="string">'click'</span>,listenerEventB1,<span class="literal">false</span>);</span></span><br><span class="line"><span class="javascript">    container.addEventListener(<span class="string">'click'</span>,listenerEventB2,<span class="literal">false</span>);</span></span><br><span class="line"><span class="javascript">    test.addEventListener(<span class="string">'click'</span>,listenerEventB3,<span class="literal">false</span>);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">htmlEvent1</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">'htmlEvent1'</span>);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">htmlEvent2</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">'htmlEvent2'</span>);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">htmlEvent3</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">'htmlEvent3'</span>);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">propsEvent1</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">'propsEvent1'</span>);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">propsEvent2</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">'propsEvent2'</span>);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">propsEvent3</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">'propsEvent3'</span>);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">listenerEventB1</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">'listenerEventB1'</span>);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">listenerEventB2</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">'listenerEventB2'</span>);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">listenerEventB3</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">'listenerEventB3  '</span>);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">listenerEventC1</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">'listenerEventC1'</span>);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">listenerEventC2</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">'listenerEventC2'</span>);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">listenerEventC3</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">'listenerEventC3'</span>);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">    </span></span><br><span class="line"><span class="javascript"><span class="comment">// 捕获阶段执行开始   </span></span></span><br><span class="line"><span class="javascript"><span class="comment">// listenerEventC1</span></span></span><br><span class="line"><span class="javascript"><span class="comment">// listenerEventC2</span></span></span><br><span class="line"><span class="javascript"><span class="comment">// 捕获事件执行完毕</span></span></span><br><span class="line"><span class="javascript"><span class="comment">// 事件目标，按绑定顺序执行开始</span></span></span><br><span class="line"><span class="javascript"><span class="comment">// propsEvent3</span></span></span><br><span class="line"><span class="javascript"><span class="comment">// listenerEventC3</span></span></span><br><span class="line"><span class="javascript"><span class="comment">// listenerEventB3  </span></span></span><br><span class="line"><span class="javascript"><span class="comment">// 事件目标，按书写顺序执行结束</span></span></span><br><span class="line"><span class="javascript"><span class="comment">// 冒泡阶段开始，容器，根据书写顺序 （实际会是属性事件先执行，再监听起器）</span></span></span><br><span class="line"><span class="javascript"><span class="comment">// propsEvent2</span></span></span><br><span class="line"><span class="javascript"><span class="comment">//	listenerEventB2</span></span></span><br><span class="line"><span class="javascript"><span class="comment">// 冒泡阶段结束，容器，根据书写顺序</span></span></span><br><span class="line"><span class="javascript"><span class="comment">// 冒泡阶段开始，body，根据书写顺序 （实际会是属性事件先执行，再监听起器）</span></span></span><br><span class="line"><span class="javascript"><span class="comment">//	propsEvent1</span></span></span><br><span class="line"><span class="javascript"><span class="comment">//	listenerEventB1</span></span></span><br><span class="line"><span class="javascript"><span class="comment">// 冒泡阶段结束，body，根据书写顺序</span></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>原则一： 牢记事件绑定是浏览器绑定</li>
<li>原则二：事件向传播目标对象（捕获阶段），先出发事件监听</li>
<li>事件在目标阶段，按事件解析或事件被定义的事件执行 （简单理解可理解为js书写顺序）</li>
<li>事件上按事件解析或事件被定义的事件执行，如果包含html事件上执行，即使属性被覆盖了还是会先执行html事件（即被覆盖的属性事件）</li>
</ul>
<h4 id="4-事件传递和cs会影响事件传播有关（比如把外层div层级改动）"><a href="#4-事件传递和cs会影响事件传播有关（比如把外层div层级改动）" class="headerlink" title="(4)事件传递和cs会影响事件传播有关（比如把外层div层级改动）"></a>(4)事件传递和cs会影响事件传播有关（比如把外层div层级改动）</h4><p>不会，事件绑定与css显示不相关</p>
<p><strong>特例：</strong><br>假设绝对定位，住了遮挡元素 不会触发，（以弹窗插件为例）: 事件绑定只html结构有关</p>
<p><strong>特例中的特例：</strong></p>
<p>但是有一个例子可能会有事件穿透</p>
<p>移动端中的事件穿透：</p>
<p>touchstart touchend touchmove </p>
<ul>
<li><p>touch没有 300ms延迟</p>
</li>
<li><p>onclick 300ms延迟</p>
</li>
</ul>
<p>处理方式：</p>
<p>(1) 延迟消失弹窗</p>
<p>(2) 叠加层 300毫秒消失</p>
<h3 id="二、事件对象相关："><a href="#二、事件对象相关：" class="headerlink" title="二、事件对象相关："></a>二、事件对象相关：</h3><p>####（1）定义与兼容写法 </p>
<p>event：包含事件相关的所有信息</p>
<p>ie浏览器：绑定在window上</p>
<p>兼容性写法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> e = e || <span class="built_in">window</span>.event</span><br></pre></td></tr></table></figure>
<p>为了更好的兼容IE浏览器和非ie浏览器。<br>在ie浏览器中,window.event是全局变量,在非ie中，就需要自己传入一个参数来获取event啦，所以就有了var e = e||window.event</p>
<p>####（2）事件对象常用属性</p>
<p>参考： <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Event" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/API/Event</a></p>
<ul>
<li><p>bubbles（只读）: 当前事件是否是冒泡事件 true：是，false：不是</p>
</li>
<li><p>cancelable: 代表当前事件是否可以取消默认行为：true： 可取消 （true可以passive优化） false：不可取消</p>
</li>
<li><p>currentTarget（只读）： 当前事件正在处理哪个元素</p>
</li>
<li><p>defaultPrevented（只读） ： 一个布尔值，表示了是否已经执行过了event.preventDefault()</p>
</li>
<li><p>detail： 事件相关的详细信息（数字表示，和事件api对比）</p>
</li>
<li><p>eventPhase(只读): 1捕获 2目标 3冒泡</p>
</li>
<li><p>target（只读）: 当前的目标元素是什么</p>
</li>
<li><p>Event.isTrusted（只读）：  指明事件是否是由浏览器（当用户点击实例后）或者由脚本（使用事件的创建方法，例如event.initEvent）启动。 （大部分都是浏览器事件，当然可以开发人员可以自定义生成）</p>
</li>
<li><p>Event.type(只读) : 类事件的类型（不区分大小写）。</p>
</li>
<li><p>Event.view ：关联视图，一般是当前window</p>
</li>
</ul>
<h4 id="（3）事件对象常用方法"><a href="#（3）事件对象常用方法" class="headerlink" title="（3）事件对象常用方法"></a>（3）事件对象常用方法</h4><ul>
<li>event.preventDefault</li>
</ul>
<p>取消事件（如果该事件可取消）: canable 为 true ，同时可以用passive优化，取消事件（如果该事件可取消）。</p>
<p>return fasle</p>
<ul>
<li>event.stopPropagation</li>
</ul>
<p>阻止事件进一步传播 （bubbles为true 可以调用, false不可），只阻止会往下层传播</p>
<ul>
<li>event.stopImmediatePropagation</li>
</ul>
<p>阻止事件进一步传播 （bubbles为true 可以调用, false不可），阻止传播之后函数不执行</p>
<p>阻止事件传播不会阻止事件默认行为，阻止事件默认行为，不会阻止事件传播</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://www.neohuang.com/child/2018/09/11/js-reivew-event-level/" data-id="cjzh45xvr0003c4jgk22jpc75" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            <!--
    
        <a href="http://www.neohuang.com/child/2018/09/11/js-reivew-event-level/#comments" class="article-comment-link">Comments</a>
    
-->
        </footer>
    </div>
    
</article>



    <article id="post-js-reivew-event-mouse" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2018/09/11/js-reivew-event-mouse/">js复习鼠标事件笔记</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2018/09/11/js-reivew-event-mouse/">
            <time datetime="2018-09-10T16:00:00.000Z" itemprop="datePublished">2018-09-11</time>
        </a>
    </div>


                        
                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h3 id="一、鼠标事件"><a href="#一、鼠标事件" class="headerlink" title="一、鼠标事件"></a>一、鼠标事件</h3><p>dom3事件模型中与鼠标事件相关的事件共12种鼠标事件</p>
<ul>
<li>5个点击相关</li>
<li>5个移动相关</li>
<li>1个滚动</li>
<li>1个选择事件</li>
</ul>
<p>点击相关事件：</p>
<ul>
<li><p>click</p>
</li>
<li><p>dblclick</p>
</li>
<li><p>contextmeun (次键点击)</p>
</li>
<li><p>mousedown</p>
</li>
<li><p>mouseup</p>
</li>
</ul>
<p>移动相关</p>
<ul>
<li><p>mousemove</p>
</li>
<li><p>mouseenter</p>
</li>
<li><p>mouseover</p>
</li>
<li><p>mouseleave</p>
</li>
<li><p>mouseout</p>
</li>
</ul>
<p>滚动</p>
<ul>
<li>wheel</li>
</ul>
<p>选择</p>
<ul>
<li>select</li>
</ul>
<p>click 执行顺序</p>
<p>dblclick 执行顺序</p>
<h3 id="二、relatedTarget"><a href="#二、relatedTarget" class="headerlink" title="二、relatedTarget"></a>二、relatedTarget</h3><p>参考：<a href="https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent/relatedTarget" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent/relatedTarget</a></p>
<p>定义：和事件相关的次要节点，如果存在返回节点，不存在返回null</p>
<p>target与relatedTarget总是相反的</p>
<p>与relatedTarget相关的事件，有以下8种：</p>
<ul>
<li>focusin</li>
<li>focusout</li>
<li>mouseover</li>
<li>mouseout</li>
<li>mouseenter</li>
<li>mouseleave</li>
<li>dragenter</li>
<li>dragexit</li>
</ul>
<p>###(1) mouseover与mouseenter（mouseout和mouseleave同理）的区别</p>
<h4 id="1-mouseover："><a href="#1-mouseover：" class="headerlink" title="[1]mouseover："></a>[1]mouseover：</h4><ul>
<li>特征：从事件节点进入其子节点也会触发事件，会向父节点冒泡</li>
<li>target: 移入进入节点</li>
<li>relatedTarget： 移入时离开的节点</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">content</span>=<span class="string">"width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">        #container &#123;</span></span><br><span class="line"><span class="undefined">            width: 200px;</span></span><br><span class="line"><span class="undefined">            height: 200px;</span></span><br><span class="line"><span class="undefined">            background-color: blue;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">        #child &#123;</span></span><br><span class="line"><span class="undefined">            width: 100px;</span></span><br><span class="line"><span class="undefined">            height: 100px;</span></span><br><span class="line"><span class="undefined">            background-color: red;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"container"</span> <span class="attr">onmouseover</span>=<span class="string">"handleMouseover(event)"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"child"</span>&gt;</span>sddddd<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">handleMouseover</span>(<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(e);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="2-mouseenter："><a href="#2-mouseenter：" class="headerlink" title="[2]mouseenter："></a>[2]mouseenter：</h4><ul>
<li>特征：从事件节点进入其子节点也会不会触发事件，不会向父节点冒泡</li>
<li>target: 移入进入节点</li>
<li>relatedTarget： 移入时离开的节点</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">content</span>=<span class="string">"width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">        #container &#123;</span></span><br><span class="line"><span class="undefined">            width: 200px;</span></span><br><span class="line"><span class="undefined">            height: 200px;</span></span><br><span class="line"><span class="undefined">            background-color: blue;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">        #child &#123;</span></span><br><span class="line"><span class="undefined">            width: 100px;</span></span><br><span class="line"><span class="undefined">            height: 100px;</span></span><br><span class="line"><span class="undefined">            background-color: red;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"container"</span> <span class="attr">onmouseenter</span>=<span class="string">"handleMouseEnter(event)"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"child"</span>&gt;</span>sddddd<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">handleMouseEnter</span>(<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(e); <span class="comment">// 进入事件节点的子阶段不会触发</span></span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-通过mouseover模拟mouseenter："><a href="#3-通过mouseover模拟mouseenter：" class="headerlink" title="[3]通过mouseover模拟mouseenter："></a>[3]通过mouseover模拟mouseenter：</h4><p><strong>(1) 模拟实现核心思路：</strong></p>
<p>只处理从外层移入的事件</p>
<p><strong>(2) 拆分步骤：</strong></p>
<p>mouseOver伴随以下几种情况</p>
<ul>
<li><p>外层节点移入事件节点 （relatedTarget: 外层节点）</p>
</li>
<li><p>事件节点往子节点移入</p>
<ul>
<li>事件节点往子节点移入 （relatedTarget: 事件节点）</li>
<li>事件节点的子节点往其他子节点移入 （relatedTarget: 事件节点子节点）</li>
</ul>
</li>
</ul>
<p><strong>(3)因此模拟处理的关键：</strong></p>
<p><strong>判断次要节点不是 本身也不是其子节点</strong></p>
<p><strong>(4)是否可以只判断，非自身节点</strong></p>
<p>不能，若只判断判断次要节点不是本身，绝大多数情况可以解决但是一个前提是需要事件节点与子节点间有空间才可以判断，如果没有空间可能是更上一层的节点</p>
<p><strong>(5)是否可以通过阻止子节点冒泡来解决</strong></p>
<p>不能，只能解决子节点之间移动的问题，不能解决子节点往事件节点上的触发</p>
<p><strong>(6)是否可以通过事件流的方式解决</strong></p>
<p>不能，通过addEventListener解决： 无效（会产生新的mouseover，有一个完整的事件流）、</p>
<h4 id="2-鼠标事件对应的事件处理程序"><a href="#2-鼠标事件对应的事件处理程序" class="headerlink" title="(2)鼠标事件对应的事件处理程序"></a>(2)鼠标事件对应的事件处理程序</h4><p>参考：<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/MouseEvent" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/API/MouseEvent</a></p>
<h5 id="1-鼠标事件相关属性"><a href="#1-鼠标事件相关属性" class="headerlink" title="[1] 鼠标事件相关属性"></a>[1] 鼠标事件相关属性</h5><p>可以大致分为三类：</p>
<ul>
<li><p>位置相关</p>
<ul>
<li>screenX <strong>(相对屏幕位置)</strong>：他提供了鼠标相对于屏幕坐标系的水平偏移量</li>
<li>clientX (相对可是区域位置，浏览器窗口)</li>
<li>pageX (相对于html文档) （非标准属性）兼容：pageX = clientX + scrollLeft + clientLeft</li>
<li>offesetX： 鼠标在的位置与触发元素相距的距离，以content为参考点（ie属性非标准，但浏览器打多实现，基本通用）</li>
<li>movementX : 与mousemove搭配，两个连续的mousemove相隔的距离 （ie不支持，现代浏览器支持）</li>
</ul>
</li>
<li><p>键盘相关</p>
<ul>
<li>cotrrolKey:<br>点鼠标时，有没有按住cotrrol</li>
<li>shiftKey：<br>  点击点鼠标时，有没有按住shift        </li>
<li>altKey：<br>  点击点鼠标时，有没有按住alt</li>
<li>metaKey： （win键 command键）</li>
<li>button：-1（没有按键）鼠标移动  0 （主键） 1 （辅助键） 2 （次键） </li>
<li>buttons： 同时按下两个键，数字可能会变，3位2进制值  1 左 2 右 4 中<br>举例： 左中：5</li>
</ul>
</li>
</ul>
<h5 id="2-位置相关以及键盘相关注意事项"><a href="#2-位置相关以及键盘相关注意事项" class="headerlink" title="[2]位置相关以及键盘相关注意事项"></a>[2]位置相关以及键盘相关注意事项</h5><p>(1)强调 click只是主键点击</p>
<p>(2)其他键可以通过 mousedown mouseup</p>
<p>(3)preventDefalt可以注销contextmenu         </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">content</span>=<span class="string">"width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">        .context &#123;</span></span><br><span class="line"><span class="undefined">            background-color: pink;</span></span><br><span class="line"><span class="undefined">            width: 100px;</span></span><br><span class="line"><span class="undefined">            height: 100px;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"context"</span> <span class="attr">oncontextmenu</span>=<span class="string">"handleOnContextmenu(event)"</span>&gt;</span></span><br><span class="line">    21321</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="keyword">function</span> <span class="title">handleOnContextmenu</span>(<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    e.preventDefault(); <span class="comment">//阻止默认右键菜单</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">'弹出自定义菜单'</span>);</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>滚轮事件：</p>
<p>参考：<a href="https://developer.mozilla.org/zh-CN/docs/Web/Events/wheel" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/Events/wheel</a></p>
</li>
</ul>
<p> 当滚动鼠标滚轮或操作其它类似输入设备时会触发滚轮事件。滚轮事件替换了已被弃用的非标准mousewheel事件。</p>
<p>（1）mousewheel事件</p>
<ul>
<li>可以冒泡冒泡到document </li>
<li>wheeldelta: 是一个整值120的倍数 上滚120倍数 下滚是-120倍数 是滚动调的方向,一般只关心正数还是负数</li>
<li>mousewheel，documentmouse<br>存在detail wheelDelta 1的倍数 新版正3 -3，和标准相反</li>
<li>标准版本weel事件（html5）：大部分浏览器都支持<br>deltaX: 变量增量 X  浏览器数值不同<br>deltaY：变量增量 Y 浏览器数值不同<br>deltaZ: 变量增量 Z 浏览器数值不同</li>
</ul>
<h5 id="4-滚动鼠标事件注意点："><a href="#4-滚动鼠标事件注意点：" class="headerlink" title="[4]滚动鼠标事件注意点："></a>[4]滚动鼠标事件注意点：</h5><ul>
<li>要根据实际客户需求调研，客户版本（mdn文档）</li>
<li>wheeldelta 不一定是整数倍，线性滚轮鼠标不一定正数，mac触控板也模拟鼠标滚轮，就有可能是3的倍数（可能会触发几十次，并且可能有动画过度，wheelDealte可能还会继续改变）</li>
<li>不要相信wheeldelta的值</li>
<li>极限情况：wheeldelta（通常是抛物线曲线）会出现震动情况（一般是动画过程中旋转设备，切换屏幕）</li>
<li>鼠标滚动事件和页面滚动事件无关 （触摸设备手指滑，pc拖拽滚动条也不会触发滚动事件，mac放大不会触发，mac和安卓 2手指手势会触发）<br>只能通过滚轮或触控板触发</li>
<li>滚动到页面顶部和底部后也会继续触发</li>
</ul>
<h4 id="（3）防抖函数与节流函数"><a href="#（3）防抖函数与节流函数" class="headerlink" title="（3）防抖函数与节流函数"></a>（3）防抖函数与节流函数</h4><p>只叙述概念，之后文章具体分析源码与原理</p>
<p>根本原理是通过时间戳控制</p>
<h5 id="1-防抖函数"><a href="#1-防抖函数" class="headerlink" title="[1] 防抖函数"></a>[1] 防抖函数</h5><p>同一个时间处理，当超过设定时间后才触发，</p>
<p><strong>核心实现思路</strong>：2个事件发生间隔小于某个时间点，推迟执行</p>
<h5 id="2-节流函数"><a href="#2-节流函数" class="headerlink" title="[2] 节流函数"></a>[2] 节流函数</h5><p>同一个事件处理，设定时间内只触发一次 </p>
<p><strong>核心实现思路</strong>：2个事件发生间隔大于某个时间点，就执行</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://www.neohuang.com/child/2018/09/11/js-reivew-event-mouse/" data-id="cjzh45xvs0005c4jgi2fd25c9" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            <!--
    
        <a href="http://www.neohuang.com/child/2018/09/11/js-reivew-event-mouse/#comments" class="article-comment-link">Comments</a>
    
-->
        </footer>
    </div>
    
</article>



    <article id="post-js-review-event-op" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2018/09/06/js-review-event-op/">js复习事件的基本操作</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2018/09/06/js-review-event-op/">
            <time datetime="2018-09-05T16:00:00.000Z" itemprop="datePublished">2018-09-06</time>
        </a>
    </div>


                        
                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h2 id="一、什么是事件"><a href="#一、什么是事件" class="headerlink" title="一、什么是事件"></a>一、什么是事件</h2><h3 id="1-定义"><a href="#1-定义" class="headerlink" title="1. 定义"></a>1. 定义</h3><p>在js中事件通常是指发生某种于Dom元素、document对象、window对象 有关的预定义或自定义的时刻或契机，这些契机通常是预定义的并且程序上依赖于它们，以关联这些契机发生时候的的功能发生代码。</p>
<h3 id="2-相关基本概念"><a href="#2-相关基本概念" class="headerlink" title="2. 相关基本概念"></a>2. 相关基本概念</h3><h4 id="1-事件类型"><a href="#1-事件类型" class="headerlink" title="(1)事件类型"></a>(1)事件类型</h4><p>字符串，用来表示事件类型</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">onclick</span>=<span class="string">""</span>&gt;</span>来点我<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.addEventListener(<span class="string">'onclick'</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">'我是点击事件'</span>);</span></span><br><span class="line"><span class="undefined">    &#125;);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="2-事件目标"><a href="#2-事件目标" class="headerlink" title="(2)事件目标"></a>(2)事件目标</h4><p>指事件发生在哪个对象上(dom元素、document对象、window对象)。</p>
<h4 id="3-事件处理程序"><a href="#3-事件处理程序" class="headerlink" title="(3)事件处理程序"></a>(3)事件处理程序</h4><p>当事件发生时，执行的函数</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">onclick</span>=<span class="string">"console.log('来点我')"</span>&gt;</span>来点我<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.addEventListener(<span class="string">'onclick'</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">'我是点击事件'</span>);</span></span><br><span class="line"><span class="undefined">    &#125;)</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="4-事件对象"><a href="#4-事件对象" class="headerlink" title="(4)事件对象"></a>(4)事件对象</h4><p>事件发生时，事件本身包含的信息的对象（event对象）</p>
<p>如：位置信息，具体操作,事件对象等</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"getEvent(event)"</span>&gt;</span>来点我<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">getEvent</span>(<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(e); <span class="comment">// MouseEvent &#123;clientX:27, clientY: 16, toElement: button ...&#125;</span></span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="5-事件流"><a href="#5-事件流" class="headerlink" title="(5)事件流"></a>(5)事件流</h4><p>浏览器中事件传播的机制：</p>
<h5 id="1-事件冒泡："><a href="#1-事件冒泡：" class="headerlink" title="[1]事件冒泡："></a>[1]事件冒泡：</h5><p>从具体节点到不具体节点，接受事件</p>
<h5 id="2-事件捕获："><a href="#2-事件捕获：" class="headerlink" title="[2]事件捕获："></a>[2]事件捕获：</h5><p>从不具体节点到具体节点，接受事件</p>
<p>在事件达到节点之前，捕获事件，性能更好，移动设备上touch事件用捕获实现</p>
<p>ps: 规范中定义事件从document开始传播,但实际浏览器是从windows开始捕获（为了性能）</p>
<h5 id="3-IE事件流-基于事件冒泡，并且他们不基于W3C规范"><a href="#3-IE事件流-基于事件冒泡，并且他们不基于W3C规范" class="headerlink" title="[3]IE事件流 (基于事件冒泡，并且他们不基于W3C规范)"></a>[3]IE事件流 (基于事件冒泡，并且他们不基于W3C规范)</h5><ul>
<li><p>EventTarget.attachEvent(type, listener)</p>
<ul>
<li>this指向window</li>
<li>执行顺序相反</li>
<li>detachEventEvent删除必须是同一引用</li>
</ul>
</li>
</ul>
<ul>
<li>EventTarget.detachEventEvent(type, listener)</li>
</ul>
<p>分两个阶段 </p>
<p>（1）事件目标</p>
<p>（2）事件冒泡</p>
<h5 id="4-dom2级别事件流（现代浏览器）："><a href="#4-dom2级别事件流（现代浏览器）：" class="headerlink" title="[4]dom2级别事件流（现代浏览器）："></a>[4]dom2级别事件流（现代浏览器）：</h5><p>添加事件处理程序</p>
<p>分三个阶段 </p>
<p>（1）事件捕获 （规范不设计涉及事件目标，但是实现里会触发事件对象）</p>
<p>（2）事件目标</p>
<p>（3）事件冒泡 （为了IE增加了事件冒泡）</p>
<h3 id="3-事件触发"><a href="#3-事件触发" class="headerlink" title="3.事件触发"></a>3.事件触发</h3><h4 id="1-html事件"><a href="#1-html事件" class="headerlink" title="(1) html事件"></a>(1) html事件</h4><p>称为html内联属性或html事件</p>
<h5 id="1-如何触发"><a href="#1-如何触发" class="headerlink" title="[1] 如何触发"></a>[1] 如何触发</h5><p>在dom元素上on + 事件名称 = “需要执行的函数” （需要括号，因为是执行函数）</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"getEvent(event)"</span>&gt;</span>html事件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>例子：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"getEvent(event)"</span>&gt;</span>html事件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">getEvent</span>(<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(e);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="2-Html事件使用注意事项"><a href="#2-Html事件使用注意事项" class="headerlink" title="[2] Html事件使用注意事项"></a>[2] Html事件使用注意事项</h5><ul>
<li>Html不支持字符 需要转义</li>
<li>可以访问全局作用域下所有函数</li>
<li>有event 事件对象 </li>
<li>this的指针指向当前是触发事件的dom元素</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;button onclick=&quot;htmlEvent(this)&quot;&gt;HTML事件&lt;/button&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    function htmlEvent(_this) &#123;</span><br><span class="line">        console.log(_this); // 不能直接打印this</span><br><span class="line">        console.log(this); // 指向window</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>可以通过setattribute 动态修改、移除事件</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;button id=<span class="string">"button"</span> onclick=<span class="string">"htmlEvent(this)"</span>&gt;HTML事件&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;button onclick="removeEvent()"&gt;移除HTML事件&lt;/</span>button&gt;</span><br><span class="line">&lt;<span class="regexp">/body&gt;</span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">    var btn = document.getElementById('button');</span></span><br><span class="line"><span class="regexp">    function htmlEvent(_this) &#123;</span></span><br><span class="line"><span class="regexp">        console.log(_this); /</span><span class="regexp">/ 不能直接打印this</span></span><br><span class="line"><span class="regexp">        console.log(this); /</span><span class="regexp">/ 指向window</span></span><br><span class="line"><span class="regexp">        btn.setAttribute('onclick',console.log('替换咯...'));</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    function removeEvent() &#123;</span></span><br><span class="line"><span class="regexp">      btn.setAttribute('onclick',''); /</span><span class="regexp">/ 删除事件</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure>
<h5 id="3-Html事件的缺点"><a href="#3-Html事件的缺点" class="headerlink" title="[3] Html事件的缺点"></a>[3] Html事件的缺点</h5><ul>
<li>使用会存在时间差 写在body最后 try catch避免</li>
<li>html事件作用域,全局作用域访问限定对象会出问题</li>
<li>代码耦合问题(需要修改两个地方)</li>
</ul>
<h4 id="2-属性事件（dom-0事件）"><a href="#2-属性事件（dom-0事件）" class="headerlink" title="(2) 属性事件（dom 0事件）"></a>(2) 属性事件（dom 0事件）</h4><h5 id="1-添加事件"><a href="#1-添加事件" class="headerlink" title="[1] 添加事件"></a>[1] 添加事件</h5><p>获取dom元素，将on + 事件名称的属性赋予相关函数</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"test"</span>&gt;</span>属性事件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> test = <span class="built_in">document</span>.getElementById(<span class="string">'test'</span>);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">    test.onclick = getEvent;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">getEvent</span>(<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(e);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="2-删除事件"><a href="#2-删除事件" class="headerlink" title="[2] 删除事件"></a>[2] 删除事件</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;button id=&quot;button&quot;&gt;HTML事件&lt;/button&gt;</span><br><span class="line">    &lt;button id=&quot;button2&quot;&gt;移除HTML事件&lt;/button&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    var btn = document.getElementById(&apos;button&apos;);</span><br><span class="line">    var btn2 = document.getElementById(&apos;button2&apos;);</span><br><span class="line">    btn.onclick = htmlEvent;</span><br><span class="line">    btn2.onclick = removeEvent;</span><br><span class="line"></span><br><span class="line">    function htmlEvent() &#123;</span><br><span class="line">        console.log(this); </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function removeEvent() &#123;</span><br><span class="line">      btn.onclick = null;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h5 id="3-节点复制"><a href="#3-节点复制" class="headerlink" title="[3] 节点复制"></a>[3] 节点复制</h5><p>事件会被复制，复制出来的事件不是指向同一个引用</p>
<h5 id="4-属性事件使用注意事项"><a href="#4-属性事件使用注意事项" class="headerlink" title="[4]属性事件使用注意事项"></a>[4]属性事件使用注意事项</h5><ul>
<li><p>增加事件  事件处理程序（小写）</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">El.onclick</span><br></pre></td></tr></table></figure>
</li>
<li><p>支持Event对象</p>
</li>
<li><p>This指向当前dom</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">htmlEvent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>);  <span class="comment">// 指向当前dom</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>解决问题</p>
<ul>
<li>解决了时间差问题</li>
<li>降低了代码耦合性</li>
</ul>
<p>缺点</p>
<ul>
<li><p>一次只能指定一个事件</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;button id=&quot;test&quot;&gt;属性事件&lt;/button&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    var test = document.getElementById(&apos;test&apos;);</span><br><span class="line">    test.onclick = hello;</span><br><span class="line"></span><br><span class="line">    test.onclick = world;</span><br><span class="line"></span><br><span class="line">    test.onclick = helloWolrd;</span><br><span class="line"></span><br><span class="line">    function hello() &#123;</span><br><span class="line">      console.log(&apos;hello&apos;);</span><br><span class="line">    &#125;</span><br><span class="line">    // world 会覆盖 world</span><br><span class="line">    function world() &#123;</span><br><span class="line">      console.log(&apos;world&apos;);</span><br><span class="line">    &#125;</span><br><span class="line">    // 必须放一个fp</span><br><span class="line">    function helloWolrd() &#123;</span><br><span class="line">      console.log(&apos;hello&apos;);</span><br><span class="line">      console.log(&apos;world&apos;);</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="3-事件监听回调-（dom2）"><a href="#3-事件监听回调-（dom2）" class="headerlink" title="(3) 事件监听回调 （dom2）"></a>(3) 事件监听回调 （dom2）</h4><p>注意事件类型没有on</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"test"</span>&gt;</span>属性事件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> test = <span class="built_in">document</span>.getElementById(<span class="string">'test'</span>);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">getEvent</span>(<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(e);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    test.addEventListener(<span class="string">'click'</span>,getEvent);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>p.s: 没有dom1没有做事件相关规定</p>
<h4 id="1-绑定事件与删除事件"><a href="#1-绑定事件与删除事件" class="headerlink" title="[1]绑定事件与删除事件"></a>[1]绑定事件与删除事件</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">target.addEventListener(type, listener, options);</span><br><span class="line"></span><br><span class="line">target.addEventListener(type, listener ,&#123;<span class="attr">capture</span>: <span class="built_in">Boolean</span>, <span class="attr">passive</span>: <span class="built_in">Boolean</span>, <span class="attr">once</span>: <span class="built_in">Boolean</span>&#125;);</span><br><span class="line"></span><br><span class="line">target.addEventListener(type, listener, useCapture);</span><br><span class="line"></span><br><span class="line">target.addEventListener(type, listener[, useCapture, wantsUntrusted  ]); <span class="comment">// Gecko/Mozilla only</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>type 表示监听事件类型的字符串。</p>
</li>
<li><p>listener</p>
<p>  当所监听的事件类型触发时，会接收到一个事件通知（实现了 Event 接口的对象）对象。listener 必须是一个实现了 EventListener 接口的对象，或者是一个函数</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">'button'</span>);</span><br><span class="line"></span><br><span class="line">   btn.addEventListener(<span class="string">'click'</span>,handleEvent);</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">handleEvent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">       <span class="built_in">console</span>.log(<span class="keyword">this</span>); <span class="comment">// 指向当前dom</span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>options 可选<br>  一个指定有关 listener 属性的可选参数对象。可用的选项如下：</p>
<ul>
<li><p>capture:  Boolean，表示 listener 会在该类型的事件捕获阶段传播到该 EventTarget 时触发。</p>
<p>效果同useCapture可参考</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">'button'</span>);</span><br><span class="line"><span class="keyword">var</span> container = <span class="built_in">document</span>.getElementById(<span class="string">'container'</span>);</span><br><span class="line">btn.addEventListener(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'button'</span>); <span class="comment">// 后触发</span></span><br><span class="line">&#125;);</span><br><span class="line">	</span><br><span class="line">container.addEventListener(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'container'</span>); <span class="comment">// 先触发</span></span><br><span class="line">&#125;,&#123; <span class="attr">capture</span>: <span class="literal">true</span> &#125;);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<pre><code>- once:  Boolean，表示 listener 在添加之后最多只调用一次。如果是 true， listener 会在其被调用之后自动移除。

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">'button'</span>);</span><br><span class="line">  btn.addEventListener(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'button'</span>); <span class="comment">// 只执行一次</span></span><br><span class="line">  &#125;,&#123;<span class="attr">once</span>: <span class="literal">true</span>&#125;);</span><br></pre></td></tr></table></figure>


- passive: Boolean，表示 listener 永远不会调用 preventDefault()。如果 listener 仍然调用了这个函数，客户端将会忽略它并抛出一个控制台警告。
mozSystemGroup: 只能在 XBL 或者是 Firefox&apos; chrome 使用，这是个 Boolean，表示 listener 被添加到 system group。

关于passive可以参考：[https://zhuanlan.zhihu.com/p/24555031](****)

具体之后文章会具体聊聊这个问题

- true的话浏览器会开2个线程为了提高性能， 
- 永远不会调用 preventDefault()
- 同一个dom对象，只要同一事件一个设置了passivefasle，浏览器都不会做性能优化，
- cancelable 为true都可以支持
</code></pre><p>option支持的安全检测例子:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> passiveSupported = <span class="literal">false</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">	  <span class="keyword">var</span> options = <span class="built_in">Object</span>.defineProperty(&#123;&#125;, <span class="string">"passive"</span>, &#123;</span><br><span class="line">	    get: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	      passiveSupported = <span class="literal">true</span>;</span><br><span class="line">	    &#125;</span><br><span class="line">	  &#125;);</span><br><span class="line">	</span><br><span class="line">	  <span class="built_in">window</span>.addEventListener(<span class="string">"test"</span>, <span class="literal">null</span>, options);</span><br><span class="line">	&#125; <span class="keyword">catch</span>(err) &#123;&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>useCapture  可选<br>Boolean，是指在DOM树中，注册了该listener的元素，是否会先于它下方的任何事件目标，接收到该事件。沿着DOM树向上冒泡的事件不会触发被指定为use capture（也就是设为true）的listener。当一个元素嵌套了另一个元素，两个元素都对同一个事件注册了一个处理函数时，所发生的事件冒泡和事件捕获是两种不同的事件传播方式。事件传播模式决定了元素以哪个顺序接收事件。进一步的解释可以查看 事件流 及 JavaScript Event order 文档。 如果没有指定， useCapture 默认为 false 。 </li>
</ul>
<p>例子：父容器元素与子容器元素都为false:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">'button'</span>);</span><br><span class="line"><span class="keyword">var</span> container = <span class="built_in">document</span>.getElementById(<span class="string">'container'</span>);</span><br><span class="line">btn.addEventListener(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'button'</span>); <span class="comment">// 先触发</span></span><br><span class="line">&#125;,<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">container.addEventListener(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'container'</span>); <span class="comment">// 后触发</span></span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>
<p>例子：父容器元素与子容器元素都为true:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">'button'</span>);</span><br><span class="line"><span class="keyword">var</span> container = <span class="built_in">document</span>.getElementById(<span class="string">'container'</span>);</span><br><span class="line">btn.addEventListener(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'button'</span>); <span class="comment">// 后触发</span></span><br><span class="line">&#125;,<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">container.addEventListener(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'container'</span>); <span class="comment">// 先触发</span></span><br><span class="line">&#125;,<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>
<p>例子：父容器元素为true与子容器元素false:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">'button'</span>);</span><br><span class="line"><span class="keyword">var</span> container = <span class="built_in">document</span>.getElementById(<span class="string">'container'</span>);</span><br><span class="line">btn.addEventListener(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'button'</span>); <span class="comment">// 后触发</span></span><br><span class="line">&#125;,<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">container.addEventListener(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'container'</span>); <span class="comment">// 先触发</span></span><br><span class="line">&#125;,<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>
<p>例子：父容器元素为false与子容器元素true:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">'button'</span>);</span><br><span class="line"><span class="keyword">var</span> container = <span class="built_in">document</span>.getElementById(<span class="string">'container'</span>);</span><br><span class="line">btn.addEventListener(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'button'</span>); <span class="comment">// 先触发</span></span><br><span class="line">&#125;,<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">container.addEventListener(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'container'</span>); <span class="comment">// 后触发</span></span><br><span class="line">&#125;,<span class="literal">false</span>);</span><br></pre></td></tr></table></figure>
<p>注意事项：</p>
<ul>
<li>事件类别没有on 如click keydown</li>
<li>this指向window</li>
<li>useCapture默认是fasle表示冒泡，true表示捕获</li>
</ul>
<ul>
<li><p>wantsUntrusted  （only Gecko）<br>如果为 true , 则事件处理程序会接收网页自定义的事件。此参数只适用于 Gecko，主要用于附加组件的代码和浏览器本身。请见 Interaction between privileged and non-privileged pages.<br>在使用 options 对象中的特定值之前，最好确保用户的浏览器支持它，因为他并没有被所有浏览器所支持。查看更多细节关于option支持的安全检测。</p>
</li>
<li><p>删除事件处理程序</p>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">target.removeEventListener(type, listener[, useCapture])</span><br></pre></td></tr></table></figure>
<ul>
<li>type：一个字符串，表示需要移除的事件类型，如 “click”。</li>
<li>listener： 需要移除的 EventListener 函数（先前使用 addEventListener 方法定义的）</li>
<li>useCapture 可选<br>指定需要移除的 EventListener 函数是否为事件捕获。如果无此参数，默认值为 false。</li>
</ul>
<p>注意事项</p>
<ul>
<li>用EventTarget.addEventListener指定，只能用EventTarget.removeEventListener删除</li>
<li>如果同一个监听事件分别为“事件捕获”和“事件冒泡”注册了一次，一共两次，这两次事件需要分别移除。两者不会互相干扰。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div id=<span class="string">"container"</span>&gt;</span><br><span class="line">        &lt;button id=<span class="string">"button"</span>&gt;事件&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button onclick="removeBubbleEvent()"&gt;删除冒泡事件&lt;/</span>button&gt;</span><br><span class="line">        &lt;button onclick=<span class="string">"removeCaptureEvent()"</span>&gt;删除捕获事件&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line"></span><br><span class="line">&lt;<span class="regexp">/body&gt;</span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">    var btn = document.getElementById('button');</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    btn.addEventListener('click',clickEvent,false);</span></span><br><span class="line"><span class="regexp">    btn.addEventListener('click',clickEvent,true);</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    function removeCaptureEvent()&#123;</span></span><br><span class="line"><span class="regexp">      btn.removeEventListener('click',clickEvent,true);</span></span><br><span class="line"><span class="regexp">      console.log('removeCaptureEvent ')</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    function removeBubbleEvent()&#123;</span></span><br><span class="line"><span class="regexp">      btn.removeEventListener('click',clickEvent,false);</span></span><br><span class="line"><span class="regexp">      console.log('removeBubbleEvent ')</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    function clickEvent()&#123;</span></span><br><span class="line"><span class="regexp">        console.log('clickEvent');</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>删除的函数，必须与添加时函数同一引用</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> div = <span class="built_in">document</span>.getElementById(<span class="string">'div'</span>);</span><br><span class="line"><span class="keyword">var</span> listener = <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="comment">/* do something here */</span></span><br><span class="line">&#125;;</span><br><span class="line">div.addEventListener(<span class="string">'click'</span>, listener, <span class="literal">false</span>);</span><br><span class="line">div.removeEventListener(<span class="string">'click'</span>, listener, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"button"</span>&gt;</span>事件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"delEvent()"</span>&gt;</span>删除事件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">'button'</span>);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    btn.addEventListener(<span class="string">'click'</span>,clickEvent,<span class="literal">false</span>);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">delEvent</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">      btn.removeEventListener(<span class="string">'click'</span>,clickEvent,<span class="literal">false</span>);</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">'removeEvent'</span>)</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">clickEvent</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">'clickEvent'</span>);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="4-事件目标支持情况"><a href="#4-事件目标支持情况" class="headerlink" title="(4) 事件目标支持情况"></a>(4) 事件目标支持情况</h4><h5 id="1-element"><a href="#1-element" class="headerlink" title="[1] element:"></a>[1] element:</h5><p>[x] html事件</p>
<p>[x] 属性事件 (dom0 事件)</p>
<p>[x] 事件监听回调  （dom2事件）</p>
<h5 id="2-document"><a href="#2-document" class="headerlink" title="[2] document:"></a>[2] document:</h5><p>[x] html事件</p>
<p>[x] 属性事件 (dom0 事件)</p>
<p>[] 事件监听回调  （dom2事件）</p>
<h5 id="3-window"><a href="#3-window" class="headerlink" title="[3] window:"></a>[3] window:</h5><p>实际body标签通过frameset等来支持html事件</p>
<p>[x] html事件</p>
<p>[x] 属性事件 (dom0 事件)</p>
<p>[x] 事件监听回调  （dom2事件）</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://www.neohuang.com/child/2018/09/06/js-review-event-op/" data-id="cjzh45xvv0008c4jgii5aal3z" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            <!--
    
        <a href="http://www.neohuang.com/child/2018/09/06/js-review-event-op/#comments" class="article-comment-link">Comments</a>
    
-->
        </footer>
    </div>
    
</article>



    <article id="post-muti-npm" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2018/09/04/muti-npm/">前端项目共享node_modules</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2018/09/04/muti-npm/">
            <time datetime="2018-09-03T16:00:00.000Z" itemprop="datePublished">2018-09-04</time>
        </a>
    </div>


                        
                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p><img src="/img/npm.jpg" alt=""></p>
<h3 id="1-前言"><a href="#1-前言" class="headerlink" title="1. 前言"></a>1. 前言</h3><p>在npm、yarn等包管理工具的帮助下，前端工程化模块化的进程日益加快，项目的依赖包也日益增大，特别是若项目采用webpack来构建用到许多webpack的插、一些辅助开发如（eslint、Browsersync之类的插件）以及一些单元测试可能需要用到的插件，项目中的node_module就会变的十分庞大。</p>
<p>因此团队开发者每次重新初始化项目进行npm install会十分缓慢，并且若占用大量空间，更进一步来说项目中往往很多前端团队会用到一台构建服务器，对前端项目的代码获取、打包、构建、部署进行管理（例如我自己所在的团队就在使用jenkins对前端项目的打包、构建、部署进行自动化托管）。npm这样的项目级依赖管理的特性就会造成大量的时间以及资源的消耗。</p>
<p>当然笔者也想在文章开始之前表明一个态度，npm本身portable的模块化设计，使每个项目互不干系，也是一种它设计的精华所在，本文仅是针对实际使用中遇到的一些小困扰进行解读，希望提供一个新的思路。</p>
<p>此本篇文章就在这样的背景下诞生了。纯粹是笔者在项目中积累的一些经验，若有不足望指出。</p>
<h3 id="2-问题的总结"><a href="#2-问题的总结" class="headerlink" title="2. 问题的总结"></a>2. 问题的总结</h3><p>接前言，若不对项目做任何优化以及设置正常一般前端项目的依赖应该是这样的：</p>
<p>如图：</p>
<p><img src="/img/npm-1.png" alt=""></p>
<p>可以看到图中 webpackA 与 webpackB项目在devDependencies层面其实只有less和sass，以及他们两者的webpackloader的差异，但是其项目中的node_modules剩余的依赖都会被重复获取。parcel项目A项目A 与 parcel项目B项目B同理,项目中的devDependencies只有parcel-plugin-vue 1.5.0和babel-preset-react有区别。</p>
<p>p.s: </p>
<p><strong>1. dependencies一般项目都会有较大差异，因此不在本文讨论范围，该图还是列出以便更接近现实状况</strong></p>
<p><strong>2. 使用webpack和parcel技术栈也可能会有一部分devDependencies，但本文暂不考虑两个项目差异极大的node_modules共享</strong></p>
<p>这样的情况，总结如下来会带来如下问题：</p>
<ul>
<li>项目devDependencies以及dependencies过多造成项目初始化过慢。</li>
<li>各个项目devDependencies大量重复，打包时项目占用空间过大。</li>
</ul>
<p>这样的问题在项目数不大时并不会明显体现，并且这些重复很大一部分是因为构建是devDependencies中的依赖所导致的。</p>
<h3 id="3-现有的一些解决方案以及存在的一些问题"><a href="#3-现有的一些解决方案以及存在的一些问题" class="headerlink" title="3. 现有的一些解决方案以及存在的一些问题"></a>3. 现有的一些解决方案以及存在的一些问题</h3><p>那难道没有方法让几个项目的依赖指向同一路径吗？答案当然是有</p>
<h4 id="1-解决办法"><a href="#1-解决办法" class="headerlink" title="(1)解决办法"></a>(1)解决办法</h4><p>可以通过配置NODE_PATH，具体来说就是：</p>
<p>在对应系统的环境变量配置文件中增加环境变量NODE_PATH，例如在MacOS中</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /ect/profile <span class="comment"># 或/etc/bashrc或~/.bashrc此处不赘述配置问价的加载顺序以及原理</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-&gt; <span class="built_in">export</span> PATH=<span class="variable">$PATH</span>: <span class="comment"># 将 /usr/bin 追加到 PATH 变量中</span></span><br><span class="line">-&gt; <span class="built_in">export</span> NODE_PATH=<span class="string">"/usr/lib/node_modules;/usr/local/lib/node_modules"</span> <span class="comment">#指定 NODE_PATH 变量</span></span><br></pre></td></tr></table></figure>
<p>那 NODE_PATH 就是NODE中用来寻找模块所提供的路径注册环境变量。我们可以使用上面的方法指定NODE_PATH环境变量。并且用;分割多个不同的目录。</p>
<p>关于 node 的包加载机制我就不在这里赘述了。NODE_PATH中的路径被遍历是发生在<br>从项目的根位置递归搜寻 node_modules 目录，直到文件系统根目录的 node_modules，如果还没有查找到指定模块的话，就会去 NODE_PATH中注册的路径中查找。</p>
<h4 id="2-存在问题"><a href="#2-存在问题" class="headerlink" title="(2)存在问题"></a>(2)存在问题</h4><p>经过调整后，依赖的结构目前变为了：</p>
<p>如图：</p>
<p>看似不错让多个项目指向的依赖指向了全局的node_modules，但这种方式存在很明显的缺点：</p>
<h5 id="a-不会生成package-json-无法增量安装"><a href="#a-不会生成package-json-无法增量安装" class="headerlink" title="a. 不会生成package.json,无法增量安装"></a>a. 不会生成package.json,无法增量安装</h5><p>在使用 –global 参数的时候 –save 或 –save-dev参数是无效的。<br>此时 package.json 中的 dependencies, devDependencies 将无法享受到npm增量更新带来的便利，不使用 dependencies, devDependencies 字段对整个依赖库的管理是非常不利的。</p>
<h5 id="b-若项目模块出现版本差异，很难维护以及解决"><a href="#b-若项目模块出现版本差异，很难维护以及解决" class="headerlink" title="b.若项目模块出现版本差异，很难维护以及解决"></a>b.若项目模块出现版本差异，很难维护以及解决</h5><p>差异性的解决方法<br>如果 项目A 使用了，express的3.x版本，项目B 使用了 express的4.x版本，那这种情况该怎么办呢？</p>
<p>如图：</p>
<p>可以将 NODE_PATH 指定的位置中存放 webpack的3.x版本，项目B需要webpack 目录中放置 2.x 版本呢？</p>
<p>可以利用node_module依赖包加载的机制，将webpack的3.x版本放在项目A自己的node_modules中</p>
<p>，这样确实可以解决了模块版本差异性问题，并不能做到根据让项目按技术框架去划分并且因为若项目数量多，依然无法做到统一管理，当然这种灵活使用node_module依赖包加载的机制仍十分有借鉴意义，也启发了我们可以使用一个更灵活的方式去解决问题。</p>
<h3 id="4-进一步增强以及改进的方案"><a href="#4-进一步增强以及改进的方案" class="headerlink" title="4.进一步增强以及改进的方案"></a>4.进一步增强以及改进的方案</h3><p>总而言之上述两种方式，在实际使用中都存在一定的问题。</p>
<p><strong>目前笔者的理想方案应该能够达到下列几个目的：</strong></p>
<ul>
<li><p>可以将项目构建相似技术栈的项目统一在一起，共享依赖</p>
</li>
<li><p>可以实现对公共模块的维护和管理，并实现增量安装</p>
</li>
<li><p>对原来npm install流程改动不会太大</p>
</li>
</ul>
<p><strong>因此笔者我经过了一系列的实践，采用了这种结构去维护模块，以下是主要思路：</strong></p>
<ul>
<li><p>由于node的包加载机制是从项目的根位置递归搜寻 node_modules 目录，因此我们只需要向当前项目的上层的node_modules安装依赖，既可以使项目正常引入。</p>
</li>
<li><p>对于相同构建技术栈的项目，建立一个框架目录，并将相同技术栈项目放在该目录中，在此目录下的node_modules和package.json中管理以及共享依赖包，项目目录如: webpack、gulp</p>
</li>
<li><p>在每个项目框架下维护一个自己的package.json以及一个框架级的node_modules，为了更好的区分哪些是我们框架需要的依赖包，并仍可以在项目中直接操作，故我们在项目级增加一个devDependenciesGlobal字段以从项目层面更好的维护公共框架的依赖</p>
</li>
<li><p>使用nodejs、shell脚本，结合npm script中的preinstall hook npm install的流程进行一些补充</p>
</li>
<li><p>在框架目录中建立带有md5的package.json来维护、管理公共的依赖</p>
</li>
<li><p>检查框架目录下是否存在package.json，若不存在视为需要初始化</p>
</li>
<li><p>若被视为初始化，会生成一个含有devDependenciesGlobal指纹的package.json，并在这个package.json的devDependencies写入，devDependenciesGlobal中所有描述的依赖</p>
</li>
<li><p>若已存在，跳过此步骤对项目自己的devdependencies以及devDependencies进行安装</p>
</li>
<li><p>若md5改变，则进行npm install，此时npm install会对借助npm本身的机制，对包进行分析，进行增量安装或更新</p>
</li>
</ul>
<p>故按这种结构来管理，假设团队项目中有2套技术框架 A: webpack B: gulp</p>
<p>调整下的依赖关系图：</p>
<p>如图:</p>
<p>示例webpack项目的github地址：<a href="https://github.com/Roxyhuang/npm-module-share" target="_blank" rel="noopener">https://github.com/Roxyhuang/npm-module-share</a></p>
<p>下面是本人的一些具体实践的核心代码以及，希望能够对大家有所启发：</p>
<h4 id="1-按技术框架划分项目目录，并增加devDependenciesGlobal"><a href="#1-按技术框架划分项目目录，并增加devDependenciesGlobal" class="headerlink" title="(1)按技术框架划分项目目录，并增加devDependenciesGlobal"></a>(1)按技术框架划分项目目录，并增加devDependenciesGlobal</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"dependencies"</span>: &#123;</span><br><span class="line">  <span class="string">"react"</span>: <span class="string">"^16.2.0"</span>,</span><br><span class="line">  <span class="string">"react-dom"</span>: <span class="string">"^16.2.0"</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">"devDependencies"</span>: &#123;</span><br><span class="line">  <span class="string">"babel-cli"</span>: <span class="string">"6.26.0"</span>,</span><br><span class="line">  <span class="string">"babel-plugin-transform-decorators-legacy"</span>: <span class="string">"1.3.4"</span>,</span><br><span class="line">  <span class="string">"babel-plugin-transform-runtime"</span>: <span class="string">"6.23.0"</span>,</span><br><span class="line">  <span class="string">"babel-polyfill"</span>: <span class="string">"6.23.0"</span>,</span><br><span class="line">  <span class="string">"babel-preset-env"</span>: <span class="string">"1.6.0"</span>,</span><br><span class="line">  <span class="string">"babel-preset-react"</span>: <span class="string">"6.24.1"</span>,</span><br><span class="line">  <span class="string">"babel-preset-stage-0"</span>: <span class="string">"6.24.1"</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">"devDependenciesGlobal"</span>: &#123;</span><br><span class="line">  <span class="string">"babel-core"</span>: <span class="string">"6.26.0"</span>,</span><br><span class="line">  <span class="string">"babel-loader"</span>: <span class="string">"7.1.2"</span>,</span><br><span class="line">  <span class="string">"chalk"</span>: <span class="string">"2.1.0"</span>,</span><br><span class="line">  <span class="string">"css-loader"</span>: <span class="string">"0.28.4"</span>,</span><br><span class="line">  <span class="string">"connect-history-api-fallback"</span>: <span class="string">"1.3.0"</span>,</span><br><span class="line">  <span class="string">"express"</span>: <span class="string">"4.16.1"</span>,</span><br><span class="line">  <span class="string">"webpack"</span>: <span class="string">"3.6.0"</span>,</span><br><span class="line">  <span class="string">"style-loader"</span>: <span class="string">"0.18.2"</span>,</span><br><span class="line">  <span class="string">"less"</span>: <span class="string">"2.7.3"</span>,</span><br><span class="line">  <span class="string">"rimraf"</span>: <span class="string">"2.6.1"</span>,</span><br><span class="line">  <span class="string">"html-webpack-plugin"</span>: <span class="string">"2.30.1"</span>,</span><br><span class="line">  <span class="string">"less-loader"</span>: <span class="string">"4.0.5"</span>,</span><br><span class="line">  <span class="string">"webpack-dev-middleware"</span>: <span class="string">"1.12.0"</span>,</span><br><span class="line">  <span class="string">"webpack-hot-middleware"</span>: <span class="string">"2.19.1"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-利用npm-script的hook机制，增加preinstall脚本"><a href="#2-利用npm-script的hook机制，增加preinstall脚本" class="headerlink" title="(2)利用npm script的hook机制，增加preinstall脚本"></a>(2)利用npm script的hook机制，增加preinstall脚本</h4><p>接下来为了更好和本身npm依赖管理机制结合的更好，可以利用npm script的hook，在script中增加preinstall</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">  <span class="string">"preinstall"</span>: <span class="string">"node build/script/preinstall.js"</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>下面是具体的node.js代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> exec = <span class="built_in">require</span>(<span class="string">'child_process'</span>).exec;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> preList = <span class="built_in">require</span>(<span class="string">'../../package.json'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">'crypto'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> execPath = path.resolve(<span class="string">'../'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> preListObj = preList.devDependenciesGlobal;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> preListObjArray = <span class="built_in">Object</span>.keys(preListObj);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isFirst = !fs.existsSync(<span class="string">`<span class="subst">$&#123;execPath&#125;</span>/package.json`</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> currentMd5 = md5(<span class="built_in">JSON</span>.stringify(preListObj));</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> script = <span class="string">`cd <span class="subst">$&#123;execPath&#125;</span> &amp;&amp; npm i`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> isUpdate = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`The md5 for this project: <span class="subst">$&#123;currentMd5&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> md5 = <span class="function"><span class="keyword">function</span> (<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> md5sum = crypto.createHash(<span class="string">'md5'</span>);</span><br><span class="line">  md5sum.update(str);</span><br><span class="line">  str = md5sum.digest(<span class="string">'hex'</span>);</span><br><span class="line">  <span class="keyword">return</span> str;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (isFirst)&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'init global modules...'</span>);</span><br><span class="line">  fs.writeFileSync(<span class="string">`<span class="subst">$&#123;execPath&#125;</span>/package.json`</span>, <span class="built_in">JSON</span>.stringify(&#123;<span class="string">"md5"</span>: currentMd5,<span class="attr">dependencies</span>: preListObj&#125;));</span><br><span class="line">  isUpdate = <span class="literal">true</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'will check update'</span>);</span><br><span class="line">  <span class="keyword">const</span> lastVersion = <span class="built_in">require</span>(<span class="string">`<span class="subst">$&#123;execPath&#125;</span>/package.json`</span>).md5;</span><br><span class="line">  <span class="keyword">if</span> (lastVersion !== currentMd5) &#123;</span><br><span class="line">    fs.writeFileSync(<span class="string">`<span class="subst">$&#123;execPath&#125;</span>/package.json`</span>, <span class="built_in">JSON</span>.stringify(&#123;<span class="string">"md5"</span>: currentMd5,<span class="attr">dependencies</span>: preListObj&#125;));</span><br><span class="line">    isUpdate = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (isUpdate) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`will install in <span class="subst">$&#123;execPath&#125;</span>`</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'start install public package for neo-antd'</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'please wait some minutes.....'</span>);</span><br><span class="line"></span><br><span class="line">  exec(script, <span class="function"><span class="keyword">function</span> (<span class="params">err, stdout, stderr</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(stdout);</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'error:'</span> + stderr);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(stdout);</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'package init success'</span>);</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`The global install in <span class="subst">$&#123;execPath&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'not any update'</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'will be run next'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="（3）-通过node-js生成package-json，并维护md5安装框架级依赖"><a href="#（3）-通过node-js生成package-json，并维护md5安装框架级依赖" class="headerlink" title="（3） 通过node.js生成package.json，并维护md5安装框架级依赖"></a>（3） 通过node.js生成package.json，并维护md5安装框架级依赖</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"md5"</span>: <span class="string">"4c4ee67828b3e09f07b17774cb1633c7"</span>,</span><br><span class="line">  <span class="attr">"dependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"babel-core"</span>: <span class="string">"6.26.0"</span>,</span><br><span class="line">    <span class="attr">"babel-loader"</span>: <span class="string">"7.1.2"</span>,</span><br><span class="line">    <span class="attr">"chalk"</span>: <span class="string">"2.1.0"</span>,</span><br><span class="line">    <span class="attr">"css-loader"</span>: <span class="string">"0.28.4"</span>,</span><br><span class="line">    <span class="attr">"connect-history-api-fallback"</span>: <span class="string">"1.3.0"</span>,</span><br><span class="line">    <span class="attr">"express"</span>: <span class="string">"4.16.1"</span>,</span><br><span class="line">    <span class="attr">"webpack"</span>: <span class="string">"3.6.0"</span>,</span><br><span class="line">    <span class="attr">"style-loader"</span>: <span class="string">"0.18.2"</span>,</span><br><span class="line">    <span class="attr">"less"</span>: <span class="string">"2.7.3"</span>,</span><br><span class="line">    <span class="attr">"rimraf"</span>: <span class="string">"2.6.1"</span>,</span><br><span class="line">    <span class="attr">"html-webpack-plugin"</span>: <span class="string">"2.30.1"</span>,</span><br><span class="line">    <span class="attr">"less-loader"</span>: <span class="string">"4.0.5"</span>,</span><br><span class="line">    <span class="attr">"webpack-dev-middleware"</span>: <span class="string">"1.12.0"</span>,</span><br><span class="line">    <span class="attr">"webpack-hot-middleware"</span>: <span class="string">"2.19.1"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-初始化项目，并在框架目录生成存有md的package-json"><a href="#4-初始化项目，并在框架目录生成存有md的package-json" class="headerlink" title="(4) 初始化项目，并在框架目录生成存有md的package.json"></a>(4) 初始化项目，并在框架目录生成存有md的package.json</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">npm install <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">&gt; npm-module-share@1.0.0 preinstall /Users/neo/home/webpack/npm-module-share</span><br><span class="line">&gt; node build/script/preinstall.js</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">The md5 <span class="keyword">for</span> this project: 4c4ee67828b3e09f07b17774cb1633c7</span><br><span class="line">init global modules...</span><br><span class="line">will install <span class="keyword">in</span> /Users/neo/home/webpack</span><br><span class="line">start install public package <span class="keyword">for</span> neo-antd</span><br><span class="line">please <span class="built_in">wait</span> some minutes....</span><br><span class="line"></span><br><span class="line">....</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">added 704 packages <span class="keyword">in</span> 7.777s</span><br><span class="line"></span><br><span class="line">package init success</span><br><span class="line">The global install <span class="keyword">in</span> /Users/neo/home/webpack</span><br><span class="line"></span><br><span class="line">....</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt; fsevents@1.1.3 install /Users/neo/home/webpack/npm-module-share/node_modules/fsevents</span><br><span class="line">&gt; node install</span><br><span class="line"></span><br><span class="line">[fsevents] Success: <span class="string">"/Users/neo/home/webpack/npm-module-share/node_modules/fsevents/lib/binding/Release/node-v57-darwin-x64/fse.node"</span> already installed</span><br><span class="line">Pass --update-binary to reinstall or --build-from-source to recompile</span><br><span class="line">npm WARN npm-module-share@1.0.0 No description</span><br><span class="line"></span><br><span class="line">added 341 packages <span class="keyword">in</span> 13.46s</span><br></pre></td></tr></table></figure>
<h4 id="5-检查md5是否存在变化，判断是否需要进行增量安装"><a href="#5-检查md5是否存在变化，判断是否需要进行增量安装" class="headerlink" title="(5)    检查md5是否存在变化，判断是否需要进行增量安装"></a>(5)    检查md5是否存在变化，判断是否需要进行增量安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">npm install <span class="comment"># 若没有任何更新，md5不会有任何变化，也不会再对会直接跳过preinstall的步骤</span></span><br><span class="line"></span><br><span class="line">The md5 <span class="keyword">for</span> this project: 4c4ee67828b3e09f07b17774cb1633c7</span><br><span class="line">will check update</span><br><span class="line">not any update</span><br><span class="line">will be run next</span><br><span class="line">npm WARN npm-module-share@1.0.0 No description</span><br><span class="line"></span><br><span class="line">update <span class="keyword">in</span> 1.291s</span><br></pre></td></tr></table></figure>
<h4 id="6-几点需要注意的地方"><a href="#6-几点需要注意的地方" class="headerlink" title="(6) 几点需要注意的地方"></a>(6) 几点需要注意的地方</h4><h5 id="a-npm-script中直接需要调用的模块，需要放置到该项目的dependencies和devDependencies中"><a href="#a-npm-script中直接需要调用的模块，需要放置到该项目的dependencies和devDependencies中" class="headerlink" title="a. npm script中直接需要调用的模块，需要放置到该项目的dependencies和devDependencies中"></a>a. npm script中直接需要调用的模块，需要放置到该项目的dependencies和devDependencies中</h5><p>关于这点阮一峰前辈的博客中: <a href="http://www.ruanyifeng.com/blog/2016/10/npm_scripts.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2016/10/npm_scripts.html</a></p>
<p>在对npm script的原理中有提到，在此因为篇幅有限不赘述了，简单来说就是npm script当中用到的模块需要存在当前项目的devdependencies或devDependencies中。</p>
<h5 id="b-经过测试在windows下需要将babel以及babelrc相关的依赖"><a href="#b-经过测试在windows下需要将babel以及babelrc相关的依赖" class="headerlink" title="b. 经过测试在windows下需要将babel以及babelrc相关的依赖"></a>b. 经过测试在windows下需要将babel以及babelrc相关的依赖</h5><p>目前这点笔者暂时还没有找到原因，在mac中并不会报错，但是在windows中会包找不到这些模块。</p>
<p>希望知道的同行能够与我联系告知我具体原因</p>
<h5 id="c-若有eslint需要增加-eslintignore"><a href="#c-若有eslint需要增加-eslintignore" class="headerlink" title="c. 若有eslint需要增加 .eslintignore"></a>c. 若有eslint需要增加 .eslintignore</h5><h5 id="d-需要尽量保证一套技术框架下的devDependenciesGlobal尽量一致"><a href="#d-需要尽量保证一套技术框架下的devDependenciesGlobal尽量一致" class="headerlink" title="d. 需要尽量保证一套技术框架下的devDependenciesGlobal尽量一致"></a>d. 需要尽量保证一套技术框架下的devDependenciesGlobal尽量一致</h5><h3 id="结语："><a href="#结语：" class="headerlink" title="结语："></a>结语：</h3><p>经过上述操作，我们便可以将前端项目根据框架进行依赖管理以及划分了，其实如此改进仍并非最完美以及优化，不足之处仍非常之多，如：同一技术框架下，框架依赖包的升级策略并不完善，期待更加优雅的解决方案，使我们前端项目的架构更佳健壮和灵活。</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://www.neohuang.com/child/2018/09/04/muti-npm/" data-id="cjzh45xvx0009c4jg3sw6qusn" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            <!--
    
        <a href="http://www.neohuang.com/child/2018/09/04/muti-npm/#comments" class="article-comment-link">Comments</a>
    
-->
        </footer>
    </div>
    
</article>



    <article id="post-hash-backListener" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2018/09/03/hash-backListener/">监听浏览器回退</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2018/09/03/hash-backListener/">
            <time datetime="2018-09-02T16:00:00.000Z" itemprop="datePublished">2018-09-03</time>
        </a>
    </div>


                        
                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h2 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h2><p>近来遇到一个需求需要监听浏览器回退事件，恰好目前项目中运用的路由为hash-router，因此对这方面做了一个总结。因此本文更多其实只能算对mdn相关文档的一个汇总笔记。</p>
<h2 id="二、相关api"><a href="#二、相关api" class="headerlink" title="二、相关api"></a>二、相关api</h2><h3 id="1-window-onpopstate"><a href="#1-window-onpopstate" class="headerlink" title="1.window.onpopstate"></a>1.window.onpopstate</h3><p>参考：<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/onpopstate" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/API/Window/onpopstate</a></p>
<p> 每当活动的历史记录项发生变化时， popstate 事件都会被传递给window对象。如果当前活动的历史记录项是被 pushState 创建的，或者是由 replaceState 改变的，那么 popstate 事件的状态属性 state 会包含一个当前历史记录状态对象的拷贝。</p>
<h4 id="1-概述："><a href="#1-概述：" class="headerlink" title="(1) 概述："></a>(1) 概述：</h4><p>根据mdn文档上的解释，我还想来画一下重点：</p>
<p>[1] window.onpopstate是popstate事件在window对象上的事件处理程序，<strong>每当处于激活状态的历史记录条目发生变化时</strong>,popstate事件就会在对应window对象上触发。</p>
<p>[2] <strong>调用history.pushState()或者history.replaceState()不会触发popstate事件</strong>. popstate事件<strong>只会在浏览器某些行为下触发</strong>, 比如点击后退、前进按钮(或者在JavaScript中调用history.back()、history.forward()、history.go()方法)。</p>
<p>[3] 如果当前处于激活状态的历史记录条目是由history.pushState()方法创建,或者由history.replaceState()方法修改过的, 则popstate事件对象的state属性包含了这个历史记录条目的state对象的一个拷贝。</p>
<p>[4] <strong>当网页加载时,各浏览器对popstate事件是否触发有不同的表现</strong>,Chrome 和 Safari会触发popstate事件, 而Firefox不会。</p>
<p>语法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.onpopstate = funcRef;</span><br></pre></td></tr></table></figure>
<p>例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.onpopstate = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">"location: "</span> + <span class="built_in">document</span>.location + <span class="string">", state: "</span> + <span class="built_in">JSON</span>.stringify(event.state));</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">//绑定事件处理函数.</span></span><br><span class="line"> history.pushState(&#123;<span class="attr">page</span>: <span class="number">1</span>&#125;, <span class="string">"title 1"</span>, <span class="string">"?page=1"</span>);    <span class="comment">//添加并激活一个历史记录条目 http://example.com/example.html?page=1,条目索引为1</span></span><br><span class="line"> history.pushState(&#123;<span class="attr">page</span>: <span class="number">2</span>&#125;, <span class="string">"title 2"</span>, <span class="string">"?page=2"</span>);    <span class="comment">//添加并激活一个历史记录条目 http://example.com/example.html?page=2,条目索引为2</span></span><br><span class="line"> history.replaceState(&#123;<span class="attr">page</span>: <span class="number">3</span>&#125;, <span class="string">"title 3"</span>, <span class="string">"?page=3"</span>); <span class="comment">//修改当前激活的历史记录条目 http://ex..?page=2 变为 http://ex..?page=3,条目索引为3</span></span><br><span class="line"> history.back(); <span class="comment">// 弹出 "location: http://example.com/example.html?page=1, state: &#123;"page":1&#125;"</span></span><br><span class="line"> history.back(); <span class="comment">// 弹出 "location: http://example.com/example.html, state: null</span></span><br><span class="line"> history.go(<span class="number">2</span>);  <span class="comment">// 弹出 "location: http://example.com/example.html?page=3, state: &#123;"page":3&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-history-pushState"><a href="#2-history-pushState" class="headerlink" title="2.history.pushState"></a>2.history.pushState</h3><p>参考：<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/History_API" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/API/History_API</a></p>
<h4 id="1-概念：添加历史记录中的条目"><a href="#1-概念：添加历史记录中的条目" class="headerlink" title="(1) 概念：添加历史记录中的条目"></a>(1) 概念：添加历史记录中的条目</h4><h4 id="2-pushState-使用"><a href="#2-pushState-使用" class="headerlink" title="(2) pushState()使用"></a>(2) pushState()使用</h4><p>pushState() 需要三个参数: 一个状态对象, 一个标题 (目前被忽略), 和 (可选的) 一个URL. 让我们来解释下这三个参数详细内容：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pushState(&#123; <span class="attr">state1</span>: <span class="number">1</span>, <span class="attr">state2</span>: <span class="number">2</span> &#125;, title, URL);</span><br></pre></td></tr></table></figure>
<ul>
<li><p>状态对象： </p>
<p>  状态对象state是一个JavaScript对象，通过pushState () 创建新的历史记录条目。无论什么时候用户导航到新的状态，popstate事件就会被触发，且该事件的state属性包含该历史记录条目状态对象的副本。</p>
<p>  状态对象可以是能被序列化的任何东西。原因在于Firefox将状态对象保存在用户的磁盘上，以便在用户重启浏览器时使用，我<strong>们规定了状态对象在序列化表示后有640k的大小限制</strong>。如果你给 pushState() 方法传了一个序列化后大于640k的状态对象，该方法会抛出异常。如果你需要更大的空间，建议使用 sessionStorage 以及 localStorage.</p>
  <figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这一句可以理解为，pushState()后不会立即跳转，此时会对该历史记录条目状态保存一个副本，无	论什么时候用户导航到新的状态，popstate事件就会被触发。</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>标题</p>
<p>  Firefox 目前忽略这个参数，但未来可能会用到。传递一个空字符串在这里是安全的，而在将来这是不安全的。二选一的话，你可以为跳转的state传递一个短标题</p>
</li>
<li><p>URL </p>
<p>   该参数定义了新的历史URL记录。注意，调用 pushState() <strong>后浏览器并不会立即加载这个URL</strong>，但可能会在稍后某些情况下加载这个URL，比如在用户重新打开浏览器时。新URL不必须为绝对路径。如果新URL是相对路径，那么它将被作为相对于当前URL处理。<strong>新URL必须与当前URL同源</strong>，否则 pushState() 会抛出一个异常。该参数是可选的，缺省为当前URL。</p>
</li>
</ul>
<h4 id="3-例子"><a href="#3-例子" class="headerlink" title="(3) 例子"></a>(3) 例子</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> stateObj = &#123; <span class="attr">foo</span>: <span class="string">"bar"</span> &#125;;</span><br><span class="line">history.pushState(stateObj, <span class="string">"page 2"</span>, <span class="string">"bar.html"</span>);</span><br></pre></td></tr></table></figure>
<p>使用 history.pushState() 可以改变referrer，它在用户发送 XMLHttpRequest 请求时在HTTP头部使用，改变state后创建的 XMLHttpRequest 对象的referrer都会被改变。因为referrer是标识创建  XMLHttpRequest 对象时 this 所代表的window对象中document的URL。</p>
<p>在某种意义上，调用 pushState() 与 设置 window.location = “#foo” 类似，二者都会在当前页面创建并激活新的历史记录。但 pushState() 具有如下几条优点：</p>
<ul>
<li><p>新的 URL 可以是与当前URL同源的任意URL 。而设置 window.location 仅当你只修改了哈希值时才保持同一个 document。</p>
</li>
<li><p>如果需要，你可以不必改变URL。而设置 window.location = “#foo”;在当前哈希不是 #foo 的情况下， 仅仅是新建了一个新的历史记录项。</p>
</li>
<li><p>你可以为新的历史记录项关联任意数据。而基于哈希值的方式，则必须将所有相关数据编码到一个短字符串里。</p>
</li>
<li><p>假如 标题 在之后会被浏览器用到，那么这个数据是可以被使用的（哈希则不然）。</p>
</li>
</ul>
<p>注意 pushState() 绝对不会触发 hashchange 事件，即使新的URL与旧的URL仅哈希不同也是如此。    </p>
<h3 id="3-history-replaceState"><a href="#3-history-replaceState" class="headerlink" title="3.history.replaceState"></a>3.history.replaceState</h3><p>参考：<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/History_API" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/API/History_API</a></p>
<h4 id="1-概念：修改历史记录中的条目"><a href="#1-概念：修改历史记录中的条目" class="headerlink" title="(1) 概念：修改历史记录中的条目"></a>(1) 概念：修改历史记录中的条目</h4><p>history.replaceState() 的使用与 history.pushState() 非常相似，区别在于  replaceState()  是修改了当前的历史记录项而不是新建一个。 注意这并不会阻止其在全局浏览器历史记录中创建一个新的历史记录项。</p>
<p>replaceState() 的使用场景在于为了响应用户操作，你想要更新状态对象state或者当前历史记录的URL。</p>
<h4 id="2-replaceState-使用"><a href="#2-replaceState-使用" class="headerlink" title="(2) replaceState()使用"></a>(2) replaceState()使用</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> stateObj = &#123; <span class="attr">foo</span>: <span class="string">"bar"</span> &#125;;</span><br><span class="line">history.replaceState(stateObj, <span class="string">"page 3"</span>, <span class="string">"bar2.html"</span>);</span><br></pre></td></tr></table></figure>
<p><strong>导致地址栏显示<a href="http://mozilla.org/bar2.html,，但是浏览器并不会去加载bar2.html" target="_blank" rel="noopener">http://mozilla.org/bar2.html,，但是浏览器并不会去加载bar2.html</a></strong> 甚至都不需要检查 bar2.html 是否存在。</p>
<p>假设现在用户重新导向到了 <strong><a href="http://www.microsoft.com" target="_blank" rel="noopener">http://www.microsoft.com</a></strong>，然后点击了回退按钮。这里，地址栏会显示<strong><a href="http://mozilla.org/bar2.html" target="_blank" rel="noopener">http://mozilla.org/bar2.html</a></strong>。假如用户再次点击回退按钮，地址栏会显示<strong><a href="http://mozilla.org/foo.html" target="_blank" rel="noopener">http://mozilla.org/foo.html</a></strong>，完全跳过了bar.html。</p>
<h3 id="4-HashChangeEvent"><a href="#4-HashChangeEvent" class="headerlink" title="4.HashChangeEvent"></a>4.HashChangeEvent</h3><p>当URL中的片段标识符发生改变时触发（URL中紧跟’#’号的部分，包括‘#’号）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">window</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// exit if the browser implements that event</span></span><br><span class="line">  <span class="keyword">if</span> ( <span class="string">"onhashchange"</span> <span class="keyword">in</span> <span class="built_in">window</span>.document.body ) &#123; <span class="keyword">return</span>; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> location = <span class="built_in">window</span>.location,</span><br><span class="line">    oldURL = location.href,</span><br><span class="line">    oldHash = location.hash;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// check the location hash on a 100ms interval</span></span><br><span class="line">  setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> newURL = location.href,</span><br><span class="line">      newHash = location.hash;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// if the hash has changed and a handler has been bound...</span></span><br><span class="line">    <span class="keyword">if</span> ( newHash != oldHash &amp;&amp; <span class="keyword">typeof</span> <span class="built_in">window</span>.onhashchange === <span class="string">"function"</span> ) &#123;</span><br><span class="line">      <span class="comment">// execute the handler</span></span><br><span class="line">      <span class="built_in">window</span>.onhashchange(&#123;</span><br><span class="line">        type: <span class="string">"hashchange"</span>,</span><br><span class="line">        oldURL: oldURL,</span><br><span class="line">        newURL: newURL</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      oldURL = newURL;</span><br><span class="line">      oldHash = newHash;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">&#125;)(<span class="built_in">window</span>);</span><br></pre></td></tr></table></figure>
<h3 id="5-history-length"><a href="#5-history-length" class="headerlink" title="5.history.length"></a>5.history.length</h3><p>History.length是一个只读属性，返回当前session中的history个数，包含当前页面在内。举个例子，对于新开一个tab加载的页面当前属性返回值1。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">length = history.length; <span class="comment">// 返回当前session中的history个数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> result = <span class="built_in">window</span>.history.length; <span class="comment">// 返回当前session中的history个数</span></span><br></pre></td></tr></table></figure>
<p>mdn文档中，对这块的翻译基本以上，实际在使用中有一点是非常需要注意的，就是history.length并不是整个当前会话的历史条目的当前状态(即currentLength)，而实际是当前会话历史条目的存在记录的整体长度（即maxlength）</p>
<h2 id="三、常用遇到的情况"><a href="#三、常用遇到的情况" class="headerlink" title="三、常用遇到的情况"></a>三、常用遇到的情况</h2><h3 id="1-监听回退"><a href="#1-监听回退" class="headerlink" title="1. 监听回退"></a>1. 监听回退</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> detectBack = &#123;</span><br><span class="line"></span><br><span class="line">  initialize: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">//监听hashchange事件</span></span><br><span class="line">  <span class="built_in">window</span>.addEventListener(<span class="string">'hashchange'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//为当前导航页附加一个tag</span></span><br><span class="line">  <span class="keyword">this</span>.history.replaceState(<span class="string">'hasHash'</span>, <span class="string">''</span>, <span class="string">''</span>);</span><br><span class="line"></span><br><span class="line">  &#125;, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">window</span>.addEventListener(<span class="string">'popstate'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (e.state) &#123;</span><br><span class="line">      <span class="comment">//侦测是用户触发的后退操作, dosomething</span></span><br><span class="line">      <span class="comment">//这里刷新当前url</span></span><br><span class="line">      <span class="keyword">this</span>.location.reload();</span><br><span class="line">  	&#125;</span><br><span class="line">   &#125;, <span class="literal">false</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    detectBack.initialize();</span><br></pre></td></tr></table></figure>
<h3 id="2-阻止回退"><a href="#2-阻止回退" class="headerlink" title="2. 阻止回退"></a>2. 阻止回退</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pushHash</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="built_in">window</span>.history.pushState(<span class="string">'home'</span>,<span class="literal">null</span>,<span class="string">'#/home'</span>); <span class="comment">// 跳转后压入一次历史，并表示home状态</span></span><br><span class="line">   <span class="built_in">window</span>.history.pushState(<span class="literal">null</span>,<span class="literal">null</span>,<span class="string">'#/home'</span>); <span class="comment">// 跳转后压入一次历史，以便回退拦截</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'popstate'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(e.state === <span class="string">'home'</span>) &#123;</span><br><span class="line">		拦截回退</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://www.neohuang.com/child/2018/09/03/hash-backListener/" data-id="cjzh45xvk0000c4jg4dc7rpo7" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            <!--
    
        <a href="http://www.neohuang.com/child/2018/09/03/hash-backListener/#comments" class="article-comment-link">Comments</a>
    
-->
        </footer>
    </div>
    
</article>



    <article id="post-position-sticky" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2018/08/22/position-sticky/">白话聊聊position sticky</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2018/08/22/position-sticky/">
            <time datetime="2018-08-21T16:00:00.000Z" itemprop="datePublished">2018-08-22</time>
        </a>
    </div>


                        
                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h2 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h2><p>项目中有一个同事遇到了一个吸顶效果的需求，于是帮助他完成的同时顺便分析下position：sticky。</p>
<h2 id="二、position：sticky是什么"><a href="#二、position：sticky是什么" class="headerlink" title="二、position：sticky是什么"></a>二、position：sticky是什么</h2><p>粘性定位元素（stickily positioned element）：粘性定位可以被认为是相对定位和固定定位的混合。元素在跨越特定阈值前为相对定位，之后为固定定位。</p>
<p>最白话来说，其实这句话想表达的是： 粘性定位（position：sticky） = 相对定位(position：relative) + 固定定位 (position：fixed)</p>
<h2 id="三、position：sticky作用以及兼容"><a href="#三、position：sticky作用以及兼容" class="headerlink" title="三、position：sticky作用以及兼容"></a>三、position：sticky作用以及兼容</h2><h3 id="1-作用："><a href="#1-作用：" class="headerlink" title="1. 作用："></a>1. 作用：</h3><p>其作用为了在iOS下实现吸顶效果，原先吸顶效果的基本的开发思路如下：</p>
<p>利用scroll事件进行监听scrollTop的值，当scrollTop达到一定的值得时候设置吸顶元素的position : fixed;属性。</p>
<p>但是问题是：安卓支持scroll事件和fixed属性，但是ios8.0的scroll事件不是连续触发的，只会在scroll事件结束后触发一次scroll事件，同时ios下fixed属性的支持一直是个问题。</p>
<h3 id="2-兼容性探究："><a href="#2-兼容性探究：" class="headerlink" title="2. 兼容性探究："></a>2. 兼容性探究：</h3><h4 id="1-MDN"><a href="#1-MDN" class="headerlink" title="(1) MDN"></a>(1) <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/position" target="_blank" rel="noopener">MDN</a></h4><p><img src="/img/sticky-mdn.png" alt=""></p>
<h4 id="2-caniuse"><a href="#2-caniuse" class="headerlink" title="(2) caniuse"></a>(2) <a href="https://caniuse.com/#search=sticky" target="_blank" rel="noopener">caniuse</a></h4><p><img src="/img/sticky-use.png" alt=""></p>
<p>####( 3) 因为mdn以及caniuse给到的兼容性并不一致，同时如上面所述主要在iOS使用，因此实际使用仍需要对iOS机型进行实际测试，并考虑polyfill方案</p>
<p>之后在实际找到设备测试后，会持续更新</p>
<h4 id="4-polyfill方案"><a href="#4-polyfill方案" class="headerlink" title="(4) polyfill方案:"></a>(4) polyfill方案:</h4><p><a href="[https://github.com/wilddeer/stickyfill">https://github.com/wilddeer/stickyfill</a></p>
<h2 id="三、position：sticky触发条件"><a href="#三、position：sticky触发条件" class="headerlink" title="三、position：sticky触发条件"></a>三、position：sticky触发条件</h2><p>1、具有sticky属性的元素，其父级高度必须大于sticky元素的高度。</p>
<p>2、sticky元素的底部，不能和父级底部重叠。（这条不好表述，文后详细说明）</p>
<p>3、sticky元素的父级不能含有overflow:hidden 和 overflow:auto 属性 （不包括祖先，仅直接包含的父容器）</p>
<p>4、必须具有top，或 bottom 属性。</p>
<h2 id="四、移动端吸顶效果实战"><a href="#四、移动端吸顶效果实战" class="headerlink" title="四、移动端吸顶效果实战"></a>四、移动端吸顶效果实战</h2><h3 id="1-position：sticky"><a href="#1-position：sticky" class="headerlink" title="1.position：sticky"></a>1.position：sticky</h3><p>使用position：sticky 一定要记得处理浏览器兼容，并且指定top或bottom</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.sticky</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: -webkit-sticky;</span><br><span class="line">  <span class="attribute">position</span>: sticky;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-实战"><a href="#2-实战" class="headerlink" title="2.实战"></a>2.实战</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1, shrink-to-fit=no, user-scalable=no"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--适配移动端js--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">      (<span class="function"><span class="keyword">function</span> (<span class="params">doc, win</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> docEl = doc.documentElement,</span></span><br><span class="line"><span class="javascript">            resizeEvt = <span class="string">'orientationchange'</span> <span class="keyword">in</span> <span class="built_in">window</span> ? <span class="string">'orientationchange'</span> : <span class="string">'resize'</span>,</span></span><br><span class="line"><span class="javascript">            recalc = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">              <span class="keyword">var</span> clientWidth = docEl.clientWidth;</span></span><br><span class="line"><span class="javascript">              <span class="keyword">if</span> (!clientWidth) <span class="keyword">return</span>;</span></span><br><span class="line"><span class="javascript">              docEl.style.fontSize = <span class="number">75</span> * (clientWidth / <span class="number">750</span>) + <span class="string">'px'</span>;</span></span><br><span class="line"><span class="undefined">            &#125;;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (doc.addEventListener) &#123;</span></span><br><span class="line"><span class="javascript">          win.addEventListener(resizeEvt, recalc, <span class="literal">false</span>);</span></span><br><span class="line"><span class="javascript">          doc.addEventListener(<span class="string">'DOMContentLoaded'</span>, recalc, <span class="literal">false</span>);</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="javascript">      &#125;)(<span class="built_in">document</span>, <span class="built_in">window</span>);</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    * &#123;</span></span><br><span class="line"><span class="undefined">        margin: 0;</span></span><br><span class="line"><span class="undefined">        padding: 0;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.container</span> &#123;</span></span><br><span class="line"><span class="undefined">        position: fixed;</span></span><br><span class="line"><span class="undefined">        overflow: auto;</span></span><br><span class="line"><span class="undefined">        width: 100%;</span></span><br><span class="line"><span class="undefined">        height: 100%;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.banner</span> &#123;</span></span><br><span class="line"><span class="undefined">        height: 2rem;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">background-color</span>: <span class="selector-id">#009EE0</span>;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.sticky</span> &#123;</span></span><br><span class="line"><span class="undefined">        position: -webkit-sticky;</span></span><br><span class="line"><span class="undefined">        position: sticky;</span></span><br><span class="line"><span class="undefined">        top: 0;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.fixed</span> &#123;</span></span><br><span class="line"><span class="undefined">        position: fixed;</span></span><br><span class="line"><span class="undefined">        width: 100%;</span></span><br><span class="line"><span class="undefined">        top: 0;</span></span><br><span class="line"><span class="undefined">        left: 0;</span></span><br><span class="line"><span class="undefined">        background-color: white;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.relative</span> &#123;</span></span><br><span class="line"><span class="undefined">        background-color: white;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.sticky-title</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">height</span>: 1<span class="selector-class">.4rem</span>;</span></span><br><span class="line"><span class="undefined">        background-color: pink;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.sticky-content</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">height</span>: 20<span class="selector-class">.3rem</span>;</span></span><br><span class="line"><span class="undefined">        overflow: auto;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span> <span class="attr">id</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"banner"</span>&gt;</span></span><br><span class="line">                Banner部分</span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"sticky"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sticky-title"</span>&gt;</span>吸顶结构标题。。。<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sticky-content"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span>内容块<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span>内容块<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span>内容块<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span>内容块<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span>内容块<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span>内容块<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span>内容块<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span>内容块<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span>内容块<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span>内容块<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span>内容块<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span>内容块<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span>内容块<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span>内容块<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span>内容块<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span>内容块<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span>内容块<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="comment">// 安卓吸顶方案</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> scrollWrapper = <span class="built_in">document</span>.getElementById(<span class="string">'container'</span>); <span class="comment">// 假设windows 为滚动容器</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> stickyDom = <span class="built_in">document</span>.getElementById(<span class="string">'sticky'</span>);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> u = navigator.userAgent;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> isAndroid = u.indexOf(<span class="string">'Android'</span>) &gt; <span class="number">-1</span> || u.indexOf(<span class="string">'Adr'</span>) &gt; <span class="number">-1</span>;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> isiOS = !!u.match(<span class="regexp">/\(i[^;]+;( U;)? CPU.+Mac OS X/</span>);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    scrollWrapper.addEventListener(<span class="string">'scroll'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (isAndroid) &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> bannerHeight = <span class="built_in">document</span>.getElementsByClassName(<span class="string">'banner'</span>)[<span class="number">0</span>].clientHeight;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (<span class="keyword">this</span>.scrollTop &gt; <span class="number">72</span>) &#123;</span></span><br><span class="line"><span class="javascript">          stickyDom.className = <span class="string">'fixed'</span>;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">        </span></span><br><span class="line"><span class="javascript">      &#125; <span class="keyword">else</span> <span class="keyword">if</span>(isiOS &amp;&amp; (CSS.supports(<span class="string">"position"</span>, <span class="string">"sticky"</span>) || CSS.supports(<span class="string">"position"</span>, <span class="string">"-webkit-sticky"</span>)))&#123;</span></span><br><span class="line"><span class="javascript">        stickyDom.className = <span class="string">'stickay'</span>;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    &#125;);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://www.neohuang.com/child/2018/08/22/position-sticky/" data-id="cjzh45xw2000ec4jgiu5h8uuw" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            <!--
    
        <a href="http://www.neohuang.com/child/2018/08/22/position-sticky/#comments" class="article-comment-link">Comments</a>
    
-->
        </footer>
    </div>
    
</article>



    <nav id="page-nav">
        <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
</section>
            
                <aside id="sidebar">
   
        
    <div class="widget-wrap">
        <h3 class="widget-title">recent</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2019/08/18/neo-fe-review-prospect/" class="thumbnail">
    
    
        <span style="background-image:url(/img/npm.jpg)" alt="回顾前端系列 - 前瞻" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2019/08/18/neo-fe-review-prospect/" class="title">回顾前端系列 - 前瞻</a></p>
                            <p class="item-date"><time datetime="2019-08-17T16:00:00.000Z" itemprop="datePublished">2019-08-18</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/12/10/npm-manager/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2018/12/10/npm-manager/" class="title"></a></p>
                            <p class="item-date"><time datetime="2018-12-10T07:01:03.000Z" itemprop="datePublished">2018-12-10</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/11/20/http-cache/" class="thumbnail">
    
    
        <span style="background-image:url(/img/how-browser-caching-works.png)" alt="浅聊HTTP缓存 (HTTP Cache)" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2018/11/20/http-cache/" class="title">浅聊HTTP缓存 (HTTP Cache)</a></p>
                            <p class="item-date"><time datetime="2018-11-19T16:00:00.000Z" itemprop="datePublished">2018-11-20</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/09/12/array-review/" class="thumbnail">
    
    
        <span style="background-image:url(/img/array-review.jpeg)" alt="js数组方法分类复习" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2018/09/12/array-review/" class="title">js数组方法分类复习</a></p>
                            <p class="item-date"><time datetime="2018-09-11T16:00:00.000Z" itemprop="datePublished">2018-09-12</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/09/11/js-reivew-event-level/" class="thumbnail">
    
    
        <span style="background-image:url(/img/js-review-event-op.jpg)" alt="js复习事件的优先级和事件对象" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2018/09/11/js-reivew-event-level/" class="title">js复习事件的优先级和事件对象</a></p>
                            <p class="item-date"><time datetime="2018-09-10T16:00:00.000Z" itemprop="datePublished">2018-09-11</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

    
        
    
        
    <div class="widget-wrap">
        <h3 class="widget-title">archives</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a><span class="archive-list-count">1</span></li></ul>
        </div>
    </div>

    
        
    
        
    
        
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">links</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://blog.zhaiyifan.cn/">MarkZhai</a>
                    </li>
                
                    <li>
                        <a href="http://silverd.cn/">SilverdJiang</a>
                    </li>
                
                    <li>
                        <a href="http://yownyang.github.io">YownYang</a>
                    </li>
                
                    <li>
                        <a href="http://zhukejin.com">PrimoZhu</a>
                    </li>
                
                    <li>
                        <a href="http://wjerryzhen11.github.io">JerryXu</a>
                    </li>
                
                    <li>
                        <a href="http://yocann.cn">CnnyChen</a>
                    </li>
                
            </ul>
        </div>
    </div>


    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>
            
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2019 Neo<br>
            Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>
        </div>
    </div>
</footer>
        
    
    <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2131605"></script>




    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>