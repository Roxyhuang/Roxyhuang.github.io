<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    
    <title>Neo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta property="og:type" content="website">
<meta property="og:title" content="Neo">
<meta property="og:url" content="http://www.neohuang.com/child/index.html">
<meta property="og:site_name" content="Neo">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Neo">
    

    

    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/open-sans/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/2.1.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
    
    


</head>

<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <!--<span class="site-title">Neo</span>-->
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/.">Home</a>
                
                    <a class="main-nav-link" href="/archives">Archives</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="/css/images/doge.jpeg" />
                            <i class="fa fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/.">Home</a></td>
                
                    <td><a class="main-nav-link" href="/archives">Archives</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
                

<aside id="profile">
    <div class="inner profile-inner">
        <div class="base-info profile-block">
            <img id="avatar" src="/css/images/doge.jpeg" />
            <h2 id="name">Neo Huang</h2>
            <h3 id="title">Front End Developer</h3>
            <span id="location"><i class="fa fa-map-marker"></i>Shanghai, China</span>
            <a id="follow" target="_blank" href="https://github.com/Roxyhuang">FOLLOW</a>
        </div>
        <div class="article-info profile-block">
            <div class="article-info-block">
                14
                <span>posts</span>
            </div>
            <div class="article-info-block">
                0
                <span>tag</span>
            </div>
        </div>
        
        <div class="profile-block social-links">
            <table>
                <tr>
                    
                    
                    <td>
                        <a href="https://github.com/Roxyhuang" target="_blank" title="github" class=tooltip>
                            <i class="fa fa-github"></i>
                        </a>
                    </td>
                    
                </tr>
            </table>
        </div>
        
    </div>
</aside>

            
            <section id="main">
    <article id="post-hash-backListener" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2018/09/03/hash-backListener/">监听浏览器回退</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2018/09/03/hash-backListener/">
            <time datetime="2018-09-02T16:00:00.000Z" itemprop="datePublished">2018-09-03</time>
        </a>
    </div>


                        
                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h2 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h2><p>近来遇到一个需求需要监听浏览器回退事件，恰好目前项目中运用的路由为hash-router，因此对这方面做了一个总结。因此本文更多其实只能算对mdn相关文档的一个汇总笔记。</p>
<h2 id="二、相关api"><a href="#二、相关api" class="headerlink" title="二、相关api"></a>二、相关api</h2><h3 id="1-window-onpopstate"><a href="#1-window-onpopstate" class="headerlink" title="1.window.onpopstate"></a>1.window.onpopstate</h3><p>参考：<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/onpopstate" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/API/Window/onpopstate</a></p>
<p> 每当活动的历史记录项发生变化时， popstate 事件都会被传递给window对象。如果当前活动的历史记录项是被 pushState 创建的，或者是由 replaceState 改变的，那么 popstate 事件的状态属性 state 会包含一个当前历史记录状态对象的拷贝。</p>
<h4 id="1-概述："><a href="#1-概述：" class="headerlink" title="(1) 概述："></a>(1) 概述：</h4><p>根据mdn文档上的解释，我还想来画一下重点：</p>
<p>[1] window.onpopstate是popstate事件在window对象上的事件处理程序，<strong>每当处于激活状态的历史记录条目发生变化时</strong>,popstate事件就会在对应window对象上触发。</p>
<p>[2] <strong>调用history.pushState()或者history.replaceState()不会触发popstate事件</strong>. popstate事件<strong>只会在浏览器某些行为下触发</strong>, 比如点击后退、前进按钮(或者在JavaScript中调用history.back()、history.forward()、history.go()方法)。</p>
<p>[3] 如果当前处于激活状态的历史记录条目是由history.pushState()方法创建,或者由history.replaceState()方法修改过的, 则popstate事件对象的state属性包含了这个历史记录条目的state对象的一个拷贝。</p>
<p>[4] <strong>当网页加载时,各浏览器对popstate事件是否触发有不同的表现</strong>,Chrome 和 Safari会触发popstate事件, 而Firefox不会。</p>
<p>语法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.onpopstate = funcRef;</span><br></pre></td></tr></table></figure>
<p>例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.onpopstate = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">"location: "</span> + <span class="built_in">document</span>.location + <span class="string">", state: "</span> + <span class="built_in">JSON</span>.stringify(event.state));</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">//绑定事件处理函数.</span></span><br><span class="line"> history.pushState(&#123;<span class="attr">page</span>: <span class="number">1</span>&#125;, <span class="string">"title 1"</span>, <span class="string">"?page=1"</span>);    <span class="comment">//添加并激活一个历史记录条目 http://example.com/example.html?page=1,条目索引为1</span></span><br><span class="line"> history.pushState(&#123;<span class="attr">page</span>: <span class="number">2</span>&#125;, <span class="string">"title 2"</span>, <span class="string">"?page=2"</span>);    <span class="comment">//添加并激活一个历史记录条目 http://example.com/example.html?page=2,条目索引为2</span></span><br><span class="line"> history.replaceState(&#123;<span class="attr">page</span>: <span class="number">3</span>&#125;, <span class="string">"title 3"</span>, <span class="string">"?page=3"</span>); <span class="comment">//修改当前激活的历史记录条目 http://ex..?page=2 变为 http://ex..?page=3,条目索引为3</span></span><br><span class="line"> history.back(); <span class="comment">// 弹出 "location: http://example.com/example.html?page=1, state: &#123;"page":1&#125;"</span></span><br><span class="line"> history.back(); <span class="comment">// 弹出 "location: http://example.com/example.html, state: null</span></span><br><span class="line"> history.go(<span class="number">2</span>);  <span class="comment">// 弹出 "location: http://example.com/example.html?page=3, state: &#123;"page":3&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-history-pushState"><a href="#2-history-pushState" class="headerlink" title="2.history.pushState"></a>2.history.pushState</h3><p>参考：<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/History_API" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/API/History_API</a></p>
<h4 id="1-概念：添加历史记录中的条目"><a href="#1-概念：添加历史记录中的条目" class="headerlink" title="(1) 概念：添加历史记录中的条目"></a>(1) 概念：添加历史记录中的条目</h4><h4 id="2-pushState-使用"><a href="#2-pushState-使用" class="headerlink" title="(2) pushState()使用"></a>(2) pushState()使用</h4><p>pushState() 需要三个参数: 一个状态对象, 一个标题 (目前被忽略), 和 (可选的) 一个URL. 让我们来解释下这三个参数详细内容：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pushState(&#123; <span class="attr">state1</span>: <span class="number">1</span>, <span class="attr">state2</span>: <span class="number">2</span> &#125;, title, URL);</span><br></pre></td></tr></table></figure>
<ul>
<li><p>状态对象： </p>
<p>  状态对象state是一个JavaScript对象，通过pushState () 创建新的历史记录条目。无论什么时候用户导航到新的状态，popstate事件就会被触发，且该事件的state属性包含该历史记录条目状态对象的副本。</p>
<p>  状态对象可以是能被序列化的任何东西。原因在于Firefox将状态对象保存在用户的磁盘上，以便在用户重启浏览器时使用，我<strong>们规定了状态对象在序列化表示后有640k的大小限制</strong>。如果你给 pushState() 方法传了一个序列化后大于640k的状态对象，该方法会抛出异常。如果你需要更大的空间，建议使用 sessionStorage 以及 localStorage.</p>
  <figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这一句可以理解为，pushState()后不会立即跳转，此时会对该历史记录条目状态保存一个副本，无	论什么时候用户导航到新的状态，popstate事件就会被触发。</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>标题</p>
<p>  Firefox 目前忽略这个参数，但未来可能会用到。传递一个空字符串在这里是安全的，而在将来这是不安全的。二选一的话，你可以为跳转的state传递一个短标题</p>
</li>
<li><p>URL </p>
<p>   该参数定义了新的历史URL记录。注意，调用 pushState() <strong>后浏览器并不会立即加载这个URL</strong>，但可能会在稍后某些情况下加载这个URL，比如在用户重新打开浏览器时。新URL不必须为绝对路径。如果新URL是相对路径，那么它将被作为相对于当前URL处理。<strong>新URL必须与当前URL同源</strong>，否则 pushState() 会抛出一个异常。该参数是可选的，缺省为当前URL。</p>
</li>
</ul>
<h4 id="3-例子"><a href="#3-例子" class="headerlink" title="(3) 例子"></a>(3) 例子</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> stateObj = &#123; <span class="attr">foo</span>: <span class="string">"bar"</span> &#125;;</span><br><span class="line">history.pushState(stateObj, <span class="string">"page 2"</span>, <span class="string">"bar.html"</span>);</span><br></pre></td></tr></table></figure>
<p>使用 history.pushState() 可以改变referrer，它在用户发送 XMLHttpRequest 请求时在HTTP头部使用，改变state后创建的 XMLHttpRequest 对象的referrer都会被改变。因为referrer是标识创建  XMLHttpRequest 对象时 this 所代表的window对象中document的URL。</p>
<p>在某种意义上，调用 pushState() 与 设置 window.location = “#foo” 类似，二者都会在当前页面创建并激活新的历史记录。但 pushState() 具有如下几条优点：</p>
<ul>
<li><p>新的 URL 可以是与当前URL同源的任意URL 。而设置 window.location 仅当你只修改了哈希值时才保持同一个 document。</p>
</li>
<li><p>如果需要，你可以不必改变URL。而设置 window.location = “#foo”;在当前哈希不是 #foo 的情况下， 仅仅是新建了一个新的历史记录项。</p>
</li>
<li><p>你可以为新的历史记录项关联任意数据。而基于哈希值的方式，则必须将所有相关数据编码到一个短字符串里。</p>
</li>
<li><p>假如 标题 在之后会被浏览器用到，那么这个数据是可以被使用的（哈希则不然）。</p>
</li>
</ul>
<p>注意 pushState() 绝对不会触发 hashchange 事件，即使新的URL与旧的URL仅哈希不同也是如此。    </p>
<h3 id="3-history-replaceState"><a href="#3-history-replaceState" class="headerlink" title="3.history.replaceState"></a>3.history.replaceState</h3><p>参考：<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/History_API" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/API/History_API</a></p>
<h4 id="1-概念：修改历史记录中的条目"><a href="#1-概念：修改历史记录中的条目" class="headerlink" title="(1) 概念：修改历史记录中的条目"></a>(1) 概念：修改历史记录中的条目</h4><p>history.replaceState() 的使用与 history.pushState() 非常相似，区别在于  replaceState()  是修改了当前的历史记录项而不是新建一个。 注意这并不会阻止其在全局浏览器历史记录中创建一个新的历史记录项。</p>
<p>replaceState() 的使用场景在于为了响应用户操作，你想要更新状态对象state或者当前历史记录的URL。</p>
<h4 id="2-replaceState-使用"><a href="#2-replaceState-使用" class="headerlink" title="(2) replaceState()使用"></a>(2) replaceState()使用</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> stateObj = &#123; <span class="attr">foo</span>: <span class="string">"bar"</span> &#125;;</span><br><span class="line">history.replaceState(stateObj, <span class="string">"page 3"</span>, <span class="string">"bar2.html"</span>);</span><br></pre></td></tr></table></figure>
<p><strong>导致地址栏显示<a href="http://mozilla.org/bar2.html,，但是浏览器并不会去加载bar2.html" target="_blank" rel="noopener">http://mozilla.org/bar2.html,，但是浏览器并不会去加载bar2.html</a></strong> 甚至都不需要检查 bar2.html 是否存在。</p>
<p>假设现在用户重新导向到了 <strong><a href="http://www.microsoft.com" target="_blank" rel="noopener">http://www.microsoft.com</a></strong>，然后点击了回退按钮。这里，地址栏会显示<strong><a href="http://mozilla.org/bar2.html" target="_blank" rel="noopener">http://mozilla.org/bar2.html</a></strong>。假如用户再次点击回退按钮，地址栏会显示<strong><a href="http://mozilla.org/foo.html" target="_blank" rel="noopener">http://mozilla.org/foo.html</a></strong>，完全跳过了bar.html。</p>
<h3 id="4-HashChangeEvent"><a href="#4-HashChangeEvent" class="headerlink" title="4.HashChangeEvent"></a>4.HashChangeEvent</h3><p>当URL中的片段标识符发生改变时触发（URL中紧跟’#’号的部分，包括‘#’号）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">window</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// exit if the browser implements that event</span></span><br><span class="line">  <span class="keyword">if</span> ( <span class="string">"onhashchange"</span> <span class="keyword">in</span> <span class="built_in">window</span>.document.body ) &#123; <span class="keyword">return</span>; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> location = <span class="built_in">window</span>.location,</span><br><span class="line">    oldURL = location.href,</span><br><span class="line">    oldHash = location.hash;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// check the location hash on a 100ms interval</span></span><br><span class="line">  setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> newURL = location.href,</span><br><span class="line">      newHash = location.hash;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// if the hash has changed and a handler has been bound...</span></span><br><span class="line">    <span class="keyword">if</span> ( newHash != oldHash &amp;&amp; <span class="keyword">typeof</span> <span class="built_in">window</span>.onhashchange === <span class="string">"function"</span> ) &#123;</span><br><span class="line">      <span class="comment">// execute the handler</span></span><br><span class="line">      <span class="built_in">window</span>.onhashchange(&#123;</span><br><span class="line">        type: <span class="string">"hashchange"</span>,</span><br><span class="line">        oldURL: oldURL,</span><br><span class="line">        newURL: newURL</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      oldURL = newURL;</span><br><span class="line">      oldHash = newHash;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">&#125;)(<span class="built_in">window</span>);</span><br></pre></td></tr></table></figure>
<h3 id="5-history-length"><a href="#5-history-length" class="headerlink" title="5.history.length"></a>5.history.length</h3><p>History.length是一个只读属性，返回当前session中的history个数，包含当前页面在内。举个例子，对于新开一个tab加载的页面当前属性返回值1。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">length = history.length; <span class="comment">// 返回当前session中的history个数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> result = <span class="built_in">window</span>.history.length; <span class="comment">// 返回当前session中的history个数</span></span><br></pre></td></tr></table></figure>
<p>mdn文档中，对这块的翻译基本以上，实际在使用中有一点是非常需要注意的，就是history.length并不是整个当前会话的历史条目的当前状态(即currentLength)，而实际是当前会话历史条目的存在记录的整体长度（即maxlength）</p>
<h2 id="三、常用遇到的情况"><a href="#三、常用遇到的情况" class="headerlink" title="三、常用遇到的情况"></a>三、常用遇到的情况</h2><h3 id="1-监听回退"><a href="#1-监听回退" class="headerlink" title="1. 监听回退"></a>1. 监听回退</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> detectBack = &#123;</span><br><span class="line"></span><br><span class="line">  initialize: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">//监听hashchange事件</span></span><br><span class="line">  <span class="built_in">window</span>.addEventListener(<span class="string">'hashchange'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//为当前导航页附加一个tag</span></span><br><span class="line">  <span class="keyword">this</span>.history.replaceState(<span class="string">'hasHash'</span>, <span class="string">''</span>, <span class="string">''</span>);</span><br><span class="line"></span><br><span class="line">  &#125;, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">window</span>.addEventListener(<span class="string">'popstate'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (e.state) &#123;</span><br><span class="line">      <span class="comment">//侦测是用户触发的后退操作, dosomething</span></span><br><span class="line">      <span class="comment">//这里刷新当前url</span></span><br><span class="line">      <span class="keyword">this</span>.location.reload();</span><br><span class="line">  	&#125;</span><br><span class="line">   &#125;, <span class="literal">false</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    detectBack.initialize();</span><br></pre></td></tr></table></figure>
<h3 id="2-阻止回退"><a href="#2-阻止回退" class="headerlink" title="2. 阻止回退"></a>2. 阻止回退</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pushHash</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="built_in">window</span>.history.pushState(<span class="string">'home'</span>,<span class="literal">null</span>,<span class="string">'#/home'</span>); <span class="comment">// 跳转后压入一次历史，并表示home状态</span></span><br><span class="line">   <span class="built_in">window</span>.history.pushState(<span class="literal">null</span>,<span class="literal">null</span>,<span class="string">'#/home'</span>); <span class="comment">// 跳转后压入一次历史，以便回退拦截</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'popstate'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(e.state === <span class="string">'home'</span>) &#123;</span><br><span class="line">		拦截回退</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://www.neohuang.com/child/2018/09/03/hash-backListener/" data-id="cjlm3ctoh0000eam70aqr384h" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            <!--
    
        <a href="http://www.neohuang.com/child/2018/09/03/hash-backListener/#comments" class="article-comment-link">Comments</a>
    
-->
        </footer>
    </div>
    
</article>



    <article id="post-position-sticky" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2018/08/22/position-sticky/">白话聊聊position sticky</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2018/08/22/position-sticky/">
            <time datetime="2018-08-21T16:00:00.000Z" itemprop="datePublished">2018-08-22</time>
        </a>
    </div>


                        
                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h2 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h2><p>项目中有一个同事遇到了一个吸顶效果的需求，于是帮助他完成的同时顺便分析下position：sticky。</p>
<h2 id="二、position：sticky是什么"><a href="#二、position：sticky是什么" class="headerlink" title="二、position：sticky是什么"></a>二、position：sticky是什么</h2><p>粘性定位元素（stickily positioned element）：粘性定位可以被认为是相对定位和固定定位的混合。元素在跨越特定阈值前为相对定位，之后为固定定位。</p>
<p>最白话来说，其实这句话想表达的是： 粘性定位（position：sticky） = 相对定位(position：relative) + 固定定位 (position：fixed)</p>
<h2 id="三、position：sticky作用以及兼容"><a href="#三、position：sticky作用以及兼容" class="headerlink" title="三、position：sticky作用以及兼容"></a>三、position：sticky作用以及兼容</h2><h3 id="1-作用："><a href="#1-作用：" class="headerlink" title="1. 作用："></a>1. 作用：</h3><p>其作用为了在iOS下实现吸顶效果，原先吸顶效果的基本的开发思路如下：</p>
<p>利用scroll事件进行监听scrollTop的值，当scrollTop达到一定的值得时候设置吸顶元素的position : fixed;属性。</p>
<p>但是问题是：安卓支持scroll事件和fixed属性，但是ios8.0的scroll事件不是连续触发的，只会在scroll事件结束后触发一次scroll事件，同时ios下fixed属性的支持一直是个问题。</p>
<h3 id="2-兼容性探究："><a href="#2-兼容性探究：" class="headerlink" title="2. 兼容性探究："></a>2. 兼容性探究：</h3><h4 id="1-MDN"><a href="#1-MDN" class="headerlink" title="(1) MDN"></a>(1) <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/position" target="_blank" rel="noopener">MDN</a></h4><p><img src="/img/sticky-mdn.png" alt=""></p>
<h4 id="2-caniuse"><a href="#2-caniuse" class="headerlink" title="(2) caniuse"></a>(2) <a href="https://caniuse.com/#search=sticky" target="_blank" rel="noopener">caniuse</a></h4><p><img src="/img/sticky-use.png" alt=""></p>
<p>####( 3) 因为mdn以及caniuse给到的兼容性并不一致，同时如上面所述主要在iOS使用，因此实际使用仍需要对iOS机型进行实际测试，并考虑polyfill方案</p>
<p>之后在实际找到设备测试后，会持续更新</p>
<h4 id="4-polyfill方案"><a href="#4-polyfill方案" class="headerlink" title="(4) polyfill方案:"></a>(4) polyfill方案:</h4><p><a href="[https://github.com/wilddeer/stickyfill">https://github.com/wilddeer/stickyfill</a></p>
<h2 id="三、position：sticky触发条件"><a href="#三、position：sticky触发条件" class="headerlink" title="三、position：sticky触发条件"></a>三、position：sticky触发条件</h2><p>1、具有sticky属性的元素，其父级高度必须大于sticky元素的高度。</p>
<p>2、sticky元素的底部，不能和父级底部重叠。（这条不好表述，文后详细说明）</p>
<p>3、sticky元素的父级不能含有overflow:hidden 和 overflow:auto 属性 （不包括祖先，仅直接包含的父容器）</p>
<p>4、必须具有top，或 bottom 属性。</p>
<h2 id="四、移动端吸顶效果实战"><a href="#四、移动端吸顶效果实战" class="headerlink" title="四、移动端吸顶效果实战"></a>四、移动端吸顶效果实战</h2><h3 id="1-position：sticky"><a href="#1-position：sticky" class="headerlink" title="1.position：sticky"></a>1.position：sticky</h3><p>使用position：sticky 一定要记得处理浏览器兼容，并且指定top或bottom</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.sticky</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: -webkit-sticky;</span><br><span class="line">  <span class="attribute">position</span>: sticky;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-实战"><a href="#2-实战" class="headerlink" title="2.实战"></a>2.实战</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1, shrink-to-fit=no, user-scalable=no"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--适配移动端js--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">      (<span class="function"><span class="keyword">function</span> (<span class="params">doc, win</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> docEl = doc.documentElement,</span></span><br><span class="line"><span class="javascript">            resizeEvt = <span class="string">'orientationchange'</span> <span class="keyword">in</span> <span class="built_in">window</span> ? <span class="string">'orientationchange'</span> : <span class="string">'resize'</span>,</span></span><br><span class="line"><span class="javascript">            recalc = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">              <span class="keyword">var</span> clientWidth = docEl.clientWidth;</span></span><br><span class="line"><span class="javascript">              <span class="keyword">if</span> (!clientWidth) <span class="keyword">return</span>;</span></span><br><span class="line"><span class="javascript">              docEl.style.fontSize = <span class="number">75</span> * (clientWidth / <span class="number">750</span>) + <span class="string">'px'</span>;</span></span><br><span class="line"><span class="undefined">            &#125;;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (doc.addEventListener) &#123;</span></span><br><span class="line"><span class="javascript">          win.addEventListener(resizeEvt, recalc, <span class="literal">false</span>);</span></span><br><span class="line"><span class="javascript">          doc.addEventListener(<span class="string">'DOMContentLoaded'</span>, recalc, <span class="literal">false</span>);</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="javascript">      &#125;)(<span class="built_in">document</span>, <span class="built_in">window</span>);</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    * &#123;</span></span><br><span class="line"><span class="undefined">        margin: 0;</span></span><br><span class="line"><span class="undefined">        padding: 0;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.container</span> &#123;</span></span><br><span class="line"><span class="undefined">        position: fixed;</span></span><br><span class="line"><span class="undefined">        overflow: auto;</span></span><br><span class="line"><span class="undefined">        width: 100%;</span></span><br><span class="line"><span class="undefined">        height: 100%;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.banner</span> &#123;</span></span><br><span class="line"><span class="undefined">        height: 2rem;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">background-color</span>: <span class="selector-id">#009EE0</span>;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.sticky</span> &#123;</span></span><br><span class="line"><span class="undefined">        position: -webkit-sticky;</span></span><br><span class="line"><span class="undefined">        position: sticky;</span></span><br><span class="line"><span class="undefined">        top: 0;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.fixed</span> &#123;</span></span><br><span class="line"><span class="undefined">        position: fixed;</span></span><br><span class="line"><span class="undefined">        width: 100%;</span></span><br><span class="line"><span class="undefined">        top: 0;</span></span><br><span class="line"><span class="undefined">        left: 0;</span></span><br><span class="line"><span class="undefined">        background-color: white;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.relative</span> &#123;</span></span><br><span class="line"><span class="undefined">        background-color: white;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.sticky-title</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">height</span>: 1<span class="selector-class">.4rem</span>;</span></span><br><span class="line"><span class="undefined">        background-color: pink;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.sticky-content</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">height</span>: 20<span class="selector-class">.3rem</span>;</span></span><br><span class="line"><span class="undefined">        overflow: auto;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span> <span class="attr">id</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"banner"</span>&gt;</span></span><br><span class="line">                Banner部分</span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"sticky"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sticky-title"</span>&gt;</span>吸顶结构标题。。。<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sticky-content"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span>内容块<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span>内容块<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span>内容块<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span>内容块<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span>内容块<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span>内容块<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span>内容块<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span>内容块<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span>内容块<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span>内容块<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span>内容块<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span>内容块<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span>内容块<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span>内容块<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span>内容块<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span>内容块<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span>内容块<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="comment">// 安卓吸顶方案</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> scrollWrapper = <span class="built_in">document</span>.getElementById(<span class="string">'container'</span>); <span class="comment">// 假设windows 为滚动容器</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> stickyDom = <span class="built_in">document</span>.getElementById(<span class="string">'sticky'</span>);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> u = navigator.userAgent;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> isAndroid = u.indexOf(<span class="string">'Android'</span>) &gt; <span class="number">-1</span> || u.indexOf(<span class="string">'Adr'</span>) &gt; <span class="number">-1</span>;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> isiOS = !!u.match(<span class="regexp">/\(i[^;]+;( U;)? CPU.+Mac OS X/</span>);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    scrollWrapper.addEventListener(<span class="string">'scroll'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (isAndroid) &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> bannerHeight = <span class="built_in">document</span>.getElementsByClassName(<span class="string">'banner'</span>)[<span class="number">0</span>].clientHeight;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (<span class="keyword">this</span>.scrollTop &gt; <span class="number">72</span>) &#123;</span></span><br><span class="line"><span class="javascript">          stickyDom.className = <span class="string">'fixed'</span>;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">        </span></span><br><span class="line"><span class="javascript">      &#125; <span class="keyword">else</span> <span class="keyword">if</span>(isiOS &amp;&amp; (CSS.supports(<span class="string">"position"</span>, <span class="string">"sticky"</span>) || CSS.supports(<span class="string">"position"</span>, <span class="string">"-webkit-sticky"</span>)))&#123;</span></span><br><span class="line"><span class="javascript">        stickyDom.className = <span class="string">'stickay'</span>;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    &#125;);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://www.neohuang.com/child/2018/08/22/position-sticky/" data-id="cjlm3caor000adqm7268fzevi" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            <!--
    
        <a href="http://www.neohuang.com/child/2018/08/22/position-sticky/#comments" class="article-comment-link">Comments</a>
    
-->
        </footer>
    </div>
    
</article>



    <article id="post-new-operators" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2018/08/11/new-operators/">白话说说new操作符的背后</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2018/08/11/new-operators/">
            <time datetime="2018-08-10T16:00:00.000Z" itemprop="datePublished">2018-08-11</time>
        </a>
    </div>


                        
                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h3 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h3><p>今天群里有一段代码，发现小伙伴想尝试模拟new操作符，想想写一篇相关的博客吧。</p>
<h3 id="二、作用"><a href="#二、作用" class="headerlink" title="二、作用"></a>二、作用</h3><p>new 运算符创建一个用户定义的对象类型的实例或具有构造函数的内置对象的实例。</p>
<h3 id="三、语法"><a href="#三、语法" class="headerlink" title="三、语法"></a>三、语法</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="keyword">constructor</span>[([arguments])]</span><br></pre></td></tr></table></figure>
<p>参数：</p>
<ul>
<li>constructor</li>
<li>arguments</li>
</ul>
<h3 id="四、new执行的背后"><a href="#四、new执行的背后" class="headerlink" title="四、new执行的背后"></a>四、new执行的背后</h3><p>举例当new Foo(…) 执行时，会发生以下事情：</p>
<ol>
<li>一个继承自 Foo.prototype 的新对象被创建。</li>
<li>使用指定的参数调用构造函数 Foo ，并将 this 绑定到新创建的对象。new Foo 等同于 new Foo()，也就是没有指定参数列表，Foo 不带任何参数调用的情况。</li>
<li>由构造函数返回的对象就是 new 表达式的结果。如果构造函数没有显式返回一个对象，则使用步骤1创建的对象。（一般情况下，构造函数不返回值，但是用户可以选择主动返回对象，来覆盖正常的对象创建步骤）</li>
</ol>
<h3 id="五、自己模拟new实现"><a href="#五、自己模拟new实现" class="headerlink" title="五、自己模拟new实现"></a>五、自己模拟new实现</h3><p>既然已经知道new操作符背后做了些什么我们可以尝试自己模拟下。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = objectFactory(Constructor,...);</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">objectFactory</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">var</span> obj = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">var</span> Constructor = [].shift.call(<span class="built_in">arguments</span>);</span><br><span class="line"></span><br><span class="line">   obj.__proto__ = Constructor.prototype;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">var</span> ret = Constructor.apply(obj, <span class="built_in">arguments</span>);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">typeof</span> ret === <span class="string">'object'</span> ? ret : obj;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://www.neohuang.com/child/2018/08/11/new-operators/" data-id="cjlm3caon0006dqm7o1echiam" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            <!--
    
        <a href="http://www.neohuang.com/child/2018/08/11/new-operators/#comments" class="article-comment-link">Comments</a>
    
-->
        </footer>
    </div>
    
</article>



    <article id="post-js-review-datatype" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2018/07/08/js-review-datatype/">js复习基本概念（数据类型）</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2018/07/08/js-review-datatype/">
            <time datetime="2018-07-07T16:00:00.000Z" itemprop="datePublished">2018-07-08</time>
        </a>
    </div>


                        
                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p><img src="js-review-datetype.png" alt=""></p>
<ul>
<li>参考1: JAVASCRIPT高级程序设计 第三版 p25</li>
<li>参考2: <a href="https://www.zhihu.com/question/21691758" target="_blank" rel="noopener">知乎 为什么JavaScript里面typeof(null)的值是”object”？</a></li>
<li>参考3: <a href="http://es6.ruanyifeng.com/#docs/symbol" target="_blank" rel="noopener">ECMAScript 6 入门 阮一峰 symbol</a></li>
</ul>
<h3 id="一、-什么是数据类型"><a href="#一、-什么是数据类型" class="headerlink" title="一、 什么是数据类型"></a>一、 什么是数据类型</h3><p>数据：未经过处理的原始记录，在计算机系统中，数据以二进制信息单元0,1的形式表示。    </p>
<p>数据类型： 是用来约束数据的解释规约。</p>
<h3 id="二、基础数据类型、引用数据类型"><a href="#二、基础数据类型、引用数据类型" class="headerlink" title="二、基础数据类型、引用数据类型"></a>二、基础数据类型、引用数据类型</h3><h3 id="1-typeof操作符"><a href="#1-typeof操作符" class="headerlink" title="1. typeof操作符"></a>1. typeof操作符</h3><h4 id="1-typeof的所有返回值都是字符串"><a href="#1-typeof的所有返回值都是字符串" class="headerlink" title="(1) typeof的所有返回值都是字符串"></a>(1) typeof的所有返回值都是字符串</h4><h4 id="2-六种返回值类型"><a href="#2-六种返回值类型" class="headerlink" title="(2) 六种返回值类型"></a>(2) 六种返回值类型</h4><ul>
<li><p>undefined</p>
</li>
<li><p>number</p>
</li>
<li><p>string</p>
</li>
<li><p>boolean</p>
</li>
<li><p>Object</p>
</li>
<li><p>Function</p>
</li>
</ul>
<h4 id="3-建议使用（）"><a href="#3-建议使用（）" class="headerlink" title="(3) 建议使用（）"></a>(3) 建议使用（）</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(type <span class="keyword">of</span> a);</span><br></pre></td></tr></table></figure>
<p><strong>原因：</strong>原因操作符优先级，js中有15种优先级，为避免混乱建议使用()包裹。</p>
<h4 id="4-typrof-null"><a href="#4-typrof-null" class="headerlink" title="(4) typrof null"></a>(4) typrof null</h4><ul>
<li>返回值为”Obejct”</li>
</ul>
<ul>
<li><p><strong>原因</strong>：</p>
</li>
<li><p>（1）从逻辑角度来看，null值表示一个空对象指针，而这正是使用typeof操作符检测null值时会返回“object”的原因。摘自《JAVASCRIPT高级程序设计 第三版 p25》</p>
</li>
<li><p>（2）null不是一个空引用, 而是一个原始值, <a href="http://lzw.me/pages/ecmascript/#20" target="_blank" rel="noopener">参考ECMAScript5.1中文版 4.3.11节</a>; 它只是期望此处将引用一个对象, 注意是”期望”, 参考 null - JavaScript.</p>
</li>
<li><p>（3）typeof null结果是object, 这是个历史遗留bug, 参考 <a href="https://link.zhihu.com/?target=https%3A//developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/typeof" target="_blank" rel="noopener">typeof - JavaScript</a></p>
</li>
<li><p>（4）在ECMA6中, 曾经有提案为历史平凡, 将type null的值纠正为null, 但最后提案被拒了. 理由是历史遗留代码太多, 不想得罪人, 不如继续将错就错当和事老, <a href="https://link.zhihu.com/?target=http%3A//wiki.ecmascript.org/doku.php%3Fid%3Dharmony%253atypeof_null" target="_blank" rel="noopener">参考 harmony:typeof_null [ES Wiki]</a></p>
</li>
</ul>
<p>以上内容作者：克荷林<br>链接：<a href="https://www.zhihu.com/question/21691758/answer/98782260" target="_blank" rel="noopener">https://www.zhihu.com/question/21691758/answer/98782260</a><br>来源：知乎<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p>
<h3 id="2-undefined"><a href="#2-undefined" class="headerlink" title="2. undefined"></a>2. undefined</h3><ul>
<li>undefined类型只有一个值，即特殊的undefined</li>
<li>在使用var关键字声明变量，但未对其初始化时，这个变量就是undefined</li>
</ul>
<h3 id="3-null"><a href="#3-null" class="headerlink" title="3. null"></a>3. null</h3><ul>
<li>null类型只有一个值，这个特殊值是null,从逻辑角度来看，null表示一个空对象指针，而这也是typeof操作符检测null时会返回“obeject”的原因</li>
<li>在使用var关键字声明变量，但未对其初始化时，这个变量就是undefined</li>
</ul>
<h3 id="4-null-和-undefined"><a href="#4-null-和-undefined" class="headerlink" title="4. null 和 undefined"></a>4. null 和 undefined</h3><h4 id="1-相同点"><a href="#1-相同点" class="headerlink" title="(1)相同点"></a>(1)相同点</h4><p>（1）参与判断 返回false</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// if判断为false的情况</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="literal">false</span>)</span><br><span class="line"><span class="keyword">if</span> (<span class="literal">null</span>)</span><br><span class="line"><span class="keyword">if</span> (<span class="literal">undefined</span>)</span><br><span class="line"><span class="keyword">if</span> (<span class="number">0</span>)</span><br><span class="line"><span class="keyword">if</span> (<span class="literal">NaN</span>)</span><br><span class="line"><span class="keyword">if</span> (<span class="string">''</span>)</span><br><span class="line"><span class="keyword">if</span> (<span class="string">""</span>)</span><br></pre></td></tr></table></figure>
<p>（2）没有方法</p>
<p>（3）都是falsy,不加!比较都是false</p>
<h4 id="2-不同点"><a href="#2-不同点" class="headerlink" title="(2)不同点"></a>(2)不同点</h4><ul>
<li><p>(1) 语义上不同，null是有值，但值为空，undefined是值未定义</p>
</li>
<li><p>(2) typeof</p>
<p>   <strong>null typeof 是obejct undefined typeof undefined</strong></p>
</li>
<li><p>(3) 数字转化 </p>
<p>  <strong>undefined =&gt;NAN  null =&gt; 0</strong></p>
</li>
</ul>
<ul>
<li><p>(4) null可以json化</p>
</li>
<li><p>*(5）通常情况下，undefined代表未初始化，null已经初始化</p>
</li>
<li><p>*(6）在浏览器环境中，undefined是windows的一个属性，只不过属性对应的值是undefined</p>
</li>
<li><p>*(7) null不可以作为变量名  undefined可以作为变量名</p>
<p>  原因：null不能做变量名的原因应该是因为null是字面量</p>
</li>
</ul>
<h4 id="3-为什么不同"><a href="#3-为什么不同" class="headerlink" title="(3)为什么不同"></a>(3)为什么不同</h4><p>JavaScript的最初版本是这样区分的：null是一个表示”无”的对象，转为数值时为0；undefined是一个表示”无”的原始值，转为数值时为NaN。</p>
<p>原因有如下两个：</p>
<ul>
<li><p>null像在Java里一样，被当成一个对象。但是，JavaScript的数据类型分成原始类型（primitive）和合成类型（complex）两大类，Brendan Eich觉得表示”无”的值最好不是对象。</p>
</li>
<li><p>null像在Java里一样，被当成一个对象。但是，JavaScript的数据类型分成原始类型（primitive）和合成类型（complex）两大类，Brendan Eich觉得表示”无”的值最好不是对象。</p>
</li>
</ul>
<p>因此，Brendan Eich又设计了一个undefined。</p>
<p><strong>如果不深究，简单理解可以归纳为历史原因</strong></p>
<h4 id="4-使用场景"><a href="#4-使用场景" class="headerlink" title="(4)使用场景"></a>(4)使用场景</h4><h5 id="1-null"><a href="#1-null" class="headerlink" title="[1] null"></a>[1] null</h5><p>null表示”没有对象”，即该处不应该有值</p>
<p>典型用法：</p>
<ul>
<li>null表示”没有对象”，即该处不应该有值</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> test = <span class="literal">null</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>作为对象原型链的终点</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.getPrototypeOf(<span class="built_in">Object</span>.prototype)</span><br><span class="line"><span class="comment">// null</span></span><br></pre></td></tr></table></figure>
<h5 id="2-undefined-1"><a href="#2-undefined-1" class="headerlink" title="[2] undefined"></a>[2] undefined</h5><ul>
<li><p>undefined表示”缺少值”，就是此处应该有一个值，但是还没有定义</p>
</li>
<li><p>变量被声明了，但没有赋值时，就等于undefined</p>
</li>
<li><p>调用函数时，应该提供的参数没有提供，该参数等于undefined</p>
</li>
<li><p>对象没有赋值的属性，该属性的值为undefined</p>
</li>
<li><p>函数没有返回值时，默认返回undefined</p>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> i;</span><br><span class="line">i <span class="comment">// undefined</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">x</span>)</span>&#123;<span class="built_in">console</span>.log(x)&#125;</span><br><span class="line">f() <span class="comment">// undefined</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span>  o = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line">o.p <span class="comment">// undefined</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> x = f();</span><br><span class="line">x <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>
<p>有些框架会定义</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="literal">undefined</span></span><br></pre></td></tr></table></figure>
<p>建立undefined的引用是为了提高性能。</p>
<h5 id="3-amp-amp"><a href="#3-amp-amp" class="headerlink" title="[3] == &amp;&amp; ==="></a>[3] == &amp;&amp; ===</h5><ul>
<li>undeined是派生自null的值，因此ECMA-262规定他们的相等性测试要返回true</li>
<li><strong>原因</strong>：由于  == 会进行转换操作</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="literal">null</span> == undeinded) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="literal">null</span> === undeinded) <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<h3 id="5-boolean"><a href="#5-boolean" class="headerlink" title="5.boolean"></a>5.boolean</h3><p>名称源自数学家乔治布尔。</p>
<h4 id="1-特点"><a href="#1-特点" class="headerlink" title="(1) 特点"></a>(1) 特点</h4><h5 id="1-该类型只有2个字面值，true和false"><a href="#1-该类型只有2个字面值，true和false" class="headerlink" title="[1] 该类型只有2个字面值，true和false"></a>[1] 该类型只有2个字面值，true和false</h5><p>这两个值与数字不是一回事，true不一定等于1, false也不一定等于0</p>
<h5 id="2-所有数据类型都可以转换为-boolean-js提供了Boolean方法转换"><a href="#2-所有数据类型都可以转换为-boolean-js提供了Boolean方法转换" class="headerlink" title="[2] 所有数据类型都可以转换为 boolean , js提供了Boolean方法转换"></a>[2] 所有数据类型都可以转换为 boolean , js提供了Boolean方法转换</h5><p>js中只有6个数据会被转化为fasle（fasly）</p>
<ul>
<li><p>null</p>
</li>
<li><p>undefined</p>
</li>
<li><p>0 </p>
</li>
<li><p>-0</p>
</li>
<li><p>NaN</p>
</li>
<li><p>空字符串</p>
</li>
</ul>
<h3 id="2-转换boolean"><a href="#2-转换boolean" class="headerlink" title="(2) 转换boolean"></a>(2) 转换boolean</h3><ul>
<li><p>Boolean()</p>
</li>
<li><p>!!转换为boolean</p>
</li>
</ul>
<h3 id="5-Number"><a href="#5-Number" class="headerlink" title="5.Number"></a>5.Number</h3><h4 id="1-标准"><a href="#1-标准" class="headerlink" title="(1) 标准"></a>(1) 标准</h4><ul>
<li><p>ECMAScript使用的是IEEE 754标准（浮点数算术标准）来定义Number类型，ECMAScript中所有的数字，无论是整数还是小数，其类型均为Number。</p>
</li>
<li><p>在程序内部，Number类型的实质是一个64位的浮点数，这与Java中double类型的浮点数是一致的。</p>
</li>
</ul>
<h4 id="2-数字表示方式："><a href="#2-数字表示方式：" class="headerlink" title="(2)数字表示方式："></a>(2)数字表示方式：</h4><ul>
<li>十进制</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> intNum = <span class="number">12</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>八进制</li>
</ul>
<p>建议不使用（严格模式、ES5下无效，会导致Javascript引擎抛出错误）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> octalNum1 = <span class="number">070</span></span><br></pre></td></tr></table></figure>
<ul>
<li>十六制</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> hexNum = <span class="number">0xA</span></span><br></pre></td></tr></table></figure>
<h4 id="3-数值范围"><a href="#3-数值范围" class="headerlink" title="(3)数值范围:"></a>(3)数值范围:</h4><h5 id="1-JavaScript所能表示的数值范围为："><a href="#1-JavaScript所能表示的数值范围为：" class="headerlink" title="[1] JavaScript所能表示的数值范围为："></a>[1] JavaScript所能表示的数值范围为：</h5><pre><code>正负1.7976931348623157乘以10的308次方，其最小所能表示的小数为正负5乘以10的负324次方
</code></pre><h5 id="2-JavaScript能表示并进行精确算术运算的整数范围为："><a href="#2-JavaScript能表示并进行精确算术运算的整数范围为：" class="headerlink" title="[2] JavaScript能表示并进行精确算术运算的整数范围为："></a>[2] JavaScript能表示并进行精确算术运算的整数范围为：</h5><pre><code>正负2的53次方，也即从最小值-9007199254740992到最大值+9007199254740992之间的范围
</code></pre><p>对于超过这个范围的整数，JavaScript依旧可以进行运算，但却不保证运算结果的精度。值得注意的是，对于整数的位运算（比如移位等操作），JavaScript仅支持32位整型数，也即从-2147483648到+2147483647之间的整数。</p>
<p><strong>获取边界值：</strong></p>
<p>两个边界值可以分别通过访问Number对象的MAX_VALUE属性和MIN_VALUE属性来获取。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Number</span>.MAX_VALUE <span class="comment">// 1.7976931348623157e+308</span></span><br><span class="line"><span class="built_in">Number</span>.MIN_VALUE <span class="comment">// 5e-324</span></span><br><span class="line"><span class="string">``</span><span class="string">`	</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**超过边界值：**</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>javascript</span><br><span class="line"><span class="literal">Infinity</span> <span class="comment">// 如果超过Number.MAX_VALUE </span></span><br><span class="line">-<span class="literal">Infinity</span> <span class="comment">// 如果小于Number.MIN_VALUE</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">9007199254740992</span>; <span class="comment">// 对正负2的53次方范围以外的整数</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(a+<span class="number">3</span>); <span class="comment">// 正确的运算结果应该是9007199254740995，但JavaScript给出的计算结果却是9007199254740996</span></span><br><span class="line"><span class="string">``</span><span class="string">`	</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#### (4) float</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">##### [1] 所谓浮点数值，就是该数值中必须包含一个小数点，并且小数点后至少有一位数字</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>javascript</span><br><span class="line"><span class="keyword">var</span> floatNum1 = <span class="number">1.1</span>;</span><br></pre></td></tr></table></figure>
<h5 id="2-虽然小数点前面可以没有整数，但不推荐"><a href="#2-虽然小数点前面可以没有整数，但不推荐" class="headerlink" title="[2] 虽然小数点前面可以没有整数，但不推荐:"></a>[2] 虽然小数点前面可以没有整数，但不推荐:</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> floatNum2 = <span class="number">.1</span>;</span><br></pre></td></tr></table></figure>
<h5 id="3-由于保存浮点数值需要的内存是保存整数的两倍，因此ECMAscript会不失时机地将浮点数值转换为整数"><a href="#3-由于保存浮点数值需要的内存是保存整数的两倍，因此ECMAscript会不失时机地将浮点数值转换为整数" class="headerlink" title="[3] 由于保存浮点数值需要的内存是保存整数的两倍，因此ECMAscript会不失时机地将浮点数值转换为整数"></a>[3] 由于保存浮点数值需要的内存是保存整数的两倍，因此ECMAscript会不失时机地将浮点数值转换为整数</h5><ul>
<li>小数点后没有任何数字，那么数值就可以作为为整数值来保存</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> floatNum1 = <span class="number">1.</span>; <span class="comment">// 解析为1</span></span><br></pre></td></tr></table></figure>
<ul>
<li>浮点数本身表示就是整数，那么该值会被转换为整数</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> floatNum2 = <span class="number">10.0</span>; <span class="comment">// 解析为10</span></span><br></pre></td></tr></table></figure>
<h4 id="5-科学计数法："><a href="#5-科学计数法：" class="headerlink" title="(5)科学计数法："></a>(5)科学计数法：</h4><ul>
<li><p>当数字极大或极小，可以用e表示法（即科学计数法）表示。</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> floatNum = <span class="number">3.125e7</span>; <span class="comment">// 等于31250000 3.125乘以10的7次方</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ECMAscript会将那些小数点后面带有6个0以上的浮点数值转化为科学计数表示法。</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> floatNum = <span class="number">3e-7</span> <span class="comment">// 等于0.0000003</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>浮点数值的最高精度是17位小数，但在进行算术计算时其精度远远不如整数。建议永远不要测试某个特定的浮点数值。</p>
</li>
</ul>
<h4 id="6-Infinity"><a href="#6-Infinity" class="headerlink" title="(6) Infinity"></a>(6) Infinity</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">11 ／ 0 // Infinity</span><br></pre></td></tr></table></figure>
<h4 id="7-NaN"><a href="#7-NaN" class="headerlink" title="(7) NaN"></a>(7) NaN</h4><p>Not a Number</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span> / <span class="number">0</span> <span class="comment">// NaN</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Nan === <span class="literal">NaN</span> <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>isNaN()</p>
</li>
<li><p>返回结果只有 true false</p>
</li>
<li>使用<strong>isNaN()</strong>判断传入值是不是NaN</li>
<li>但实际使用中会判断传入值是否能被转化为数字</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alert(<span class="built_in">isNaN</span>(<span class="literal">NaN</span>)); <span class="comment">// true</span>alert(<span class="built_in">isNaN</span>(<span class="number">10</span>)); <span class="comment">// false</span>alert(<span class="built_in">isNaN</span>(<span class="string">"10"</span>)); <span class="comment">// false</span>alert(<span class="built_in">isNaN</span>(<span class="string">"blue"</span>)); <span class="comment">// true</span>alert(<span class="built_in">isNaN</span>(<span class="literal">true</span>)); <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<h4 id="7-转换方法"><a href="#7-转换方法" class="headerlink" title="(7) 转换方法"></a>(7) 转换方法</h4><p>目的：将数据转换成数字、整数、浮点数。</p>
<p>[1] Number()</p>
<p>作用：任何数据类型转Number</p>
<pre><code>- 数字

- NaN
</code></pre><p>[2] parseFloat</p>
<p>作用：处理字符串</p>
<p>建议：传第二个参数10</p>
<p>[3] parseInt</p>
<p>作用：处理字符串</p>
<p>建议：传第二个参数10 （表示第一个参数是什么进制，返回值结果始终十进制）</p>
<h4 id="8-精度损失-（0-1-0-2-！-0-3）"><a href="#8-精度损失-（0-1-0-2-！-0-3）" class="headerlink" title="(8) 精度损失 （0.1 + 0.2 ！= 0.3）"></a>(8) 精度损失 （0.1 + 0.2 ！= 0.3）</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">0.1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b = <span class="number">0.2</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (a + b === <span class="number">0.3</span>) &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'You got 0.3'</span>); <span class="comment">// 无法到达</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="1-原因"><a href="#1-原因" class="headerlink" title="[1] 原因"></a>[1] 原因</h5><p>关于浮点数值计算误差的问题，是因为基于IEEE754标准。</p>
<h5 id="2-解决方案"><a href="#2-解决方案" class="headerlink" title="[2] 解决方案"></a>[2] 解决方案</h5><p>(1) 基数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">0.1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b = <span class="number">0.2</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> res = ((a * <span class="number">10</span>) + (b * <span class="number">10</span>)) /  <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(res); <span class="comment">// 0.3</span></span><br></pre></td></tr></table></figure>
<p>(2) toFixed</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">0.1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b = <span class="number">0.2</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> res = <span class="number">0.1</span> + <span class="number">0.2</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(res.toFixed(<span class="number">1</span>));</span><br></pre></td></tr></table></figure>
<h3 id="6-String"><a href="#6-String" class="headerlink" title="6.String"></a>6.String</h3><p>String类型用于表示由零或多个16位unicode字符组成的字符序列，即字符串。</p>
<p>(1) 字符串特性</p>
<p>ECMAScript中字符串是不可变的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&apos;abcd&apos;</span><br><span class="line">&apos;abcd&apos;.length = 5</span><br><span class="line"></span><br><span class="line">console.log(&apos;abcd&apos;.length); // 4</span><br></pre></td></tr></table></figure>
<p>(2) 转义符</p>
<p>(3) unicode 编码</p>
<p>\uxxxx</p>
<p>(4) 字符串类型转换</p>
<p>toString</p>
<p>null undefined 不可用</p>
<p>String()</p>
<p>可以转换传进去所有类型</p>
<h3 id="6-基础数据类型转换归纳"><a href="#6-基础数据类型转换归纳" class="headerlink" title="6.基础数据类型转换归纳"></a>6.基础数据类型转换归纳</h3><p>相同点：</p>
<p>(1) 都有String Boolean</p>
<p>(2) 首字母大写</p>
<p>(3) 都可以穿入任何类型</p>
<p>(4) 得到的结果都是和自己对应的</p>
<p>(5) 传入对象[Object,Object]</p>
<h3 id="8-Object"><a href="#8-Object" class="headerlink" title="8. Object"></a>8. Object</h3><p>定义：属性构成对象的无序的集合</p>
<p>对象的比较是引用的比较</p>
<h4 id="1-Object对象的分类"><a href="#1-Object对象的分类" class="headerlink" title="(1) Object对象的分类"></a>(1) Object对象的分类</h4><h4 id="1-内部对象-（17个）"><a href="#1-内部对象-（17个）" class="headerlink" title="[1] 内部对象 （17个）"></a>[1] 内部对象 （17个）</h4><p>a. 内置对象 (3)</p>
<ul>
<li>Math</li>
<li>Global</li>
<li>JSON</li>
</ul>
<p>b. 常用对象 (8)</p>
<ul>
<li><p>Boolean</p>
</li>
<li><p>String</p>
</li>
<li><p>Number</p>
</li>
<li><p>Object</p>
</li>
<li><p>Array</p>
</li>
<li><p>Function</p>
</li>
<li><p>Date</p>
</li>
<li><p>RegExp</p>
</li>
</ul>
<p>c. 错误对象 (6)</p>
<ul>
<li><p>Error</p>
</li>
<li><p>EvalError</p>
</li>
<li><p>RangeError</p>
</li>
<li><p>ReferenceError</p>
</li>
<li><p>SyntaxError</p>
</li>
<li><p>TypeError</p>
</li>
<li><p>URIError</p>
</li>
</ul>
<h4 id="2-宿主对象"><a href="#2-宿主对象" class="headerlink" title="[2] 宿主对象"></a>[2] 宿主对象</h4><ul>
<li>window (浏览器)</li>
<li>global (node)</li>
<li>document</li>
</ul>
<h4 id="3-自定义对象"><a href="#3-自定义对象" class="headerlink" title="[3] 自定义对象"></a>[3] 自定义对象</h4><h4 id="2-基础数据类型转对象"><a href="#2-基础数据类型转对象" class="headerlink" title="(2)基础数据类型转对象"></a>(2)基础数据类型转对象</h4><h5 id="1-boolean-gt-Object"><a href="#1-boolean-gt-Object" class="headerlink" title="[1] boolean =&gt; Object"></a>[1] boolean =&gt; Object</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">Boolean</span> &#123;<span class="literal">false</span>&#125;</span><br><span class="line">__proto__: <span class="built_in">Boolean</span></span><br><span class="line">[[PrimitiveValue]]:<span class="literal">false</span></span><br></pre></td></tr></table></figure>
<h5 id="2-null-gt-Object"><a href="#2-null-gt-Object" class="headerlink" title="[2] null =&gt; Object"></a>[2] null =&gt; Object</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>(<span class="literal">null</span>)；</span><br><span class="line"></span><br><span class="line">&#123;&#125;</span><br></pre></td></tr></table></figure>
<h5 id="3-undefined-gt-Object"><a href="#3-undefined-gt-Object" class="headerlink" title="[3] undefined =&gt; Object"></a>[3] undefined =&gt; Object</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>(<span class="literal">undefined</span>);</span><br><span class="line"></span><br><span class="line">&#123;&#125;</span><br></pre></td></tr></table></figure>
<h5 id="4-string-gt-Object"><a href="#4-string-gt-Object" class="headerlink" title="[4] string =&gt; Object"></a>[4] string =&gt; Object</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>(<span class="string">'abc'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">String</span> &#123;<span class="string">"abc"</span>&#125;</span><br><span class="line">	<span class="number">0</span>: <span class="string">"a"</span></span><br><span class="line">	<span class="number">1</span>: <span class="string">"b"</span></span><br><span class="line">	<span class="number">2</span>: <span class="string">"c"</span></span><br><span class="line">	length: <span class="number">3</span></span><br><span class="line">	__proto__: <span class="built_in">String</span></span><br><span class="line">	[[PrimitiveValue]]: <span class="string">"abc"</span></span><br></pre></td></tr></table></figure>
<h5 id="5-number-gt-Object"><a href="#5-number-gt-Object" class="headerlink" title="[5] number =&gt; Object"></a>[5] number =&gt; Object</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>(<span class="number">123</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">Number</span> &#123;<span class="number">123</span>&#125;</span><br><span class="line">	__proto__: <span class="built_in">Number</span></span><br><span class="line">	[[PrimitiveValue]]: <span class="number">123</span></span><br></pre></td></tr></table></figure>
<h4 id="3-对象转基础数据类型"><a href="#3-对象转基础数据类型" class="headerlink" title="(3) 对象转基础数据类型"></a>(3) 对象转基础数据类型</h4><h5 id="1-Object-gt-boolean"><a href="#1-Object-gt-boolean" class="headerlink" title="[1] Object =&gt; boolean"></a>[1] Object =&gt; boolean</h5><p>任何对象转换boolean类型，都是true</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Boolean</span>(<span class="built_in">Object</span>); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Boolean</span>(&#123;&#125;); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Boolean</span>(<span class="keyword">new</span> <span class="built_in">Boolean</span>(<span class="literal">false</span>));  <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h5 id="2-Object-gt-number"><a href="#2-Object-gt-number" class="headerlink" title="[2] Object =&gt; number"></a>[2] Object =&gt; number</h5><p>先调用valueOf(),后调用toString()</p>
<p>调用valueOf()，返回原始值，若无原始值则返回对象本身</p>
<p>[1] date对象特殊，当前系统时间与1970年1月1日差额毫秒</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>[2] 对象</p>
<h5 id="3-Object-gt-string"><a href="#3-Object-gt-string" class="headerlink" title="[3] Object =&gt; string"></a>[3] Object =&gt; string</h5><p>先调用toString(),后调用valueOf()</p>
<p>调用toString(),当前对象通过字符串表示</p>
<ul>
<li>数组</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">String</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line"></span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>].toString() <span class="comment">// 等同于调用了 结果："1,2,3"</span></span><br></pre></td></tr></table></figure>
<ul>
<li>函数</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function a() &#123;</span><br><span class="line">	console.log(&apos;test&apos;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">a.toString()</span><br></pre></td></tr></table></figure>
<ul>
<li>日期</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line"></span><br><span class="line"><span class="built_in">String</span>(a);</span><br><span class="line"></span><br><span class="line">a.toString(); <span class="comment">// 相当于</span></span><br><span class="line"></span><br><span class="line"><span class="string">"Sat Jun 30 2018 23:43:59 GMT+0800 (China Standard Time)"</span></span><br></pre></td></tr></table></figure>
<ul>
<li>正则</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> <span class="built_in">RegExp</span>();</span><br><span class="line"></span><br><span class="line"><span class="built_in">String</span>(a); <span class="comment">// 输出"/(?:)/"</span></span><br><span class="line"></span><br><span class="line">a.toString() <span class="comment">// 相当于</span></span><br></pre></td></tr></table></figure>
<h4 id="4-创建Object"><a href="#4-创建Object" class="headerlink" title="(4). 创建Object"></a>(4). 创建Object</h4><h5 id="1-对象字面量"><a href="#1-对象字面量" class="headerlink" title="[1] 对象字面量"></a>[1] 对象字面量</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> o1 = &#123;<span class="attr">test</span>: <span class="number">1</span>&#125;;</span><br></pre></td></tr></table></figure>
<h5 id="2-new-Object"><a href="#2-new-Object" class="headerlink" title="[2] new Object()"></a>[2] new Object()</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> o1 = <span class="keyword">new</span> <span class="built_in">Object</span>(&#123;<span class="attr">test</span>: <span class="number">1111</span>&#125;);</span><br></pre></td></tr></table></figure>
<h5 id="3-Object-create"><a href="#3-Object-create" class="headerlink" title="[3] Object.create()"></a>[3] Object.create()</h5><ul>
<li>语法</li>
</ul>
<p>Object.create(proto, [propertiesObject])</p>
<ul>
<li>参数</li>
</ul>
<p><strong>proto:</strong></p>
<p>新创建对象的原型对象。</p>
<p><strong>propertiesObject:</strong></p>
<p>可选。如果没有指定为 undefined，则是要添加到新创建对象的可枚举属性（即其自身定义的属性，而不是其原型链上的枚举属性）对象的属性描述符以及相应的属性名称。这些属性对应Object.defineProperties()的第二个参数</p>
<ul>
<li>返回值</li>
</ul>
<p>一个新对象，带着指定的原型对象和属性</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="built_in">Object</span>.create(<span class="built_in">Object</span>.prototype,&#123;<span class="attr">foo</span>: &#123;<span class="attr">value</span>: <span class="string">'111'</span>&#125;&#125;);</span><br></pre></td></tr></table></figure>
<h5 id="4-new-Object-和-Object-create-区别"><a href="#4-new-Object-和-Object-create-区别" class="headerlink" title="[4] new Object() 和  Object.create()区别"></a>[4] new Object() 和  Object.create()区别</h5><p>new操作符——完成四件事</p>
<ol>
<li><p>创建一个新的空对象；</p>
</li>
<li><p>绑定this到这个空对象，即切换上下文；</p>
</li>
<li><p>给这个新对象添加<strong>proto</strong>，并指向构造函数的原型；</p>
</li>
<li><p>如果构造函数未返回对象(如返回对象，则替换return this)，则将该新对象返回，即return this（第2条：this指向新对象）；</p>
</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="built_in">Object</span>.create(<span class="literal">null</span>,&#123;<span class="attr">foo</span>: &#123;<span class="attr">value</span>: <span class="string">'111'</span>&#125;&#125;);</span><br><span class="line"></span><br><span class="line">&#123;<span class="attr">foo</span>: <span class="string">"111"</span>&#125;</span><br><span class="line">foo: <span class="string">"111"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="built_in">Object</span>.create(<span class="built_in">Object</span>.prototype,&#123;<span class="attr">foo</span>: &#123;<span class="attr">value</span>: <span class="string">'111'</span>&#125;&#125;);</span><br><span class="line"></span><br><span class="line">&#123;<span class="attr">foo</span>: <span class="string">"111"</span>&#125;</span><br><span class="line"></span><br><span class="line">foo: <span class="string">"111"</span></span><br><span class="line"></span><br><span class="line">__proto__: </span><br><span class="line">Objectconstructor: ƒ <span class="built_in">Object</span>()</span><br><span class="line">hasOwnProperty: ƒ hasOwnProperty()</span><br><span class="line">isPrototypeOf: ƒ isPrototypeOf()</span><br><span class="line">propertyIsEnumerable: ƒ propertyIsEnumerable()</span><br><span class="line">toLocaleString: ƒ toLocaleString()</span><br><span class="line">toString: ƒ toString()</span><br><span class="line">valueOf: ƒ valueOf()</span><br><span class="line">__defineGetter__: ƒ __defineGetter__()</span><br><span class="line">__defineSetter__: ƒ __defineSetter__()</span><br><span class="line">__lookupGetter__: ƒ __lookupGetter__()</span><br><span class="line">__lookupSetter__: ƒ __lookupSetter__()</span><br><span class="line">get __proto__: ƒ __proto__()</span><br><span class="line">set __proto__: ƒ __proto__()</span><br></pre></td></tr></table></figure>
<p>Object.create</p>
<ol>
<li><p>Object.create传入对象将作为新建对象的原型。</p>
</li>
<li><p>Object.create传入构造函数原型时，无论构造函数是否返回对象，Object.create只会return 以构造函数原型来新建的对象（参见下面的polyfill），而new则参见上节粗体描述。</p>
</li>
</ol>
<h5 id="5-Object-assign-vs-new"><a href="#5-Object-assign-vs-new" class="headerlink" title="[5] Object.assign vs new"></a>[5] Object.assign vs new</h5><p>Object.assign 只拷贝对象的属性和函数，丢失原型链，<strong>proto</strong>指向Object.prototype</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Dog</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">   <span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line">Dog.prototype.getName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> pet1 = <span class="keyword">new</span> Dog(<span class="string">'rocky'</span>); </span><br><span class="line"><span class="built_in">console</span>.log(pet1.getName());      <span class="comment">//rocky</span></span><br><span class="line"><span class="keyword">const</span> pet2 = <span class="built_in">Object</span>.assign(&#123;&#125;,pet1);</span><br><span class="line"><span class="built_in">console</span>.log(pet2.name)            <span class="comment">//rocky</span></span><br><span class="line"><span class="built_in">console</span>.log(pet2.getName());      <span class="comment">//error!!!!!  getName undefined</span></span><br></pre></td></tr></table></figure>
<h4 id="5-对象属性查找"><a href="#5-对象属性查找" class="headerlink" title="(5). 对象属性查找"></a>(5). 对象属性查找</h4><h5 id="1"><a href="#1" class="headerlink" title="[1] ."></a>[1] .</h5><p>解释器解析步骤：</p>
<ul>
<li>判断.之前是否为null 或 undefined</li>
<li>判断.前时候为对象，若不是转化为对象</li>
<li>.后名字匹配</li>
<li>返回值或undefined</li>
</ul>
<h5 id="2"><a href="#2" class="headerlink" title="[2] []"></a>[2] []</h5><p>解释器解析步骤</p>
<ul>
<li>判断[]之前是否为null 或 undefined</li>
<li>判断[]前时候为对象，若不是转化为对象</li>
<li>计算[]，转换为字符串,匹配值</li>
<li>返回值或undefined</li>
</ul>
<h3 id="7-symbol"><a href="#7-symbol" class="headerlink" title="7.symbol"></a>7.symbol</h3><p>ES6 引入了一种新的原始数据类型Symbol，表示独一无二的值。</p>
<h4 id="1-Symbol值通过Symbol函数生成的"><a href="#1-Symbol值通过Symbol函数生成的" class="headerlink" title="[1] Symbol值通过Symbol函数生成的"></a>[1] Symbol值通过Symbol函数生成的</h4><p>Symbol 值通过Symbol函数生成,Symbol函数前不能使用new命令，否则会报错。这是因为生成的 Symbol 是一个原始类型的值，不是对象。也就是说，由于 Symbol 值不是对象，所以不能添加属性。基本上，它是一种类似于字符串的数据类型。<strong>基本上，它是一种类似于字符串的数据类型。</strong></p>
<ul>
<li>创建</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="built_in">Symbol</span>();</span><br></pre></td></tr></table></figure>
<ul>
<li>不能使用new操作符</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="keyword">new</span> <span class="built_in">Symbol</span>(); <span class="comment">//报错</span></span><br></pre></td></tr></table></figure>
<ul>
<li>不能添加属性 </li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="built_in">Symbol</span>(); <span class="comment">// s.name 等 '123' 不可行</span></span><br></pre></td></tr></table></figure>
<h4 id="2-typeof"><a href="#2-typeof" class="headerlink" title="[2] typeof"></a>[2] typeof</h4><p>typeof运算符的结果，表明变量s是 Symbol 数据类型</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typeof</span> s <span class="comment">// "symbol"</span></span><br></pre></td></tr></table></figure>
<h4 id="3-参数"><a href="#3-参数" class="headerlink" title="[3] 参数"></a>[3] 参数</h4><p><strong>Symbol</strong>函数可以接受一个字符串作为参数，表示对 Symbol 实例的描述，主要是为了在控制台显示，或者转为字符串时，比较容易区分。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s1 = <span class="built_in">Symbol</span>(<span class="string">'foo'</span>);</span><br><span class="line"><span class="keyword">let</span> s2 = <span class="built_in">Symbol</span>(<span class="string">'bar'</span>);</span><br><span class="line"></span><br><span class="line">s1 <span class="comment">// Symbol(foo)</span></span><br><span class="line">s2 <span class="comment">// Symbol(bar)</span></span><br><span class="line"></span><br><span class="line">s1.toString() <span class="comment">// "Symbol(foo)"</span></span><br><span class="line">s2.toString() <span class="comment">// "Symbol(bar)"</span></span><br></pre></td></tr></table></figure>
<p>如果 Symbol 的参数是一个对象，就会调用该对象的toString方法，将其转为字符串，然后才生成一个 Symbol值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  toString() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'abc'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> sym = <span class="built_in">Symbol</span>(obj);</span><br><span class="line">sym <span class="comment">// Symbol(abc)</span></span><br></pre></td></tr></table></figure>
<h4 id="4-比较"><a href="#4-比较" class="headerlink" title="[4] 比较"></a>[4] 比较</h4><p>Symbol函数的参数只是表示对当前 Symbol 值的描述，因此相同参数的Symbol函数的返回值是不相等的</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 没有参数的情况</span></span><br><span class="line"><span class="keyword">let</span> s1 = <span class="built_in">Symbol</span>();</span><br><span class="line"><span class="keyword">let</span> s2 = <span class="built_in">Symbol</span>();</span><br><span class="line"></span><br><span class="line">s1 === s2 <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 有参数的情况</span></span><br><span class="line"><span class="keyword">let</span> s1 = <span class="built_in">Symbol</span>(<span class="string">'foo'</span>);</span><br><span class="line"><span class="keyword">let</span> s2 = <span class="built_in">Symbol</span>(<span class="string">'foo'</span>);</span><br><span class="line"></span><br><span class="line">s1 === s2 <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<h4 id="5-运算"><a href="#5-运算" class="headerlink" title="[5] 运算"></a>[5] 运算</h4><ul>
<li>Symbol 值不能与其他类型的值进行运算，会报错</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> sym = <span class="built_in">Symbol</span>(<span class="string">'My symbol'</span>);</span><br><span class="line"></span><br><span class="line"><span class="string">"your symbol is "</span> + sym</span><br><span class="line"><span class="comment">// TypeError: can't convert symbol to string</span></span><br><span class="line"><span class="string">`your symbol is <span class="subst">$&#123;sym&#125;</span>`</span></span><br><span class="line"><span class="comment">// TypeError: can't convert symbol to string</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Symbol 值可以显式转为字符串</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> sym = <span class="built_in">Symbol</span>(<span class="string">'My symbol'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">String</span>(sym) <span class="comment">// 'Symbol(My symbol)'</span></span><br><span class="line">sym.toString() <span class="comment">// 'Symbol(My symbol)'</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Symbol 值也可以转为布尔值，但是不能转为数值</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> sym = <span class="built_in">Symbol</span>();</span><br><span class="line"><span class="built_in">Boolean</span>(sym) <span class="comment">// true</span></span><br><span class="line">!sym  <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (sym) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Number</span>(sym) <span class="comment">// TypeError</span></span><br><span class="line">sym + <span class="number">2</span> <span class="comment">// TypeError</span></span><br></pre></td></tr></table></figure>
<h4 id="6-作为属性名的-Symbol"><a href="#6-作为属性名的-Symbol" class="headerlink" title="[6] 作为属性名的 Symbol"></a>[6] 作为属性名的 Symbol</h4><ul>
<li>定义</li>
</ul>
<p>由于每一个 Symbol 值都是不相等的，这意味着 Symbol 值可以作为标识符，用于对象的属性名，就能保证不会出现同名的属性。这对于一个对象由多个模块构成的情况非常有用，能防止某一个键被不小心改写或覆盖。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> mySymbol = <span class="built_in">Symbol</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第一种写法</span></span><br><span class="line"><span class="keyword">let</span> a = &#123;&#125;;</span><br><span class="line">a[mySymbol] = <span class="string">'Hello!'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二种写法</span></span><br><span class="line"><span class="keyword">let</span> a = &#123;</span><br><span class="line">  [mySymbol]: <span class="string">'Hello!'</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第三种写法</span></span><br><span class="line"><span class="keyword">let</span> a = &#123;&#125;;</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(a, mySymbol, &#123; <span class="attr">value</span>: <span class="string">'Hello!'</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 以上写法都得到同样结果</span></span><br><span class="line">a[mySymbol] <span class="comment">// "Hello!"</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Symbol 值作为对象属性名时，不能用点运算符</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mySymbol = <span class="built_in">Symbol</span>();</span><br><span class="line"><span class="keyword">const</span> a = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">a.mySymbol = <span class="string">'Hello!'</span>;</span><br><span class="line">a[mySymbol] <span class="comment">// undefined</span></span><br><span class="line">a[<span class="string">'mySymbol'</span>] <span class="comment">// "Hello!"</span></span><br></pre></td></tr></table></figure>
<p>上面代码中，因为点运算符后面总是字符串，所以不会读取mySymbol作为标识名所指代的那个值，导致a的属性名实际上是一个字符串，而不是一个 Symbol 值。</p>
<p>同理，在对象的内部，使用 Symbol 值定义属性时，Symbol 值必须放在方括号之中。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="built_in">Symbol</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  [s]: <span class="function"><span class="keyword">function</span> (<span class="params">arg</span>) </span>&#123; ... &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">obj[s](<span class="number">123</span>);</span><br></pre></td></tr></table></figure>
<p>上面代码中，如果s不放在方括号中，该属性的键名就是字符串s，而不是s所代表的那个 Symbol 值。</p>
<ul>
<li>增强的对象写法</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  [s](arg) &#123; ... &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>增强的对象写法</li>
</ul>
<p>Symbol 类型还可以用于定义一组常量，保证这组常量的值都是不相等的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> log = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">log.levels = &#123;</span><br><span class="line">  DEBUG: <span class="built_in">Symbol</span>(<span class="string">'debug'</span>),</span><br><span class="line">  INFO: <span class="built_in">Symbol</span>(<span class="string">'info'</span>),</span><br><span class="line">  WARN: <span class="built_in">Symbol</span>(<span class="string">'warn'</span>)</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(log.levels.DEBUG, <span class="string">'debug message'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(log.levels.INFO, <span class="string">'info message'</span>);</span><br></pre></td></tr></table></figure>
<p>下面是另外一个例子。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> COLOR_RED    = <span class="built_in">Symbol</span>();</span><br><span class="line"><span class="keyword">const</span> COLOR_GREEN  = <span class="built_in">Symbol</span>();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getComplement</span>(<span class="params">color</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (color) &#123;</span><br><span class="line">    <span class="keyword">case</span> COLOR_RED:</span><br><span class="line">      <span class="keyword">return</span> COLOR_GREEN;</span><br><span class="line">    <span class="keyword">case</span> COLOR_GREEN:</span><br><span class="line">      <span class="keyword">return</span> COLOR_RED;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Undefined color'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>常量使用 Symbol 值最大的好处，就是其他任何值都不可能有相同的值了，因此可以保证上面的switch语句会按设计的方式工作。</p>
<p>还有一点需要注意，Symbol 值作为属性名时，该属性还是公开属性，不是私有属性。</p>
<h3 id="8-可变类型与不可类型"><a href="#8-可变类型与不可类型" class="headerlink" title="8.可变类型与不可类型"></a>8.可变类型与不可类型</h3><p>注：数据类型动态性 定义变量只是赋值，但过程中没有确定数据类型，在使用时在确定数据类型</p>
<h4 id="1-基础数据类型是不可变："><a href="#1-基础数据类型是不可变：" class="headerlink" title="(1) 基础数据类型是不可变："></a>(1) 基础数据类型是不可变：</h4><h5 id="1-值比较"><a href="#1-值比较" class="headerlink" title="[1] 值比较"></a>[1] 值比较</h5><ul>
<li>基础数据类型，是值的比较</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">a === b <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h5 id="2-动态的属性"><a href="#2-动态的属性" class="headerlink" title="[2] 动态的属性"></a>[2] 动态的属性</h5><ul>
<li>不可以添加属性和方法，也不能改变和删除属性和方法</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="string">'test'</span>;</span><br><span class="line"></span><br><span class="line">a.name = <span class="string">'helloworld'</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(a.name); <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>
<h5 id="3-复制变量值"><a href="#3-复制变量值" class="headerlink" title="[3] 复制变量值"></a>[3] 复制变量值</h5><p>从一个变量向另一个变量复制基本类型的值，会在变量对象上创建一个新值，然后把该值复制为新变量分配的位置上。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> num1 = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> num2 = num1; <span class="comment">// num1: 1 num2: 1</span></span><br><span class="line"></span><br><span class="line">num2 = <span class="number">3</span>; <span class="comment">// num1: 1 num2: 3</span></span><br></pre></td></tr></table></figure>
<h5 id="4-传递参数"><a href="#4-传递参数" class="headerlink" title="[4] 传递参数"></a>[4] 传递参数</h5><ul>
<li><p>传递参数的方式为值传递</p>
</li>
<li><p>向参数传递基本类型，被传递的值会复制给一个局部变量，因此这个局部变量的变化会反应在函数外部。</p>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addTen</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">	num += <span class="number">10</span>;</span><br><span class="line">	<span class="keyword">return</span> num;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> count = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> result = addTen(count);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(count); <span class="comment">// 20</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(result); <span class="comment">// 30</span></span><br></pre></td></tr></table></figure>
<h4 id="2-引用数据类型可变"><a href="#2-引用数据类型可变" class="headerlink" title="(2) 引用数据类型可变"></a>(2) 引用数据类型可变</h4><h5 id="1-值比较-1"><a href="#1-值比较-1" class="headerlink" title="[1] 值比较"></a>[1] 值比较</h5><ul>
<li>引用比较，独立对象不相等</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj1 = &#123;<span class="attr">a</span>: <span class="number">1</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj2 = &#123;<span class="attr">a</span>:<span class="number">1</span>&#125;;</span><br><span class="line"></span><br><span class="line">obj1 ===  obj2 <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<h5 id="2-动态的属性-1"><a href="#2-动态的属性-1" class="headerlink" title="[2] 动态的属性"></a>[2] 动态的属性</h5><ul>
<li>可以添加属性和方法，也不能改变和删除属性和方法</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">a.name = <span class="string">'helloworld'</span>;</span><br><span class="line"></span><br><span class="line">a.name; <span class="comment">// 'helloworld'</span></span><br></pre></td></tr></table></figure>
<h5 id="3-复制变量值-1"><a href="#3-复制变量值-1" class="headerlink" title="[3] 复制变量值"></a>[3] 复制变量值</h5><p>从一个变量向另一个变量复制引用类型的值，同样会将存储在变量对象中的值复制一份放到新变量分配的空间中。不同的是，这个值的副本实际上是一个指针，复制结束后，两个变量实际上将引用同一个对象。<br>因此，改变其中一个，会影响另一个。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj1 = &#123;<span class="attr">a</span>: <span class="number">1</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj2 = obj1</span><br><span class="line"></span><br><span class="line">obj2.a = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">obj1.a <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line">obj2.b <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>
<h5 id="4-传递参数-1"><a href="#4-传递参数-1" class="headerlink" title="[4] 传递参数"></a>[4] 传递参数</h5><ul>
<li><p>传递参数的方式为值传递</p>
</li>
<li><p>向参数传递引用类型，被传递的对象的引用会复制给一个局部变量，因此外部和函数内部的变量指向同一引用，因此内部会影响外部：</p>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setName</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">	obj.name = <span class="string">"Neo"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line"></span><br><span class="line">setName(person);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(person.name); <span class="comment">// Neo</span></span><br></pre></td></tr></table></figure>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://www.neohuang.com/child/2018/07/08/js-review-datatype/" data-id="cjlm3caos000bdqm7rls63s5l" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            <!--
    
        <a href="http://www.neohuang.com/child/2018/07/08/js-review-datatype/#comments" class="article-comment-link">Comments</a>
    
-->
        </footer>
    </div>
    
</article>



    <article id="post-js-review-base-md" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2018/06/25/js-review-base-md/">js复习基本概念（语法、严格模式）</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2018/06/25/js-review-base-md/">
            <time datetime="2018-06-24T16:00:00.000Z" itemprop="datePublished">2018-06-25</time>
        </a>
    </div>


                        
                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p><img src="js-review-base.png" alt=""></p>
<h2 id="1-语法"><a href="#1-语法" class="headerlink" title="1.语法"></a>1.语法</h2><p>ECMAScript的语法大量借鉴了C及其他类C语言（如JAVA和Perl）的语法。</p>
<h3 id="（1）区分大小写"><a href="#（1）区分大小写" class="headerlink" title="（1）区分大小写"></a>（1）区分大小写</h3><ul>
<li><p>ECMAScript中的一切（变量、函数名和操作符都区分大小写。</p>
</li>
<li><p>拓展 HTML（要求区分大小写，但实际浏览器会做兼容）和CSS中不区分大小写</p>
</li>
</ul>
<h4 id="1-js写在html中是否区分大小写"><a href="#1-js写在html中是否区分大小写" class="headerlink" title="[1] js写在html中是否区分大小写"></a>[1] js写在html中是否区分大小写</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- 事件 如（onclick属性不区分大小写，但是事件后的内容区分大小写）</span><br><span class="line">- 事件内的部分需要区分大小写 如：onclick=&quot;这部分&quot;</span><br></pre></td></tr></table></figure>
<h4 id="2-data属性"><a href="#2-data属性" class="headerlink" title="[2] data属性"></a>[2] data属性</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">data写入属性都会转为小写 如： data-Name === data-name (chrome下测试并不是,ie下会有问题)</span><br><span class="line"></span><br><span class="line">一旦涉及-都会涉及大小写问题，主要表现就是定义时如果存在大写，调用时需要用小写，负责会出现undefined</span><br></pre></td></tr></table></figure>
<h3 id="（2）标识符"><a href="#（2）标识符" class="headerlink" title="（2）标识符"></a>（2）标识符</h3><p>所谓标识符，就是指变量、函数、属性的名字，或者函数的参数。</p>
<p>js中标识符是按下列格式规则组合起来的一或多个字符：</p>
<ul>
<li><p>第一个字符可以是：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(1)字母 (2)下划线（_）(3)美元符号（$）；</span><br></pre></td></tr></table></figure>
</li>
<li><p>其他字符可以是： </p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(1）字母 (2）下划线 （3）美元符号 (4）数字</span><br><span class="line">// 汉字也是字符，unicode（不建议使用，除涉及数学计算）</span><br></pre></td></tr></table></figure>
</li>
<li><p>ECMAScirpt推荐标识符采用驼峰大小写格式</p>
</li>
</ul>
<h3 id="3-注释"><a href="#3-注释" class="headerlink" title="(3) 注释"></a>(3) 注释</h3><p>ECMAScirpt推荐标识符采用驼峰大小写格式使用C风格的注释</p>
<p>包含</p>
<ul>
<li>[1] 单行注释</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// 单行注释</span><br></pre></td></tr></table></figure>
<ul>
<li>[2] 多行注释</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/* * 这是一个多行</span><br><span class="line"> *	（块级注释） */</span><br></pre></td></tr></table></figure>
<p>第二第三行的*不是必须的，纯粹为了提高可读性。</p>
<h2 id="2-严格模式"><a href="#2-严格模式" class="headerlink" title="2.严格模式"></a>2.严格模式</h2><p>ES5引入了严格模式（strict mode）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// 进入表示</span><br><span class="line"></span><br><span class="line">&quot;use strict&quot;;</span><br></pre></td></tr></table></figure>
<p>老版本的浏览器会把它当作一行普通字符串，加以忽略。</p>
<p>“严格模式”有两种调用方法，适用于不同的场合。</p>
<h3 id="1-启用（整个脚本启用）"><a href="#1-启用（整个脚本启用）" class="headerlink" title="[1] 启用（整个脚本启用）"></a>[1] 启用（整个脚本启用）</h3><p>将”use strict”放在脚本文件的第一行，则整个脚本都将以”严格模式”运行。如果这行语句不在第一行，则无效，整个脚本以”正常模式”运行。如果不同模式的代码文件合并成一个文件，这一点需要特别注意。</p>
<p>(严格地说，只要前面不是产生实际运行结果的语句，”use strict”可以不在第一行，比如直接跟在一个空的分号后面。)</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">　<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">　　　"use strict";</span></span><br><span class="line"><span class="undefined">　　　console.log("这是严格模式。");</span></span><br><span class="line"><span class="undefined">　</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">　<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">　　　console.log("这是正常模式。");kly, it's almost 2 years ago now. I can admit it now - I run it on my school's network that has about 50 computers.</span></span><br><span class="line"><span class="undefined">　</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-启用（指定函数启用）"><a href="#2-启用（指定函数启用）" class="headerlink" title="[2] 启用（指定函数启用）"></a>[2] 启用（指定函数启用）</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">　<span class="function"><span class="keyword">function</span> <span class="title">strict</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="meta">　　　"use strict"</span>;</span><br><span class="line">　　　<span class="keyword">return</span> <span class="string">"这是严格模式。"</span>;</span><br><span class="line">　&#125;</span><br><span class="line"></span><br><span class="line">　<span class="function"><span class="keyword">function</span> <span class="title">notStrict</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">　　　<span class="keyword">return</span> <span class="string">"这是正常模式。"</span>;</span><br><span class="line">　&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-脚本文件的变通写法"><a href="#3-脚本文件的变通写法" class="headerlink" title="[3] 脚本文件的变通写法"></a>[3] 脚本文件的变通写法</h3><p>因为第一种调用方法不利于文件合并，所以更好的做法是，借用第二种方法，将整个脚本文件放在一个立即执行的匿名函数之中。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">　(<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">　　　"use strict"</span>;</span><br><span class="line"></span><br><span class="line">　　　<span class="comment">// some code here</span></span><br><span class="line"></span><br><span class="line">　&#125;)();</span><br></pre></td></tr></table></figure>
<h3 id="4-严格模式目的"><a href="#4-严格模式目的" class="headerlink" title="[4] 严格模式目的"></a>[4] 严格模式目的</h3><ul>
<li>消除Javascript语法的一些不合理、不严谨之处，减少一些怪异行为;</li>
<li>消除代码运行的一些不安全之处，保证代码运行的安全；</li>
<li>提高编译器效率，增加运行速度；</li>
<li>为未来新版本的Javascript做好铺垫。</li>
</ul>
<h3 id="5-语法和行为改变"><a href="#5-语法和行为改变" class="headerlink" title="[5] 语法和行为改变"></a>[5] 语法和行为改变</h3><h4 id="1-全局变量显示声明"><a href="#1-全局变量显示声明" class="headerlink" title="(1) 全局变量显示声明"></a>(1) 全局变量显示声明</h4><p>在正常模式中，如果一个变量没有声明就赋值，默认是全局变量。严格模式禁止这种用法，全局变量必须显式声明。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"></span><br><span class="line">v = <span class="number">1</span>; <span class="comment">// 报错，v未声明</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123; <span class="comment">// 报错，i未声明</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因此，严格模式下，变量都必须先用var命令声明，然后再使用。</p>
<h4 id="2-静态绑定"><a href="#2-静态绑定" class="headerlink" title="(2) 静态绑定"></a>(2) 静态绑定</h4><p>[1] 禁止使用with语句<br>因为with语句无法在编译时就确定，属性到底归属哪个对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">　"use strict"</span>;</span><br><span class="line"></span><br><span class="line">　<span class="keyword">var</span> v = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">　<span class="keyword">with</span> (o)&#123; <span class="comment">// 语法错误 </span></span><br><span class="line">　　　v = <span class="number">2</span>;</span><br><span class="line">　&#125;</span><br></pre></td></tr></table></figure>
<p>[2] 创设eval作用域</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">正常模式下，Javascript语言有两种变量作用域（scope）：全局作用域和函数作用域。严格模式创设了第三种作用域：eval作用域。</span><br><span class="line"></span><br><span class="line">正常模式下，eval语句的作用域，取决于它处于全局作用域，还是处于函数作用域。严格模式下，eval语句本身就是一个作用域，不再能够生成全局变量了，它所生成的变量只能用于eval内部。</span><br></pre></td></tr></table></figure>
<h4 id="3-增强的安全措施"><a href="#3-增强的安全措施" class="headerlink" title="(3) 增强的安全措施"></a>(3) 增强的安全措施</h4><p>[1] 禁止this关键字指向全局对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">　<span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">　　　<span class="keyword">return</span> !<span class="keyword">this</span>;</span><br><span class="line">　&#125; </span><br><span class="line">　<span class="comment">// 返回false，因为"this"指向全局对象，"!this"就是false</span></span><br><span class="line"></span><br><span class="line">　<span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line"><span class="meta">　　　"use strict"</span>;</span><br><span class="line">　　　<span class="keyword">return</span> !<span class="keyword">this</span>;</span><br><span class="line">　&#125; </span><br><span class="line">　<span class="comment">// 返回true，因为严格模式下，this的值为undefined，所以"!this"为true。</span></span><br></pre></td></tr></table></figure>
<p>[2] 禁止在函数内部遍历调用栈</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">　　"use strict"</span>;</span><br><span class="line"></span><br><span class="line">　　f1.caller; <span class="comment">// 报错</span></span><br><span class="line"></span><br><span class="line">　　f1.arguments; <span class="comment">// 报错</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">f1();</span><br></pre></td></tr></table></figure>
<h4 id="4-禁止删除变量"><a href="#4-禁止删除变量" class="headerlink" title="(4) 禁止删除变量"></a>(4) 禁止删除变量</h4><p>严格模式下无法删除变量。只有configurable设置为true的对象属性，才能被删除。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">　"use strict"</span>;</span><br><span class="line"></span><br><span class="line">　<span class="keyword">var</span> x;</span><br><span class="line"></span><br><span class="line">　<span class="keyword">delete</span> x; <span class="comment">// 语法错误</span></span><br><span class="line"></span><br><span class="line">　<span class="keyword">var</span> o = <span class="built_in">Object</span>.create(<span class="literal">null</span>, &#123;<span class="string">'x'</span>: &#123;</span><br><span class="line">　　　　　value: <span class="number">1</span>,</span><br><span class="line">　　　　　configurable: <span class="literal">true</span></span><br><span class="line">　&#125;&#125;);</span><br><span class="line"></span><br><span class="line">　<span class="keyword">delete</span> o.x; <span class="comment">// 删除成功</span></span><br></pre></td></tr></table></figure>
<h4 id="5-显式报错"><a href="#5-显式报错" class="headerlink" title="(5) 显式报错"></a>(5) 显式报错</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">　"use strict"</span>;</span><br><span class="line"></span><br><span class="line">　<span class="keyword">var</span> o = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">　<span class="built_in">Object</span>.defineProperty(o, <span class="string">"v"</span>, &#123; <span class="attr">value</span>: <span class="number">1</span>, <span class="attr">writable</span>: <span class="literal">false</span> &#125;);</span><br><span class="line"></span><br><span class="line">　o.v = <span class="number">2</span>; <span class="comment">// 报错</span></span><br></pre></td></tr></table></figure>
<p>严格模式下，对一个使用getter方法读取的属性进行赋值，会报错。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">　"use strict"</span>;</span><br><span class="line"></span><br><span class="line">　<span class="keyword">var</span> o = &#123;</span><br><span class="line"></span><br><span class="line">　　　get v() &#123; <span class="keyword">return</span> <span class="number">1</span>; &#125;</span><br><span class="line"></span><br><span class="line">　&#125;;</span><br><span class="line"></span><br><span class="line">　o.v = <span class="number">2</span>; <span class="comment">// 报错</span></span><br></pre></td></tr></table></figure>
<h4 id="6-重名错误"><a href="#6-重名错误" class="headerlink" title="(6) 重名错误"></a>(6) 重名错误</h4><p>严格模式新增了一些语法错误。</p>
<p>（1）对象不能有重名的属性</p>
<p>正常模式下，如果对象有多个重名属性，最后赋值的那个属性会覆盖前面的值。严格模式下，这属于语法错误。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"></span><br><span class="line">　　<span class="keyword">var</span> o = &#123;</span><br><span class="line">　　　　p: <span class="number">1</span>,</span><br><span class="line">　　　　p: <span class="number">2</span></span><br><span class="line">　　&#125;; <span class="comment">// 语法错误</span></span><br></pre></td></tr></table></figure>
<p>（2）函数不能有重名的参数</p>
<p>正常模式下，如果函数有多个重名的参数，可以用arguments[i]读取。严格模式下，这属于语法错误。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">　"use strict"</span>;</span><br><span class="line"></span><br><span class="line">　<span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">a, a, b</span>) </span>&#123; <span class="comment">// 语法错误</span></span><br><span class="line"></span><br><span class="line">　　　<span class="keyword">return</span> ;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="7-禁止八进制表示法"><a href="#7-禁止八进制表示法" class="headerlink" title="(7) 禁止八进制表示法"></a>(7) 禁止八进制表示法</h4><p>正常模式下，整数的第一位如果是0，表示这是八进制数，比如0100等于十进制的64。严格模式禁止这种表示法，整数第一位为0，将报错。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">　"use strict"</span>;</span><br><span class="line"></span><br><span class="line">　<span class="keyword">var</span> n = <span class="number">0100</span>; <span class="comment">// 语法错误</span></span><br></pre></td></tr></table></figure>
<h4 id="8-arguments对象的限制"><a href="#8-arguments对象的限制" class="headerlink" title="(8) arguments对象的限制"></a>(8) arguments对象的限制</h4><p>arguments是函数的参数对象，严格模式对它的使用做了限制。</p>
<p>(1) 不允许对arguments赋值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">　　"use strict"</span>;</span><br><span class="line"></span><br><span class="line">　　<span class="built_in">arguments</span>++; <span class="comment">// 语法错误</span></span><br><span class="line"></span><br><span class="line">　　<span class="keyword">var</span> obj = &#123; set p(<span class="built_in">arguments</span>) &#123; &#125; &#125;; <span class="comment">// 语法错误</span></span><br><span class="line"></span><br><span class="line">　　<span class="keyword">try</span> &#123; &#125; <span class="keyword">catch</span> (<span class="built_in">arguments</span>) &#123; &#125; <span class="comment">// 语法错误</span></span><br><span class="line"></span><br><span class="line">　　<span class="function"><span class="keyword">function</span> <span class="title">arguments</span>(<span class="params"></span>) </span>&#123; &#125; <span class="comment">// 语法错误</span></span><br><span class="line"></span><br><span class="line">　　<span class="keyword">var</span> f = <span class="keyword">new</span> <span class="built_in">Function</span>(<span class="string">"arguments"</span>, <span class="string">"'use strict'; return 17;"</span>); <span class="comment">// 语法错误</span></span><br></pre></td></tr></table></figure>
<p>（2）arguments不再追踪参数的变化</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">　　<span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">　　　　a = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">　　　　<span class="keyword">return</span> [a, <span class="built_in">arguments</span>[<span class="number">0</span>]];</span><br><span class="line"></span><br><span class="line">　　&#125;</span><br><span class="line"></span><br><span class="line">　　f(<span class="number">1</span>); <span class="comment">// 正常模式为[2,2]</span></span><br><span class="line"></span><br><span class="line">　　<span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">　　　　"use strict"</span>;</span><br><span class="line"></span><br><span class="line">　　　　a = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">　　　　<span class="keyword">return</span> [a, <span class="built_in">arguments</span>[<span class="number">0</span>]];</span><br><span class="line"></span><br><span class="line">　　&#125;</span><br><span class="line"></span><br><span class="line">　　f(<span class="number">1</span>); <span class="comment">// 严格模式为[2,1]</span></span><br></pre></td></tr></table></figure>
<p>（3）禁止使用arguments.callee</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">　　"use strict"</span>;</span><br><span class="line"></span><br><span class="line">　　<span class="keyword">var</span> f = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="built_in">arguments</span>.callee; &#125;;</span><br><span class="line"></span><br><span class="line">　　f(); <span class="comment">// 报错</span></span><br></pre></td></tr></table></figure>
<h4 id="9-函数必须声明在顶层"><a href="#9-函数必须声明在顶层" class="headerlink" title="(9) 函数必须声明在顶层"></a>(9) 函数必须声明在顶层</h4><p>将来Javascript的新版本会引入”块级作用域”。为了与新版本接轨，严格模式只允许在全局作用域或函数作用域的顶层声明函数。也就是说，不允许在非函数的代码块内声明函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">　　"use strict"</span>;</span><br><span class="line"></span><br><span class="line">　　<span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line"></span><br><span class="line">　　　　<span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123; &#125; <span class="comment">// 语法错误</span></span><br><span class="line"></span><br><span class="line">　　&#125;</span><br><span class="line"></span><br><span class="line">　　<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line"></span><br><span class="line">　　　　<span class="function"><span class="keyword">function</span> <span class="title">f2</span>(<span class="params"></span>) </span>&#123; &#125; <span class="comment">// 语法错误</span></span><br><span class="line"></span><br><span class="line">　　&#125;</span><br></pre></td></tr></table></figure>
<h4 id="10-保留字"><a href="#10-保留字" class="headerlink" title="(10) 保留字"></a>(10) 保留字</h4><p>为了向将来Javascript的新版本过渡，严格模式新增了一些保留字：implements, interface, let, package, private, protected, public, static, yield。</p>
<p>使用这些词作为变量名将会报错。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">　　<span class="function"><span class="keyword">function</span> <span class="title">package</span>(<span class="params">protected</span>) </span>&#123; <span class="comment">// 语法错误</span></span><br><span class="line"></span><br><span class="line"><span class="meta">　　　　"use strict"</span>;</span><br><span class="line"></span><br><span class="line">　　　　<span class="keyword">var</span> implements; <span class="comment">// 语法错误</span></span><br><span class="line"></span><br><span class="line">　　&#125;</span><br></pre></td></tr></table></figure>
<p>此外，ECMAscript第五版本身还规定了另一些保留字（class, enum, export, extends, import, super），以及各大浏览器自行增加的const保留字，也是不能作为变量名的。</p>
<h3 id="3-语句"><a href="#3-语句" class="headerlink" title="[3] 语句"></a>[3] 语句</h3><p>（1）语句以一个分号结尾；如果省略分号，则由解释器确定语句的结尾（建议不要忽略）</p>
<h3 id="4-关键字和保留字"><a href="#4-关键字和保留字" class="headerlink" title="[4] 关键字和保留字"></a>[4] 关键字和保留字</h3><p>es3 es5(*标识):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">break	do instanceof typeof</span><br><span class="line"></span><br><span class="line">case	else	new		var</span><br><span class="line"></span><br><span class="line">catch	finally	return		void</span><br><span class="line"></span><br><span class="line">debugger*	function	this	with</span><br><span class="line"></span><br><span class="line">default	if	throw</span><br><span class="line"></span><br><span class="line">delete		in	try</span><br></pre></td></tr></table></figure>
<p>ecma-262还描述了另外一组不能用标识符的保留字。尽管保留字。尽管保留字在这门</p>
<p>es3: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">abstract	enum	int short</span><br><span class="line"></span><br><span class="line">boolean	export	interface	static</span><br><span class="line"></span><br><span class="line">byte	extentds	long	super</span><br><span class="line"></span><br><span class="line">char	final	native	synchronized</span><br><span class="line"></span><br><span class="line">class	float	package	throws</span><br><span class="line"></span><br><span class="line">const goto	private	transient</span><br><span class="line"></span><br><span class="line">debugger	implement	protected	volatile</span><br><span class="line"></span><br><span class="line">double	import	public</span><br></pre></td></tr></table></figure>
<p>es5:</p>
<p>把非严格模式下运行时的保留字缩减为下列这些：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">class	enum	extends	super</span><br><span class="line"></span><br><span class="line">const	export	import</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">implement	package	public</span><br><span class="line"></span><br><span class="line">interface	private	static</span><br><span class="line"></span><br><span class="line">let		protected	yield</span><br></pre></td></tr></table></figure>
<h2 id="3-语句-1"><a href="#3-语句-1" class="headerlink" title="3.语句"></a>3.语句</h2><h3 id="（1）分号"><a href="#（1）分号" class="headerlink" title="（1）分号"></a>（1）分号</h3><h4 id="Q1-解释器如何判断是否需自动增加分号："><a href="#Q1-解释器如何判断是否需自动增加分号：" class="headerlink" title="Q1: 解释器如何判断是否需自动增加分号："></a>Q1: 解释器如何判断是否需自动增加分号：</h4><p>解释器会判断前后语句是否可以放一起执行，如果可以合并为一句，如果不可以就补全分号，再不行就报错。</p>
<p><strong>特例</strong>有如下2个</p>
<h4 id="1-return-breank-contiune"><a href="#1-return-breank-contiune" class="headerlink" title="[1] return breank contiune"></a>[1] return breank contiune</h4><p>不会合并，直接结束。（return后的部分请不要换行）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> res = <span class="string">'aaa'</span>;</span><br><span class="line">	<span class="keyword">return</span> </span><br><span class="line">		res; <span class="comment">// 不会返回aaa</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-–等操作符"><a href="#2-–等操作符" class="headerlink" title="[2] ++ –等操作符"></a>[2] ++ –等操作符</h4><p>不会与上行语句合并，而会与下语句合并</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">a</span><br><span class="line">++</span><br><span class="line">b</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(a);</span><br><span class="line"><span class="built_in">console</span>.log(b);</span><br></pre></td></tr></table></figure>
<h3 id="（2）括号"><a href="#（2）括号" class="headerlink" title="（2）括号"></a>（2）括号</h3><p>建议能使用则使用</p>
<h2 id="补充（变量类型）"><a href="#补充（变量类型）" class="headerlink" title="补充（变量类型）"></a>补充（变量类型）</h2><p>ECMAscript的变量是松散类型的，所谓松散类型就是可以用来保存任何类型的数据。换句话说，每个变量仅仅是用于保存值的占位符而已。 js在定义变量时，不会严格限制类型，而是使用（调用的时候）的时候分配类型</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://www.neohuang.com/child/2018/06/25/js-review-base-md/" data-id="cjlm3caol0004dqm75ud1qxnm" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            <!--
    
        <a href="http://www.neohuang.com/child/2018/06/25/js-review-base-md/#comments" class="article-comment-link">Comments</a>
    
-->
        </footer>
    </div>
    
</article>



    <article id="post-promise-2" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2018/06/22/promise-2/">白话分析promise（二） promise规范</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2018/06/22/promise-2/">
            <time datetime="2018-06-21T16:00:00.000Z" itemprop="datePublished">2018-06-22</time>
        </a>
    </div>


                        
                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p><img src="/img/do-you-promise.png" alt="promise"></p>
<p>图片来源<a href="https://objcer.com/2017/05/07/About-Promise/" target="_blank" rel="noopener">https://objcer.com/2017/05/07/About-Promise/</a></p>
<ul>
<li>参考1: <a href="http://wiki.commonjs.org/wiki/Promises/A" target="_blank" rel="noopener">http://wiki.commonjs.org/wiki/Promises/A</a></li>
<li>参考2: <a href="http://www.ituring.com.cn/article/66566" target="_blank" rel="noopener">http://www.ituring.com.cn/article/66566</a></li>
<li>参考3: <a href="https://promisesaplus.com/" target="_blank" rel="noopener">https://promisesaplus.com/</a></li>
</ul>
<p>Promise 规范有很多，如 Promise/A，Promise/B，Promise/D 以及 Promise/A 的升级版 Promise/A+，有兴趣的可以去了解下，最终 ES6 中采用了 Promise/A+ 规范。在讲解 Promise 实现之前，当然要先了解 Promise/A+ 规范。</p>
<h3 id="1-Promise-A规范"><a href="#1-Promise-A规范" class="headerlink" title="1.Promise/A规范"></a>1.Promise/A规范</h3><p>Promises/A是由CommonJS组织制定的异步模式编程规范。</p>
<p>Promise及其API规范：</p>
<h4 id="（1）有限状态机"><a href="#（1）有限状态机" class="headerlink" title="（1）有限状态机"></a>（1）有限状态机</h4><p>它规定了Promises一个有限状态机，共有三种状态：unfulfilled（执行中）、fulfilled（执行成功）和failed（执行失败）。随着状态的转换将触发各种事件（如执行成功事件、执行失败事件等）。</p>
<h5 id="1-状态类型"><a href="#1-状态类型" class="headerlink" title="[1] 状态类型"></a>[1] 状态类型</h5><p>其中unfulfilled为初始状态，fulfilled和failed为结束状态（结束状态表示promise的生命周期已结束）。</p>
<h5 id="2-状态转换关系"><a href="#2-状态转换关系" class="headerlink" title="[2] 状态转换关系"></a>[2] 状态转换关系</h5><p>状态转换仅为：unfulfilled-&gt;fulfilled，unfulfilled-&gt;rejected。</p>
<h5 id="3-状态不可变"><a href="#3-状态不可变" class="headerlink" title="[3] 状态不可变"></a>[3] 状态不可变</h5><p>当一次promise的状态已经是fulfilled或failed时，promise状态的值不可被改变</p>
<h4 id="（2）必要Api"><a href="#（2）必要Api" class="headerlink" title="（2）必要Api"></a>（2）必要Api</h4><p>该规范没有定义如何创建承诺，但仅定义了承诺必须提供给承诺消费者与其交互的必要接口。实现者可以自由定义如何产生承诺。</p>
<h5 id="1-then-fulfilledHandler-errorHandler-progressHandler"><a href="#1-then-fulfilledHandler-errorHandler-progressHandler" class="headerlink" title="[1] then(fulfilledHandler, errorHandler, progressHandler)"></a>[1] then(fulfilledHandler, errorHandler, progressHandler)</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">then(fulfilledHandler, errorHandler, progressHandler);</span><br></pre></td></tr></table></figure>
<ul>
<li>fulfilledHandler： 成功处理</li>
<li>errorHandler： 错误处理</li>
<li>progressHandler（可选）： 获得进度</li>
</ul>
<p>then函数应该返回一个新的promise，当它给定的fulfilledHandler或者errorHandler回调完成时。这样就允许promise实现链式操作。回调的返回的值是返回的promise的执行后的返回值。如果回调引发错误回调，则返回的promise将移至失败状态。</p>
<p>一个基于Promises A规范使用示例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;asyncComputeTheAnswerToEverything().</span><br><span class="line">  then(addTwo).</span><br><span class="line">  then(printResult, onError);</span><br><span class="line"><span class="number">44</span></span><br></pre></td></tr></table></figure>
<p>交互式promise是一个promise的扩展，它支持以下附加功能（Promise/A+已忽略，所以不详细说明）：</p>
<p>[1] get(propertyName)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">从promise的target中请求指定的属性</span><br></pre></td></tr></table></figure>
<p>[2] call(functionName, arg1, arg2, …)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">从promise的target中执行相应方法</span><br></pre></td></tr></table></figure>
<h3 id="2-Promise-A-规范"><a href="#2-Promise-A-规范" class="headerlink" title="2.Promise/A+规范"></a>2.Promise/A+规范</h3><p>这部分，图灵社区已经有了十分完善的翻译，我就尽量结合翻译的基础上，稍微进行一些简化。</p>
<h4 id="1-什么是-Promise-A-规范"><a href="#1-什么是-Promise-A-规范" class="headerlink" title="[1] 什么是 Promise/A+规范"></a>[1] 什么是 Promise/A+规范</h4><p><strong>定义</strong>： 一个可靠的可共同协作的JavaScript Promise开放标准。</p>
<p><strong>简述</strong>：PromiseA/+规范，详细列出了 then 方法的执行过程，所有遵循 Promises/A+ 规范实现的 promise 均可以本标准作为参照基础来实施 then 方法。尽管 Promise/A+ 组织有时可能会修订本规范，但主要是为了处理一些特殊的边界情况，且这些改动都是微小且向下兼容的。如果我们要进行大规模不兼容的更新，我们一定会在事先进行谨慎地考虑、详尽的探讨和严格的测试。</p>
<p>从历史上说，本规范实际上是把之前 Promise/A 规范 中的建议明确成为了行为标准：我们一方面扩展了原有规范约定俗成的行为，一方面删减了原规范的一些特例情况和有问题的部分。</p>
<p>最后，核心的 Promises/A+ 规范不涉及如何创建、解决和拒绝 promise，而是专注于提供一个通用的 then 方法。上述对于 promises 的操作方法将来在其他规范中可能会提及。</p>
<h4 id="（1）术语"><a href="#（1）术语" class="headerlink" title="（1）术语"></a>（1）术语</h4><h5 id="1-Promise"><a href="#1-Promise" class="headerlink" title="[1]Promise"></a>[1]Promise</h5><p>promise 是一个拥有 then 方法的对象或函数，其行为符合本规范；</p>
<h5 id="2-thenable"><a href="#2-thenable" class="headerlink" title="[2]thenable"></a>[2]thenable</h5><p>是一个定义了 then 方法的对象或函数，文中译作“拥有 then 方法”；</p>
<h5 id="3-值（value）"><a href="#3-值（value）" class="headerlink" title="[3]值（value）"></a>[3]值（value）</h5><p>指任何 JavaScript 的合法值（包括 undefined , thenable 和 promise）；</p>
<h5 id="4-异常（exception）"><a href="#4-异常（exception）" class="headerlink" title="[4]异常（exception）"></a>[4]异常（exception）</h5><p>是使用 throw 语句抛出的一个值。</p>
<h5 id="5-据因（reason）"><a href="#5-据因（reason）" class="headerlink" title="[5]据因（reason）"></a>[5]据因（reason）</h5><p>表示一个 promise 的拒绝原因。</p>
<h4 id="2-状态"><a href="#2-状态" class="headerlink" title="(2)状态"></a>(2)状态</h4><p>一个 Promise 的当前状态必须为以下三种状态中的一种：等待态（Pending）、执行态（Fulfilled）和拒绝态（Rejected）。</p>
<h5 id="1-等待态（Pending）"><a href="#1-等待态（Pending）" class="headerlink" title="[1]等待态（Pending）"></a>[1]等待态（Pending）</h5><p>处于等待态时，promise 需满足以下条件：</p>
<ul>
<li>可以迁移至执行态或拒绝态</li>
</ul>
<h5 id="2-执行态（Fulfilled）"><a href="#2-执行态（Fulfilled）" class="headerlink" title="[2]执行态（Fulfilled）"></a>[2]执行态（Fulfilled）</h5><p>处于执行态时，promise 需满足以下条件：</p>
<ul>
<li>不能迁移至其他任何状态</li>
<li>必须拥有一个不可变的终值</li>
</ul>
<h5 id="3-拒绝态（Rejected）"><a href="#3-拒绝态（Rejected）" class="headerlink" title="[3]拒绝态（Rejected）"></a>[3]拒绝态（Rejected）</h5><p>处于拒绝态时，promise 需满足以下条件：</p>
<ul>
<li>不能迁移至其他任何状态</li>
<li>必须拥有一个不可变的据因</li>
</ul>
<p>这里的不可变指的是恒等（即可用 === 判断相等），而不是意味着更深层次的不可变（译者注：盖指当 value 或 reason 不是基本值时，只要求其引用地址相等，但属性值可被更改）。</p>
<h4 id="3-Then-方法"><a href="#3-Then-方法" class="headerlink" title="(3)Then 方法"></a>(3)Then 方法</h4><p>一个 promise 必须提供一个 then 方法以访问其当前值、终值和据因。</p>
<p>promise 的 then 方法接受两个参数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">promise.then(onFulfilled, onRejected)</span><br></pre></td></tr></table></figure>
<h5 id="1-参数（可选）"><a href="#1-参数（可选）" class="headerlink" title="[1]  参数（可选）"></a>[1]  参数（可选）</h5><p>onFulfilled 和 onRejected 都是可选参数。</p>
<ul>
<li>如果 onFulfilled 不是函数，其必须被忽略</li>
<li>如果 onRejected 不是函数，其必须被忽略</li>
</ul>
<p><strong>onFulfilled 特性：</strong></p>
<p>如果 onFulfilled 是函数：</p>
<ul>
<li>当 promise 执行结束后其必须被调用，其第一个参数为 promise 的终值</li>
<li>在 promise 执行结束前其不可被调用</li>
<li>其调用次数不可超过一次</li>
</ul>
<p><strong>onRejected 特性</strong></p>
<p>如果 onRejected 是函数：</p>
<ul>
<li>当 promise 被拒绝执行后其必须被调用，其第一个参数为 promise 的据因</li>
<li>在 promise 被拒绝执行前其不可被调用</li>
<li>其调用次数不可超过一次</li>
</ul>
<p><strong>调用时机</strong></p>
<ul>
<li>onFulfilled 和 onRejected 只有在执行环境堆栈仅包含平台代码时才可被调用 <strong>注1</strong></li>
</ul>
<p><strong>调用要求</strong></p>
<ul>
<li>onFulfilled 和 onRejected 必须被作为函数调用（即没有 this 值 <strong>注2</strong></li>
</ul>
<p><strong>多次调用</strong></p>
<p>then 方法可以被同一个 promise 调用多次</p>
<ul>
<li>当 promise 成功执行时，所有 onFulfilled 需按照其注册顺序依次回调</li>
<li>当 promise 被拒绝执行时，所有的 onRejected 需按照其注册顺序依次回调</li>
</ul>
<p><strong>返回</strong></p>
<p>then 方法必须返回一个 promise 对象 <strong>注3</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">promise2 = promise1.then(onFulfilled, onRejected);</span><br></pre></td></tr></table></figure>
<ul>
<li>如果 onFulfilled 或者 onRejected 返回一个值 x ，则运行下面的 Promise 解决过程：<a href="promise2, x">[Resolve]</a></li>
<li>如果 onFulfilled 或者 onRejected 抛出一个异常 e ，则 promise2 必须拒绝执行，并返回拒因 e</li>
<li>如果 onFulfilled 不是函数且 promise1 成功执行， promise2 必须成功执行并返回相同的值</li>
<li>如果 onRejected 不是函数且 promise1 拒绝执行， promise2 必须拒绝执行并返回相同的据因</li>
</ul>
<p>译者注：理解上面的“返回”部分非常重要，即：不论 promise1 被 reject 还是被 resolve 时 promise2 都会被 resolve，只有出现异常时才会被 rejected。</p>
<h4 id="4-Promise-解决过程"><a href="#4-Promise-解决过程" class="headerlink" title="(4)Promise 解决过程"></a>(4)Promise 解决过程</h4><p>Promise 解决过程是一个抽象的操作，其需输入一个 promise 和一个值，我们表示为 <a href="promise, x">[Resolve]</a>，如果 x 有 then 方法且看上去像一个 Promise ，解决程序即尝试使 promise 接受 x 的状态；否则其用 x 的值来执行 promise 。</p>
<p>这种 thenable 的特性使得 Promise 的实现更具有通用性：只要其暴露出一个遵循 Promise/A+ 协议的 then 方法即可；这同时也使遵循 Promise/A+ 规范的实现可以与那些不太规范但可用的实现能良好共存。</p>
<p>运行 <a href="promise, x">[Resolve]</a> 需遵循以下步骤：</p>
<h5 id="1-x-与-promise-相等"><a href="#1-x-与-promise-相等" class="headerlink" title="[1]x 与 promise 相等"></a>[1]x 与 promise 相等</h5><p>如果 promise 和 x 指向同一对象，以 TypeError 为据因拒绝执行 promise</p>
<h5 id="2-x-为-Promise"><a href="#2-x-为-Promise" class="headerlink" title="[2]x 为 Promise"></a>[2]x 为 Promise</h5><p>如果 x 为 Promise ，则使 promise 接受 x 的状态  <strong>注4</strong></p>
<ul>
<li>如果 x 处于等待态， promise 需保持为等待态直至 x 被执行或拒绝</li>
<li>如果 x 处于执行态，用相同的值执行 promise</li>
<li>如果 x 处于拒绝态，用相同的据因拒绝 promise</li>
</ul>
<h5 id="3-x-为对象或函数"><a href="#3-x-为对象或函数" class="headerlink" title="[3]x 为对象或函数"></a>[3]x 为对象或函数</h5><p>如果 x 为对象或者函数：</p>
<ul>
<li>把 x.then 赋值给 then <strong>注5</strong></li>
<li>如果取 x.then 的值时抛出错误 e ，则以 e 为据因拒绝 promise</li>
<li>如果 then 是函数，将 x 作为函数的作用域 this 调用之。传递两个回调函数作为参数，第一个参数叫做 resolvePromise ，第二个参数叫做 rejectPromise:<ul>
<li>如果 resolvePromise 以值 y 为参数被调用，则运行 <a href="promise, y">[Resolve]</a></li>
<li>如果 rejectPromise 以据因 r 为参数被调用，则以据因 r 拒绝 promise</li>
<li>如果 resolvePromise 和 rejectPromise 均被调用，或者被同一参数调用了多次，则优先采用首次调用并忽略剩下的调用</li>
<li>如果调用 then 方法抛出了异常 e：<ul>
<li>如果 resolvePromise 或 rejectPromise 已经被调用，则忽略之</li>
<li>否则以 e 为据因拒绝 promise</li>
</ul>
</li>
<li>如果 then 不是函数，以 x 为参数执行 promise</li>
</ul>
</li>
<li>如果 x 不为对象或者函数，以 x 为参数执行 promise</li>
</ul>
<p>如果一个 promise 被一个循环的 thenable 链中的对象解决，而 <a href="promise, thenable">[Resolve]</a> 的递归性质又使得其被再次调用，根据上述的算法将会陷入无限递归之中。算法虽不强制要求，但也鼓励施者检测这样的递归是否存在，若检测到存在则以一个可识别的 TypeError 为据因来拒绝 promise <strong>注6</strong></p>
<h4 id="5-注释"><a href="#5-注释" class="headerlink" title="(5)注释"></a>(5)注释</h4><ul>
<li><p><strong>注1</strong> 这里的<strong>平台代码</strong>指的是引擎、环境以及 promise 的实施代码。实践中要确保 onFulfilled 和 onRejected 方法异步执行，且应该在 then 方法被调用的那一轮事件循环之后的新执行栈中执行。这个事件队列可以采用“宏任务（macro-task）”机制或者“微任务（micro-task）”机制来实现。由于 promise 的实施代码本身就是平台代码（译者注：即都是 JavaScript），故代码自身在处理在处理程序时可能已经包含一个任务调度队列。</p>
<p>  译者注：这里提及了 macrotask 和 microtask 两个概念，这表示异步任务的两种分类。在挂起任务时，JS 引擎会将所有任务按照类别分到这两个队列中，首先在 macrotask 的队列（这个队列也被叫做 task queue）中取出第一个任务，执行完毕后取出 microtask 队列中的所有任务顺序执行；之后再取 macrotask 任务，周而复始，直至两个队列的任务都取完。</p>
<p>  两个类别的具体分类如下：</p>
<ul>
<li><strong>macro-task</strong>: script（整体代码）, setTimeout, setInterval, setImmediate, I/O, UI rendering</li>
<li><strong>micro-task</strong>: process.nextTick, Promises（这里指浏览器实现的原生 Promise）, Object.observe, MutationObserver<br>详见 stackoverflow 解答 或 这篇博客</li>
</ul>
</li>
<li><p><strong>注2</strong> 也就是说在严格模式（strict）中，函数 this 的值为 undefined ；在非严格模式中其为全局对象。</p>
</li>
<li><p><strong>注3</strong> 代码实现在满足所有要求的情况下可以允许 promise2 === promise1 。每个实现都要文档说明其是否允许以及在何种条件下允许 promise2 === promise1 。</p>
</li>
<li><p><strong>注4</strong> 总体来说，如果 x 符合当前实现，我们才认为它是真正的 promise 。这一规则允许那些特例实现接受符合已知要求的 Promises 状态。</p>
</li>
<li><p><strong>注5</strong> 这步我们先是存储了一个指向 x.then 的引用，然后测试并调用该引用，以避免多次访问 x.then 属性。这种预防措施确保了该属性的一致性，因为其值可能在检索调用时被改变。</p>
</li>
<li><p><strong>注6</strong> 实现不应该对 thenable 链的深度设限，并假定超出本限制的递归就是无限循环。只有真正的循环递归才应能导致 TypeError 异常；如果一条无限长的链上 thenable 均不相同，那么递归下去永远是正确的行为。</p>
</li>
</ul>
<h3 id="3-Promise-A-规范和Promise-A规范的不同"><a href="#3-Promise-A-规范和Promise-A规范的不同" class="headerlink" title="3.Promise/A+规范和Promise/A规范的不同"></a>3.Promise/A+规范和Promise/A规范的不同</h3><p>这部分主要是翻译了promisesaplus中的文档：</p>
<ul>
<li>参考： <a href="https://promisesaplus.com/differences-from-promises-a" target="_blank" rel="noopener"> Differences from Promises/A</a></li>
</ul>
<h4 id="（1）省略的部分"><a href="#（1）省略的部分" class="headerlink" title="（1）省略的部分"></a>（1）省略的部分</h4><p>以下Promises/A的部分已经被省略：</p>
<h5 id="1-省略Progress-handling"><a href="#1-省略Progress-handling" class="headerlink" title="[1]省略Progress handling"></a>[1]省略Progress handling</h5><p>在实践中，它已被证明是不明确的，目前在社区内的Promise实现中通常都没有具体实现。</p>
<h5 id="2-省略互操作性相关的Api"><a href="#2-省略互操作性相关的Api" class="headerlink" title="[2]省略互操作性相关的Api"></a>[2]省略互操作性相关的Api</h5><p>互操作性相关的Api被认为超出了最小必要api的范围</p>
<h5 id="3-不强制要求-promise1-promise2"><a href="#3-不强制要求-promise1-promise2" class="headerlink" title="[3]不强制要求 promise1 !== promise2"></a>[3]不强制要求 promise1 !== promise2</h5><p>由于可能出现</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> promise2 = promise1.then(onFulfilled, onRejected)</span><br></pre></td></tr></table></figure>
<p>因此不强制要求promise1 !== promise2 </p>
<h4 id="（2）澄清的部分"><a href="#（2）澄清的部分" class="headerlink" title="（2）澄清的部分"></a>（2）澄清的部分</h4><p>Promises/A+使用了与Promises/A不同的术语，来表达他们实际上已经在promise中实现了。</p>
<p>具体的是：</p>
<h5 id="1-Promise状态-规定为-“pending”-“fulfilled”-and-“rejected”"><a href="#1-Promise状态-规定为-“pending”-“fulfilled”-and-“rejected”" class="headerlink" title="[1] Promise状态    规定为 “pending”, “fulfilled”, and “rejected”"></a>[1] Promise状态    规定为 “pending”, “fulfilled”, and “rejected”</h5><h5 id="2-当Promise状态为fulfilled，拥有value，当Promise状态为rejected-拥有reason"><a href="#2-当Promise状态为fulfilled，拥有value，当Promise状态为rejected-拥有reason" class="headerlink" title="[2] 当Promise状态为fulfilled，拥有value，当Promise状态为rejected,拥有reason"></a>[2] 当Promise状态为fulfilled，拥有value，当Promise状态为rejected,拥有reason</h5><h5 id="3-以便于更精确的讨论鸭子类型在互操作实现中的必要性，Promises-A-规范介绍了thenable与promise的不同"><a href="#3-以便于更精确的讨论鸭子类型在互操作实现中的必要性，Promises-A-规范介绍了thenable与promise的不同" class="headerlink" title="[3] 以便于更精确的讨论鸭子类型在互操作实现中的必要性，Promises/A+规范介绍了thenable与promise的不同"></a>[3] 以便于更精确的讨论鸭子类型在互操作实现中的必要性，Promises/A+规范介绍了thenable与promise的不同</h5><h4 id="（3）附加的部分"><a href="#（3）附加的部分" class="headerlink" title="（3）附加的部分"></a>（3）附加的部分</h4><p>Promises/A+ 增加了以下规范：</p>
<h5 id="1-在onFulfilled-或-onRejected-返回的thenable-包含了处理程序的细节"><a href="#1-在onFulfilled-或-onRejected-返回的thenable-包含了处理程序的细节" class="headerlink" title="[1] 在onFulfilled 或 onRejected 返回的thenable,包含了处理程序的细节"></a>[1] 在onFulfilled 或 onRejected 返回的thenable,包含了处理程序的细节</h5><h5 id="2-在onRejected状态下的拒因必须是使用-throw-语句抛出的一个值"><a href="#2-在onRejected状态下的拒因必须是使用-throw-语句抛出的一个值" class="headerlink" title="[2] 在onRejected状态下的拒因必须是使用 throw 语句抛出的一个值"></a>[2] 在onRejected状态下的拒因必须是使用 throw 语句抛出的一个值</h5><h5 id="3-要确保-onFulfilled-和-onRejected-方法异步执行"><a href="#3-要确保-onFulfilled-和-onRejected-方法异步执行" class="headerlink" title="[3] 要确保 onFulfilled 和 onRejected 方法异步执行"></a>[3] 要确保 onFulfilled 和 onRejected 方法异步执行</h5><h5 id="4-onFulfilled-和-onRejected-必须被作为函数调用"><a href="#4-onFulfilled-和-onRejected-必须被作为函数调用" class="headerlink" title="[4] onFulfilled 和 onRejected 必须被作为函数调用"></a>[4] onFulfilled 和 onRejected 必须被作为函数调用</h5><h5 id="5-Promises-A-严格定义了onFulfilled或者onRejected的调用-以便于随后调用then在相同的Promise中"><a href="#5-Promises-A-严格定义了onFulfilled或者onRejected的调用-以便于随后调用then在相同的Promise中" class="headerlink" title="[5] Promises/A+ 严格定义了onFulfilled或者onRejected的调用,以便于随后调用then在相同的Promise中"></a>[5] Promises/A+ 严格定义了onFulfilled或者onRejected的调用,以便于随后调用then在相同的Promise中</h5><h3 id="4-ECMAscript规范下的Promise"><a href="#4-ECMAscript规范下的Promise" class="headerlink" title="4.ECMAscript规范下的Promise"></a>4.ECMAscript规范下的Promise</h3><p>ES6的Promise是Promise/A+规范的实现,并且在规范实现基础上额外增加了一些Promise.all和Promise.race之类的简便方法。</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://www.neohuang.com/child/2018/06/22/promise-2/" data-id="cjlm3caou000ddqm7xhs2atrr" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            <!--
    
        <a href="http://www.neohuang.com/child/2018/06/22/promise-2/#comments" class="article-comment-link">Comments</a>
    
-->
        </footer>
    </div>
    
</article>



    <article id="post-promise-1" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2018/06/10/promise-1/">白话分析promise（一） 概念及使用</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2018/06/10/promise-1/">
            <time datetime="2018-06-09T16:00:00.000Z" itemprop="datePublished">2018-06-10</time>
        </a>
    </div>


                        
                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p><img src="/img/do-you-promise.png" alt="promise"></p>
<p>图片来源<a href="https://objcer.com/2017/05/07/About-Promise/" target="_blank" rel="noopener">https://objcer.com/2017/05/07/About-Promise/</a></p>
<ul>
<li>参考：<a href="http://es6.ruanyifeng.com/#docs/promise" target="_blank" rel="noopener">ECMAScript 6 入门–阮一峰</a></li>
</ul>
<p>Promise是前端目前不论面试还是工作中都应该十分了解的知识，本文希望全面并且简单的能够把promise的概念、使用、原理讲清楚，所以分了为了三篇。</p>
<p>这第一篇使用基本就是一些我自己的概念理解，以及许多部分搬运阮一峰大大的文章，将一部分最核心的篇幅，重新学习，并且记录了一下。</p>
<h3 id="一、什么是promise"><a href="#一、什么是promise" class="headerlink" title="一、什么是promise"></a>一、什么是promise</h3><p>文档解读：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Promises/A+ 规范中表示为一个异步操作的最终结果，ECMAscript 规范定义为延时或异步计算最终结果的占位符。</span><br><span class="line"></span><br><span class="line">严谨来讲，Promise 是一种封装和组合未来值得易于复用机制，实现关注点分离、异步流程控制、异常冒泡、串行/并行控制等。</span><br></pre></td></tr></table></figure>
<hr>
<p>白话解读：</p>
<ol>
<li>Promise是<strong>异步编程</strong>的一种<strong>解决方案</strong></li>
<li>Promise，简单说就是一个<strong>容器</strong>，里面保存着某个未来才会结束的事件（通常是一个异步操作）的结果</li>
<li>从语法上说，Promise 是一个<strong>对象</strong>，从它可以获取异步操作的消息。Promise 提供统一的 API，各种异步操作都可以用同样的方法进行处理。</li>
</ol>
<h3 id="二、Promise使用"><a href="#二、Promise使用" class="headerlink" title="二、Promise使用"></a>二、Promise使用</h3><h4 id="1-基本用法"><a href="#1-基本用法" class="headerlink" title="1. 基本用法"></a>1. 基本用法</h4><h5 id="1-创造了一个Promise实例"><a href="#1-创造了一个Promise实例" class="headerlink" title="(1) 创造了一个Promise实例"></a>(1) 创造了一个Promise实例</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const promise = new Promise(function(resolve, reject) &#123;</span><br><span class="line">  // ... some code</span><br><span class="line"></span><br><span class="line">  if (/* 异步操作成功 */)&#123;</span><br><span class="line">    resolve(value);</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    reject(error);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h5 id="2-指定回调函数"><a href="#2-指定回调函数" class="headerlink" title="(2) 指定回调函数"></a>(2) 指定回调函数</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">promise.then(function(value) &#123;</span><br><span class="line">  // success</span><br><span class="line">&#125;, function(error) &#123;</span><br><span class="line">  // failure</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>then方法可以接受两个回调函数作为参数。</p>
<p>[1]第一个回调函数是Promise对象的状态变为resolved时调用，</p>
<p>[2]第二个回调函数是Promise对象的状态变为rejected时调用。</p>
<p>[3]其中，第二个函数是可选的，不一定要提供。这两个函数都接受Promise对象传出的值作为参数。</p>
<p>[4]Promise 新建后就会<strong>立即执行</strong>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Promise'</span>);</span><br><span class="line">  resolve();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">promise.then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'resolved.'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Hi!'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Promise</span></span><br><span class="line"><span class="comment">// Hi!</span></span><br><span class="line"><span class="comment">// resolved</span></span><br></pre></td></tr></table></figure>
<p>[5]调用resolve或reject并不会终结 Promise 的参数函数的执行。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  resolve(<span class="number">1</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">&#125;).then(<span class="function"><span class="params">r</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(r);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line"><span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
<p>上面代码中，调用resolve(1)以后，后面的console.log(2)还是会执行，并且会首先打印出来。这是因为立即 resolved 的 Promise 是在本轮事件循环的末尾执行，总是晚于本轮循环的同步任务。</p>
<p>一般来说，调用resolve或reject以后，Promise 的使命就完成了，后继操作应该放到then方法里面，而不应该直接写在resolve或reject的后面。所以，最好在它们前面加上return语句，这样就不会有意外。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> resolve(<span class="number">1</span>);</span><br><span class="line">  <span class="comment">// 后面的语句不会执行</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h5 id="3-promise嵌套"><a href="#3-promise嵌套" class="headerlink" title="(3) promise嵌套"></a>(3) promise嵌套</h5><p>果调用resolve函数和reject函数时带有参数，那么它们的参数会被传递给回调函数。reject函数的参数通常是Error对象的实例，表示抛出的错误；resolve函数的参数除了正常的值以外，还可能是另一个 Promise 实例，比如像下面这样。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  resolve(p1);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>这时p1的状态就会传递给p2，也就是说，p1的状态决定了p2的状态。如果p1的状态是pending，那么p2的回调函数就会等待p1的状态改变；如果p1的状态已经是resolved或者rejected，那么p2的回调函数将会立刻执行。</p>
<h4 id="2-api讲解"><a href="#2-api讲解" class="headerlink" title="2. api讲解"></a>2. api讲解</h4><h5 id="1-Promise-prototype-then"><a href="#1-Promise-prototype-then" class="headerlink" title="(1)Promise.prototype.then()"></a>(1)Promise.prototype.then()</h5><p>它的作用是为 Promise 实例添加状态改变时的回调函数。前面说过，then方法的第一个参数是resolved状态的回调函数，第二个参数（可选）是rejected状态的回调函数。</p>
<p>then方法返回的是一个新的Promise实例（注意，不是原来那个Promise实例）。因此可以采用链式写法，即then方法后面再调用另一个then方法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">getJSON(<span class="string">"/posts.json"</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params">json</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> json.post;</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">post</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h5 id="2-Promise-prototype-catch"><a href="#2-Promise-prototype-catch" class="headerlink" title="(2)Promise.prototype.catch()"></a>(2)Promise.prototype.catch()</h5><p>Promise.prototype.catch方法是.then(null, rejection)的别名，用于指定发生错误时的回调函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">getJSON(<span class="string">'/posts.json'</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params">posts</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 处理 getJSON 和 前一个回调函数运行时发生的错误</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'发生错误！'</span>, error);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>如果 Promise 状态已经变成resolved，再抛出错误是无效的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  resolve(<span class="string">'ok'</span>);</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'test'</span>);</span><br><span class="line">&#125;);</span><br><span class="line">promise</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123; <span class="built_in">console</span>.log(value) &#125;)</span><br><span class="line">  .catch(<span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123; <span class="built_in">console</span>.log(error) &#125;);</span><br><span class="line"><span class="comment">// ok</span></span><br></pre></td></tr></table></figure>
<h5 id="3-Promise-prototype-finally"><a href="#3-Promise-prototype-finally" class="headerlink" title="(3)Promise.prototype.finally()"></a>(3)Promise.prototype.finally()</h5><p>finally方法用于指定不管 Promise 对象最后状态如何，都会执行的操作。该方法是 ES2018 引入标准的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">promise</span><br><span class="line">.then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;···&#125;)</span><br><span class="line">.catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;···&#125;)</span><br><span class="line">.finally(<span class="function"><span class="params">()</span> =&gt;</span> &#123;···&#125;);</span><br></pre></td></tr></table></figure>
<p>上面代码中，不管promise最后的状态，在执行完then或catch指定的回调函数以后，都会执行finally方法指定的回调函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">promise</span><br><span class="line">.finally(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 语句</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line">promise</span><br><span class="line">.then(</span><br><span class="line">  result =&gt; &#123;</span><br><span class="line">    <span class="comment">// 语句</span></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;,</span><br><span class="line">  error =&gt; &#123;</span><br><span class="line">    <span class="comment">// 语句</span></span><br><span class="line">    <span class="keyword">throw</span> error;</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>实现：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.prototype.finally = <span class="function"><span class="keyword">function</span> (<span class="params">callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> P = <span class="keyword">this</span>.constructor;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.then(</span><br><span class="line">    value  =&gt; P.resolve(callback()).then(<span class="function"><span class="params">()</span> =&gt;</span> value),</span><br><span class="line">    reason =&gt; P.resolve(callback()).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="keyword">throw</span> reason &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>从上面的实现还可以看到，finally方法总是会返回原来的值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// resolve 的值是 undefined</span><br><span class="line">Promise.resolve(2).then(() =&gt; &#123;&#125;, () =&gt; &#123;&#125;)</span><br><span class="line"></span><br><span class="line">// resolve 的值是 2</span><br><span class="line">Promise.resolve(2).finally(() =&gt; &#123;&#125;)</span><br><span class="line"></span><br><span class="line">// reject 的值是 undefined</span><br><span class="line">Promise.reject(3).then(() =&gt; &#123;&#125;, () =&gt; &#123;&#125;)</span><br><span class="line"></span><br><span class="line">// reject 的值是 3</span><br><span class="line">Promise.reject(3).finally(() =&gt; &#123;&#125;)</span><br></pre></td></tr></table></figure>
<h5 id="4-Promise-all"><a href="#4-Promise-all" class="headerlink" title="(4)Promise.all()"></a>(4)Promise.all()</h5><p>Promise.all方法用于将多个 Promise 实例，包装成一个新的 Promise 实例。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p = <span class="built_in">Promise</span>.all([p1, p2, p3]);</span><br></pre></td></tr></table></figure>
<p>p1、p2、p3都是 Promise 实例，<strong>如果不是，就会先调用Promise.resolve方法</strong>，将参数转为 Promise 实例,再进一步处理。（Promise.all方法的参数可以不是数组，但必须具有 Iterator 接口，且返回的每个成员都是 Promise 实例。）</p>
<p>p的状态由p1、p2、p3决定，分成两种情况。</p>
<p>[1]只有p1、p2、p3的状态都变成fulfilled，p的状态才会变成fulfilled，此时p1、p2、p3的返回值组成一个数组，传递给p的回调函数。</p>
<p>[2]只要p1、p2、p3之中有一个被rejected，p的状态就变成rejected，此时第一个被reject的实例的返回值，会传递给p的回调函数。</p>
<h5 id="5-Promise-race"><a href="#5-Promise-race" class="headerlink" title="(5)Promise.race()"></a>(5)Promise.race()</h5><p>Promise.race方法同样是将多个 Promise 实例，包装成一个新的 Promise 实例。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p = <span class="built_in">Promise</span>.race([p1, p2, p3]);</span><br></pre></td></tr></table></figure>
<h5 id="6-Promise-resolve"><a href="#6-Promise-resolve" class="headerlink" title="(6)Promise.resolve();"></a>(6)Promise.resolve();</h5><p>Promise.resolve方法的参数分成四种情况。</p>
<p>[1]参数是一个 Promise 实例</p>
<p>如果参数是 Promise 实例，那么Promise.resolve将不做任何修改、原封不动地返回这个实例。</p>
<p>[2]参数是一个thenable对象</p>
<p>thenable对象指的是具有then方法的对象，比如下面这个对象。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let thenable = &#123;</span><br><span class="line">  then: function(resolve, reject) &#123;</span><br><span class="line">    resolve(42);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>Promise.resolve方法会将这个对象转为 Promise 对象，然后就立即执行thenable对象的then方法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> thenable = &#123;</span><br><span class="line">  then: <span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    resolve(<span class="number">42</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> p1 = <span class="built_in">Promise</span>.resolve(thenable);</span><br><span class="line">p1.then(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(value);  <span class="comment">// 42</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>[3]参数不是具有then方法的对象，或根本就不是对象</p>
<p>如果参数是一个原始值，或者是一个不具有then方法的对象，则Promise.resolve方法返回一个新的 Promise 对象，状态为resolved。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p = <span class="built_in">Promise</span>.resolve(<span class="string">'Hello'</span>);</span><br><span class="line"></span><br><span class="line">p.then(<span class="function"><span class="keyword">function</span> (<span class="params">s</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(s)</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// Hello</span></span><br></pre></td></tr></table></figure>
<p>上面代码生成一个新的 Promise 对象的实例p。由于字符串Hello不属于异步操作（判断方法是字符串对象不具有 then 方法），返回 Promise 实例的状态从一生成就是resolved，所以回调函数会立即执行。Promise.resolve方法的参数，会同时传给回调函数。</p>
<p>[4]不带有任何参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const p = Promise.resolve();</span><br><span class="line"></span><br><span class="line">p.then(function () &#123;</span><br><span class="line">  // ...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>上面代码的变量p就是一个 Promise 对象。</p>
<p>需要注意的是，立即resolve的 Promise 对象，是在本轮“事件循环”（event loop）的结束时，而不是在下一轮“事件循环”的开始时。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(function () &#123;</span><br><span class="line">  console.log(&apos;three&apos;);</span><br><span class="line">&#125;, 0);</span><br><span class="line"></span><br><span class="line">Promise.resolve().then(function () &#123;</span><br><span class="line">  console.log(&apos;two&apos;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">console.log(&apos;one&apos;);</span><br><span class="line"></span><br><span class="line">// one</span><br><span class="line">// two</span><br><span class="line">// three</span><br></pre></td></tr></table></figure>
<p>上面代码中，setTimeout(fn, 0)在下一轮“事件循环”开始时执行，Promise.resolve()在本轮“事件循环”结束时执行，console.log(‘one’)则是立即执行，因此最先输出。</p>
<h5 id="7-Promise-reject"><a href="#7-Promise-reject" class="headerlink" title="(7)Promise.reject()"></a>(7)Promise.reject()</h5><p>Promise.reject(reason)方法也会返回一个新的 Promise 实例，该实例的状态为rejected。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p = <span class="built_in">Promise</span>.reject(<span class="string">'出错了'</span>);</span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> reject(<span class="string">'出错了'</span>))</span><br><span class="line"></span><br><span class="line">p.then(<span class="literal">null</span>, <span class="function"><span class="keyword">function</span> (<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(s)</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 出错了</span></span><br></pre></td></tr></table></figure>
<p>上面代码生成一个 Promise 对象的实例p，状态为rejected，回调函数会立即执行。</p>
<p>注意，Promise.reject()方法的参数，会原封不动地作为reject的理由，变成后续方法的参数。这一点与Promise.resolve方法不一致。</p>
<h5 id="（8）Promise-try"><a href="#（8）Promise-try" class="headerlink" title="（8）Promise.try()"></a>（8）Promise.try()</h5><p>[1] 无法或不想区分，数f是同步函数还是异步操作</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.resolve().then(f)</span><br></pre></td></tr></table></figure>
<p>[2] 让同步函数同步执行，异步函数异步执行，并且让它们具有统一的 API</p>
<p>(1) async函数来写</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> f = <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'now'</span>);</span><br><span class="line">(<span class="keyword">async</span> () =&gt; f())();</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'next'</span>);</span><br><span class="line"><span class="comment">// now</span></span><br><span class="line"><span class="comment">// next</span></span><br></pre></td></tr></table></figure>
<p>上面代码中，第二行是一个立即执行的匿名函数，会立即执行里面的async函数，因此如果f是同步的，就会得到同步的结果；如果f是异步的，就可以用then指定下一步，就像下面的写法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(async () =&gt; f())()</span><br><span class="line">.then(...)</span><br></pre></td></tr></table></figure>
<p>需要注意的是，async () =&gt; f()会吃掉f()抛出的错误。所以，如果想捕获错误，要使用promise.catch方法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">async</span> () =&gt; f())()</span><br><span class="line">.then(...)</span><br><span class="line">.catch(...)</span><br></pre></td></tr></table></figure>
<p>(2) 第二种写法是使用new Promise()</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const f = () =&gt; console.log(&apos;now&apos;);</span><br><span class="line">(</span><br><span class="line">  () =&gt; new Promise(</span><br><span class="line">    resolve =&gt; resolve(f())</span><br><span class="line">  )</span><br><span class="line">)();</span><br><span class="line">console.log(&apos;next&apos;);</span><br><span class="line">// now</span><br><span class="line">// next</span><br></pre></td></tr></table></figure>
<p>上面代码也是使用立即执行的匿名函数，执行new Promise()。这种情况下，同步函数也是同步执行的。</p>
<p>(3) Promise.try</p>
<p>事实上，Promise.try存在已久，Promise 库Bluebird、Q和when，早就提供了这个方法。</p>
<p>由于Promise.try为所有操作提供了统一的处理机制，所以如果想用then方法管理流程，最好都用Promise.try包装一下。这样有许多好处，其中一点就是可以更好地管理异常。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  database.users.get(&#123;<span class="attr">id</span>: userId&#125;)</span><br><span class="line">  .then(...)</span><br><span class="line">  .catch(...)</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面这样的写法就很笨拙了，这时就可以统一用promise.catch()捕获所有同步和异步的错误。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.try(database.users.get(&#123;<span class="attr">id</span>: userId&#125;))</span><br><span class="line">  .then(...)</span><br><span class="line">  .catch(...)</span><br></pre></td></tr></table></figure>
<p>事实上，Promise.try就是模拟try代码块，就像promise.catch模拟的是catch代码块。</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://www.neohuang.com/child/2018/06/10/promise-1/" data-id="cjlm3caot000cdqm7rm75o08w" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            <!--
    
        <a href="http://www.neohuang.com/child/2018/06/10/promise-1/#comments" class="article-comment-link">Comments</a>
    
-->
        </footer>
    </div>
    
</article>



    <article id="post-week-question-1" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2018/06/04/week-question-1/">6月第一周趣问</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2018/06/04/week-question-1/">
            <time datetime="2018-06-03T16:00:00.000Z" itemprop="datePublished">2018-06-04</time>
        </a>
    </div>


                        
                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p><img src="/img/github-ms.jpeg" alt=""></p>
<p>这周开始想不定期更新一个新板块，就是把平时开发或者听到的有趣的面试题汇总起来，这周听到组里一前端同事面试中遇到了几个有趣的问题先行更新下：</p>
<h3 id="1-div居中，内部文字左对齐"><a href="#1-div居中，内部文字左对齐" class="headerlink" title="1.div居中，内部文字左对齐"></a>1.div居中，内部文字左对齐</h3><p>光看标题无法理解这题目的意思，详细描述一下的该题：</p>
<p>一个div容器，里面的字体少了居中，多了的话够一行的沾满一行，剩下的靠左，以下是图示：</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">|  xxx  |</span><br><span class="line">和</span><br><span class="line">|xxxxxxxx|</span><br><span class="line">|xxx         |</span><br></pre></td></tr></table></figure>
<p>主要思路其实就是2个容器，子容器设置为inline-block，并且内容居左，父容器居中，以下是代码实现：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.container &#123;</span><br><span class="line">     text-align: center;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">.text &#123;</span><br><span class="line">    display: inline-block;</span><br><span class="line">    text-align: left;</span><br><span class="line">    word-<span class="keyword">break</span>: <span class="keyword">break</span>-all;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-普通函数和剪头函数的区别"><a href="#2-普通函数和剪头函数的区别" class="headerlink" title="2.普通函数和剪头函数的区别"></a>2.普通函数和剪头函数的区别</h3><h4 id="1-函数体内的this对象，就是定义时所在的对象，而不是使用时所在的对象。"><a href="#1-函数体内的this对象，就是定义时所在的对象，而不是使用时所在的对象。" class="headerlink" title="(1)函数体内的this对象，就是定义时所在的对象，而不是使用时所在的对象。"></a>(1)函数体内的this对象，就是定义时所在的对象，而不是使用时所在的对象。</h4><p>普通函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>); <span class="comment">// foo</span></span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>); <span class="comment">// window</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'id:'</span>, <span class="keyword">this</span>.id); <span class="comment">// 21</span></span><br><span class="line">  &#125;, <span class="number">100</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> id = <span class="number">21</span>;</span><br><span class="line"></span><br><span class="line">foo2.call(&#123; <span class="attr">id</span>: <span class="number">42</span> &#125;);</span><br></pre></td></tr></table></figure>
<p>箭头函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>); <span class="comment">// foo</span></span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>); <span class="comment">// foo</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'id:'</span>, <span class="keyword">this</span>.id); <span class="comment">// 42</span></span><br><span class="line">  &#125;, <span class="number">100</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> id = <span class="number">21</span>;</span><br><span class="line"></span><br><span class="line">foo1.call(&#123; <span class="attr">id</span>: <span class="number">42</span> &#125;);</span><br></pre></td></tr></table></figure>
<h4 id="2-箭头函数不会创建自己的this-而是默认绑定函数的宿主对象（或者绑定函数的对象）"><a href="#2-箭头函数不会创建自己的this-而是默认绑定函数的宿主对象（或者绑定函数的对象）" class="headerlink" title="(2)箭头函数不会创建自己的this,而是默认绑定函数的宿主对象（或者绑定函数的对象）"></a>(2)箭头函数不会创建自己的this,而是默认绑定函数的宿主对象（或者绑定函数的对象）</h4><p>箭头函数里面根本没有自己的this，而是引用外层的this</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'id:'</span>, <span class="keyword">this</span>.id);</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> f = foo.call(&#123;<span class="attr">id</span>: <span class="number">1</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> t1 = f.call(&#123;<span class="attr">id</span>: <span class="number">2</span>&#125;)()(); <span class="comment">// id: 1</span></span><br><span class="line"><span class="keyword">var</span> t2 = f().call(&#123;<span class="attr">id</span>: <span class="number">3</span>&#125;)(); <span class="comment">// id: 1</span></span><br><span class="line"><span class="keyword">var</span> t3 = f()().call(&#123;<span class="attr">id</span>: <span class="number">4</span>&#125;); <span class="comment">// id: 1</span></span><br></pre></td></tr></table></figure>
<p>上面代码之中，只有一个this，就是函数foo的this，所以t1、t2、t3都输出同样的结果。因为所有的内层函数都是箭头函数，都没有自己的this，它们的this其实都是最外层foo函数的this。</p>
<h4 id="3-如果有对象嵌套的情况，则this绑定到最近的一层对象上"><a href="#3-如果有对象嵌套的情况，则this绑定到最近的一层对象上" class="headerlink" title="(3)如果有对象嵌套的情况，则this绑定到最近的一层对象上"></a>(3)如果有对象嵌套的情况，则this绑定到最近的一层对象上</h4><h4 id="4-不可以当作构造函数，也就是说，不可以使用new命令，否则会抛出一个错误。"><a href="#4-不可以当作构造函数，也就是说，不可以使用new命令，否则会抛出一个错误。" class="headerlink" title="(4)不可以当作构造函数，也就是说，不可以使用new命令，否则会抛出一个错误。"></a>(4)不可以当作构造函数，也就是说，不可以使用new命令，否则会抛出一个错误。</h4><h4 id="5-不可以使用arguments对象，该对象在函数体内不存在。如果要用，可以用-rest-参数代替。"><a href="#5-不可以使用arguments对象，该对象在函数体内不存在。如果要用，可以用-rest-参数代替。" class="headerlink" title="(5)不可以使用arguments对象，该对象在函数体内不存在。如果要用，可以用 rest 参数代替。"></a>(5)不可以使用arguments对象，该对象在函数体内不存在。如果要用，可以用 rest 参数代替。</h4><h4 id="6-不可以使用yield命令，因此箭头函数不能用作-Generator-函数。"><a href="#6-不可以使用yield命令，因此箭头函数不能用作-Generator-函数。" class="headerlink" title="(6)不可以使用yield命令，因此箭头函数不能用作 Generator 函数。"></a>(6)不可以使用yield命令，因此箭头函数不能用作 Generator 函数。</h4><h4 id="7-除了this，以下三个变量在箭头函数之中也是不存在的，指向外层函数的对应变量：arguments、super、new-target"><a href="#7-除了this，以下三个变量在箭头函数之中也是不存在的，指向外层函数的对应变量：arguments、super、new-target" class="headerlink" title="(7)除了this，以下三个变量在箭头函数之中也是不存在的，指向外层函数的对应变量：arguments、super、new.target"></a>(7)除了this，以下三个变量在箭头函数之中也是不存在的，指向外层函数的对应变量：arguments、super、new.target</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'args:'</span>, <span class="built_in">arguments</span>);</span><br><span class="line">  &#125;, <span class="number">100</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo(<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>)</span><br><span class="line"><span class="comment">// args: [2, 4, 6, 8]</span></span><br></pre></td></tr></table></figure>
<p>上面代码中，箭头函数内部的变量arguments，其实是函数foo的arguments变量。</p>
<h4 id="8-无法使用bind、call、apply改变指向"><a href="#8-无法使用bind、call、apply改变指向" class="headerlink" title="(8) 无法使用bind、call、apply改变指向"></a>(8) 无法使用bind、call、apply改变指向</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> [</span><br><span class="line">    (<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">this</span>.x).bind(&#123; <span class="attr">x</span>: <span class="string">'inner'</span> &#125;)()</span><br><span class="line">  ];</span><br><span class="line">&#125;).call(&#123; <span class="attr">x</span>: <span class="string">'outer'</span> &#125;);</span><br><span class="line"><span class="comment">// ['outer']</span></span><br></pre></td></tr></table></figure>
<h3 id="3-尾递归"><a href="#3-尾递归" class="headerlink" title="3.尾递归"></a>3.尾递归</h3><p>这个我准备写一个单独的文章：</p>
<p><a href="">白话讲解尾递归</a></p>
<h3 id="4-react组件多继承"><a href="#4-react组件多继承" class="headerlink" title="4.react组件多继承"></a>4.react组件多继承</h3><h4 id="1-Mixins"><a href="#1-Mixins" class="headerlink" title="(1)Mixins"></a>(1)Mixins</h4><h4 id="2-HOC"><a href="#2-HOC" class="headerlink" title="(2)HOC"></a>(2)HOC</h4><h3 id="5-git-revert"><a href="#5-git-revert" class="headerlink" title="5.git revert"></a>5.git revert</h3><h4 id="（1）revert-详解"><a href="#（1）revert-详解" class="headerlink" title="（1）revert 详解"></a>（1）revert 详解</h4><p>git revert 撤销 某次操作，此次操作之前和之后的commit和history都会保留，并且把这次撤销<br>作为一次最新的提交。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git revert HEAD                <span class="comment"># 撤销前一次 commit</span></span><br><span class="line">git revert HEAD^               <span class="comment"># 	撤销前前一次 commit</span></span><br><span class="line">git revert commit （比如：bca867bcbae6e1942ef89423506777fb337fb651）<span class="comment"># 撤销指定的版本，撤销也会作为一次提交进行保存。</span></span><br></pre></td></tr></table></figure>
<p>git revert是提交一个新的版本，将需要revert的版本的内容再反向修改回去，<br>版本会递增，不影响之前提交的内容</p>
<hr>
<h4 id="（2）git-revert-和-git-reset的区别"><a href="#（2）git-revert-和-git-reset的区别" class="headerlink" title="（2）git revert 和 git reset的区别"></a>（2）git revert 和 git reset的区别</h4><p>[1] git revert是用一次新的commit来回滚之前的commit，git reset是直接删除指定的commit。</p>
<p>[2] 在回滚这一操作上看，效果差不多。但是在日后继续merge以前的老版本时有区别。因为git revert是用一次逆向的commit“中和”之前的提交，因此日后合并老的branch时，导致这部分改变不会再次出现，但是git reset是之间把某些commit在某个branch上删除，因而和老的branch再次merge时，这些被回滚的commit应该还会被引入。 </p>
<p>[3] git reset 是把HEAD向后移动了一下，而git revert是HEAD继续前进，只是新的commit的内容和要revert的内容正好相反，能够抵消要被revert的内容。</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://www.neohuang.com/child/2018/06/04/week-question-1/" data-id="cjlm3caox000hdqm7tn9wcsbb" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            <!--
    
        <a href="http://www.neohuang.com/child/2018/06/04/week-question-1/#comments" class="article-comment-link">Comments</a>
    
-->
        </footer>
    </div>
    
</article>



    <article id="post-subscribe" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2018/05/28/subscribe/">结合代码白话理解javascript中的观察者模式与发布订阅</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2018/05/28/subscribe/">
            <time datetime="2018-05-27T16:00:00.000Z" itemprop="datePublished">2018-05-28</time>
        </a>
    </div>


                        
                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <ul>
<li><p>参考：<a href="https://zh.wikipedia.org/wiki/%E5%8F%91%E5%B8%83/%E8%AE%A2%E9%98%85" target="_blank" rel="noopener">https://zh.wikipedia.org/wiki/%E5%8F%91%E5%B8%83/%E8%AE%A2%E9%98%85</a></p>
</li>
<li><p>参考：<a href="https://www.zhihu.com/question/23486749" target="_blank" rel="noopener">https://www.zhihu.com/question/23486749</a> - No zuo must die - 知乎用户的回答 - 知乎</p>
</li>
<li><p>参考：<a href="https://juejin.im/post/5a14e9edf265da4312808d86#comment" target="_blank" rel="noopener">https://juejin.im/post/5a14e9edf265da4312808d86#comment</a></p>
</li>
</ul>
<h3 id="1-概念解释："><a href="#1-概念解释：" class="headerlink" title="1 概念解释："></a>1 概念解释：</h3><h4 id="（1）观察者设计模式"><a href="#（1）观察者设计模式" class="headerlink" title="（1）观察者设计模式"></a>（1）观察者设计模式</h4><h5 id="标准解释："><a href="#标准解释：" class="headerlink" title="标准解释："></a>标准解释：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">观察者模式： 是一种设计模式，在软件设计中往往是一个对象，维护一个依赖列表，当任何状态发生改变自动通知它们。</span><br></pre></td></tr></table></figure>
<p>来源：维基百科</p>
<h5 id="图示："><a href="#图示：" class="headerlink" title="图示："></a>图示：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">╭─────────────╮  Fire Event  ╭──────────────╮</span><br><span class="line">│             │─────────────&gt;│              │</span><br><span class="line">│   Subject   │              │   Observer   │</span><br><span class="line">│             │&lt;─────────────│              │</span><br><span class="line">╰─────────────╯  Subscribe   ╰──────────────╯</span><br></pre></td></tr></table></figure>
<h5 id="白话讲解："><a href="#白话讲解：" class="headerlink" title="白话讲解："></a>白话讲解：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">假设你想去xx公司应聘前端工程师，但xx公司hr告知你目前没有岗位空缺，你向留下了联系方式，让其在有岗位空缺时，通知你。当然公司还会通知同样已留下联系方式的其他候选者。</span><br><span class="line"></span><br><span class="line">Observers（观察者）: 候选人</span><br><span class="line"></span><br><span class="line">Subject（被观察者）： xx公司</span><br><span class="line"></span><br><span class="line">Fire Event (事件)： xx公司有了新前端空缺</span><br><span class="line"></span><br><span class="line">Subscribe（订阅）： 候选人将联系方式留给了xx公司</span><br><span class="line"></span><br><span class="line">Notify (通知) ： xx公司向候选人致电</span><br><span class="line"></span><br><span class="line">观察者模式运行流程：</span><br><span class="line"></span><br><span class="line">Observers -&gt; Subscribe -&gt; Subject -&gt; Fire Event -&gt; Notify -&gt; Observers</span><br></pre></td></tr></table></figure>
<h4 id="（2）发布订阅模式"><a href="#（2）发布订阅模式" class="headerlink" title="（2）发布订阅模式"></a>（2）发布订阅模式</h4><h5 id="标准解释：-1"><a href="#标准解释：-1" class="headerlink" title="标准解释："></a>标准解释：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">发布订阅模式属于广义上的观察者模式，发布-订阅是一种消息范式，消息的发送者（称为发布者）不会将消息直接发送给特定的接收者（称为订阅者）。而是将发布的消息分为不同的类别，无需了解哪些订阅者（如果有的话）可能存在。同样的，订阅者可以表达对一个或多个类别的兴趣，只接收感兴趣的消息，无需了解哪些发布者（如果有的话）存在。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">发布订阅模式是最常用的一种观察者模式的实现，并且从解耦和重用角度来看，更优于典型的观察者模式</span><br></pre></td></tr></table></figure>
<p>来源：维基百科</p>
<h5 id="图示：-1"><a href="#图示：-1" class="headerlink" title="图示："></a>图示：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">╭─────────────╮                 ╭───────────────╮   Fire Event   ╭──────────────╮</span><br><span class="line">│             │  Publish Event  │               │───────────────&gt;│              │</span><br><span class="line">│  Publisher  │────────────────&gt;│ Event Channel │                │  Subscriber  │</span><br><span class="line">│             │                 │               │&lt;───────────────│              │</span><br><span class="line">╰─────────────╯                 ╰───────────────╯    Subscribe   ╰──────────────╯</span><br></pre></td></tr></table></figure>
<h5 id="白话讲解：-1"><a href="#白话讲解：-1" class="headerlink" title="白话讲解："></a>白话讲解：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">- 你想成为一个前端工程师，但目前没有明确目标，你可以联系了猎头让其有前端相关岗位时通知你。</span><br><span class="line"></span><br><span class="line">- 猎头可能与多家公司都有合作，这些公司发布职位会告知猎头</span><br><span class="line"></span><br><span class="line">- 这个过程xx公司，只需要根据自身情况，只需要根据自己实际的岗位情况，告知猎头自己需要什么岗位的候选人，无需知道有哪些具体候选人，候选人在订阅过程中，只是向猎头公司订阅了有前端相关岗位时通知自己</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Publisher（发布者）: xx公司</span><br><span class="line"></span><br><span class="line">Publish Event（发布事件）： 发布职位</span><br><span class="line"></span><br><span class="line">Event Channel (事件通道)： 猎头公司</span><br><span class="line"></span><br><span class="line">Fire Event（事件）： xx公司发布职位后，猎头公司根据职位发送联系相应岗位候选人</span><br><span class="line"></span><br><span class="line">Subscriber（订阅者)： 候选人</span><br><span class="line"></span><br><span class="line">Subscribe（订阅）： 候选人将联系方式留给hr</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">运行流程：</span><br><span class="line"></span><br><span class="line">Subscriber -&gt; Subscribe -&gt; Event Channel</span><br><span class="line"></span><br><span class="line">Publisher -&gt; Publish Event -&gt; Event Channel -&gt; Fire Event -&gt; Subscriber</span><br></pre></td></tr></table></figure>
<h3 id="2-观察者模式和发布订阅模式有什么不同："><a href="#2-观察者模式和发布订阅模式有什么不同：" class="headerlink" title="2 观察者模式和发布订阅模式有什么不同："></a>2 观察者模式和发布订阅模式有什么不同：</h3><p>发布订阅模式属于广义上的观察者模式。发布订阅模式是最常用的一种观察者模式的实现，并且从解耦和重用角度来看，更优于典型的观察者模式。</p>
<p>区别：</p>
<ul>
<li>发布订阅模式多了个事件通道</li>
</ul>
<p>在观察者模式中，观察者需要直接订阅目标事件；在目标发出内容改变的事件后，直接接收事件并作出响应</p>
<ul>
<li>在发布订阅模式中，发布者和订阅者之间多了一个发布通道；一方面从发布者接收事件，另一方面向订阅者发布事件；订阅者需要从事件通道订阅事件</li>
</ul>
<p>以此避免发布者和订阅者之间产生依赖关系。</p>
<h3 id="3-观察者模式代码实现"><a href="#3-观察者模式代码实现" class="headerlink" title="3. 观察者模式代码实现"></a>3. 观察者模式代码实现</h3><p>使用观察者模式的好处：</p>
<ul>
<li>支持简单的广播通信，自动通知所有已经订阅过的对象。</li>
<li>页面载入后目标对象很容易与观察者存在一种动态关联，增加了灵活性。</li>
<li>目标对象与观察者之间的抽象耦合关系能够单独扩展以及重用。</li>
</ul>
<p>最简单观察者模式在js中的运用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.body.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'body 被观察'</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>观察者模式实现数据打包下载功能:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 观察者模式 实现下载任务</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 观察者</span></span><br><span class="line"><span class="comment"> * @param id</span></span><br><span class="line"><span class="comment"> * @constructor</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">DownloadTask</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.id = id;</span><br><span class="line">  <span class="keyword">this</span>.loaded = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">this</span>.url = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DownloadTask.prototype.finish = <span class="function"><span class="keyword">function</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.loaded = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">this</span>.url = url;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Task '</span> + <span class="keyword">this</span>.id + <span class="string">' load data from '</span> + url);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 被观察者</span></span><br><span class="line"><span class="comment"> * @constructor</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">DataHub</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.downloadTasks = []; <span class="comment">// 观察者列表</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DataHub.prototype.addDownloadTask = <span class="function"><span class="keyword">function</span>(<span class="params">downloadTask</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.downloadTasks.push(downloadTask);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">DataHub.prototype.removeDownloadTask = <span class="function"><span class="keyword">function</span>(<span class="params">downloadTask</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.downloadTasks.filter(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (item === downloadTask) &#123;</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// this.downloadTasks.remove(downloadTask);</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">DataHub.prototype.notify = <span class="function"><span class="keyword">function</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> downloadTaskCount = <span class="keyword">this</span>.downloadTasks.length;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; downloadTaskCount; i++) &#123;</span><br><span class="line">    <span class="keyword">this</span>.downloadTasks[i].finish(url);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> d = <span class="keyword">new</span> DataHub();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> task1 = <span class="keyword">new</span> DownloadTask(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">var</span> task2 = <span class="keyword">new</span> DownloadTask(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">d.addDownloadTask(task1);</span><br><span class="line">d.addDownloadTask(task2);</span><br><span class="line"></span><br><span class="line">d.removeDownloadTask(task1);</span><br><span class="line"></span><br><span class="line">d.notify(<span class="string">'http://somedomain.someaddress'</span>);</span><br></pre></td></tr></table></figure>
<h3 id="4-发布订阅代码实现"><a href="#4-发布订阅代码实现" class="headerlink" title="4. 发布订阅代码实现"></a>4. 发布订阅代码实现</h3><ul>
<li>发布订阅模式属于广义上的观察者模式</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">发布订阅模式是最常用的一种观察者模式的实现，并且从解耦和重用角度来看，更优于典型的观察者模式</span><br></pre></td></tr></table></figure>
<ul>
<li>发布订阅模式多了个事件通道</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在观察者模式中，观察者需要直接订阅目标事件；在目标发出内容改变的事件后，直接接收事件并作出响应</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 发布者</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Observer</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.fnList = []; <span class="comment">// 订阅者列表</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Observer.prototype = &#123;</span><br><span class="line">  subscribe: <span class="function"><span class="keyword">function</span> (<span class="params">fn</span>) </span>&#123; <span class="comment">// 增加订阅者</span></span><br><span class="line">    <span class="keyword">this</span>.fnList.push(fn);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  unsubscribe: <span class="function"><span class="keyword">function</span> (<span class="params">fn</span>) </span>&#123; <span class="comment">// 移除订阅者</span></span><br><span class="line">    <span class="keyword">this</span>.fnList = <span class="keyword">this</span>.fnList.filter(<span class="function"><span class="keyword">function</span> (<span class="params">el</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (el !== fn)&#123;</span><br><span class="line">        <span class="keyword">return</span> el;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  notify: <span class="function"><span class="keyword">function</span> (<span class="params">p, thisObj</span>) </span>&#123; <span class="comment">//发布消息函数</span></span><br><span class="line">    <span class="keyword">var</span> scope = thisObj || <span class="built_in">window</span>;</span><br><span class="line">    <span class="keyword">this</span>.fnList.forEach(</span><br><span class="line">        <span class="function"><span class="keyword">function</span> (<span class="params">el</span>) </span>&#123;</span><br><span class="line">          el.call(scope, o);</span><br><span class="line">        &#125;</span><br><span class="line">    );</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.fnList);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> o = <span class="keyword">new</span> Observer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> f1 = <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Robbin: '</span> + data + <span class="string">', 赶紧干活了！'</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> f2 = <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Randall: '</span> + data + <span class="string">', 找他加点工资去！'</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">o.subscribe(f1);</span><br><span class="line">o.subscribe(f2);</span><br><span class="line"></span><br><span class="line">o.notify(<span class="string">"Tom回来了！"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//退订f1</span></span><br><span class="line">o.unsubscribe(f1);</span><br><span class="line"><span class="comment">//再来验证</span></span><br><span class="line">o.notify(<span class="string">"Tom回来了！"</span>);</span><br></pre></td></tr></table></figure>
<p>发布定远模式实现数据打包下载功能:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 发布者</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">DataHub</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">DataHub.prototype.notify = <span class="function"><span class="keyword">function</span>(<span class="params">url, callback</span>) </span>&#123;</span><br><span class="line">  callback(url);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 事件通道</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">DownloadManager</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.events = &#123;&#125;;</span><br><span class="line">  <span class="keyword">this</span>.uId = <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DownloadManager.prototype.publish = <span class="function"><span class="keyword">function</span>(<span class="params">eventType, url</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">this</span>.events[eventType]) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> subscribers = <span class="keyword">this</span>.events[eventType],</span><br><span class="line">    count = subscribers ? subscribers.length : <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (count--) &#123;</span><br><span class="line">    <span class="keyword">var</span> subscriber = subscribers[count];</span><br><span class="line">    subscriber.handler(eventType, subscriber.taskId, url);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DownloadManager.prototype.subscribe = <span class="function"><span class="keyword">function</span>(<span class="params">eventType, handler</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">this</span>.events[eventType]) &#123;</span><br><span class="line">    <span class="keyword">this</span>.events[eventType] = [];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> taskId = (++<span class="keyword">this</span>.uId).toString();</span><br><span class="line">  <span class="keyword">this</span>.events[eventType].push(&#123;</span><br><span class="line">    taskId: taskId,</span><br><span class="line">    handler: handler</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> taskId;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个数据中心</span></span><br><span class="line"><span class="keyword">var</span> dataHub = <span class="keyword">new</span> DataHub();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个下载事件管理器</span></span><br><span class="line"><span class="keyword">var</span> downloadManager = <span class="keyword">new</span> DownloadManager();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个下载器</span></span><br><span class="line"><span class="keyword">var</span> dataLoader = <span class="function"><span class="keyword">function</span>(<span class="params">eventType, taskId, url</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Task '</span> + taskId + <span class="string">' load data from '</span> + url);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用户来请求数据了</span></span><br><span class="line"><span class="keyword">var</span> downloadTask1 = downloadManager.subscribe(<span class="string">'dataReady'</span>, dataLoader);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数据打包完成了</span></span><br><span class="line"></span><br><span class="line">dataHub.notify(<span class="string">'http://somedomain.someaddress'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">url</span>)</span>&#123;</span><br><span class="line">  downloadManager.publish(<span class="string">'dataReady'</span>, url);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://www.neohuang.com/child/2018/05/28/subscribe/" data-id="cjlm3caow000gdqm79fvxbyx7" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            <!--
    
        <a href="http://www.neohuang.com/child/2018/05/28/subscribe/#comments" class="article-comment-link">Comments</a>
    
-->
        </footer>
    </div>
    
</article>



    <article id="post-js-review-script" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2018/05/04/js-review-script/">js复习之基础概念以及script</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2018/05/04/js-review-script/">
            <time datetime="2018-05-03T16:00:00.000Z" itemprop="datePublished">2018-05-04</time>
        </a>
    </div>


                        
                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p><img src="/img/js-reivew-script.png" alt=""></p>
<h1 id="一、js复习之前置概念"><a href="#一、js复习之前置概念" class="headerlink" title="一、js复习之前置概念"></a>一、js复习之前置概念</h1><h2 id="1-js历史及以前名词"><a href="#1-js历史及以前名词" class="headerlink" title="1.js历史及以前名词"></a>1.js历史及以前名词</h2><ul>
<li><p>ECMA(European Computer Manufactures Associatio)</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">欧洲计算机制造联合会</span><br></pre></td></tr></table></figure>
</li>
<li><p>TC39（Technical Committee #39）</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ECMA指派负责“标准化一种通用、跨平台、供应商中立的脚本语言的语法和语意”的39号技术委员会</span><br></pre></td></tr></table></figure>
</li>
<li><p>ECMA-262</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">基于以javascript1.1为蓝本的新脚本语言标准</span><br></pre></td></tr></table></figure>
</li>
<li><p>ECMAScript</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">由ECMA-262标准定义的脚本语言（通常都被人们用来表达相同的含义）</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="2-js实现"><a href="#2-js实现" class="headerlink" title="2.js实现"></a>2.js实现</h2><p>虽然JavasScript和ECMAScript都用来表达相同含义，但一个完整的浏览器端js应实现3个不同的部分</p>
<ul>
<li>核心（ECMAScript）</li>
<li>文档对象模型（DOM）</li>
<li>浏览器对象模型 （BOM）</li>
</ul>
<h3 id="1-ECMAScript"><a href="#1-ECMAScript" class="headerlink" title="(1) ECMAScript"></a>(1) ECMAScript</h3><h4 id="1-ECMAScript环境"><a href="#1-ECMAScript环境" class="headerlink" title="[1] ECMAScript环境"></a>[1] ECMAScript环境</h4><ul>
<li>Web浏览器只是ECMAScript实现可能的宿主环境之一，宿主环境不仅提供基本的ECMA实现，同时也提供该语言的扩展，以便语言和环境对接交互。</li>
<li>其他宿主环境包括Node和Adobe Flash</li>
<li>ECMAScript就是对实现该标准规定的各方面内容的语言环境 。JavaScript实现了ECMAScript， Adobe ActionScript也实现了ECMAScript。 </li>
</ul>
<h4 id="2-ECMAScript的实现"><a href="#2-ECMAScript的实现" class="headerlink" title="[2] ECMAScript的实现"></a>[2] ECMAScript的实现</h4><p>根据EMCA-262对ECMAScript兼容的定义，想要成为ECMAScript的实现，则该实现必须做到：</p>
<p>（1）支持ECMA262描述的所有类型、值、对象、属性、函数以及程序句法、语义</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">包括：语法、类型、语句、关键字、保留字、操作符、对象</span><br></pre></td></tr></table></figure>
<p>（2）全面支持Unicode字符标准</p>
<h4 id="3-ECMAScript兼容"><a href="#3-ECMAScript兼容" class="headerlink" title="[3] ECMAScript兼容"></a>[3] ECMAScript兼容</h4><p>此外，兼容实现还可以进行下列扩展。</p>
<p>（1）添加ECMA-262没有描述的“更多类型、值、对象、属性和函数”。ECMA-262所说的这些新增特性，主要是指标该标准没有规定的新对象和对象的新属性</p>
<p>（2）支持ECMA-262定义的“程序和正则表达式语法”。（也就是说，可以修改和扩展正则表达式语法）</p>
<h4 id="4-ECMAScript的版本"><a href="#4-ECMAScript的版本" class="headerlink" title="[4] ECMAScript的版本"></a>[4] ECMAScript的版本</h4><h5 id="1-ECMAScript-262"><a href="#1-ECMAScript-262" class="headerlink" title="(1) ECMAScript 262"></a>(1) ECMAScript 262</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1997年，基于javascript 1.1</span><br></pre></td></tr></table></figure>
<h5 id="2-ECMAScript-2"><a href="#2-ECMAScript-2" class="headerlink" title="(2) ECMAScript 2"></a>(2) ECMAScript 2</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1998年，基于javascript 1.1和</span><br></pre></td></tr></table></figure>
<h5 id="3-ECMAScript-3"><a href="#3-ECMAScript-3" class="headerlink" title="(3) ECMAScript 3"></a>(3) ECMAScript 3</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1999年</span><br></pre></td></tr></table></figure>
<h5 id="4-ECMAScript-4-（未完成）"><a href="#4-ECMAScript-4-（未完成）" class="headerlink" title="(4) ECMAScript 4 （未完成）"></a>(4) ECMAScript 4 （未完成）</h5><h5 id="5-ECMAScript-5-1-或仅-ES5-目前主流浏览器大多支持这个标准"><a href="#5-ECMAScript-5-1-或仅-ES5-目前主流浏览器大多支持这个标准" class="headerlink" title="(5) ECMAScript 5.1 (或仅 ES5)  (目前主流浏览器大多支持这个标准)"></a>(5) ECMAScript 5.1 (或仅 ES5)  (目前主流浏览器大多支持这个标准)</h5><h5 id="7-ECMAScript-6-es2015"><a href="#7-ECMAScript-6-es2015" class="headerlink" title="(7) ECMAScript 6 es2015"></a>(7) ECMAScript 6 es2015</h5><p>新增特性</p>
<ul>
<li>let const</li>
<li>Symbol</li>
<li>Set Map</li>
<li>Iterator for…of</li>
<li>class</li>
<li>箭头函数</li>
<li>extend</li>
<li>promise</li>
<li>decorator</li>
<li>Module</li>
</ul>
<h5 id="8-ECMAScript-7-有种说法是es6-1-es2016"><a href="#8-ECMAScript-7-有种说法是es6-1-es2016" class="headerlink" title="(8) ECMAScript 7(有种说法是es6.1) es2016"></a>(8) ECMAScript 7(有种说法是es6.1) es2016</h5><ul>
<li>Array.prototype.includes</li>
<li>Exponentiation Operator<br>只新增了数组实例的includes方法和指数运算符</li>
</ul>
<h5 id="9-ECMAScript-8-es2017"><a href="#9-ECMAScript-8-es2017" class="headerlink" title="(9) ECMAScript 8 es2017"></a>(9) ECMAScript 8 es2017</h5><ul>
<li>Object.values()</li>
<li>Object.entries()</li>
<li>padStart()</li>
<li>padEnd()</li>
<li>Object.getOwnPropertyDescriptors()</li>
<li>函数参数列表结尾允许逗号</li>
<li>Async/Await</li>
</ul>
<p>文档说(es8 es2017 实验阶段)</p>
<ul>
<li>property initializers</li>
</ul>
<h5 id="9-ECMAScript-9-es2018"><a href="#9-ECMAScript-9-es2018" class="headerlink" title="(9) ECMAScript 9 es2018"></a>(9) ECMAScript 9 es2018</h5><ul>
<li><p>可观察性(Observables)，响应式架构的关键 (Dojo 2 的 可观察特性)</p>
</li>
<li><p>全局性，一种用来一致地引用全局对象的标准 (Dojo 2 中的全局特性)</p>
</li>
<li><p>trimStart/trimEnd, 类似于 padStart/padEnd (估计是批量空格填充什么的，回看特性2，译者注)</p>
</li>
<li><p>import, 一种 ES 模块标准中没有的动态 import 机制</p>
</li>
<li><p>类和属性装饰器 (已经在 TypeScript 中实现)</p>
</li>
<li><p>异步迭代 (Asynchronous iteration)</p>
</li>
<li><p>单指令多数据 (SIMD，Single Instruction Multiple Data), 它能够使得渲染和使用像 WebGL, Canvas 之类的动画加速</p>
</li>
</ul>
<h4 id="5-浏览器对ECMAScript支持情况"><a href="#5-浏览器对ECMAScript支持情况" class="headerlink" title="[5] 浏览器对ECMAScript支持情况"></a>[5] 浏览器对ECMAScript支持情况</h4><ul>
<li>ECMAScript 3</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chrome 1+ Firefox 3.0x Sarfari3.x Opera7.2+ ie7 Netscap 6</span><br></pre></td></tr></table></figure>
<ul>
<li>ECMAScript 5</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IE8部分支持 IE9支持 Firefox4.0+</span><br></pre></td></tr></table></figure>
<ul>
<li>ECMAScript 6</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">支持情况可查询：http://kangax.github.io/compat-table/es6/</span><br></pre></td></tr></table></figure>
<h4 id="6-ECMAScript更新流程"><a href="#6-ECMAScript更新流程" class="headerlink" title="[6] ECMAScript更新流程"></a>[6] ECMAScript更新流程</h4><p>任何人都可以向标准委员会（又称 TC39 委员会）提案，要求修改语言标准。</p>
<p>一种新的语法从提案到变成正式标准，需要经历五个阶段。每个阶段的变动都需要由 TC39 委员会批准。</p>
<ul>
<li>Stage 0 - Strawman（展示阶段）</li>
<li>Stage 1 - Proposal（征求意见阶段）</li>
<li>Stage 2 - Draft（草案阶段）</li>
<li>Stage 3 - Candidate（候选人阶段）</li>
<li>Stage 4 - Finished（定案阶段）</li>
</ul>
<p>一个提案只要能进入 Stage 2，就差不多肯定会包括在以后的正式标准里面。ECMAScript 当前的所有提案，可以在 TC39 的官方网站Github.com/tc39/ecma262查看。</p>
<h3 id="2-DOM文档对象模型"><a href="#2-DOM文档对象模型" class="headerlink" title="(2) DOM文档对象模型"></a>(2) DOM文档对象模型</h3><h4 id="1-概念"><a href="#1-概念" class="headerlink" title="[1] 概念"></a>[1] 概念</h4><p>文档对象模型是针对XML但经过扩展用于HTML的应用程序编程接口。数结构</p>
<h4 id="2-DOM级别"><a href="#2-DOM级别" class="headerlink" title="[2] DOM级别"></a>[2] DOM级别</h4><p>(0) DOM 0</p>
<p>当阅读与DOM有关的材料时，可能会遇到参考0级DOM的情况。需要注意的是并没有标准被称为0级DOM，它仅是DOM历史上一个参考点（0级DOM被认为是在Internet Explorer 4.0 与Netscape Navigator4.0支持的最早的DHTML）。</p>
<p>(1) DOM 1</p>
<p>映射文档结构为目标</p>
<p>DOM 1由两个模块组成：DOM核心（DOM Core）和 DOM HTML</p>
<ul>
<li><p>DOM Core: DOM核心规定的是如何映射基于XML的文档结构，以便简化对文档中任意部分的访问和操作。</p>
</li>
<li><p>DOM HTML: DOM核心的基础上加以扩展，添加了针对HTML的对象和方法。</p>
</li>
</ul>
<p>(2) DOM 2</p>
<ul>
<li>DOM Views (DOM视图)：定义了跟踪不同文档（例如：应用CSS之前和之后的文档）视图的接口；</li>
<li>DOM Events(DOM事件)：定义了事件和事件处理的接口</li>
<li>DOM Style (DOM样式)：定义了基于CSS为元素应用样式的接口；</li>
<li>DOM Traversal and Range (DOM遍历和范围)：定义了遍历和操作文档树的接口。</li>
</ul>
<p>(3) DOM 3</p>
<ul>
<li>引入了以统一方式加载和保存文档的方法——在DOM加载和保存（DOM Load and Save）模块中定义；</li>
<li>新增了验证文档的方法——在DOM验证（DOM Validation）模块定义。</li>
<li>DOM3级也对DOM核心进行了扩展，开始支持XML1.0规范，涉及XML Infoset、Xpath和 XML Base。</li>
</ul>
<p>(4) 其他DOM标准</p>
<p>除了DOM核心和DOM HTML接口之外，另外几种语言还发布只针对自己的DOM标准。下面列出的语言都是基于XML的，每种语言的DOM标准都添加了与特定语言相关的新方法和新接口</p>
<p>W3C:</p>
<ul>
<li>SVG (Scalable Vector Graphic, 可伸缩矢量图) 1.0</li>
<li>MathML (Mathematical Markup Language，数学标记语言) 1.0</li>
<li>SMIL (Synchronized Multimedia Integration Language, 同步多媒体集成语言)。</li>
</ul>
<p>Mozillas:</p>
<ul>
<li>XUL: (XML User Interface Language, XML用户界面语言)。</li>
</ul>
<h4 id="3-DOM支持"><a href="#3-DOM支持" class="headerlink" title="[3] DOM支持"></a>[3] DOM支持</h4><ul>
<li><p>Chrome 1+</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Dom: 1级 2级</span><br></pre></td></tr></table></figure>
</li>
<li><p>Firefox</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Dom: 1级 2级 3级</span><br></pre></td></tr></table></figure>
</li>
<li><p>ie2 ～ ie4.x</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DOM: -</span><br></pre></td></tr></table></figure>
</li>
<li><p>ie5</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DOM: 1级 （最小限度）</span><br></pre></td></tr></table></figure>
</li>
<li><p>ie5.5 ~ ie8</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DOM: 1级 （几乎全部）</span><br></pre></td></tr></table></figure>
</li>
<li><p>ie9+</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DOM: 1级 2级 3级</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="3-BOM浏览器对象模型"><a href="#3-BOM浏览器对象模型" class="headerlink" title="(3) BOM浏览器对象模型"></a>(3) BOM浏览器对象模型</h3><p>BOM(Browser Object Model)浏览器对象模型：</p>
<ul>
<li>HTML5之前没有标准，HTML5把很多BOM功能写入正式规范</li>
<li>从根上BOM只处理浏览器窗口和框架</li>
<li><p>但是习惯上对浏览器的的Javascript扩展算作BOM的一部分，包括</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt; 弹出新浏览器窗口的功能</span><br><span class="line"></span><br><span class="line">&gt; 移动、缩放和关闭浏览器窗口的功能</span><br><span class="line"></span><br><span class="line">&gt; 提供浏览器详细信息的navigator对象</span><br><span class="line"></span><br><span class="line">&gt; 提供浏览器所加载页面的详细信息的location对象</span><br><span class="line"></span><br><span class="line">&gt; 提供用户显示器分辨率详细信息的screen对象</span><br><span class="line"></span><br><span class="line">&gt; 对cookies的支持</span><br><span class="line"></span><br><span class="line">&gt; 像XMLHttpRequest 和 IE的 ActiveXObject这样的自定义对象</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="2-script"><a href="#2-script" class="headerlink" title="2.script"></a>2.script</h2><h3 id="1-script六个属性"><a href="#1-script六个属性" class="headerlink" title="(1) script六个属性"></a>(1) script六个属性</h3><h4 id="async（可选）"><a href="#async（可选）" class="headerlink" title="async（可选）"></a>async（可选）</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">立即下载，但不妨碍页面中的其他操作,比如下载其他资源或等待加载其他脚本 只对外部脚本文件有效。</span><br></pre></td></tr></table></figure>
<h4 id="charset（可选）"><a href="#charset（可选）" class="headerlink" title="charset（可选）"></a>charset（可选）</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">指定src属性的代码字符集，通常会被大多数浏览器忽略，可以用来解决乱码问题。</span><br></pre></td></tr></table></figure>
<h4 id="defer-（可选）"><a href="#defer-（可选）" class="headerlink" title="defer （可选）"></a>defer （可选）</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">表示脚本可以延迟到文档完全被解析显示之后再执行。只对外部脚本有效</span><br></pre></td></tr></table></figure>
<h4 id="language-（已弃用）"><a href="#language-（已弃用）" class="headerlink" title="language （已弃用）"></a>language （已弃用）</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">表示编写代码使用的脚本语言（如：Javascript、Javascript1.2或VBScript），已废弃。</span><br></pre></td></tr></table></figure>
<h4 id="src-（可选）"><a href="#src-（可选）" class="headerlink" title="src （可选）"></a>src （可选）</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">表示包含要执行代码的外部文件。</span><br></pre></td></tr></table></figure>
<h4 id="type-（可选）（不是必须默认值text-javascirpt）"><a href="#type-（可选）（不是必须默认值text-javascirpt）" class="headerlink" title="type （可选）（不是必须默认值text/javascirpt）"></a>type （可选）（不是必须默认值text/javascirpt）</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; 可以看作language的替代属性；表示编写代码使用的脚本语言的内容类型（也称为MIME类型）。</span><br><span class="line">&gt; text/javascirpt text/ecmascirpt都已经不被推荐使用。</span><br><span class="line"></span><br><span class="line">&gt; 实际上服务端传递javascirpt文件时使用的MIME类型通常是application/x-javascirpt，但是type设置该值可能会导致被忽略。</span><br><span class="line"></span><br><span class="line">&gt; 另外，在非ie下可以设置： application/javascript和application/ecmascript（不推荐）</span><br></pre></td></tr></table></figure>
<h3 id="2-使用标签的一些注意事项"><a href="#2-使用标签的一些注意事项" class="headerlink" title="(2) 使用标签的一些注意事项"></a>(2) 使用标签的一些注意事项</h3><h4 id="1-script闭标签"><a href="#1-script闭标签" class="headerlink" title="[1] script闭标签"></a>[1] script闭标签</h4><ul>
<li>不要在代码任何地方出现script闭标签</li>
<li><p>不要出现以下形式，某些浏览器（尤其是ie）的正确解析</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;example.js&quot; /&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-标签位置"><a href="#2-标签位置" class="headerlink" title="[2] 标签位置"></a>[2] 标签位置</h4><ul>
<li>body尾部</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这样在解析包含的javascirpt代码之前，页面内容将完全呈现在浏览器中。从而减少页面空白时间。</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--这里放内容--&gt;</span><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"example1.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span> <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"example2.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>需要在DOM加载解析之前执行的脚本</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这样意味着必须等到全部javascirpt下载、解析、执行完成以后，才能开始呈现页面内容（浏览器在遇到body标签菜开始呈现内容），会增加页面空白时间</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span>   <span class="tag">&lt;<span class="name">title</span>&gt;</span>Example HTML Page<span class="tag">&lt;/<span class="name">title</span>&gt;</span>   <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"example1.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>   <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"example2.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="3-延迟脚本（defer）"><a href="#3-延迟脚本（defer）" class="headerlink" title="(3) 延迟脚本（defer）"></a>(3) 延迟脚本（defer）</h3><p>html 4.01 script标签定义了defer属性。</p>
<ul>
<li>相当于告知浏览器立即下载，但延迟执行</li>
<li>脚本会被延迟到整个页面都解析完毕后再运行</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;Example HTML Page&lt;/title&gt;&lt;script type=&quot;text/javascript&quot; defer=&quot;defer&quot; src=&quot;example1.js&quot;&gt;&lt;/script&gt; &lt;script type=&quot;text/javascript&quot; defer=&quot;defer&quot; src=&quot;example2.js&quot;&gt;&lt;/script&gt;  &lt;/head&gt;  &lt;body&gt;</span><br><span class="line">  &lt;!-- 内容 --&gt; &lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>本例子中，虽然我们把script元素放在了文档的head元素中，但其中包含的脚本将延迟到浏览器解析html的闭标签后再执行。</p>
<ul>
<li><p>HTML5规范要求它们出现的执行顺序因此：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">example1.js会先于example2,并两者都会先于DOMContentLoaded事件</span><br><span class="line"></span><br><span class="line">但实际中，延迟脚本并不一定按顺序执行，也不一定在DOMContentLoaded事件前执行，因此最好只包含一个延迟脚本</span><br><span class="line"></span><br><span class="line">HTML5会忽略内部脚本使用defer,ie4-ie7支持内部脚本defer,但请尽量拥抱标准。</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="4-异步脚本（async）"><a href="#4-异步脚本（async）" class="headerlink" title="(4) 异步脚本（async）"></a>(4) 异步脚本（async）</h3><p>async的属性目的是不让页面等待脚本文件之前下载和执行，从而异步加载页面其他内容，建议异步脚本不要在加载期间修改DOM。</p>
<ul>
<li>与defer不同，标记为async的脚本不保证它们的先后顺序执行，因此两者互不依赖非常重要。</li>
<li>异步脚本一定会在页面的load事件前执行，但可能会在DOMContentLoaded事件触发之前或之后执行</li>
<li>支持异步浏览器firefox 3.6 chrome safari5。</li>
</ul>
<h3 id="5-嵌入脚本和外部脚本"><a href="#5-嵌入脚本和外部脚本" class="headerlink" title="(5) 嵌入脚本和外部脚本"></a>(5) 嵌入脚本和外部脚本</h3><p>一般建议使用外部脚本</p>
<p>优点如下：</p>
<ul>
<li>可维护性强</li>
<li>可缓存</li>
<li>适应未来</li>
</ul>
<h3 id="6-文档模式"><a href="#6-文档模式" class="headerlink" title="(6) 文档模式"></a>(6) 文档模式</h3><h4 id="1-混杂模式"><a href="#1-混杂模式" class="headerlink" title="(1)混杂模式"></a>(1)混杂模式</h4><ul>
<li>没有放入&lt;!doctype html&gt; （没有文档类型声明，则所有浏览器都会默认开启混杂模式）</li>
</ul>
<p>让IE行为与IE5相同</p>
<h4 id="2-标准模式"><a href="#2-标准模式" class="headerlink" title="(2)标准模式"></a>(2)标准模式</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HTML 4.01 严格型    --&gt;</span><span class="meta">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"&gt;</span><span class="comment">&lt;!-- XHTML 1.0 严格型    --&gt;</span><span class="meta">&lt;!DOCTYPE html PUBLIC"-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"&gt;</span><span class="comment">&lt;!-- HTML 5 --&gt;</span><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br></pre></td></tr></table></figure>
<p>使浏览器行为更接近标准行为</p>
<h4 id="3-准标准模式"><a href="#3-准标准模式" class="headerlink" title="(3)准标准模式"></a>(3)准标准模式</h4><ul>
<li>准表示模式，则可以通过使用过渡型（Transitional）或框架集型（Frameset）文档类型来触发</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HTML 4.01  过渡型   --&gt;</span><span class="meta">&lt;!DOCTYPE HTML PUBLIC"-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;</span>8   <span class="comment">&lt;!-- HTML 4.01 框架集型     --&gt;</span><span class="meta">&lt;!DOCTYPE HTML PUBLIC 9 "-//W3C//DTD HTML 4.01 Frameset//EN""http://www.w3.org/TR/html4/frameset.dtd"&gt;</span>  <span class="comment">&lt;!-- XHTML 1.0  过渡型    --&gt;</span><span class="meta">&lt;!DOCTYPE html PUBLIC"-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</span><span class="comment">&lt;!-- XHTML 1.0  框架集型    --&gt;</span><span class="meta">&lt;!DOCTYPE html PUBLIC"-//W3C//DTD XHTML 1.0 Frameset//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-frameset.dtd"&gt;</span></span><br></pre></td></tr></table></figure>
<p>准标准模式与标准模式非常接近，它们差异几乎可以忽略不计。</p>
<h3 id="7-noscript元素"><a href="#7-noscript元素" class="headerlink" title="(7) noscript元素"></a>(7) noscript元素</h3><p>noscirpt标签只有在下列情况会被显示出来：</p>
<ul>
<li>浏览器不支持脚本</li>
<li>浏览器支持脚本，但脚本被禁用</li>
</ul>
<p>作用：</p>
<ul>
<li>在不支持javascirpt的浏览器中显示替代的内容</li>
</ul>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://www.neohuang.com/child/2018/05/04/js-review-script/" data-id="cjlm3caop0009dqm7vofm5yxk" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            <!--
    
        <a href="http://www.neohuang.com/child/2018/05/04/js-review-script/#comments" class="article-comment-link">Comments</a>
    
-->
        </footer>
    </div>
    
</article>



    <nav id="page-nav">
        <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
</section>
            
                <aside id="sidebar">
   
        
    <div class="widget-wrap">
        <h3 class="widget-title">recent</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/09/03/hash-backListener/" class="thumbnail">
    
    
        <span style="background-image:url(/img/hash-back.jpeg)" alt="监听浏览器回退" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2018/09/03/hash-backListener/" class="title">监听浏览器回退</a></p>
                            <p class="item-date"><time datetime="2018-09-02T16:00:00.000Z" itemprop="datePublished">2018-09-03</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/08/22/position-sticky/" class="thumbnail">
    
    
        <span style="background-image:url(/img/position-sticky.jpeg)" alt="白话聊聊position sticky" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2018/08/22/position-sticky/" class="title">白话聊聊position sticky</a></p>
                            <p class="item-date"><time datetime="2018-08-21T16:00:00.000Z" itemprop="datePublished">2018-08-22</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/08/11/new-operators/" class="thumbnail">
    
    
        <span style="background-image:url(/img/new-op.jpg)" alt="白话说说new操作符的背后" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2018/08/11/new-operators/" class="title">白话说说new操作符的背后</a></p>
                            <p class="item-date"><time datetime="2018-08-10T16:00:00.000Z" itemprop="datePublished">2018-08-11</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/07/08/js-review-datatype/" class="thumbnail">
    
    
        <span style="background-image:url(/img/js-review-datetype.png)" alt="js复习基本概念（数据类型）" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2018/07/08/js-review-datatype/" class="title">js复习基本概念（数据类型）</a></p>
                            <p class="item-date"><time datetime="2018-07-07T16:00:00.000Z" itemprop="datePublished">2018-07-08</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/06/25/js-review-base-md/" class="thumbnail">
    
    
        <span style="background-image:url(/img/js-review-base.png)" alt="js复习基本概念（语法、严格模式）" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2018/06/25/js-review-base-md/" class="title">js复习基本概念（语法、严格模式）</a></p>
                            <p class="item-date"><time datetime="2018-06-24T16:00:00.000Z" itemprop="datePublished">2018-06-25</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

    
        
    
        
    <div class="widget-wrap">
        <h3 class="widget-title">archives</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a><span class="archive-list-count">1</span></li></ul>
        </div>
    </div>

    
        
    
        
    
        
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">links</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://blog.zhaiyifan.cn/">MarkZhai</a>
                    </li>
                
                    <li>
                        <a href="http://silverd.cn/">SilverdJiang</a>
                    </li>
                
                    <li>
                        <a href="http://yownyang.github.io">YownYang</a>
                    </li>
                
                    <li>
                        <a href="http://zhukejin.com">PrimoZhu</a>
                    </li>
                
                    <li>
                        <a href="http://wjerryzhen11.github.io">JerryXu</a>
                    </li>
                
                    <li>
                        <a href="http://yocann.cn">CnnyChen</a>
                    </li>
                
            </ul>
        </div>
    </div>


    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>
            
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2018 Neo<br>
            Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>
        </div>
    </div>
</footer>
        
    
    <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2131605"></script>




    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>